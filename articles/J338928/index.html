<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😼 🧔🏽 👩🏾‍🎨 パフォーマンスの検索、パート2：LinuxでのJavaのプロファイリング 👩🏻‍🤝‍👨🏿 🚕 👨🏼‍🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="火、水、他の人の働きを際限なく見ることができるという意見がありますが、他にも何かがあります！ Sasha goldshtn Goldsteinとパフォーマンスについて延々と話すことができると確信しています。 JPoint 2017の前にすでにSashaにインタビューしていましたが、その会話は特にBP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>パフォーマンスの検索、パート2：LinuxでのJavaのプロファイリング</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/338928/"> 火、水、他の人の働きを際限なく見ることができるという意見がありますが、他にも何かがあります！  Sasha <a href="https://habrahabr.ru/users/goldshtn/" class="user_link">goldshtn</a> Goldsteinとパフォーマンスについて延々と話すことができると確信しています。  JPoint 2017の前にすでにSashaに<a href="https://habrahabr.ru/company/jugru/blog/320620/">インタビューし</a>ていましたが、その会話は特にBPFについてのものであり、Sashaのレポートはそのためのものです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     今回は、パフォーマンスモニタリングとそのソリューションの基本的な問題をより深く掘り下げて調べることにしました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/59/cc/e8/59cce87023d03470935360.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> どこから始めるか </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>-前回、BPFについて詳細に話し、LinuxでのJavaパフォーマンスの監視の問題について簡単に説明しました。</b>  <b>今回は、特定のツールではなく、問題と解決策を見つけることに集中したいと思います。</b>  <b>最初の質問は、むしろ平凡なものですが、パフォーマンスに問題があることをどのように理解するのですか？</b>  <b>ユーザーが苦情を言っていない場合、私はそれについて考える必要がありますか？</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Sasha Goldstein：</b>ユーザーが文句を言ったときだけパフォーマンスについて考え始めると、彼らは長くあなたと一緒にいません。 多くの場合、パフォーマンスエンジニアリングはトラブルシューティングと危機モードです。 電話が鳴り、ライトが点滅し、システムがクラッシュし、キーボードがオンになります-パフォーマンスエンジニアの通常の勤務日。 実際には、彼らは危機の計画、設計、監視、および防止にほとんどの時間を費やしています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     まず、キャパシティプランニングは、予想されるシステム負荷とリソース使用の評価です。 スケーラビリティの設計は、ボトルネックを回避し、負荷を大幅に増加させるのに役立ちます。 計装と監視は、システム内で何が起こっているのかを理解し、盲目的に発掘しないようにするために不可欠です。 自動通知のインストールのおかげで、ユーザーが苦情を申し立てる前であっても、原則として発生する問題について確実に知ることができます。 そしてもちろん、孤立した危機があり、それはストレスの多い状況で解決されなければなりません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ツールは絶えず変化していますが、プロセス自体は変更されていないことに注意してください。 いくつかの具体例を挙げましょう。膝の上で一枚の紙でできる容量計画。  APMソリューション（New RelicやPlumbrなど）を使用して、エンドツーエンドの計測と監視を行い、ABとJMeterを使用して迅速な負荷テストなどを行うことができます。 詳細については、ライフサイクルとパフォーマンスの方法論に関する優れた情報源であるBrendan Greggの<a href="http://www.brendangregg.com/sysperfbook.html">著書Systems Performance</a>と、パフォーマンスレベルの設定とパフォーマンスの監視に関するトピックのGoogle <a href="https://landing.google.com/sre/book.html">のサイト信頼性エンジニアリング</a>をご覧ください。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>-問題があることを理解したとしましょう：どこから始めればいいですか？</b>  <b>多くの人（特に非プロのパフォーマンスエンジニア）はすぐにJMHを発見し、すべてを安全でない「ハッカーコンパイラ」に書き換える準備ができているように思えます。</b>  <b>その後、何が起こったかを見てください。</b>  <b>しかし、実際には、これから始めないほうがいいですか？</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Sasha Goldstein：</b>これはかなり一般的な方法です。コードを記述してプロファイラーの基本的なテストを実行するとき、コードを変更するかコンパイラーをハッキングすることで簡単に修正できるパフォーマンスの問題があります。 しかし、私の経験に基づいた製品では、これはそれほど頻繁には行われません。 多くの問題は、1つの環境のみに固有のものであり、ワークロードパターンの変更によって引き起こされるか、アプリケーションのコード外のボトルネックに関連付けられます。また、スマートハックによってソースコードレベルでマイクロベンドおよび改善できるのはごく一部です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     以下に、いくつか例を示します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> 数年前、Datadogは、PostgreSQLでデータベースの挿入と更新が50ミリ秒から800ミリ秒にジャンプしたときに問題に遭遇しました。 彼らはSSDでAWS EBSを使用しました。 それは何を与えましたか？ データベースを調整したり、アプリケーションコードを変更したりする代わりに、EBSスロットリングがすべての原因であることがわかりました。パフォーマンス制限の対象となるIOPSクォータを超える場合です。 </li><li> 最近、ガベージコレクションの遅延に関連するサーバーの応答時間の大幅なジャンプの問題を抱えたユーザーがいました。 ガベージコレクションが制御不能になったため、5秒以上かかったリクエストもありました（そして、それらは完全に偶然に見えました）。 システムを注意深く調べた結果、すべてがアプリケーションのメモリ割り当てまたはガベージコレクションの調整で正常であることがわかりました。 ワークロードのサイズの急増により、実際のメモリ使用量が増加し、スワッピングが発生しました。これは、ガベージコレクションの実装に完全に有害です（コレクタがアクティブオブジェクトをマークするためにメモリをポンピングおよびポンピングする必要がある場合、これは終わりです）。 </li><li> 数か月前、Sysdigはコンテナ分離の問題に直面していました。コンテナXに隣接しているため、コンテナYが実行するファイルシステム操作は非常に遅く、一方、両方のコンテナのメモリ使用量とプロセッサ負荷は非常に低かったです。 少し調査したところ、カーネルディレクトリキャッシュがコンテナXで過負荷になり、その後ハッシュテーブルの衝突が発生し、その結果、大幅な速度低下が発生することがわかりました。 繰り返しますが、アプリケーションコードまたはコンテナリソースの割り当てを変更しても、この問題は解決しません。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     多くの場合、アプリケーションレベルのハッキングなど、制御可能なものに集中する方がはるかに簡単であることを理解しています。 心理的には、これは理解可能であり、システムや環境に関する深い知識を必要とせず、何らかの理由で一部の文化では「よりクール」と見なされます。 しかし、そもそもこれに対処するのは間違っています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>-確かに、最初にアプリケーション/サービスが本番環境でどのように機能するかを確認する必要があります。</b>  <b>これにはどのツールをお勧めしますか？</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Sasha Goldstein：製品の</b>モニタリングとプロファイリングは、ツールとテクニックのセットです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     リソース（プロセッサ、メモリ、ディスク、ネットワーク）の使用と負荷特性（＃クエリ、エラー、クエリタイプ、＃データベースクエリ）に焦点を当てた、高レベルのパフォーマンスのメトリックから始めます。 操作およびランタイムごとにこのデータを取得するための標準ツールがあります。 たとえば、Linuxは通常、vmstat、iostat、sar、ifconfig、pidstatなどのツールを使用します。  JVMの場合、JMXベースのツールまたはjstatを使用します。 これらは、おそらく5秒または30秒間隔でデータベースに継続的に収集できるメトリックであり、飛躍を分析し、必要に応じて前の展開操作、リリース、ワールドイベント、またはワークロードの変更を相関させることができます。 多くの人が平均値のみの収集に集中することが重要です。 これらは優れていますが、定義上、測定対象の完全な分布を表すものではありません。 パーセンタイルを収集し、可能であればヒストグラムも収集することをお勧めします。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次のレベルは運用メトリックです。通常は、長期間にわたって継続的に収集または保存することはできません。 これらには、ガベージコレクションログ、ネットワーククエリ、データベースクエリ、クラスロードなどが含まれます。 これらのデータをどこかに保存した後に理解することは、収集するよりもはるかに難しい場合があります。 ただし、これにより、「データベースCPUの負荷が100％に増加したときにどのような種類の要求が機能したか」や「この要求の実行中のドライブのIOPSと応答時間はどうですか」などの質問をすることができます。 特に平均の形式の数字だけでは、この種の研究を行うことはできません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     そして最後に、「ハードコア」レベル：サーバーのSSH（またはツールのリモート起動）は、サービスの通常の運用中に保存できない内部メトリックをさらに収集します。 これらは、一般にプロファイラーと呼ばれるツールです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Javaプロダクションのプロファイリングには、多くのオーバーヘッドと遅延をもたらすだけでなく、うそをつくことのできる不気味なツールが多数あります。 エコシステムは20年前から存在しているという事実にもかかわらず、JVMアプリケーションのオーバーヘッドが低く、信頼性の高いプロファイリング手法はわずかしかありません。  Andrey Panginの<a href="https://github.com/jvm-profiling-tools/async-profiler">非同期</a> <a href="https://github.com/jvm-profiling-tools/honest-profiler">プロファイラーである</a> Richard Warburtonの<a href="https://github.com/jvm-profiling-tools/honest-profiler">Honest Profilerを</a>お勧めします。もちろん、私のお気に入りは<a href="https://perf.wiki.kernel.org/index.php/Main_Page">perf</a>です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ところで、多くのツールはプロセッサのプロファイリングに焦点を当てており、どのコード実行が高いCPU使用率を引き起こすかを理解しています。 これは素晴らしいことですが、多くの場合、これは問題ではありません。 メモリ割り当ての原因となるコード実行パスを表示できるツールが必要です（非同期プロファイラーでもこれができるようになりました）、ページエラーの欠落、キャッシュミス、ディスクアクセス、ネットワーク要求、データベースクエリ、その他のイベント。 この分野に私を惹きつけたのは、まさに作業環境を研究するための適切なパフォーマンスツールを見つけることの問題でした。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  LinuxのJavaプロファイリング </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>-Java / Linuxスタックの下では、測定の信頼性に多くの問題があると聞きました。</b>  <b>きっとあなたは何とかこれと戦うことができます。</b>  <b>これをどうやってやるの？</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Sasha Goldstein：</b>はい、これは悲しいです。 現在の状況は次のようになります。欠陥を見つけてアプリケーション/サービスの速度を理解するためにテストする必要がある膨大な数の異なる部品を備えた高速コンベヤーラインがあります。 すべての部分を完全にチェックすることはできないため、主な戦略は1秒間に1つの部分をチェックし、すべてが正常かどうかを確認することです。この「テープ」の上にある「小さなウィンドウ」でこれを行う必要があります。 いいですね。 しかし、調べてみると、コンベアベルトで現在何が起こっているかはわかりません。 コンベヤーが魔法の「セーフ」モードに入るまで待機し、その後はすべて見ることができます。 また、コンベアは近くにある間は「セーフ」モードに入ることができないため、多くの部品が表示されることはありません。 また、ウィンドウ内の欠陥を見つけるプロセスには5秒もかかるため、毎秒これを行うことは不可能です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この状態を中心に、JVMの世界には多くのプロファイラーが存在します。  YourKit、jstack、JProfiler、VisualVM-これらはすべて、CPUプロファイリングに対して同じアプローチを採用しています。スレッドサンプリングを安全な状態で使用します。 これは、文書化されたAPIを使用してすべてのJVMスレッドを一時停止し、スタックトレースを取得し、最もホットなメソッドとスタックでレポートするために収集することを意味します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     このようなプロセスの中断の問題は次のとおりです。スレッドはすぐには停止せず、ランタイムは安全な状態に達するまで待機します。 その結果、アプリケーションの偏った画像を取得し、異なるプロファイラーがまだ互いに同意しない場合があります！ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     各プロファイラーが同じワークロードで最もホットなメソッドについて独自の観点を持っている場合、それがどれほど悪いかを示す研究があります（Mitkovichら、「Javaプロファイラーの精度の評価」）。 さらに、複雑なSpring呼び出しスタックに1000個のスレッドがある場合、スタックトレースの収集に失敗することがよくあります。 おそらく1秒あたり10回以下です。 その結果、スタックデータは実際のワークロードとはさらに異なります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     このような問題を解決するのは簡単ではありませんが、投資する価値があります。製品の一部のワークロードは、上記のような「従来の」ツールを使用してプロファイルできません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      2つの個別のアプローチと1つのハイブリッドがあります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Richard Warburtonの<a href="https://github.com/jvm-profiling-tools/honest-profiler">Honest Profiler</a>は、ドキュメント化されていない内部API AsyncGetCallTraceを使用します。これは、単一スレッドのスタックトレースを返し、安全な状態への移行を必要とせず、シグナルハンドラを使用して呼び出されます。 もともとはOracle Developer Studioによって設計されました。 主なアプローチは、信号プロセッサをインストールし、設定された時間（100 Hzなど）の信号に登録することです。 次に、シグナルハンドラ内で現在動作しているスレッドのスタックトレースを取得する必要があります。 明らかに、特にシグナルハンドラのコンテキストでは、効率的なスタックスタックマージに関して困難なタスクがありますが、このアプローチはうまく機能します。  （このアプローチでは、商用ライセンスが必要なJFRを使用します） </li><li>  <a href="https://perf.wiki.kernel.org/index.php/Main_Page">Linux perf</a>は、スタックの豊富なサンプリングを提供できます（CPU命令だけでなく、ディスクアクセスやネットワーク要求などの他のイベントにも）。 問題は、Javaメソッドのアドレスをメソッドの名前に変換することです。これには、perfが読み取りおよび使用できるテキストファイル（perfマップ）を取得するためにJVMTIエージェントが必要です。  JITがフレームポインター抑制を使用する場合、スタックの再構築にも問題があります。 このアプローチはうまくいくかもしれませんが、準備はほとんど必要ありません。 ただし、その結果、JVMスレッドとJavaメソッドだけでなく、カーネルスタックやC ++スタックを含むすべてのスレッドのスタックトレースを取得できます。 </li><li>  Andrei Panginの<a href="https://github.com/jvm-profiling-tools/async-profiler">非同期プロファイラー</a>は2つのアプローチを組み合わせています。 一連のパフォーマンスパターンをインストールしますが、シグナルハンドラーを使用してAsyncGetStackTraceを呼び出し、Javaスタックを取得します。  2つのスタックを組み合わせると、ストリームで何が起こっているかを完全に把握でき、Javaメソッド名の解決やフレームポインターの抑制の問題を回避できます。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     これらのオプションはいずれも、精度、リソース消費、およびレポート頻度の点で、セーフポイントバイアスプロファイラーよりもはるかに優れています。 それらは複雑になる可能性がありますが、オーバーヘッドの少ないプロダクションの正確なプロファイリングは努力する価値があると思います。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> コンテナのプロファイリング 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>-環境といえば、すべてをコンテナに詰め込むのが流行になっていますが、ここに何か機能はありますか？</b>  <b>コンテナ化されたアプリケーションを使用する際に覚えておくべきことは何ですか？</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Sasha Goldstein：</b>コンテナには興味深い問題があり、多くのツールが完全に無視し、結果として完全に機能しなくなります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Linuxコンテナは、コントロールグループと名前空間という2つの主要なテクノロジーを中心に構築されていることを簡単に思い出してみましょう。 監視グループを使用すると、プロセスまたはプロセスのグループ（CPU時間の上限、メモリの制限、IOPSストレージなど）のリソースクォータを増やすことができます。 ネームスペースは、コンテナの分離を可能にします：マウントネームスペースは、各コンテナに独自のマウントポイント（実際には別のファイルシステム）を提供し、PIDネームスペース-独自のプロセス識別子、ネットワークネームスペースは各コンテナに独自のネットワークインターフェイスなどを提供します。 名前空間のため、多くのツールがコンテナ化されたJVMアプリケーションと適切に通信することは困難です（ただし、これらの問題の一部はJVMに固有のものではありません）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     特定の問題について議論する前に、JVMのツールのさまざまな種類の可観測性について簡単に説明した方が良いでしょう。 一部について聞いたことがない場合は、知識を更新してください。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="http://docs.oracle.com/javase/7/docs/technotes/tools/share/jps.html">jps</a>や<a href="http://docs.oracle.com/javase/7/docs/technotes/tools/share/jinfo.html">jinfo</a>などの基本的な<a href="http://docs.oracle.com/javase/7/docs/technotes/tools/share/jps.html">ツールは</a> 、既存のJVMプロセスとその構成に関する情報を提供します。 </li><li>  <a href="http://docs.oracle.com/javase/7/docs/technotes/tools/share/jstack.html">jstack</a>は、既存のJVMプロセスからスレッドダンプ（スタックトレース）を取得するために使用できます。 </li><li>  <a href="http://docs.oracle.com/javase/7/docs/technotes/tools/share/jmap.html">jmap-</a>既存のJVMプロセスのヘッドダンプまたはより単純なクラスヒストグラムを取得します。 </li><li>  <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/jcmd.html">jcmdは</a> 、以前のすべてのツールを置き換え、JVM接続インターフェースを介して既存のJVMプロセスにコマンドを送信するために使用されます。 これは、JVMプロセスとjcmdがデータを交換するために使用するUNIXドメインソケットに基づいています。 </li><li>  <a href="http://docs.oracle.com/javase/7/docs/technotes/tools/share/jstat.html">jstat-</a>クラスのロード、JITコンパイル、ガベージコレクション統計などの基本的なJVMパフォーマンス情報を監視するため。 バイナリ形式のこのデータを使用して/ tmp / hsperfdata_ $ UID / $ PIDファイルを生成するJVMに基づいています。 </li><li>  <a href="http://openjdk.java.net/groups/hotspot/docs/Serviceability.html">Serviceability Agent</a>は、JVMプロセス、スレッド、スタックなどのメモリをチェックするためのインターフェースを提供し、ライブプロセスだけでなくメモリダンプとともに使用できます。 プロセスメモリと内部データ構造を読み取ることで機能します。 </li><li>  <a href="http://www.oracle.com/technetwork/articles/java/javamanagement-140525.html">JMX</a> （管理対象Bean）を使用して、既存のプロセスからパフォーマンス情報を受信したり、コマンドを送信してその動作を制御したりできます。 </li><li>  <a href="https://docs.oracle.com/javase/8/docs/platform/jvmti/jvmti.html">JVMTI</a>エージェントは、クラスのロード、メソッドのコンパイル、スレッドの開始/停止、競合の監視など、さまざまな興味深いJVMイベントに参加できます。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ホストからコンテナをプロファイリングおよび監視する際に発生するいくつかの問題と、それらを解決する方法を次に示します（今後、これについて詳しく説明します）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> ほとんどのツールでは、オブジェクトと値を検索するためにプロセスバイナリにアクセスする必要があります。 これらはすべてコンテナのマウント名前空間にあり、ホストからはアクセスできません。 一部には、このアクセスは、コンテナーからのバインドマウントによって、またはシンボル解決中にプロファイラーでコンテナーのマウント名前空間を入力することによって提供できます（これは、 <a href="https://habrahabr.ru/company/jugru/blog/320620/">以前のインタビューで</a>説明したperfおよびBCCツール<a href="https://habrahabr.ru/company/jugru/blog/320620/">が現在行うことです</a> ）。 </li><li>  perfマップを生成するJVMTIエージェント（perf-map-agentなど）がある場合、コンテナプロセスID（/tmp/perf-1.mapなど）を使用して/ tmpコンテナリポジトリに書き込まれます。 マップファイルはホストからアクセス可能でなければならず、ホストはファイル名に正しいプロセスIDを待つ必要があります。  （繰り返しますが、perfとBCCはこれを自動的に行うことができます）。 </li><li>  JVM接続インターフェース（jcmd、jinfo、jstack、およびその他のツールが依存する）には、正しいPIDおよびマウント名前空間接続ファイル、およびJVMとの通信に使用されるドメインのUNIXソケットが必要です。 この情報は、jattachユーティリティを使用してアタッチファイルを作成し、コンテナのネームスペースを入力するか、ホスト上の対応するディレクトリをバインドマウントしてスクロールできます。 </li><li>  jstatが使用するJVMパフォーマンスデータファイル（/ tmp / hsperfdata_ $ UID / $ PID）を使用するには、コンテナー名前空間をマウントするためのアクセスが必要です。 これは、ホスト上の/ tmpコンテナをバインドマウントすることで簡単に対処できます。 </li><li>  JMXベースのツールを使用する最も簡単な方法は、おそらくリモートの場合と同様にJVMにアクセスすることです。リモート診断の場合と同様に、RMIエンドポイントを構成します。 </li><li>  Serviceability Agentツールには、JVMプロセスとホスト間で正確なバージョンの一致が必要です。 特に異なるディストリビューションを使用し、異なるバージョンのJVMがホストにインストールされている場合は、ホストで実行しないでください。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ここであなたは思うかもしれません：パフォーマンスツールをコンテナに入れて、これらのすべての分離問題が私のために発生しないようにしたらどうでしょうか？ 考え方は悪くありませんが、多くのツールはseccompのためにこの構成では動作しません。 たとえば、Dockerはperf_event_openシステムコールを拒否します。これは、perfおよびasync-profilerを使用したプロファイリングに必要です。 また、JVMプロセス内のメモリ量を読み取るために多数のツールで使用されるptraceシステムコールも拒否します。 これらのシステムコールを受け入れるようにseccompポリシーを変更すると、ホストが危険にさらされます。 また、コンテナにプロファイリングツールを配置することにより、その攻撃対象領域を増やします。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <hr>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     会話を続け、プロファイリングに対する鉄の影響について話し合いたいと思いました... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/59/cd/05/59cd056a55cfa255608997.jpeg"></div>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sashaはまもなくサンクトペテルブルクに来て<a href="https://jokerconf.com/2017/trainings/68vqefxcugkwc0wsk6gic/">、実稼働環境でのJVMアプリケーションのプロファイリング</a>に関する<a href="https://jokerconf.com/2017/trainings/68vqefxcugkwc0wsk6gic/">トレーニング</a>を実施し、 <a href="https://jokerconf.com/">Joker 2017</a>カンファレンスで<a href="https://jokerconf.com/2017/talks/4xupwfvjh6w8oksi4gu0i2/">BPFについてプレゼンテーションを行い</a>ます。したがって、トピックの詳細を知りたい場合は、Sashaに直接会う機会があります。 </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J338918/index.html">実際、CRMシステムとは何ですか？</a></li>
<li><a href="../J338920/index.html">9月30日にサンクトペテルブルクで開催されるDevFest North</a></li>
<li><a href="../J338922/index.html">System Verilogでの混合回路のモデリング</a></li>
<li><a href="../J338924/index.html">Kotlin、パズル、2 Kekses：Kotlinの動作を知っていますか？</a></li>
<li><a href="../J338926/index.html">コンピュータービジョン。 Intel Expert Answers</a></li>
<li><a href="../J338930/index.html">ボンネットの下のV8</a></li>
<li><a href="../J338934/index.html">プロトタイプ不正行為ASOプロモーション</a></li>
<li><a href="../J338938/index.html">古典的な2Dクエスト、または2年間の開発の経緯。 パート2</a></li>
<li><a href="../J338940/index.html">WeChatの解析-世界で2番目に人気のあるメッセンジャー</a></li>
<li><a href="../J338942/index.html">新しい教育形態としてのマイクロマスターの学位。 プログラムの最初のパイロットの簡単な概要</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
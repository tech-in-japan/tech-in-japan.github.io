<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👩‍👦‍👦 🏴󠁧󠁢󠁷󠁬󠁳󠁿 🧑 O（1）追加メモリを使用した外部ソート 👨‍❤️‍💋‍👨 🆚 🏨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事を読んだ後、O（1）外部メモリを使用した外部ソートを書いたことを思い出しました。 関数は、バイナリファイルと、配列に割り当てることができる最大メモリサイズを受け取りました。 
  
 
  
 

void ext_sort(const std::string filename, const...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>O（1）追加メモリを使用した外部ソート</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/268535/">  <a href="http://habrahabr.ru/post/266557/">この記事を</a>読んだ後、O（1）外部メモリを使用した外部ソートを書いたことを思い出しました。 関数は、バイナリファイルと、配列に割り当てることができる最大メモリサイズを受け取りました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ext_sort</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> memory)</span></span></span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="https://scholar.google.co.il/scholar%3Fcluster%3D7995905689817415486%26hl%3Dru%26as_sdt%3D0,5">追加のディスク領域なしで外部ソートの効果的なパフォーマンス</a>のアルゴリズムを使用しました： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li> ファイルを使用可能なメモリに収まるブロックに分割します。 これらのブロックBlock_1、Block_2、...、Block_（S-1）、Block_Sを示します。  P = 1に設定します。 </li><li>  Block_Pをメモリに読み込みます。 </li><li> メモリ内のデータをソートし、Block_Pに書き戻します。  P = P + 1に設定し、P≤Sの場合、Block_Pをメモリに読み込み、この手順を繰り返します。 つまり、ファイルの各ブロックを並べ替えます。 </li><li> 各ブロックを小さなブロックB_1とB_2に分割します。 これらの各ブロックは、使用可能なメモリの半分を占有します。 </li><li> 利用可能なメモリの前半でブロックBlock_1のブロックB_1を読み取ります。  Q = 2に設定します。 </li><li> 利用可能なメモリの後半にあるBlock_QブロックのブロックB_1を読み取ります。 </li><li> インプレースマージを使用してメモリ内の配列を結合し、メモリの後半をBlock_QブロックのブロックB_1に書き込み、Q≤Sの場合、Q = Q + 1に設定し、Block_QブロックのブロックB_1を使用可能なメモリの後半に読み取り、この手順を繰り返します。 </li><li> 利用可能なメモリの前半をブロックBlock_1のブロックB_1に書き込みます。 常にメモリ内の要素の半分未満を残し、すべてのブロックとマージするため、ファイル全体のM個の最小要素がメモリのこの部分に格納されます。 </li><li>  Block_SブロックのブロックB_2を使用可能なメモリの後半に読み込みます。  Q = S −1と設定します。 </li><li> 利用可能なメモリの前半のBlock_QブロックのブロックB_2を読み取ります。 </li><li> インプレースマージを使用してメモリ内の配列を結合し、使用可能なメモリの前半をBlock_QのブロックB_2に書き込み、Q = Q -1に設定します。  Q≥1の場合、使用可能なメモリの前半のBlock_QブロックのブロックB_2を読み取り、この手順を繰り返します。 </li><li> 利用可能なメモリの後半をBlock_SブロックのブロックB_2に書き込みます。 手順8と同様に、ファイル全体の最大要素がここに保存されます。 </li><li>  Block_1のブロックB_2からBlock_SのブロックB_1まで、ファイルに新しいブロックを定義し、Block_1からBlock_Sに再び番号を付けます。 各ブロックをブロックB_1とB_2に分割します。  P = 1に設定します。 </li><li>  Block_PブロックのB_1とB_2をメモリに読み込みます。 メモリ内の配列を結合します。 ソートされた配列をBlock_Pに書き込み、P = P +1に設定します。  P≤Sの場合、この手順を繰り返します。 </li><li>  S&gt; 1の場合、ステップ5に戻ります。M個の最小要素と最大要素を選択するたびに、それぞれファイルの先頭と末尾に書き込み、ファイルの中央に到達するまで残りの要素で同じことを行います。 </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     このアルゴリズムの利点は、ディスク上にバッファがないことに加えて、比較的大きな部分でディスクからデータを読み取るため、アルゴリズムが高速化されることです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      C ++でアルゴリズムを実装します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     まず、ブロック数とブロックサイズをバイト単位と要素単位で決定し、メモリを割り当てます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> type_size = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(T); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> filesize = file_size(filename); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-function">fstream </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::ios::in | </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::ios::out | </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::ios::binary)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> chunk_number = filesize / memory; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> chunk_size = memory / type_size - (memory / type_size) % <span class="hljs-number"><span class="hljs-number">2</span></span>, chunk_byte_size = chunk_size * type_size, half_chunk_byte_size = chunk_byte_size / <span class="hljs-number"><span class="hljs-number">2</span></span>, half_chunk_size = chunk_size / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;T&gt; *chunk = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;T&gt;(chunk_size);</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次にポイント2〜3-各ブロックをソートします。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; chunk_number; ++i) { data.seekg(chunk_byte_size * i); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), chunk_byte_size); flat_quick_sort(chunk-&gt;begin(), chunk-&gt;end()); data.seekp(chunk_byte_size * i); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), chunk_byte_size); }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ソートは少し後で記述します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     合併に進みます。 下半分： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span> s = chunk_number, start = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (s &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { data.seekp(half_chunk_byte_size * start); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), half_chunk_byte_size); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span> q = <span class="hljs-number"><span class="hljs-number">1</span></span>; q &lt; s; ++q) { data.seekg(half_chunk_byte_size * start + chunk_byte_size * q); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) (chunk-&gt;data() + half_chunk_size), half_chunk_byte_size); in_place_merge(chunk-&gt;begin(), chunk-&gt;begin() + half_chunk_size - <span class="hljs-number"><span class="hljs-number">1</span></span>, chunk-&gt;begin() + chunk_size); data.seekp(half_chunk_byte_size * start + chunk_byte_size * q); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) (chunk-&gt;data() + half_chunk_size), half_chunk_byte_size); } data.seekp(half_chunk_byte_size * start); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), half_chunk_byte_size);</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     そして同様にトップ： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"> data.seekp(half_chunk_byte_size * start + chunk_byte_size * s - half_chunk_byte_size); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) (chunk-&gt;data() + half_chunk_size), half_chunk_byte_size); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span> q = s - <span class="hljs-number"><span class="hljs-number">2</span></span>; q &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; --q) { data.seekg(half_chunk_byte_size * (start + <span class="hljs-number"><span class="hljs-number">1</span></span>) + chunk_byte_size * q); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), half_chunk_byte_size); in_place_merge(chunk-&gt;begin(), chunk-&gt;begin() + half_chunk_size - <span class="hljs-number"><span class="hljs-number">1</span></span>, chunk-&gt;begin() + chunk_size); data.seekp(half_chunk_byte_size * (start + <span class="hljs-number"><span class="hljs-number">1</span></span>) + chunk_byte_size * q); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), half_chunk_byte_size); } data.seekg(half_chunk_byte_size * start + chunk_byte_size * s - half_chunk_byte_size); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) (chunk-&gt;data() + half_chunk_size), half_chunk_byte_size);</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ブロックを再配布し、サイクルを終了し、メモリを解放することを忘れないでください。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"> --s; ++start; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span> p = <span class="hljs-number"><span class="hljs-number">0</span></span>; p &lt; s; ++p) { data.seekp(half_chunk_byte_size * start + chunk_byte_size * p); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), chunk_byte_size); in_place_merge(chunk-&gt;begin(), chunk-&gt;begin() + half_chunk_size - <span class="hljs-number"><span class="hljs-number">1</span></span>, chunk-&gt;begin() + chunk_size); data.seekg(half_chunk_byte_size * start + chunk_byte_size * p); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), chunk_byte_size); } } <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> chunk; }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">全機能</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ext_sort</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> memory)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> type_size = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(T); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> filesize = file_size(filename); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-function">fstream </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::ios::in | </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::ios::out | </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::ios::binary)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> chunk_number = filesize / memory; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> chunk_size = memory / type_size - (memory / type_size) % <span class="hljs-number"><span class="hljs-number">2</span></span>, chunk_byte_size = chunk_size * type_size, half_chunk_byte_size = chunk_byte_size / <span class="hljs-number"><span class="hljs-number">2</span></span>, half_chunk_size = chunk_size / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;T&gt; *chunk = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;T&gt;(chunk_size); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; chunk_number; ++i) { data.seekg(chunk_byte_size * i); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), chunk_byte_size); flat_quick_sort(chunk-&gt;begin(), chunk-&gt;end()); data.seekp(chunk_byte_size * i); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), chunk_byte_size); } <span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span> s = chunk_number, start = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (s &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { data.seekp(half_chunk_byte_size * start); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), half_chunk_byte_size); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span> q = <span class="hljs-number"><span class="hljs-number">1</span></span>; q &lt; s; ++q) { data.seekg(half_chunk_byte_size * start + chunk_byte_size * q); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) (chunk-&gt;data() + half_chunk_size), half_chunk_byte_size); in_place_merge(chunk-&gt;begin(), chunk-&gt;begin() + half_chunk_size - <span class="hljs-number"><span class="hljs-number">1</span></span>, chunk-&gt;begin() + chunk_size); data.seekp(half_chunk_byte_size * start + chunk_byte_size * q); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) (chunk-&gt;data() + half_chunk_size), half_chunk_byte_size); } data.seekp(half_chunk_byte_size * start); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), half_chunk_byte_size); data.seekp(half_chunk_byte_size * start + chunk_byte_size * s - half_chunk_byte_size); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) (chunk-&gt;data() + half_chunk_size), half_chunk_byte_size); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span> q = s - <span class="hljs-number"><span class="hljs-number">2</span></span>; q &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; --q) { data.seekg(half_chunk_byte_size * (start + <span class="hljs-number"><span class="hljs-number">1</span></span>) + chunk_byte_size * q); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), half_chunk_byte_size); in_place_merge(chunk-&gt;begin(), chunk-&gt;begin() + half_chunk_size - <span class="hljs-number"><span class="hljs-number">1</span></span>, chunk-&gt;begin() + chunk_size); data.seekp(half_chunk_byte_size * (start + <span class="hljs-number"><span class="hljs-number">1</span></span>) + chunk_byte_size * q); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), half_chunk_byte_size); } data.seekg(half_chunk_byte_size * start + chunk_byte_size * s - half_chunk_byte_size); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) (chunk-&gt;data() + half_chunk_size), half_chunk_byte_size); --s; ++start; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span> p = <span class="hljs-number"><span class="hljs-number">0</span></span>; p &lt; s; ++p) { data.seekp(half_chunk_byte_size * start + chunk_byte_size * p); data.read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), chunk_byte_size); in_place_merge(chunk-&gt;begin(), chunk-&gt;begin() + half_chunk_size - <span class="hljs-number"><span class="hljs-number">1</span></span>, chunk-&gt;begin() + chunk_size); data.seekg(half_chunk_byte_size * start + chunk_byte_size * p); data.write((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) chunk-&gt;data(), chunk_byte_size); } } <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> chunk; }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     関数flat_quick_sortおよびin_place_mergeの実装は残ります。  ripatti <a href="http://habrahabr.ru/users/ripatti/" class="user_link">habraiserの</a> <a href="http://habrahabr.ru/post/247053/">記事</a>で、フラットクイックソートのアイデア（およびほとんどの実装）を取り上げ<a href="http://habrahabr.ru/users/ripatti/" class="user_link">ました</a> 。 中央値の中央値（平均的なケースでは過剰と見なされます）を中央値9に置き換え、配列の小さな部分に挿入を使用した並べ替えを追加しました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">flat_quicksort.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> EXTERNAL_SORT_FLAT_QUICKSORT_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EXTERNAL_SORT_FLAT_QUICKSORT_H template</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;class ForwIt&gt; void insertion_sort(ForwIt be, ForwIt en) { for (ForwIt ii = be + 1; ii != en; ii++) { ForwIt jj = ii - 1; auto val = *ii; while (jj &gt;= be and *jj &gt; val) { *(jj + 1) = *jj; --jj; } *(jj + 1) = val; } } template&lt;class ForwIt&gt; ForwIt median_of_3(ForwIt it1, ForwIt it2, ForwIt it3) { return (*it1 &gt; *it2) ? (*it3 &gt; *it2) ? (*it1 &gt; *it3) ? it3 : it1 : it2 : (*it3 &gt; *it1) ? (*it2 &gt; *it3) ? it3 : it2 : it1; } template&lt;class ForwIt&gt; ForwIt choose_pivot(ForwIt be, ForwIt en) { ptrdiff_t s = (en - be) / 8; ForwIt mid = be + (en - be) / 2; ForwIt best1 = median_of_3(be, be + s, be + 2 * s), best2 = median_of_3(mid - s, mid, mid + s), best3 = median_of_3( en - 2 * s, en - s, en); return median_of_3(best1, best2, best3); } // search for the end of the current block template&lt;class ForwIt&gt; ForwIt block_range(ForwIt be, ForwIt en) { ForwIt it = be; while (it != en) { if (*be &lt; *it) return it; ++it; } return it; } // warning: after the partition outer pivot may point to random element template&lt;class ForwIt&gt; std::pair&lt;ForwIt, ForwIt&gt; partition_range(ForwIt be, ForwIt en, ForwIt pivot) { std::pair&lt;ForwIt, ForwIt&gt; re; ForwIt j = be; for (ForwIt i = be; i != en; ++i) if (*i &lt; *pivot) { if (pivot == i) pivot = j; else if (pivot == j) pivot = i; std::swap(*j, *i); ++j; } re.first = j; for (ForwIt i = j; i != en; ++i) if (*pivot == *i) { if (pivot == i) pivot = j; else if (pivot == j) pivot = i; std::swap(*j, *i); ++j; } re.second = j; return re; } // makes largest element the first template&lt;class ForwIt&gt; void blockify(ForwIt be, ForwIt en) { for (ForwIt it = be; it != en; ++it) if (*be &lt; *it) std::swap(*be, *it); } template&lt;class ForwIt&gt; void flat_quick_sort(ForwIt be, ForwIt en) { ForwIt tmp = en; // the current end of block while (be != en) { if (std::is_sorted(be, tmp)) { be = tmp; tmp = block_range(be, en); continue; } if (tmp - be &lt; 32) insertion_sort(be, tmp); else { ForwIt pivot = choose_pivot(be, tmp); std::pair&lt;ForwIt, ForwIt&gt; range = partition_range(be, tmp, pivot); blockify(range.second, tmp); tmp = range.first; } } } #endif //EXTERNAL_SORT_FLAT_QUICKSORT_H</span></span></span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     マージはより困難でした。 まず、O（n）メモリを使用してスタブを使用しました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">merge</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;T&gt; &amp;chunk, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> q, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;T&gt; *chunk2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;T&gt;(q - s + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> it2 = chunk2-&gt;begin(), it1 = chunk.begin() + q + <span class="hljs-number"><span class="hljs-number">1</span></span>, it = chunk.begin() + s; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::copy(it, it1, it2); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (it2 != chunk2-&gt;end() &amp;&amp; it1 != chunk.begin() + r + <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*it1 &gt; *it2) { *it = *it2; ++it2; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { *it = *it1; ++it1; } ++it; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (it1 == chunk.begin() + r + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::copy(it2, chunk2-&gt;end(), it); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::copy(it1, chunk.begin() + r + <span class="hljs-number"><span class="hljs-number">1</span></span>, it); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> chunk2; }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     スタブをインプレースバージョンに置き換えたいと思ったとき、高速インプレースマージアルゴリズムはほとんど紛らわしいことがわかりました（たとえば、 <a href="https://scholar.google.com/scholar%3Fcluster%3D15596289922936727341%26hl%3Dru%26as_sdt%3D0,5">オンプレースおよび最適インプレースマージを</a>参照）。 もっとシンプルなものが必要だったので<a href="https://scholar.google.co.il/scholar%3Fcluster%3D8489305296842245618%26hl%3Dru">、インプレースマージ用のシンプルなアルゴリズム</a>の記事からアルゴリズムを選択<a href="https://scholar.google.co.il/scholar%3Fcluster%3D8489305296842245618%26hl%3Dru">しました</a> 。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">インプレースマージ</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Iter&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">merge_B_and_Y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iter z, Iter y, Iter yn)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; z &lt; y &amp;&amp; y &lt; yn; ++z) { Iter j = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::min_element(z, y); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*j &lt;= *y) <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::swap(*z, *j); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::swap(*z, *y); ++y; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z &lt; y) flat_quick_sort(z, yn); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Iter&gt; <span class="hljs-function"><span class="hljs-function">Iter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_next_X_block</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iter x0, Iter z, Iter y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> k, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f, Iter b1, Iter b2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">auto</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> min1 = max, min2 = max; Iter m = x0 + (<span class="hljs-keyword"><span class="hljs-keyword">ptrdiff_t</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>((z - x0 - f) / k) * k + f, x = x0; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m &lt;= z) m += k; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> i = m; i + k &lt;= y; i += k) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i != b1 &amp;&amp; i != b2) { Iter j = (i &lt; b1 &amp;&amp; b1 &lt; i + k) ? m - <span class="hljs-number"><span class="hljs-number">1</span></span> : i + k - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*i &lt;= min1 &amp;&amp; *j &lt;= min2) { x = i; min1 = *i; min2 = *j; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x; } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Iter&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in_place_merge</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iter x0, Iter y0, Iter yn, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> k, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rec)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k == <span class="hljs-number"><span class="hljs-number">-1</span></span>) k = (<span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(yn - x0); <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> f = (y0 - x0) % k; Iter x = (f == <span class="hljs-number"><span class="hljs-number">0</span></span>) ? y0 - <span class="hljs-number"><span class="hljs-number">2</span></span> * k : y0 - k - f; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> t = *x, max = *<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::max_element(x0, yn); *x = *x0; Iter z = x0, y = y0, b1 = x + <span class="hljs-number"><span class="hljs-number">1</span></span>, b2 = y0 - k; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (y - z &gt; <span class="hljs-number"><span class="hljs-number">2</span></span> * k) { ++i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*x &lt;= *y || y &gt;= yn) { *z = *x; *x = *b1; ++x; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((x - x0) % k == f) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z &lt; x - k) b2 = x - k; x = find_next_X_block(x0, z, y, k, f, b1, b2, max); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { *z = *y; *y = *b1; ++y; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((y - y0) % k == <span class="hljs-number"><span class="hljs-number">0</span></span>) b2 = y - k; } ++z; *b1 = *z; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z == x) x = b1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z == b2) b2 = yn + <span class="hljs-number"><span class="hljs-number">1</span></span>; ++b1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b1 - x0) % k == f) b1 = (b2 == yn + <span class="hljs-number"><span class="hljs-number">1</span></span>) ? b1 - k : b2; } *z = t; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rec) merge_B_and_Y(z, y, yn); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { flat_quick_sort(z, y); in_place_merge(z,y,yn,(<span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span>)<span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(k),<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     しかし、私のコンピューターでは、マージをインプレースマージに置き換えると、アルゴリズムがほぼ1桁遅くなりました。 実装を間違えたか、単純さを追求して遅いアルゴリズムを選択しただけかもしれません。 いつものように、それを整理する時間がありませんでした。さらに、gprofが何らかの形で落ちました。 そして、それは私に夜明けをもたらしました。  Mバイトの動的メモリを割り当てる場合、どのように使用しても問題ありませんが、O（1）が得られます。 次に、データに2/3を選択し、マージバッファに3番目を選択します。 スローダウンはずっと少なくなります。 そして真実は： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <table><tbody><tr><th> アルゴリズム </th><th> 時間（7.5MBのメモリで75MB int64） </th><th> 速度（7.5MBのメモリで75MB int64） </th><th> 時間（75KBのメモリに7.5MB int64） </th><th> 速度（75KBのメモリで7.5MB int64） </th><th> 時間（75MBのメモリで750MB int64） </th><th> 速度（75MBのメモリで750MB int64） </th></tr><tr><td> インプレースマージ </td><td>  6.04329秒 </td><td>  1,241,045 B / s </td><td>  24.2993秒 </td><td>  3 086 508 B / s </td><td>  - </td><td>  - </td></tr><tr><td> マージ </td><td>  0.932663秒 </td><td>  8 041 489 B / s </td><td>  2.73895秒 </td><td>  27382756 B / s </td><td>  47.7946秒 </td><td>  15 691 689 B / s </td></tr><tr><td> アルゴリズム<a href="http://habrahabr.ru/users/sly_g/" class="user_link">SLY_G</a> </td><td>  1.79629秒 </td><td>  4175272 B / s </td><td>  3.84775秒 </td><td>  19 491 910 B / s </td><td>  39.77秒 </td><td>  18858436 B / s </td></tr></tbody></table> 残念ながら、大容量の場合、バッファがまったく使用されないため、アルゴリズムの速度が低下します。 それでも、アルゴリズムの速度は非常に適切であり、改善できると確信しています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     すべてのソースは<a href="https://github.com/Randl/CS/tree/master/External%2520sort">こちら</a>です。 </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J26852/index.html">Appleの新しいJavaScriptエンジン</a></li>
<li><a href="../J268523/index.html">Coremodule 920でGPIOを構成する</a></li>
<li><a href="../J268529/index.html">LinuxでのDOSアプリケーションの実行</a></li>
<li><a href="../J26853/index.html">Microsoft Managed Extensibility Framework</a></li>
<li><a href="../J268531/index.html">tkinterを使用したPythonグラフィックプログラムの作成</a></li>
<li><a href="../J268539/index.html">= ^ ._。^ =</a></li>
<li><a href="../J26854/index.html">CakePHP 1.2 RC1がリリースされました</a></li>
<li><a href="../J268541/index.html">結婚せずに接続するためのOnLime</a></li>
<li><a href="../J268547/index.html">仮想サーバー上のさまざまなタイプのディスクの管理</a></li>
<li><a href="../J26855/index.html">ユーザーコミュニティによるオンライン記事の語句の重要性のランク付け</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏻 😢 📑 別の仮想インターフェイス 🤥 🐶 🌿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="前のメモで、追加の仮想ネットワークインターフェイスを作成するためのLinuxカーネルモジュールのコードスケッチを示しました。 これは実際のプロジェクトからの単純化された断片であり、失敗や苦情なしに数年間機能したため、さらなる改善、修正、開発のテンプレートとして役立つ可能性があります。 
  
 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>別の仮想インターフェイス</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/270517/">  <a href="http://habrahabr.ru/company/ua-hosting/blog/269987/">前のメモ</a>で、追加の仮想ネットワークインターフェイスを作成するためのLinuxカーネルモジュールのコードスケッチを示しました。 これは<b>実際のプロジェクトからの</b>単純化された断片<b>であり、</b>失敗や苦情なしに数年間機能したため、さらなる改善、修正、開発のテンプレートとして役立つ可能性があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     しかし、この実装へのアプローチは、第一に、それだけではなく、第二に、状況によっては受け入れられない場合があります（たとえば、netdev_rx_handler_register（）がまだ呼び出されていない2.6.36よりも若いカーネルを備えた組み込みシステム）。 以下では、同じ機能を備えた代替案を検討しますが、TCP / IPネットワークスタックのまったく異なる層に実装します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1> ネットワーク層プロトコル </h1>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     繰り返しないように、TCP / IPネットワークスタックのレベル（レイヤー）はOSI / ISOオープンソースシステム相互作用モデルの7つのレベル（または、より正直に言うと、学界の中心に近いOSIモデル）に明確に対応していないと書かれています不適切に進化しているTCP / IPネットワーク）。  <a href="http://habrahabr.ru/company/ua-hosting/blog/269987/">前述の実装</a>の仮想インターフェイスの作成は、 <b>インターフェイス</b>レベル（L2、レベル2-OSIチャネルレベルにほぼ対応）で実行されました。 現在の実装では、 <b>ネットワーク</b>層（L3）の機能を使用しています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ネットワークレベルのツールに関して、現在のタスクに必要なものよりもわずかに広いボリュームで、さらなる拡張の可能性のために、一定の最小値を考慮することが適切と思われます。 ネットワークレベルでは、ネットワークプロトコルのスタック（TCP / IPだけでなく、他のすべてのプロトコルファミリがここでサポートされていますが、今日ではほとんど関係がないようです）、IP / IPv4 / IPv6、IPX、IGMP、RIPなどのプロトコルの<b>処理</b> 、 OSPF、ARP、または元のユーザープロトコルの<b>追加</b> 。 ネットワークレベルのハンドラーをインストールするには、ネットワークレベルのAPI（&lt;linux / netdevice.h&gt;）が提供されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packet_type</span></span></span></span> { __be16 <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* This is really htons(ether_type). */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">net_device</span></span></span></span> *dev; <span class="hljs-comment"><span class="hljs-comment">/* NULL is wildcarded here */</span></span> int (*func) (<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sk_buff</span></span></span></span>*, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">net_device</span></span></span></span>*, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packet_type</span></span></span></span>*, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">net_device</span></span></span></span>*); ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list_head</span></span></span></span> list; }; <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> void dev_add_pack( <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packet_type</span></span></span></span> *pt ); <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> void dev_remove_pack( <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packet_type</span></span></span></span> *pt );</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     実際、カーネルのプロトコルモジュールでは、インターフェイスの<b>入力</b>ストリームからソケットバッファーが通過<b>するフィルター</b>を<b>追加する</b>必要があります（前の実装で示したように、出力ストリームはより簡単に実装されます）。  dev_add_pack（）関数は、func（）関数によって実装される、指定されたタイプのパッケージに別の新しいハンドラーを追加します。 この関数<b>は、</b>既存のハンドラー（Linuxネットワークシステムのデフォルトハンドラーを含む）を<b>追加しますが、置き換えません</b> 。 処理のために、この関数は、struct packet_type構造体に規定された基準を満たすソケットバッファーを選択（取得）します（プロトコルタイプおよびネットワークインターフェイスdevのタイプに応じて）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>注：</b>同じ方法（フィルター機能の設定）で、ネットワークスタックのより高い<b>トランスポート</b>レベルで新しいプロトコルが追加されます（たとえば、UDP、TCP、SCTPプロトコルが処理されます）。 すべてのより高いレベル（OSIモデルのレベルとほぼ同じ）は、カーネルでは表現されず、BSDソケットプログラミング技術によってユーザー空間で提供されます。 しかし、これらの高レベルの詳細はすべて本文では考慮されなくなります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     新しいプロトコル（独自仕様）を<b>追加する</b>場合は、そのタイプを再定義する必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs swift">#define <span class="hljs-type"><span class="hljs-type">PROTO_ID</span></span> <span class="hljs-number"><span class="hljs-number">0x1234</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packet_type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test_proto</span></span></span><span class="hljs-class"> = </span></span>{ __constant_htons( <span class="hljs-type"><span class="hljs-type">PROT_ID</span></span> ), ... }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     問題は、標準のIPスタックがそのようなプロトコルを認識していないことであり、すべての処理を処理する必要があります。 しかし、私たちの目標は、一部のパケット<b>の</b>処理を<b>再定義すること</b>だけです。そのため、定数ETH_P_ALLを使用し、すべてのプロトコルがフィルターを通過することを示します（devフィールドがNULLの場合、すべてのネットワークインターフェイスを通過する必要があります）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     比較と具体化のために、多数のプロトコル識別子（イーサネットプロトコルID）が&lt;linux / if_ether.h&gt;にあります。以下に例を示します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ETH_P_LOOP 0x0060 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Ethernet Loopback packet */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ETH_P_IP 0x0800 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Internet Protocol packet */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ETH_P_ARP 0x0806 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Address Resolution packet */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ETH_P_PAE 0x888E </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Port Access Entity (IEEE 802.1X) */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ETH_P_ALL 0x0003 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Every packet (be careful!!!) */</span></span></span><span class="hljs-meta"> ...</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この場合、タイプフィールドはプログラムコードの抽象的な数値ではありません。バイナリ形式のこの値は、配信環境に物理的に送信されるフレームのイーサネットヘッダーに入力されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ethhdr</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> h_dest[ETH_ALEN]; <span class="hljs-comment"><span class="hljs-comment">/* destination eth addr */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> h_source[ETH_ALEN]; <span class="hljs-comment"><span class="hljs-comment">/* source ether addr */</span></span> __be16 h_proto; <span class="hljs-comment"><span class="hljs-comment">/* packet type ID field */</span></span> } __attribute__((packed));</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      （モジュールのstruct packet_type構造体に入力するとき、コードに同じ説明が必要です）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     フィルター関数自体（funcフィールド）は、おそらく最も簡単な形式ではまだ記述していませんが、次のようなものです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs rust">int test_pack_rcv( <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sk_buff</span></span></span></span> *skb, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">net_device</span></span></span></span> *dev, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packet_type</span></span></span></span> *pt, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">net_device</span></span></span></span> *odev ) { LOG( <span class="hljs-string"><span class="hljs-string">"packet received with length: %u\n"</span></span>, skb-&gt;len ); kfree_skb( skb ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> skb-&gt;len; };</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ここでは、主にkfree_skb（）の呼び出しが<b>必須である</b>ため、関数が示されています。 送信チャネルのdev_kfree_skb（）の意味で一見近いとは異なり、ソケットバッファを<b>破壊せず</b> 、その使用カウンタ（usersフィールド）を減少させるだけです。 追加の各プロトコルフィルターがdev_add_pack（）を呼び出して設定されると、このソケットバッファーフィールドがインクリメントされます。 複数のネットワークレベルのフィルターを（同じもの、または複数のロード可能なモジュールに）インストールでき、インストールの逆の順序で機能しますが、それぞれがkfree_skb（）を実行する必要があります。 そうしないと、ネットワークスタックでゆっくりですが安定したメモリリークが発生するため、システムクラッシュのような結果は、数時間の連続操作後にのみ検出されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     これは非常に興味深い場所であり、明らかではありません。そのため、kfree_skb（）（file net / core / skbuff.c）の実装のソースコードを注意散漫にして見るのが理にかなっています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs rust">void kfree_skb(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sk_buff</span></span></span></span> *skb) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (unlikely(!skb)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (likely(atomic_read(&amp;skb-&gt;users) == <span class="hljs-number"><span class="hljs-number">1</span></span>)) smp_rmb(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (likely(!atomic_dec_and_test(&amp;skb-&gt;users))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; trace_kfree_skb(skb, __builtin_return_address(<span class="hljs-number"><span class="hljs-number">0</span></span>)); __kfree_skb(skb); }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      kfree_skb（）を呼び出すと、skb-&gt; users == 1の場合にのみ実際にソケットバッファーが解放され、他のすべての値では、skb-&gt; users（使用量カウンター）だけが減少します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     これで、仮想インターフェイスの操作を整理するのに十分な詳細が得られましたが、今回はIPスタックのネットワーク層を使用しています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1> 仮想インターフェースモジュール </h1>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://habrahabr.ru/company/ua-hosting/blog/269987/">以前の</a>ように進みます：モジュールの2つのバージョンを作成します-ネットワークインターフェース（virt0） <b>が</b>親ネットワークインターフェースに<b>置き換わる</b> virtl.koの簡易バージョンと、ネットワークプロトコルフレーム（ARPおよびIP4）を分析し、そのトラフィックのみに影響するvirt.koのフルバージョンこれはそのインターフェースに関連しています。 違いは、簡略化されたモジュールのロード中、親インターフェースが一時的に動作を停止することです（virtl.koモジュールがアンロードされるまで）。フルバージョンをロードする場合、両方のインターフェースが並行して独立して動作できます。 完全なモジュールのコードは明らかに面倒ですが、原則を理解するために何も追加しません。 次に、原則を示す簡略版を詳細に検討しますが、後になってから完全版に最低限触れます（そのコードとテストレポートはサンプルアーカイブに記載されています）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">これはかなり長いコードです</b> <div class="spoiler_text"><pre> <code class="hljs erlang-repl">#include &lt;linux/module.h&gt; #include &lt;linux/version.h&gt; #include &lt;linux/netdevice.h&gt; #include &lt;linux/etherdevice.h&gt; #include &lt;linux/inetdevice.h&gt; #include &lt;linux/moduleparam.h&gt; #include &lt;net/arp.h&gt; #include &lt;linux/ip.h&gt; #define ERR(...) printk( KERN_ERR <span class="hljs-string"><span class="hljs-string">"! "</span></span>__VA_ARGS__ ) #define LOG(...) printk( KERN_INFO <span class="hljs-string"><span class="hljs-string">"! "</span></span>__VA_ARGS__ ) #define DBG(...) if( debug != <span class="hljs-number"><span class="hljs-number">0</span></span> ) printk( KERN_INFO <span class="hljs-string"><span class="hljs-string">"! "</span></span>__VA_ARGS__ ) static char* link = <span class="hljs-string"><span class="hljs-string">"eth0"</span></span>; module_param( link, charp, <span class="hljs-number"><span class="hljs-number">0</span></span> ); static char* ifname = <span class="hljs-string"><span class="hljs-string">"virt"</span></span>; module_param( ifname, charp, <span class="hljs-number"><span class="hljs-number">0</span></span> ); static int debug = <span class="hljs-number"><span class="hljs-number">0</span></span>; module_param( debug, int, <span class="hljs-number"><span class="hljs-number">0</span></span> ); static struct net_device *child = NULL; static struct net_device_stats stats; //     static u32 child_ip; struct priv { struct net_device *parent; }; static char* strIP( u32 addr ) { //  IP    static char saddr[ MAX_ADDR_LEN ]; sprintf( saddr, <span class="hljs-string"><span class="hljs-string">"%d.%d.%d.%d"</span></span>, ( addr ) &amp; <span class="hljs-number"><span class="hljs-number">0</span></span>xFF, ( addr &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> ) &amp; <span class="hljs-number"><span class="hljs-number">0</span></span>xFF, ( addr &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span> ) &amp; <span class="hljs-number"><span class="hljs-number">0</span></span>xFF, ( addr &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ) &amp; <span class="hljs-number"><span class="hljs-number">0</span></span>xFF ); return saddr; } static int open( struct net_device *dev ) { struct in_device *in_dev = dev-&gt;ip_ptr; struct in_ifaddr *ifa = in_dev-&gt;ifa_list; /* IP ifaddr chain */ LOG( <span class="hljs-string"><span class="hljs-string">"%s: device opened"</span></span>, dev-&gt;name ); child_ip = ifa-&gt;ifa_address; netif_start_queue( dev ); if( debug != <span class="hljs-number"><span class="hljs-number">0</span></span> ) { char sdebg[ <span class="hljs-number"><span class="hljs-number">40</span></span> ] = <span class="hljs-string"><span class="hljs-string">""</span></span>; sprintf( sdebg, <span class="hljs-string"><span class="hljs-string">"%s:"</span></span>, strIP( ifa-&gt;ifa_address ) ); strcat( sdebg, strIP( ifa-&gt;ifa_mask ) ); DBG( <span class="hljs-string"><span class="hljs-string">"%s: %s"</span></span>, dev-&gt;name, sdebg ); } return <span class="hljs-number"><span class="hljs-number">0</span></span>; } static int stop( struct net_device *dev ) { LOG( <span class="hljs-string"><span class="hljs-string">"%s: device closed"</span></span>, dev-&gt;name ); netif_stop_queue( dev ); return <span class="hljs-number"><span class="hljs-number">0</span></span>; } static struct net_device_stats *get_stats( struct net_device *dev ) { return &amp;stats; } //   static netdev_tx_t start_xmit( struct sk_buff *skb, struct net_device *dev ) { struct priv *priv = netdev_priv( dev ); stats.tx_packets++; stats.tx_bytes += skb-&gt;len; skb-&gt;dev = priv-&gt;parent; //    ()  skb-&gt;priority = <span class="hljs-number"><span class="hljs-number">1</span></span>; dev_queue_xmit( skb ); DBG( <span class="hljs-string"><span class="hljs-string">"tx: injecting frame from %s to %s with length: %u"</span></span>, dev-&gt;name, skb-&gt;dev-&gt;name, skb-&gt;len ); return <span class="hljs-number"><span class="hljs-number">0</span></span>; return NETDEV_TX_OK; } static struct net_device_ops net_device_ops = { .ndo_open = open, .ndo_stop = stop, .ndo_get_stats = get_stats, .ndo_start_xmit = start_xmit, }; //   int pack_parent( struct sk_buff *skb, struct net_device *dev, struct packet_type *pt, struct net_device *odev ) { skb-&gt;dev = child; //      stats.rx_packets++; stats.rx_bytes += skb-&gt;len; DBG( <span class="hljs-string"><span class="hljs-string">"tx: injecting frame from %s to %s with length: %u"</span></span>, dev-&gt;name, skb-&gt;dev-&gt;name, skb-&gt;len ); kfree_skb( skb ); return skb-&gt;len; }; static struct packet_type proto_parent = { __constant_htons( ETH_P_ALL ), //   : ETH_P_ARP &amp; ETH_P_IP NULL, pack_parent, (void*)<span class="hljs-number"><span class="hljs-number">1</span></span>, NULL }; int __init init( void ) { void setup( struct net_device *dev ) { //   ( GCC) int j; ether_setup( dev ); memset( netdev_priv( dev ), <span class="hljs-number"><span class="hljs-number">0</span></span>, sizeof( struct priv ) ); dev-&gt;netdev_ops = &amp;net_device_ops; for( j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; ETH_ALEN; ++j ) //  MAC   dev-&gt;dev_addr[ j ] = (char)j; } int err = <span class="hljs-number"><span class="hljs-number">0</span></span>; struct priv *priv; char ifstr[ <span class="hljs-number"><span class="hljs-number">40</span></span> ]; sprintf( ifstr, <span class="hljs-string"><span class="hljs-string">"%s%s"</span></span>, ifname, <span class="hljs-string"><span class="hljs-string">"%d"</span></span> ); #if (LINUX_VERSION_CODE &lt; KERNEL_VERSION(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) child = alloc_netdev( sizeof( struct priv ), ifstr, setup ); #else child = alloc_netdev( sizeof( struct priv ), ifstr, NET_NAME_UNKNOWN, setup ); #endif if( child == NULL ) { ERR( <span class="hljs-string"><span class="hljs-string">"%s: allocate error"</span></span>, THIS_MODULE-&gt;name ); return -ENOMEM; } priv = netdev_priv( child ); priv-&gt;parent = dev_get_by_name( &amp;init_net, link ); //   if( !priv-&gt;parent ) { ERR( <span class="hljs-string"><span class="hljs-string">"%s: no such net: %s"</span></span>, THIS_MODULE-&gt;name, link ); err = -ENODEV; goto err; } if( priv-&gt;parent-&gt;type != ARPHRD_ETHER &amp;&amp; priv-&gt;parent-&gt;type != ARPHRD_LOOPBACK ) { ERR( <span class="hljs-string"><span class="hljs-string">"%s: illegal net type"</span></span>, THIS_MODULE-&gt;name ); err = -EINVAL; goto err; } memcpy( child-&gt;dev_addr, priv-&gt;parent-&gt;dev_addr, ETH_ALEN ); memcpy( child-&gt;broadcast, priv-&gt;parent-&gt;broadcast, ETH_ALEN ); if( ( err = dev_alloc_name( child, child-&gt;name ) ) ) { ERR( <span class="hljs-string"><span class="hljs-string">"%s: allocate name, error %i"</span></span>, THIS_MODULE-&gt;name, err ); err = -EIO; goto err; } register_netdev( child ); //    proto_parent.dev = priv-&gt;parent; dev_add_pack( &amp;proto_parent ); //      LOG( <span class="hljs-string"><span class="hljs-string">"module %s loaded"</span></span>, THIS_MODULE-&gt;name ); LOG( <span class="hljs-string"><span class="hljs-string">"%s: create link %s"</span></span>, THIS_MODULE-&gt;name, child-&gt;name ); return <span class="hljs-number"><span class="hljs-number">0</span></span>; err: free_netdev( child ); return err; } void __exit virt_exit( void ) { struct priv *priv= netdev_priv( child ); dev_remove_pack( &amp;proto_parent ); //    unregister_netdev( child ); dev_put( priv-&gt;parent ); free_netdev( child ); LOG( <span class="hljs-string"><span class="hljs-string">"module %s unloaded"</span></span>, THIS_MODULE-&gt;name ); LOG( <span class="hljs-string"><span class="hljs-string">"============================================="</span></span> ); } module_init( init ); module_exit( virt_exit ); MODULE_AUTHOR( <span class="hljs-string"><span class="hljs-string">"Oleg Tsiliuric"</span></span> ); MODULE_LICENSE( <span class="hljs-string"><span class="hljs-string">"GPL v2"</span></span> ); MODULE_VERSION( <span class="hljs-string"><span class="hljs-string">"3.7"</span></span> );</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     すべてが非常に透明です： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> 新しいネットワークインターフェイス（virt0）を登録した後、dev_add_pack（）を呼び出します。これにより、親インターフェイスのパケットフィルターが設定されます。 </li><li>  devフィールドはpacket_type構造体で親インターフェースポインターに事前設定されています。このインターフェースからのみ、構造体で定義されたpack_parent（）関数によって着信トラフィックがインターセプトされます。 </li><li> この関数は、インターフェイスの統計情報をキャプチャし、最も重要なこととして、親インターフェイスポインタをソケットバッファ内の仮想インターフェイスポインタに置き換えます。 </li><li>  （仮想から物理への）逆置換は、フレーム送信関数start_xmit（）で発生します。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     仕組みは次のとおりです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> テストしたコンピューターで、モジュールをロードし、別の新しいサブネットで構成します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="dos hljs">$ ip address ... <span class="hljs-number"><span class="hljs-number">2</span></span>: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="hljs-number"><span class="hljs-number">1500</span></span> qdisc pfifo_fast state UP qlen <span class="hljs-number"><span class="hljs-number">1000</span></span> link/ether <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:b9:e0 brd ff:ff:ff:ff:ff:ff inet <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">21</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> brd <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">255</span></span> scope global eth0 inet6 fe80::a00:<span class="hljs-number"><span class="hljs-number">27</span></span>ff:fe52:b9e0/<span class="hljs-number"><span class="hljs-number">64</span></span> scope link valid_lft forever preferred_lft forever <span class="hljs-number"><span class="hljs-number">3</span></span>: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="hljs-number"><span class="hljs-number">1500</span></span> qdisc pfifo_fast state UP qlen <span class="hljs-number"><span class="hljs-number">1000</span></span> link/ether <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>f:<span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>d brd ff:ff:ff:ff:ff:ff inet <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">56</span></span>.<span class="hljs-number"><span class="hljs-number">102</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> brd <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">56</span></span>.<span class="hljs-number"><span class="hljs-number">255</span></span> scope global eth1 inet6 fe80::a00:<span class="hljs-number"><span class="hljs-number">27</span></span>ff:fe0f:<span class="hljs-number"><span class="hljs-number">136</span></span>d/<span class="hljs-number"><span class="hljs-number">64</span></span> scope link valid_lft forever preferred_lft forever $ sudo insmod virt.ko link=eth1 debug=<span class="hljs-number"><span class="hljs-number">1</span></span> $ sudo ifconfig virt0 <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> $ sudo ifconfig virt0 virt0 Link encap:Ethernet HWaddr <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>f:<span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>d inet addr:<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> Bcast:<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">255</span></span> Mask:<span class="hljs-number"><span class="hljs-number">255</span></span>.<span class="hljs-number"><span class="hljs-number">255</span></span>.<span class="hljs-number"><span class="hljs-number">255</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> inet6 addr: fe80::a00:<span class="hljs-number"><span class="hljs-number">27</span></span>ff:fe0f:<span class="hljs-number"><span class="hljs-number">136</span></span>d/<span class="hljs-number"><span class="hljs-number">64</span></span> Scope:Link UP BROADCAST RUNNING MULTICAST MTU:<span class="hljs-number"><span class="hljs-number">1500</span></span> Metric:<span class="hljs-number"><span class="hljs-number">1</span></span> RX packets:<span class="hljs-number"><span class="hljs-number">0</span></span> errors:<span class="hljs-number"><span class="hljs-number">0</span></span> dropped:<span class="hljs-number"><span class="hljs-number">0</span></span> overruns:<span class="hljs-number"><span class="hljs-number">0</span></span> frame:<span class="hljs-number"><span class="hljs-number">0</span></span> TX packets:<span class="hljs-number"><span class="hljs-number">46</span></span> errors:<span class="hljs-number"><span class="hljs-number">0</span></span> dropped:<span class="hljs-number"><span class="hljs-number">0</span></span> overruns:<span class="hljs-number"><span class="hljs-number">0</span></span> carrier:<span class="hljs-number"><span class="hljs-number">0</span></span> collisions:<span class="hljs-number"><span class="hljs-number">0</span></span> txqueuelen:<span class="hljs-number"><span class="hljs-number">1000</span></span> RX bytes:<span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> B) TX bytes:<span class="hljs-number"><span class="hljs-number">8373</span></span> (<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> KiB)</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      （これは、インターフェースで受信したゼロバイトの統計を示しています）。 </li><li> テスト対象のコンピューターで、新しいサブネット（192.168.50.0/24）のエイリアスIPを作成し、作成したインターフェイスへのトラフィックを実行できます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="dos hljs">$ sudo ifconfig vboxnet0:<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> $ <span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PING</span></span> <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> (<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span>) <span class="hljs-number"><span class="hljs-number">56</span></span>(<span class="hljs-number"><span class="hljs-number">84</span></span>) bytes of data. <span class="hljs-number"><span class="hljs-number">64</span></span> bytes from <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span>: icmp_req=<span class="hljs-number"><span class="hljs-number">1</span></span> ttl=<span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">627</span></span> ms <span class="hljs-number"><span class="hljs-number">64</span></span> bytes from <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span>: icmp_req=<span class="hljs-number"><span class="hljs-number">2</span></span> ttl=<span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">305</span></span> ms <span class="hljs-number"><span class="hljs-number">64</span></span> bytes from <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span>: icmp_req=<span class="hljs-number"><span class="hljs-number">3</span></span> ttl=<span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">326</span></span> ms ^C --- <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> statistics --- <span class="hljs-number"><span class="hljs-number">3</span></span> packets transmitted, <span class="hljs-number"><span class="hljs-number">3</span></span> received, <span class="hljs-number"><span class="hljs-number">0</span></span>% packet loss, <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> <span class="hljs-number"><span class="hljs-number">2000</span></span>ms rtt min/avg/max/mdev = <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">305</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">419</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">627</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">148</span></span> ms</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre></li><li> 同じ（テスト）コンピューター（戻り側）で、tcpdumpによって修正されたトラフィックを（別の端末で）観察することは非常に有益です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="dos hljs">$ sudo tcpdump -i vboxnet0 tcpdump: verbose output suppressed, use -v or -vv <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> full protocol decode listening on vboxnet0, link-<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> EN10MB (Ethernet), capture size <span class="hljs-number"><span class="hljs-number">65535</span></span> bytes ... <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>.<span class="hljs-number"><span class="hljs-number">740607</span></span> ARP, Request who-has <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> tell <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>, length <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>.<span class="hljs-number"><span class="hljs-number">741104</span></span> ARP, Reply <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> is-<span class="hljs-built_in"><span class="hljs-built_in">at</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>f:<span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>d (oui Unknown), length <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>.<span class="hljs-number"><span class="hljs-number">741116</span></span> IP <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span>: ICMP <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> request, id <span class="hljs-number"><span class="hljs-number">8402</span></span>, seq <span class="hljs-number"><span class="hljs-number">1</span></span>, length <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>.<span class="hljs-number"><span class="hljs-number">741211</span></span> IP <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> &gt; <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>: ICMP <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> reply, id <span class="hljs-number"><span class="hljs-number">8402</span></span>, seq <span class="hljs-number"><span class="hljs-number">1</span></span>, length <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>.<span class="hljs-number"><span class="hljs-number">741164</span></span> IP <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span>: ICMP <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> request, id <span class="hljs-number"><span class="hljs-number">8402</span></span>, seq <span class="hljs-number"><span class="hljs-number">2</span></span>, length <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>.<span class="hljs-number"><span class="hljs-number">741451</span></span> IP <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> &gt; <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>: ICMP <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> reply, id <span class="hljs-number"><span class="hljs-number">8402</span></span>, seq <span class="hljs-number"><span class="hljs-number">2</span></span>, length <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">03</span></span>.<span class="hljs-number"><span class="hljs-number">741163</span></span> IP <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span>: ICMP <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> request, id <span class="hljs-number"><span class="hljs-number">8402</span></span>, seq <span class="hljs-number"><span class="hljs-number">3</span></span>, length <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">03</span></span>.<span class="hljs-number"><span class="hljs-number">741471</span></span> IP <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> &gt; <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>: ICMP <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> reply, id <span class="hljs-number"><span class="hljs-number">8402</span></span>, seq <span class="hljs-number"><span class="hljs-number">3</span></span>, length <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>.<span class="hljs-number"><span class="hljs-number">747701</span></span> ARP, Request who-has <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> tell <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span>, length <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>.<span class="hljs-number"><span class="hljs-number">747715</span></span> ARP, Reply <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> is-<span class="hljs-built_in"><span class="hljs-built_in">at</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>a:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> (oui Unknown), length <span class="hljs-number"><span class="hljs-number">28</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre></li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1> 機会の拡大 </h1>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     簡潔に、簡単に言えば、独自のトラフィックでのみ動作し、親インターフェイスの動作を中断しない本格的な仮想インターフェイスを作成する方法について（モジュールのフルバージョンがアーカイブで行うこと）。 これを行うには、以下を行う必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b>2つの別個の</b>プロトコルハンドラーを宣言します（ARP名前解決プロトコルとIPプロトコル自体用）： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs julia">//   ETH_P_ARP int arp_pack_rcv( <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> sk_buff *skb, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> net_device *dev, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> packet_type *pt, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> net_device *odev ) { ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> skb-&gt;len; }; static <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> packet_type arp_proto = { __constant_htons( ETH_P_ARP ), NULL, arp_pack_rcv, //   ETH_P_ARP (void*)<span class="hljs-number"><span class="hljs-number">1</span></span>, NULL }; //   ETH_P_IP int ip4_pack_rcv( <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> sk_buff *skb, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> net_device *dev, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> packet_type *pt, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> net_device *odev ) { ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> skb-&gt;len; }; static <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> packet_type ip4_proto = { __constant_htons( ETH_P_IP ), NULL, ip4_pack_rcv, //   ETH_P_IP (void*)<span class="hljs-number"><span class="hljs-number">1</span></span>, NULL };</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre></li><li> どちらもモジュール初期化関数に順番に登録されます： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs rust"> arp_proto.dev = ip4_proto.dev = <span class="hljs-keyword"><span class="hljs-keyword">priv</span></span>-&gt;parent; <span class="hljs-comment"><span class="hljs-comment">//      dev_add_pack( &amp;arp_proto ); dev_add_pack( &amp;ip4_proto );</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li> インストールされた各フィルターは、受信者IPがインターフェイスのIPと一致するフレームに対してのみインターフェイス<b>スプーフィング</b>を実行する必要があります... </li><li>  2つの別個のハンドラーは、ARPフレームとIPフレームのヘッダーの形式がまったく異なるため、宛先IPを異なる方法で割り当てる必要があるという点で便利です（すべてのコードはアーカイブの例に示されています）。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     このようなフルウェイトモジュールを使用すると、たとえば、異なるインターフェイス上で（異なるIPを使用して）2つの並列SSHセッションを開くことができ、実際には単一の共通物理インターフェイスを並列に使用します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="dos hljs">$ ssh olej@<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span> olej@<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>'s password: Last login: Mon Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">2012</span></span> from <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">9</span></span> ... $ ssh olej@<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">56</span></span>.<span class="hljs-number"><span class="hljs-number">101</span></span> olej@<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">56</span></span>.<span class="hljs-number"><span class="hljs-number">101</span></span>'s password: Last login: Mon Jul <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">2012</span></span> from <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> ... $ who olej tty1 <span class="hljs-number"><span class="hljs-number">2012</span></span>-<span class="hljs-number"><span class="hljs-number">07</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> (:<span class="hljs-number"><span class="hljs-number">0</span></span>) olej pts/<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2012</span></span>-<span class="hljs-number"><span class="hljs-number">07</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> (:<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) ... olej pts/<span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">2012</span></span>-<span class="hljs-number"><span class="hljs-number">07</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span> (<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>) olej pts/<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">2012</span></span>-<span class="hljs-number"><span class="hljs-number">07</span></span>-<span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span> (<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">56</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>)</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     示されている最後のコマンド（誰）は、SSHセッションで、つまり2つの異なるサブネットからの2 <b>つの独立した</b>接続が固定されている（出力の最後の2行）、実際には1つのホストを表していますが、その観点からは、SSHセッションで既に実行されていますさまざまなネットワークインターフェイス。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1> さらなる洗練 </h1>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     サンプルモジュールの準備とデバッグでは、詳細を明確にするために、この（かなり最近の）本が積極的に使用されました。RamiRosen：「Linux Kernel Networking：Implementation and Theory」、Apress、650ページ、2014年、ISBN-13：978-1-4302 -6196-4。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/464/de9/dbc/464de9dbc696d2420a2055ef38fdb81f.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     著者は、本が発売される前に無料でダウンロードできるように親切に提供しました（2013-12-22）。  <a href="http://www.foxebook.net/linux-kernel-networking-implementation-and-theory/">このページから</a>ダウンロードでき<a href="http://www.foxebook.net/linux-kernel-networking-implementation-and-theory/">ます</a> 。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この記事で説明したような問題に興味がある人は、自分のネットワークインターフェイスを使用する技術をさらに発展させるために、この出版物で多くのアイデアを見つけることができます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="https://yadi.sk/d/TUnvim3EkLgco">ここ</a>か<a href="https://drive.google.com/file/d/0B__cqmYoRw_6UU1NVWJZNXdHV3c/view%3Fusp%3Dsharing">ここ</a>で実験とさらなる開発のためにテキストで言及されたコードのアーカイブを取ることができ<a href="https://drive.google.com/file/d/0B__cqmYoRw_6UU1NVWJZNXdHV3c/view%3Fusp%3Dsharing">ます</a> 。 </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J2705/index.html">ブラウザ呼び出し用のGizmo Callプラグイン</a></li>
<li><a href="../J270501/index.html">非常に短い紹介</a></li>
<li><a href="../J270505/index.html">実現までの時間：競技会終了までの5日間</a></li>
<li><a href="../J270509/index.html">GDG DevFest Voronezh 2015：イベントの写真とビデオのレポート</a></li>
<li><a href="../J270515/index.html">ビッグデータは退屈ですか？</a></li>
<li><a href="../J27052/index.html">症状と戦わないで、その原因を探してください</a></li>
<li><a href="../J270521/index.html">Docker 1.9 + Weave 1.2.1ブリッジモード</a></li>
<li><a href="../J270523/index.html">理論と実践におけるコロケーション</a></li>
<li><a href="../J270527/index.html">Firebird 3.0の公式リリース候補1およびFirebird 3.0のベータドキュメント</a></li>
<li><a href="../J270537/index.html">具体的に干渉することなく、専門教育を受けずにアンドロイド開発者になった方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎛️ 🕤 🏂🏿 ActiveMerchantにMoney Onlineを統合する 🧙🏼 🖕🏽 👚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ruby on Railsで開発しているアプリケーションでは、支払いシステムを接続する必要がありました。 顧客はMoney Onlineと契約を結びました。もちろん、私が最初にしたことは、Shopify ActiveMerchantでサポートされているシステムのリストを確認することでした -このサー...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>ActiveMerchantにMoney Onlineを統合する</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body">  Ruby on Railsで開発しているアプリケーションでは、支払いシステムを接続する必要がありました。 顧客は<a href="http://dengionline.com/">Money Online</a>と契約を結びました。もちろん、私が最初にしたことは、Shopify <a href="https://github.com/Shopify/active_merchant">ActiveMerchant</a>でサポートされているシステムのリストを確認すること<a href="https://github.com/Shopify/active_merchant">でした</a> -このサービスは存在しませんでしたが、統合を簡素化できる既製のソリューションも探しましたが、RoRでは有用なものはありませんでした その結果、ActiveMerchantを分岐して、このサービスの統合を開発し、後でプロジェクトでその経験を活用することが決定されました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この記事では、誰かに役立つことを期待して、支払いシステムを接続するプロセスについてお話したいと思います。そのような情報がなかったからです。 また、情報が誰か、特にこの支払いシステムで役立つ可能性もあります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     それ以前は、ActiveMerchantに既に精通していました：ロボカッサを統合したプロジェクトの1つで- <a href="http://habrahabr.ru/post/147435/">この</a>記事は大いに役立ち、問題は発生しませんでしたが、モジュール実装コードを確認または理解するために数回だけ調べる必要がありました特定の方法の作業-それだけです。 また、モジュールを統合するとき、ActiveMerchantのかなりの部分を学ぶ必要がありました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  ActiveMerchant構造 </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     このようなサービスの統合を支援するために、プロジェクトには3つの基本クラスがあります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="http://rubydoc.info/github/Shopify/active_merchant/master/ActiveMerchant/Billing/Integrations/Helper">ヘルパー</a> -それに基づいて、フォームは<b>payment_service_for</b>メソッドを使用して構築され、このメソッドはすべての必要なパラメーターを含むフォーム自体を生成します。開発者は特定の支払いシステムに対してのみヘルパーを正しく作成できます </li><li>  <a href="http://rubydoc.info/github/Shopify/active_merchant/master/ActiveMerchant/Billing/Integrations/Notification">通知</a> -このクラスには、支払いシステムサーバーから受信した情報の有効性を確認するためのメソッドが含まれます。たとえば、操作の完了を確認するとき </li><li>  <a href="http://rubydoc.info/github/Shopify/active_merchant/master/ActiveMerchant/Billing/Integrations/Return">Return-</a>コールバックを処理するために使用されますが、多くの場合、このクラスよりもレールに組み込まれたヘルパーを使用して、たとえば着信パラメーターを処理する方が便利です。 また、さまざまなシステムでのこのクラスの実装では、通常、特定の機能はありません。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     支払いシステムの各実装には、ベースから継承されたいくつかのクラスが含まれます。一部のモジュールには、プロトコルの追加機能を実装する追加クラスがあります。 また、ActiveMerchantの各支払いシステムには、ファイルからクラスがロードされるモジュールがあり、このモジュールに含まれる特定のクラスを作成するためのメソッドが含まれています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  ActiveMerchantにMoney Onlineを統合する </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この問題の解決<a href="http://dengionline.com/dev/protocol/main_protocol">は</a> Money Online <a href="http://dengionline.com/dev/protocol/main_protocol">プロトコルの</a>調査から始まり、ロボカッサの場合のようにすべてがそこに透明ではないことが判明しました：情報のバックグラウンド検証、確認、コールバック、実際、すべては単純ですが、リクエスト中に送信されるパラメーターと多くの異なるパラメーターにかなり混乱しました予約。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage3/01a/558/00e/01a55800e543f2400ad148cbcbb27539.png" alt="画像">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>一般的なクエリスキーム</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     要するに、一般的な場合、肯定的なシナリオでは、すべてが次のように行われます：サイトはシステムにすべての必要なパラメーターを含むフォームを送信し、ユーザーが支払いシステムのウェブサイトにアクセスすると、バックグラウンドの支払いシステムはウェブサイトからのデータの正確性の確認を求めます。 データが正しい場合、ユーザーは支払いを行うために必要な指示が表示されている場所にリダイレクトされます。  「Pay」ボタンをクリックした後、支払いシステムは、支払いを受け入れる前にデータの正確性を再度チェックし、支払いが受け入れられ、システムは支払い確認のリクエストをサイトに送信し、答えがはいの場合、ユーザーはコールバックにリダイレクトされます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     私を混乱させたプロトコルの主な機能： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> 請求時にパラメータのみが送信され、チェック中にこれらのパラメータは異なる名前で返されます </li><li> 最初に、プロトコルは、注文を行ったユーザーの識別子によってのみ検証が実行されることを想定しており、内部支払い識別子によってデータを検証する方がはるかに便利な場合がよくあります。 </li><li> 内部支払い識別子をシステムに転送できるという事実にもかかわらず、検証中に、場合によっては確認時に返されません。これはオプションのパラメーターです </li><li> パラメーターはコールバックにまったく渡されません </li><li> 請求書を発行する際、ユーザーの利便性を確保するために多くの追加機能がありますが、これらの機能はすべてプロトコルで別々に実装されます </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     これらの機能のため、私はそれらをサポートするために数回書く必要がありましたが（最初はサイトの音声モジュールを介して連絡しましたが、女の子は私の問題を聞いた後、留守番電話にリダイレクトしました）、その日のうちに適切な回答を受け取りました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     プラスの点として、説明したプロトコルに正確に従ってリクエストを行うと、期待どおりの結果が得られることがわかりましたが、場合によってはデータはチェックされませんが、明らかにゲートウェイの機能が原因です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     また、場合によってはバックグラウンドで請求できることも気に入りました。 そして、請求プロトコルのサポートを可能な限り完全にすることにしましたが、すべてを完全にテストする機会がなかったため、いくつかの問題が発生する可能性があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     また、文書化されていない1つの機会を特定することができました：QIWIを介して支払い用のアカウントを作成するバックグラウンドリクエストに応じて、説明されたパラメーター、理解できないコンテンツを含むiframeSRCパラメーター、2回考えることなく、このパラメーターからのデータをbase64でデコードし、フォームにつながるリンクを受け取りましたQIWIを介した支払い。リンクを使用してiframeを作成する必要があると思われます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ActiveMerchant <a href="https://github.com/Shopify/active_merchant/tree/master/lib/active_merchant/billing/integrations">での</a>支払いシステム<a href="https://github.com/Shopify/active_merchant/tree/master/lib/active_merchant/billing/integrations">統合の</a>さまざまな実装<a href="https://github.com/Shopify/active_merchant/tree/master/lib/active_merchant/billing/integrations">を</a>見ると、同じコードが多くのモジュールにどのように流れることができるか、いくつかのファイルではコードが複数のモジュールのコードの組み合わせなどであることがわかりますが、複雑なものはありませんスクリプト。 特にバックグラウンドクエリの実装のために、私は多くのことを書かなければならなかったので、リクエストプールが承認されないのではないかと思います。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     最後に起こったことは<a href="https://github.com/ovcharik/active_merchant/compare/dengionline">ここ</a>で見ることができ<a href="https://github.com/ovcharik/active_merchant/compare/dengionline">ます</a> 。 ヘルパーの一般的な概念のフレームワークを超えている唯一のものはデータ検証ですが、一般的には絶対に必要ではなく、バックグラウンドリクエストでのみ使用して、リクエストの前でもエラーが発生しないようにする必要があります（これにもかかわらず、サイトに支払いシステムを実装するとき、私は汚いハックでこれを回避する必要がありました）、開発者が長い間プロトコルに対処する必要がないように、いくつかの要求パラメーターも<a href="http://dengionline.com/dev/protocol/invoice">特別な</a>場合に自動的に設定されます。 私のヘルパーには、バックグラウンド要求を送信する機会もあります。これが有効なmode_typeに対して行われた場合、回答は自動的に解析され、この回答を使用すると便利です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     私は約3か月ルビーに精通しているため、コードが良かったとは言えません。どのような支援やアドバイスも喜んで受けます。また、支払いシステムをActiveMerchantに統合したい人を支援する準備ができています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5> サイトで支払いシステムを作成する例 </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     最初のステップは、プロジェクトにActiveMerchantを含めることです。そのため、Gemfileに追加します 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="ruby hljs">gem <span class="hljs-string"><span class="hljs-string">'activemerchant'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:git</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"https://github.com/ovcharik/active_merchant.git"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:branch</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"dengionline"</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     これまでのところ、これを追加できますが、 <a href="https://github.com/Shopify/active_merchant/pull/874">リクエストプール</a>を公​​式リポジトリに送信しました。おそらくすぐに承認されるでしょう。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次に、必要なルーターを作成します 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="ruby hljs">scope <span class="hljs-string"><span class="hljs-string">'top_up'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> post <span class="hljs-string"><span class="hljs-string">'create'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'top_up#create'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:as</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'top_up_create'</span></span> post <span class="hljs-string"><span class="hljs-string">'notify'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'top_up#notify'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:as</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'top_up_notify'</span></span> post <span class="hljs-string"><span class="hljs-string">'check'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'top_up#check'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:as</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'top_up_check'</span></span> match <span class="hljs-string"><span class="hljs-string">'success'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'top_up#success'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:as</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'top_up_success'</span></span> match <span class="hljs-string"><span class="hljs-string">'fail'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'top_up#fail'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:as</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'top_up_fail'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  createは、支払いのオブジェクトを作成し、請求書を発行するために使用されます。原則として、それは必要ではないか、そのロジックを他の場所に配置できますが、それを行う方が便利でした。 </li><li>  successとfailは、システムからパラメーターを返さないコールバックであるため、トランザクションの完了後にユーザーがリダイレクトされるコールバックです。 </li><li> 支払いを確認し、サイトの支払いシステムによるデータの正確性を確認するには、それぞれ通知と確認が必要です。これらのアドレスで、支払いシステムは特定のパラメーターでプッシュ要求を行います。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     最後の4つの住所は、登録時に支払いシステムに示されます。その過程で、これらの住所にポイントがあるアンケートに記入する必要があります。 サイト自体はアドレスを変更する機能を提供しておらず、これは追加のサポートリクエストによってのみ行われるため、本番環境で直接多くのテストを行う必要がありました（プロジェクトが開始されたにもかかわらず、まだ開発中であり、これはユーザーに影響しませんでした）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     私がやっているプロジェクトでは、このシナリオはサービスの支払い時に発生します：ユーザーは、「Pay」ボタンをクリックして、/ top_up / createにajaxリクエストを送信し、そこでデータをチェックしてから、バックグラウンドリクエストが支払いシステムに送信され、成功した応答がユーザーに表示され、エラーが個別に処理されます。 私の場合、成功した応答として、非表示フィールドを持つフォームが入り、その直後にこのフォームを送信するスクリプトがあります。つまり、この応答がページのどこかに表示されると、ユーザーは暗黙的にゲートウェイページにリダイレクトされます支払い。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     バックグラウンドリクエスト中に、次のことが起こります：バックグラウンドリクエストを行い、システムはすべてのデータをチェックし、それが正しい場合、システムが必要なデータを返すことを確認した後、/ top_up / checkメソッドを呼び出します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ゲートウェイのWebサイトで、ユーザーは詳細を指定する必要があるフォームを確認し、「Pay」ボタンをクリックした後、ゲートウェイはMoney Onlineシステムのデータをチェックし、プロジェクトのデータをチェックし（再び/ top_up / checkで）、応答を受信し、支払いゲートウェイに渡します。 彼は支払いを確認し、それについて支払いシステムに通知し、彼女はすでにサイトに通知を送信し（/ top_up / notify）、同時にユーザーはコールバックに戻ります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">ログを見るだけでこのプロセスを理解するのは簡単かもしれません</b> <div class="spoiler_text"><pre> <code class="hljs vbscript">Started POST <span class="hljs-string"><span class="hljs-string">"/ru/top_up/create"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> user_ip at <span class="hljs-number"><span class="hljs-number">2013</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-05</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">45</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> +<span class="hljs-number"><span class="hljs-number">0400</span></span> Processing by TopUpController#create as */* Parameters: {<span class="hljs-string"><span class="hljs-string">"amount"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"1.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"authenticity_token"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"token"</span></span>, <span class="hljs-string"><span class="hljs-string">"currency"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"RUB"</span></span>, <span class="hljs-string"><span class="hljs-string">"order"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"78"</span></span>, <span class="hljs-string"><span class="hljs-string">"lang"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"ru"</span></span>} Started POST <span class="hljs-string"><span class="hljs-string">"/top_up/check"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deingionline_ip at <span class="hljs-number"><span class="hljs-number">2013</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-05</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">45</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> +<span class="hljs-number"><span class="hljs-number">0400</span></span> Processing by TopUpController#check as */* Parameters: {<span class="hljs-string"><span class="hljs-string">"amount"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"userid"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"example@mail.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"userid_extra"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"58"</span></span>, <span class="hljs-string"><span class="hljs-string">"paymentid"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"key"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"key1"</span></span>} Rendered text template (<span class="hljs-number"><span class="hljs-number">0.0</span></span>ms) Completed <span class="hljs-number"><span class="hljs-number">200</span></span> OK <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>ms (Views: <span class="hljs-number"><span class="hljs-number">1.1</span></span>ms | ActiveRecord: <span class="hljs-number"><span class="hljs-number">2.5</span></span>ms) Completed <span class="hljs-number"><span class="hljs-number">200</span></span> OK <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">557</span></span>ms (Views: <span class="hljs-number"><span class="hljs-number">0.5</span></span>ms | ActiveRecord: <span class="hljs-number"><span class="hljs-number">11.1</span></span>ms) Started POST <span class="hljs-string"><span class="hljs-string">"/top_up/check"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deingionline_ip at <span class="hljs-number"><span class="hljs-number">2013</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-05</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">46</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span> +<span class="hljs-number"><span class="hljs-number">0400</span></span> Processing by TopUpController#check as */* Parameters: {<span class="hljs-string"><span class="hljs-string">"amount"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"userid"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"example@mail.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"userid_extra"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"58"</span></span>, <span class="hljs-string"><span class="hljs-string">"paymentid"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"key"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"key1"</span></span>} Rendered text template (<span class="hljs-number"><span class="hljs-number">0.0</span></span>ms) Completed <span class="hljs-number"><span class="hljs-number">200</span></span> OK <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span>ms (Views: <span class="hljs-number"><span class="hljs-number">1.0</span></span>ms | ActiveRecord: <span class="hljs-number"><span class="hljs-number">1.9</span></span>ms) Started POST <span class="hljs-string"><span class="hljs-string">"/top_up/notify"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deingionline_ip at <span class="hljs-number"><span class="hljs-number">2013</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-05</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">46</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span> +<span class="hljs-number"><span class="hljs-number">0400</span></span> Processing by TopUpController#notify as */* Parameters: {<span class="hljs-string"><span class="hljs-string">"amount"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"1.00"</span></span>, <span class="hljs-string"><span class="hljs-string">"userid"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"example@mail.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"userid_extra"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"58"</span></span>, <span class="hljs-string"><span class="hljs-string">"paymentid"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"123456789"</span></span>, <span class="hljs-string"><span class="hljs-string">"paymode"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"mode_type"</span></span>, <span class="hljs-string"><span class="hljs-string">"orderid"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"58"</span></span>, <span class="hljs-string"><span class="hljs-string">"key"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"key2"</span></span>} Rendered text template (<span class="hljs-number"><span class="hljs-number">0.0</span></span>ms) Completed <span class="hljs-number"><span class="hljs-number">200</span></span> OK <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">127</span></span>ms (Views: <span class="hljs-number"><span class="hljs-number">0.9</span></span>ms | ActiveRecord: <span class="hljs-number"><span class="hljs-number">15.2</span></span>ms) Started <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-string"><span class="hljs-string">"/top_up/success"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> user_ip at <span class="hljs-number"><span class="hljs-number">2013</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-05</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">46</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span> +<span class="hljs-number"><span class="hljs-number">0400</span></span> Processing by TopUpController#success as HTML Rendered ... Completed <span class="hljs-number"><span class="hljs-number">200</span></span> OK <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>ms (Views: <span class="hljs-number"><span class="hljs-number">16.6</span></span>ms | ActiveRecord: <span class="hljs-number"><span class="hljs-number">0.7</span></span>ms)</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ログでは、すべての場合に送信されるパラメーターを確認できます。また、/ top_up / checkにアクセスすると、支払いシステムはorderid（プロジェクトの内部支払い識別子、paymentidは支払いシステムの識別子）を送信しないため、支払いを識別するためにuserid_extraパラメーターを使用することが決定されました、ただし、ここでは注意が必要です。返されない場合もあるため、ユーザーIDで内部支払い番号を指定できますが、支払いシステムのアカウントでは、すべてのトランザクションを確認できるほか、 このパラメーター、およびこのパラメーターとして一意の識別子を使用する場合、サンプリングオプションのユーティリティはゼロになります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">コントローラー</b> <div class="spoiler_text"><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopUpController</span></span></span><span class="hljs-class"> &lt; ApplicationController </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveMerchant::Billing::Integrations</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#    create skip_before_filter :verify_authenticity_token, :except =&gt; [:create] #     ActiveMerchant before_filter :create_notification, :only =&gt; [:check, :notify] #    before_filter :find_payment, :only =&gt; [:check, :notify] #   def create authorize! :create, Payment r = { :success =&gt; false, :errors =&gt; {:base =&gt; []} } errors = false #    ,      #   activemerchant     </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Payment.new({ :user =&gt; current_user, :amount =&gt; params[:amount] }) #   unless errors or </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.save r[:errors].merge! </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.errors.messages errors = true end unless errors #    ActiveMerchant helper=Dengionline.helper </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.id, CONFIG["dengionline"]["project"], { :amount =&gt; </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.amount, :nickname =&gt; </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.user.email, #     :nick_extra =&gt; </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.id, #         :transaction_type =&gt; CONFIG["dengionline"]["mode_type"], #           :source =&gt; CONFIG["dengionline"]["source"], #  ,       :secret =&gt; CONFIG["dengionline"]["secret"], #    ,      , :method =&gt; :credit_card, :mode =&gt; :background } begin #    ,    mode_type   #  ,    ,   - #      ,    xml, #     # ,       mode_type #       if (helper.valid? or helper.errors.size &gt; 1 or helper.errors[0] != "mode_type") r[:errors][:base] &lt;&lt; I18n.t("views.top_up.create.technical_error") break end #   ,     #       response = helper.background_request! #      ,   xml #    if response.errors.empty? and response.fail? r[:errors][:base] &lt;&lt; response.comment break end #    parse_error -  ,     #      200 if (response.success? or response.errors.empty? or response.errors.size &gt; 1 or response.errors[0] != "parse_error") r[:errors][:base] &lt;&lt; I18n.t("views.top_up.create.gateway_error") break end #   parse_error,      #      ,     #    ,    r[:success] = true r[:body] = response.body end until true end render :json =&gt; r end #   def check if (</span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@notification</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.acknowledged? and </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> and </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.wait? and </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.valid?) render :text =&gt; </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@notification</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.generate_response("YES") else render :text =&gt; </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@notification</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.generate_response("NO") end end #   def notify if (</span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@notification</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.acknowledged? and </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> and </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.amount == </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@notification</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.amount and </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.amount &gt; 0) #       #      #              #      saved = true if </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.wait? </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.do_payment_id = </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@notification</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.payment_id </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.paid! saved = </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.save Notifier.payment_paid(</span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">).deliver if saved end if </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.paid? and saved render :text =&gt; </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@notification</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.generate_response("YES") else render :text =&gt; </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@notification</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.generate_response("NO") end else render :text =&gt; </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@notification</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.generate_response("NO") end end #      def success end def fail end private def create_notification </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@notification</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Dengionline.notification(request.raw_post, { :secret =&gt; CONFIG["dengionline"]["secret"] }) end def find_payment #  ,     nil,   </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@payment</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Payment.where(:id =&gt; </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@notification</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.nick_extra).first end end</span></span></span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     応答の性質上、すべてのデータをバックグラウンドで送信していますが、 <a href="http://habrahabr.ru/post/147435/">ここで</a>説明する方法を使用することもでき<a href="http://habrahabr.ru/post/147435/">ます</a> 。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     また、クラスを使用してリモート支払い情報を受信する例を示します。これを使用しても問題は発生しないと思います。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">例</b> <div class="spoiler_text"><pre> <code class="hljs rust">$ rails c irb(main):<span class="hljs-number"><span class="hljs-number">001</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>&gt; Dengionline = ActiveMerchant::Billing::Integrations::Dengionline =&gt; ActiveMerchant::Billing::Integrations::Dengionline irb(main):<span class="hljs-number"><span class="hljs-number">002</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>&gt; status = Dengionline.status <span class="hljs-number"><span class="hljs-number">69</span></span>, <span class="hljs-number"><span class="hljs-number">1234</span></span>, :secret =&gt; <span class="hljs-string"><span class="hljs-string">"secret"</span></span> =&gt; #&lt;ActiveMerchant::Billing::Integrations::Dengionline::Status:<span class="hljs-number"><span class="hljs-number">0xb805bb4</span></span>&gt; irb(main):<span class="hljs-number"><span class="hljs-number">003</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>&gt; status.to_hash =&gt; { <span class="hljs-string"><span class="hljs-string">"id"</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">123456789</span></span>, <span class="hljs-string"><span class="hljs-string">"amount_rub"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"1.00"</span></span>, <span class="hljs-string"><span class="hljs-string">"status"</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">"status_description"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"Success"</span></span>, <span class="hljs-string"><span class="hljs-string">"order"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"69"</span></span>, <span class="hljs-string"><span class="hljs-string">"nick"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"example@mail.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"date_payment"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"2013-10-05T13:00:00+04:00"</span></span>, <span class="hljs-string"><span class="hljs-string">"paymode"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"mode_type"</span></span>, <span class="hljs-string"><span class="hljs-string">"currency_project"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"RUB"</span></span>, <span class="hljs-string"><span class="hljs-string">"amount_project"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"1.00"</span></span>, <span class="hljs-string"><span class="hljs-string">"currency_paymode"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"RUB"</span></span> }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この例では、内部支払い識別子がメインパラメーターとして渡されます。課金時に使用しなかった場合は、支払いシステムの支払い識別子を転送できます。このため、最後のパラメーターであるpayment =&gt; payment_idを指定します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="https://github.com/Shopify/active_merchant">ActiveMerchant</a> </li><li>  <a href="https://github.com/ovcharik/active_merchant/tree/dengionline">フォーク</a> </li><li>  <a href="http://dengionline.com/">オンラインマネー</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J196968/index.html">MozillaはFirefox OS 1.1をリリースしました</a></li>
<li><a href="../J19697/index.html">マイサークル404</a></li>
<li><a href="../J196972/index.html">センサー測定値とその表示の収集</a></li>
<li><a href="../J196974/index.html">あなたが本を投げているとは信じられません！</a></li>
<li><a href="../J196976/index.html">サムスンは、湾曲したスクリーンを備えた世界初のスマートフォン-GALAXY Roundを発表しました</a></li>
<li><a href="../J19698/index.html">スターウォーズファン</a></li>
<li><a href="../J196982/index.html">Tizen-内観</a></li>
<li><a href="../J196984/index.html">外部リソースからの写真-善か悪か？</a></li>
<li><a href="../J19699/index.html">CSS：圧縮に関するすべて</a></li>
<li><a href="../J196992/index.html">Windows Phoneでの単体テスト中のコードカバレッジ制御</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
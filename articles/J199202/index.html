<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐌 🤤 🤜🏿 NSA SELinuxのクッキング 👩🏻‍🤝‍👨🏽 🍟 😪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちはHabr！ この投稿では、尊敬されているコミュニティをNSAトピックのゴシップから少し気を散らせ、代わりに「SELinuxをオフにする」と「小さな部分を理解するために最高の年を捧げる」とのクロスを書いて、彼らのテクノロジーの説明のギャップを埋めたいと思います。 実際、これらの視点はどちらも...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>NSA SELinuxのクッキング</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body"><img src="https://habrastorage.org/getpro/habr/post_images/cfa/80e/805/cfa80e80563336b6fec88c41a29c85ca.png" alt="NSAロゴ" align="left"> こんにちはHabr！ この投稿では、尊敬されているコミュニティをNSAトピックのゴシップから少し気を散らせ、代わりに「SELinuxをオフにする」と「小さな部分を理解するために最高の年を捧げる」とのクロスを書いて、彼らのテクノロジーの説明のギャップを埋めたいと思います。 実際、これらの視点はどちらも真実とはかけ離れています。テクノロジーは非常にシンプルで透明性が高く、多くのことができます。 しかし、私は膨大な数の手紙と、かなり狭い対象読者について警告したいと思います。 以下は誰にとっても興味深いものではありません。  SELinuxが何であるかを長い間理解したいが、どちらの側にアプローチするのかわからなかった場合は、この記事が役立ちます。 このすべてを長い間知っていて、それをうまく適用できたら、コメントでこれを議論できるように、私は十分な不正確さを加えました。 まあ、世界的に有名な情報セキュリティの専門家は最後まで安全にスキップしてプレイを開始できます。私は継続する予定です:-) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      NSA全般に関連するトピック、RSAを解読する機能、盗聴、その他のメディアの側面については触れません。誇大広告もFUDも、テクノロジーもありません。 さまざまなレベルのアクティビティでさまざまなソースにアクセスし、MLSの中心に条件を追加し、脆弱性を導入し（間違いも犯す）、その後、テスト<s>を開始し</s>て実行<s>しよう</s>とします。 言い換えれば、私は何とどのように説明し、その後、SELinuxを未知の動物であり、敵である可能性のある住人の悪魔と見なさなくなりましたが、このテクノロジーを大胆に使い始めました。 特に、すべてのAndroid（&gt; 4.3）および多くのディストリビューションに既に含まれていることを考慮してください。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ですから、まだ興味があり、多くのネタバレのうちの1つに1週間座ることを恐れないなら、 <a name="habracut"></a><h4> 予備測定値 </h4> つまり、お気に入りのディストリビューションを仮想環境に展開するのに十分なLinuxの経験がすでにあるということです。 私はDebianの例ですべてを行いますが、このパスを繰り返すことに決めた場合、これはすべて、最も便利で使い慣れた配布キットで行うことができます（そして非常に必要です）-その過程で、あなたはそれについて多くを学びます。 誰でも段階的に繰り返すことができるように、この記事を教材として書きました。 また、英語で技術文書を読むことは難しくないことを意味します-ロシア語のSELinuxに関する情報はまだほとんどありません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5> 一般的な技術情報 </h5>  SELinuxをめぐるうわさは非常に多いため、紹介ボリュームがどれほど小さいかには驚くでしょう。リンクは3つだけです。 <ol><li>  <a href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security-Enhanced_Linux/">RHガイド</a> ：明確でないチームがある場合、その中に説明が見つかる可能性が高いです。 便利な別のタブで開きます。 </li><li>  Eli Billauerによる講義の<a href="http://billauer.co.il/selinux-policy-module-howto.html">要約</a> ：それを事実の主要なコレクションと考えてください。 それから、何が何であるかをすばやく理解し、Googleに何を尋ねるかを正確に知ることができます。 </li><li>  <a href="http://www.lurking-grue.org/writingselinuxpolicyHOWTO.html">ポリシーの作成</a> 。  10年前のドキュメントにもかかわらず、内部デバイスSELinuxを理解するのに十分なキーポイントと、その選択方法について説明しています。 </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     これは、セットアップを進める<i>前に</i>読むことをお勧めする主なものです。そうしないと、これらのドキュメントに常に戻ることになります。 他にも<a href="http://www.nsa.gov/research/selinux/">多く</a> <a href="http://selinuxproject.org/">の</a> <a href="https://wiki.gentoo.org/wiki/Project:SELinux">リソース</a>がありますが、ブール変数をオン/オフにする以外のことをしたい場合は、間違いなくそれらに到達します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     したがって、これらすべてを読むと、簡単な質問で自分自身をテストできます。 <ol><li>  unconfined_t / unconfined_uとは何ですか？またなぜSELinuxをテストできないのですか？ </li><li> 特殊なケース、MLSまたはMCSとは何ですか？ </li><li>  * .teと* .ifの* .fcの違いは何ですか？ </li></ol><div class="spoiler">  <b class="spoiler_title">答え</b> <div class="spoiler_text"><ol><li> 無制限のドメイン/ユーザー。 同じ成功を収めて、別のマシンでSELinuxを構成できます。 </li><li>  MCS。  MLS == MCS with MLS_SENS = 1 </li><li> 基本的に-何もありません。  txtの書き込みでは、メインのMakefileを修正することを忘れないでください。 </li></ol></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> 問題ステートメントと事前設定 </h4> 既に何が欲しいのかはわかっているが、どのように実装するのかわからないので、実験の目標を定式化できます。 <ul><li>  SELinux MLSを設定したい（それを取り込んだので、最大限に<s>活用</s>して、リポジトリから準備ができていない<s>next-&gt; next-&gt;同意</s> ）; </li><li>  <a href="http://oss.tresys.com/projects/refpolicy/">RefPolicyを基礎として使用し</a>たいと<a href="http://oss.tresys.com/projects/refpolicy/">考えています</a> 。 </li><li> さて、その後、最悪のシナリオを確認します-壊れただけでなく、UID = 0になっただけでなく、一定のシェルアクセスで、ルートをuser_uに再マップするのを忘れました。 私は意図的にそのような仮定をいくつか行います。最悪のシナリオを検討します。 </li><li> 最低限必要なコピーを設定します。そうしないと、記事ではなく、約500ページのサガになります。 </li></ul><h5> サーバー </h5> あなたの許可を得て、ネタバレの下に置きます。  YMMV、Debianをお持ちでないかもしれません。KVMでのインストールも同様です。 仮想環境の最小構成でインストールされたディストリビューションはすべて機能します。 仮想-それはより便利で、最小限であるため-高速であるためです。 <div class="spoiler">  <b class="spoiler_title">詳細</b> <div class="spoiler_text"> 典型的なDebianエキスパートインストール、小さなニュアンス： <ul><li> ディスクの故障（最大4GB！）： <ul><li>  / dev / vda1 64MBとして/ boot、ext2。 </li><li>  LUKS：aes256：cbc-essiv：passphraseとして残り、すべての設定はデフォルトで最大です。 </li><li> 残りの内部-LVMの下のすべて。 </li></ul></li><li> これがfstabです <pre><code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># cat /etc/fstab # /etc/fstab: static file system information. # &lt;file system&gt; &lt;mount point&gt; &lt;type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt; /dev/vda1 /boot ext2 defaults 0 2 /dev/mapper/vg0-root / btrfs defaults 0 1 /dev/mapper/vg0-usr /usr btrfs defaults 0 2 /dev/mapper/vg0-var /var btrfs defaults 0 2 /dev/mapper/vg0-tmp /tmp btrfs defaults 0 2 /dev/mapper/vg0-rhome /root btrfs defaults 0 2 /dev/mapper/vg0-swap none swap sw 0 0</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> </li><li> その後のテストの便宜のために、個別のセクションが作成されます。 </li><li>  SSHサーバーを備えた最小限のシステムを導入しました。 </li><li> インストールを完了する前に、すぐにシェルを呼び出してシステムキーを記憶します。 <pre> <code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># ssh-keygen -l -f /etc/ssh/ssh_host_ecdsa_key 256 f6:9b:ad:dd:93:cb:3d:c2:83:76:45:c3:02:e8:6a:1d root@sandbox (ECDSA)</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre></li></ul> インストール後、sshを実行し、システムを実験用の基本バージョンに持っていきます。私の場合は次のようなものでした。 <pre> <code class="bash hljs">sed -i <span class="hljs-string"><span class="hljs-string">'s/wheezy/jessie/g'</span></span> /etc/apt/sources.list <span class="hljs-comment"><span class="hljs-comment"># that's no bloody enterprise aptitude update &amp;&amp; aptitude dist-upgrade -VR # let's go testing, it's stable enough aptitude install vim bash-completion deborphan -VR # a little comfort couldn't hurt aptitude install policycoreutils auditd setools selinux-basics -VR # last is just helper scripts, optional vim /etc/network/interfaces # make interfaces static aptitude purge isc-dhcp-client console-setup console-setup-linux kbd iproute module-init-tools $(deborphan)</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>  sshのキーを作成し、それらをルートのサーバーに登録します。 <pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>$ ssh-keygen -b 521 -t ecdsa -f selinux-test @remote<span class="hljs-comment"><span class="hljs-comment"># mkdir /root/.ssh &amp;&amp; cat selinux-test.pub &gt; /root/.ssh/authorized_keys2 &amp;&amp; chown &amp;&amp; chmod</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> さて、カーテンでアセンブルし、カーネルを配置します-PaXおよびGRSecurityパッチを実験するために、ポリシーの最新バージョン、最小限のモジュールセットをサポートしたい（これは、SELinuxともうまくいきますが、おそらくまた説明します）。 一般に、バニラカーネルは現在の段階で最適です。 はい、Debianの方法について話している聴衆からの声が聞こえます。しかし、今日のサムライの方法はそのようなフレームワークに限定されません。 この実験では、制限なしでUID = 0のままであり、必要なことは何でも行います。 そのため、アリゾナ（またはローカルのvirtualka）を少し加熱します。 <pre> <code class="bash hljs">mkdir src &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> src &amp;&amp; wget -c http://kernel.org/pub/linux/kernel/v3.0/linux-3.10.18.tar.bz2 &amp;&amp; tar jxf linux*tar.bz2 &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> linux* &amp;&amp; make menuconfig &amp;&amp; make -j$((2* $(grep processor /proc/cpuinfo | wc -l))) deb-pkg &amp;&amp; make clean</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 設定段階で<b>、SELinuxを有効に</b>します（はい、このしゃれは意図されています！）： <img src="https://habrastorage.org/getpro/habr/post_images/805/546/6c2/8055466c2f7ad7696341b7ad95e6d541.png" alt="selinux kernel opts、imageshackで申し訳ありませんが、habrastorageは私のIDでは大丈夫ではありません"><div class="spoiler">  <b class="spoiler_title">.config</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># if you are lazy to configure yourself, here's my .config, usable on KVM+libvirt wget -O - $aboveimage | dd bs=1 skip=3991 | xzcat</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre></div></div></div></div> 実験の基礎は整っていると信じています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5> ポリシーの組み立てを自動化する </h5> ローカルマシンでポリシーを収集し、それらをdebパッケージとしてサーバーにインストールする方が便利でした。 だから、私は最も抵抗の少ない道を選んだ。 <div class="spoiler">  <b class="spoiler_title">アップエンタースタイル</b> <div class="spoiler_text"><pre> <code class="bash hljs">wget http://oss.tresys.com/files/refpolicy/refpolicy-2.20130424.tar.bz2 tar jxf refpolicy-2.20130424.tar.bz2 cp -rp refpolicy custom <span class="hljs-comment"><span class="hljs-comment">#all our modifications asroot# mkdir /usr/share/selinux/custom # so we can 'make install' here asroot# mkdir /etc/selinux/custom asroot# chown $USER:$USER /etc/selinux/custom /usr/share/selinux/custom asroot# touch /etc/selinux/custom/setrans.conf &amp;&amp; chown $USER:$USER /etc/selinux/custom/setrans.conf # we'll need it later asroot# aptitude install selinux-utils python-selinux policycoreutils checkpolicy # these are for policy build</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 次に、パッケージビルドスクリプト： <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # sample deb build for custom selinux policy # harvests policy from local system version='0.0.1' name='selinux-policy-custom' description='Custom MLS SELinux policy' cf="${name}-control" cc="${name}-Copyright" # depends and conflicts shamessly ripped from selinux-policy-mls read -d '' cheader &lt;&lt; EOF Section: non-free Priority: optional Homepage: http://selinux/ Standards-Version: 3.9.2 Package: ${name} Version: ${version} Maintainer: secadm_r &lt;here.can+be@your.email&gt; Pre-Depends: Depends: policycoreutils (&gt;= 2.1.0), libpam-modules (&gt;= 0.77-0.se5), python, libselinux1 (&gt;= 2.0.35), libsepol1 (&gt;= 2.1.0) Conflicts: cron (&lt;= 3.0pl1-87.2sel), fcron (&lt;= 2.9.3-3), logrotate (&lt;= 3.7.1-1), procps (&lt;= 1:3.1.15-1), selinux-policy-refpolicy-strict, selinux-policy-refpolicy-targeted, sysvinit (&lt;= 2.86.ds1-1.se1) Architecture: all Copyright: ./selinux-policy-custom-Copyright Description: ${description} EOF read -d '' postinst &lt;&lt; "EOF" File: postinst 755 #!/bin/sh -e set -e if [ "$1" = configure ]; then /usr/sbin/semodule -s custom -b /usr/share/selinux/custom/base.pp $(find /usr/share/selinux/custom/ -type f ! -name base.pp | xargs -r -n1 echo -n " -i") fi #DEBHELPER# exit 0 EOF function make_policy() { cd custom make clean rm -rf /usr/share/selinux/custom/* make install cd .. } function make_files() { echo 'SELinux custom policy copyright:TODO' &gt; ${cc} echo -e "$cheader" &gt; ${cf} echo -e "$postinst" &gt;&gt; ${cf} echo -en "\nFiles: " &gt;&gt; ${cf} # our setrans file echo -e " /etc/selinux/custom/setrans.conf /etc/selinux/custom" &gt;&gt; ${cf} # /etc/selinux dir find /etc/selinux/custom -type f ! -name \*LOCK | xargs -r -n1 -If -- sh -c 'echo " f $(dirname f)"' &gt;&gt; ${cf} # /usr/share/selinux/custom dir find /usr/share/selinux/custom -type f | xargs -r -n1 -If -- sh -c 'echo " f $(dirname f)"' &gt;&gt; ${cf} } function cleanup() { rm -f ${cc} ${cf} } function build_deb() { equivs-build ${cf} [ $? -eq 0 ] &amp;&amp; cleanup } rm ./${name}*deb # glob is ok make_policy make_files build_deb scp -P 22 -i ~/.ssh/selinux-test selinux*deb root@selinux:/tmp/</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 完全な再組み立て時間は約30秒であることがわかったため、スクリプト操作の一般原則が選択されました。「額」と呼ばれ、rpm組み立てに簡単に適応できます。 <ul><li> すべてをきれいにします（きれいにします） </li><li> ポリシーを収集してインストールします（インストールを行います） </li><li> インストールされているものをすべて見つけて（どこを探すべきかを知っています）、パッケージを収集します </li><li>  / tmpにサーバーを入力します </li><li>  postinstで、彼自身が更新し、semoduleをプルし、ポリシーをリロードしたことに気付くでしょう。 </li></ul></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  SELinux、最初の知り合い。 </h4> サーバーの準備が整い、ビルドシステムの準備が整い、参照ポリシーが読み込まれました。これで、楽しい部分を開始できます。  （この段階で、記事の既存のボリュームを評価すると、冷静な考えはそれを<s>2</s> 5に分割することに忍び込んだ:-)。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     最初のアセンブリでは、パラメーターを決定します。これらを選択しました。 <pre> <code class="bash hljs">$ sed <span class="hljs-string"><span class="hljs-string">'/^#/d;/^$/d'</span></span> build.conf TYPE = mls NAME = custom DISTRO = debian UNK_PERMS = reject DIRECT_INITRC = n MONOLITHIC = n UBAC = y CUSTOM_BUILDOPT = MLS_SENS = 4 MLS_CATS = 32 MCS_CATS = 32 QUIET = n</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> アップストリームとの違いはごくわずかです。MLSが有効になっています（つまり、アセンブリ中にpolicy / mlsおよびconfig / appconfig-mlsからのすべてのパラメーターが含まれることになります）。  debian用のディストリビューション固有のマクロが含まれていますが、これは実際には必要ありません。 ポリシーに反映されていないアクセス許可がカーネルで定義されている場合、ポリシーは読み込まれません。突然カーネルがより新しくなりました。 さて、レベルとカテゴリの数を大幅に削減しました-4つのレベルの秘密があり、それぞれに32のカテゴリがあります。 今のところ、これで十分です。 <div class="spoiler">  <b class="spoiler_title">エッセンスヌメロウノ</b> <div class="spoiler_text"> 実験として、MONOLITHIC = yを設定し、設定せずにポリシーをコンパイルしてみてください-ポリシーを作成します。 結果は、ポリシーのテキスト表現であるpolicy.confです。 ここでは、単純な形式で、マクロの山全体からm4を親切に展開し、SELinuxで許可されるすべてのものについて説明します。 言い換えれば（警告：悪い例え！）：secadm_rがセキュリティ評議会の責任者であり、アクセスレベルと許容範囲を承認している場合、SELinuxはこれらのリストをチェックする通常のセキュリティ担当者であり、実際にはpolicy.confで次のフィールドを持つリストです： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. who（scontext）-where（tcontext）-who（class）-why（call）（さらに、MLSの場合：入学レベルも表示し、それよりも低い場合は、ルールを見ることもしません。 ） </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     必要な設定をすべて作成し、必要に応じて編集します： <b>make conf</b> 最初に、登場した<i>ポリシー/modules.conf</i>を編集して修正します-contribグループのほとんどすべてのモジュールを無効にしました（modulename = off）。 さらに、より速いアセンブリ、より少ないモジュール。 マイナス-コンテキストの過小評価の可能性。 例で説明します。 <ul><li> コンテキスト/ dev / xconsoleは、ロギングに関連していますが、xserverモジュールで定義されています。 </li><li> 無効にすると、コンテキストはディレクトリ/ dev /から継承され始めました。 </li><li> そして、高い確率で、/ dev / xconsoleに書き込みたいすべてのものがRefPolicyで考慮され、すぐに壊れました。 正解-選択：xser​​verモジュールを有効にするか、ローカルモジュールのコンテキストを再定義します。 </li></ul><div class="spoiler">  <b class="spoiler_title">contrib_off</b> <div class="spoiler_text"><pre> <code class="bash hljs">grep -A5 contrib policy/modules.conf | grep <span class="hljs-string"><span class="hljs-string">"= module$"</span></span> | wc -l <span class="hljs-comment"><span class="hljs-comment"># total number grep -A5 contrib policy/modules.conf | grep "= module$" | sed 's/ = module//' | xargs -r -n1 -I__n -- sh -c 'sed -i "s/^__n = module$/__n = off/" policy/modules.conf' # kekeke # turn some servicess off too (xserver + postgresql) # turn _on_ logrotate,mta,postfix,ulogd, and whatever you think you need</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre></div></div>  <i>modules.confの</i>編集を開始するとすぐに、リターンのないポイントを通過しました。その後、何をしていて、なぜなのかを<i>理解</i>する必要があります。 コンテキストの誤解は、システムがアクションに与える影響の最初の例にすぎません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     今後、すばらしい<i>audit2allow</i>ユーティリティについて少し<i>お話しし</i>ます<i>。audit.logを</i>使用し、かなりわかりやすい形式（特に-Revキーを使用）で、これらのメッセージがログに表示されないようにポリシーに追加する必要があるものを教えてくれます。インターネット上のどこにいても（そしてこれはほとんどどこにでも）ある場合は、推奨事項を満たします。 <pre> <code class="bash hljs">grep something-something /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/audit/audit.log | audit2allow -M mymegamodule semodule -i mymegamodule</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> そして、あなたが今何をしているのかを知っている場合にのみそれに従ってください-この一連のコマンドは、SELinuxが（潜在的に貪欲な）何かへのアクセスを求めているもの<b>すべて</b>を許可する<b>こと</b>を意味します。 さらに、MLSの場合、このメソッドはまったく機能しません。MLSでは許可ルールを作成するだけでは不十分であるため、アクセスは許容値とカテゴリに課せられるすべての制限を満たさなければなりません。 そのような行動は、「はい、今日は頭で考えたくありません。すべてを解決するのは簡単です」という誠実な承認に相当します。 システムから<a href="http://en.wikipedia.org/wiki/Security_theater">劇場を</a>作らないでください。また、この方法でSELinuxを構成しないでください。これは、ファイアウォールですべてのパケットをキャッチし、スクリプトで許容ルールに変換するようなものです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ここで<b>make install</b>を実行します。すべてが問題なければ、パッケージを収集してサーバーに配置します。 <pre> <code class="bash hljs">dpkg -i /tmp/selinux-policy-custom*deb sed -i <span class="hljs-string"><span class="hljs-string">'s/^SELINUX=.*$/SELINUX=enforcing/;s/^SELINUXTYPE=.*$/SELINUXTYPE=custom/'</span></span> /etc/selinux/config selinux-activate <span class="hljs-comment"><span class="hljs-comment"># if you installed helper package selinux-basics # if not: touch /.autorelabel # add 'selinux=1 security=selinux' to cmdline reboot # let's rock!</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> システムは再起動し、インストールされたポリシー（ <i>/ etc / selinux / custom / contexts / files / *</i> ）で定義されているコンテキストを適用し、再度再起動してログインを提供します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> 揺れているのは「揺れ」、いつ揺れているのか </h4> シェフ、それはすべてなくなっています。 何も動作しません。 ホストによって閉じられた接続-sshにアクセスすることさえできません。  SELinuxをご覧ください。  Eli Billauerによって非常に正確に定式化されたように： <blockquote>  SELinuxとは何ですか？ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     簡単に言うと、許可を通知するマシンは拒否されます。 </blockquote> ただし、このポイントに到達した場合は良いことです。 これはまさに私たちが必要とする振る舞いであり、今では<i>なぜ</i>それが私たちを許さないの<i>か</i>を理解し始めるでしょう。 <div class="spoiler">  <b class="spoiler_title">数字のデュオの本質、今度は悪い類推なし</b> <div class="spoiler_text"> 予備のドキュメントを注意深く読んだ場合、おそらく意思決定手順を覚えているでしょう。 <ol><li> 最初にDAC。 禁止されている場合は、SELinuxにアクセスすることさえできません。許可が拒否されるのは普通で、Unixであり、最初の* nixシステムに精通したときから私たち全員に馴染みがあります。 </li><li> その後、MAC。 一致する許可が見つからない場合、拒否される許可はすでにSELinuxからのものです。 一部のディストリビューション（RH）では、「 <i>SELinux is prevent</i> 」を含む行がログに表示されますが、一部は表示されませんが、すべてがaudit.logに記録されます。 </li></ol> 合計、最も可能性が高いのは、RefPolicyに配布ポリシーにあるものがないことです。 それを見つけて追加しましょう。 </div></div> ああ、私はこの瞬間から始めて、sshだけでなくサーバーにアクセスする必要があると言うのを忘れていました。 幸いなことに、この場合は仮想サーバーであり、常にVNC / <a href="http://en.wikipedia.org/wiki/SPICE_%2528protocol%2529">SPICE</a> /など（FSKNのリンクスペシャリスト）があります。 私たちはローカルに入ろうとします-それはそれを許可しません。 それからどのようにすぐに説明するのに最適な状況 <div class="spoiler">  <b class="spoiler_title">出かける</b> <div class="spoiler_text"><ol><li> パニックにならないでください。 </li><li> 再起動します-たとえば、Ctrl + Alt + Delを送信すると、acpidがすべてを行います。 </li><li> ブート段階でgrubをキャッチし、selinux = 1をselinux = 0に変更します </li><li> ブートし、rootになります。 </li></ol></div></div> この段階で、audit.logには<s>失敗の</s>すべての理由、つまり入力できなかった理由が含まれています。 なぜなら  SELinuxを無効にした状態で起動します。最初の意味は、分析のために前回の起動からaudit.logをコピーすることです。SELinuxが有効になっていると、これができないためです。 <pre> <code class="bash hljs">cp /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/audit/audit.log /root wc -l /root/audit.log 195</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 災害の規模は小さく、200行です。 ゆっくりと山を下る時です。 <ul><li><div class="spoiler">  <b class="spoiler_title">ログの読み方</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=DAEMON_START msg=audit(1383338997.597:1957): auditd start, ver=2.3.2 format=raw kernel=3.10.17-vm-slnx auid=4294967295 pid =1319 subj=system_u:system_r:auditd_t:s3:c0.c31 res=success</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 最初の行は、auditdが正常に（res）開始し、ドメインauditd_tのsystem_rの役割であるsystem_uに代わって、最大レベル（s3）のすべてのカテゴリ（c0.c31）に属していることを示しています。  <a href="http://en.wikipedia.org/wiki/Bell%25E2%2580%2593LaPadula_model">BLP</a>によると、これは、どのレベルからの情報もauditdの手に渡ることができ（書き込み）、任意のレベルから読み取ることができることを意味します（読み取り）。 完全に明確でない場合は、このアーキテクチャの開発者と、情報を記録することの意味を思い出し<a href="http://www.nsa.gov/">て</a>ください。ソース（書き込み）から受信者（書き込み先/書き込み先）に情報を転送します。 そして、すべてが所定の位置に落ちます-トップシークレットレベルは実際にそのデータをシークレットレベルに書き込めません（つまり、ダウン、ダウン）-それらは危険にさらされるため、「 <b>ノーライトダウン</b> 」になります。  「 <b>読み上げ</b> 」について、できればもっと明白に。 また、MLSには追加の制限がありますが、 <s>彼らは</s>これについてさらに<s>沈黙するように頼みました</s> 。 <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=SYSCALL msg=audit(1383338997.620:219): arch=40000003 syscall=102 success=no <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>=-13 a0=3 a1=afbe1c10 a2=a779b000 a3=ffffffc8 items=0 ppid=1338 pid=1346 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 ses=4294967295 tty=(none) comm=<span class="hljs-string"><span class="hljs-string">"acpid"</span></span> exe=<span class="hljs-string"><span class="hljs-string">"/usr/sbin/acpid"</span></span> subj=system_u:system_r:initrc_t:s0-s3:c0.c31 key=(null)</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>  2行目は、acpidデーモン、可能な最大のすべてのレガリア（uid = 0 gid = 0 euid = 0 suid = 0 egid = 0 egid = 0 sgid = 0 fsgid = 0）を使用して、rootおよびbofh sysopを使用して、 initrc_tコンテキスト（開始）がソケットにアクセス（タイプ= SYSCALL）し（syscall = 102）、（ <i>突然</i> ）認識されず、呼び出されず、結果として送信された（成功=終了なし= -13）  Linuxが最も重要なルートではないことは誰もが知っているため、これは驚くべきことではありませんが、もっと重要なルートがあります:-) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     心を問うためのなぞなぞ-彼はどのソケットに向いたのか？* 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=AVC msg=audit(1383338997.810:233): avc: denied { search } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> pid=1470 comm=<span class="hljs-string"><span class="hljs-string">"restorecond"</span></span> name=<span class="hljs-string"><span class="hljs-string">"/"</span></span> dev=<span class="hljs-string"><span class="hljs-string">"tmpfs"</span></span> ino=376 scontext=system_u:system_r:restorecond_t:s0-s3:c0.c31 tcontext=system_u:object_r:var_run_t:s3:c0.c31 tclass=dir</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> さて、中央から3行目を取ります。  Logs AVC（Access Vector Cache）は、私たちにとって最も興味深いものです。 たとえば、上記は、確立されたポリシーに許可ルールがないため、restorecond_tドメインで動作する上記の許容範囲を持つソース（scontext）は、番号inode = 376のディレクトリで検索（{search}およびtclass = dir）を実行しますコンテキストvar_run_tを使用。 何のイラスト？ 右、読まない。 何を探していましたか？  <b>Find / var / run -inum 376</b>がこの質問に答えます。 同様の行からaudit2allowが許可ルールを作成します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     などなど。 ご覧のとおり、これらのログには複雑なものはありません。  SELinuxは<i>定性的</i>に難しくなく、 <i>定量化する</i>ことも難しく、最初は異常ですが、それ以上のことはありません。 繰り返しますが、何か明確でない場合は、いつでも非人格的な文字列をGoogleに入力するか、 <a href="http://selinuxproject.org/page/Main_Page">ここで</a>検索でき<a href="http://selinuxproject.org/page/Main_Page">ます</a> 。そのため、ログを読み取って理解できるようになりました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      *推測するつもりはありません。コメントを書いてください。 </div></div></li><li><div class="spoiler">  <b class="spoiler_title">修正方法</b> <div class="spoiler_text"> 次の2つの主なオプションがあります。 <ul><li> 無効なコンテキスト </li><li> 許可ルールの欠如 </li></ul> それらは、すべての許可が拒否されたケースの90％をカバーし、audit2allowはそれらのケースで非常に効果的です。 多くの場合、それ<i>を</i>修正する<i>方法</i>の選択、最初のオプションまたは2番目は、あなた次第です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      3番目のオプションはめったに見られませんが、最も明白ではありませんが、MLS制限の違反（ポリシー制約違反）です。この場合に許可ルールを追加しても効果はありません。MLSの中心に移動して制限を編集する必要があります。 ここでは、 <i>なぜ</i>すべての変更が行われているの<i>か</i> 、 <i>なぜ</i>行われて<i>いるのか</i> 、 <i>何を正確</i>に決定すべきなの<i>か</i>を完全に理解してから行う必要があります。 軽率な変更により、セキュリティレベルが低下することが保証されています。 あなたは（再び）警告を受けました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     キャンバスはプロの解決方法についてのものであり、サイズのために取り組みます： <ul><li><div class="spoiler">  <b class="spoiler_title">間違ったコンテキストソリューション</b> <div class="spoiler_text"> 無効なコンテキストの例： <pre> <code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># ls -laZ /lib/systemd/systemd-udevd -rwxr-xr-x. 1 root root system_u:object_r:bin_t:s0 210380 Sep 23 12:24 /lib/systemd/systemd-udevd @local$ grep systemd-udevd custom/policy/ -R custom/policy/modules/system/udev.fc:/usr/lib/systemd/systemd-udevd -- gen_context(system_u:object_r:udev_exec_t,s0)</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>  debian / lib、RefPolicy / usr / lib。 編集： <pre> <code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># semanage fcontext -m -t udev_exec_t /lib/systemd/systemd-udevd # try to modify /usr/sbin/semanage: File context for /lib/systemd/systemd-udevd is not defined root@sandbox:~# semanage fcontext -a -t udev_exec_t /lib/systemd/systemd-udevd # ok, add root@sandbox:~# grep udev /etc/selinux/custom/contexts/files/file_contexts.local /lib/systemd/systemd-udevd system_u:object_r:udev_exec_t:s0</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>  <b>semanage</b>は1つの方法です。 このような変更は推奨されますが、この場合、ポリシーの更新に耐えられない場合があります（ <i>/etc/selinux/custom/contexts/files/file_contexts.localの</i>提供を開始した場合）。 別のオプションは、ローカルで再定義し、ポリシーを再構築し、ロールします（同時にポリシーを設定します）。 </div></div></li><li><div class="spoiler">  <b class="spoiler_title">許可ルールの欠如の解決策</b> <div class="spoiler_text"> たとえば、次の行をご覧ください。 <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=AVC msg=audit(1383338997.860:251): avc: denied { module_request } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> pid=1524 comm=<span class="hljs-string"><span class="hljs-string">"sshd"</span></span> kmod=<span class="hljs-string"><span class="hljs-string">"net-pf-10"</span></span> scontext=system_u:system_r:sshd_t:s0-s3:c0.c31 tcontext=system_u:system_r:kernel_t:s3:c0.c31 tclass=system</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> ログの復号化は簡単ですが、これを継続的に追求することは疲れます。 ログにドロップして、マシンが動作するようにします。 <pre> <code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># audit2allow -Rev -i /root/log require { type kernel_t; type sshd_t; class system module_request; } #============= sshd_t ============== # audit(1383338997.860:251): # scontext="system_u:system_r:sshd_t:s0-s3:c0.c31" tcontext="system_u:system_r:kernel_t:s3:c0.c31" # class="system" perms="module_request" # comm="sshd" exe="" path="" # message="type=AVC msg=audit(1383338997.860:251): avc: denied { # module_request } for pid=1524 comm="sshd" kmod="net-pf-10" # scontext=system_u:system_r:sshd_t:s0-s3:c0.c31 # tcontext=system_u:system_r:kernel_t:s3:c0.c31 tclass=system " allow sshd_t kernel_t:system module_request;</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> そしてここで、私たちは考え始めました-私たちは自分自身に簡単な質問をします <ul><li> 何が起こっているの？  sshdは、モジュールをカーネルにロードするよう要求しました。 わかりました、net-pf-10はあまり必要ありません。  ipv6はありません。 </li><li> 私たちに何が提供されましたか？  sshd_tドメインがモジュールをカーネルにロードできるようにします。 もちろん、許可すれば、そのような間違いはありません。 そして、もし彼が敵のモジュールを要求したら？ </li><li> 彼らはインターネット上で何を書いていますか？  <a href="https://bugzilla.redhat.com/show_bug.cgi%3Fid%3D669047">へへ</a> 。 ありがたいことに、この機能を解決するためにブール変数は必要ありません。 </li><li> 何してるの？ はい、sshdがこの方向に物gいすることを禁止し、彼らが与えたものに作用させます。  ipv6が必要な場合は、sshが開始する前であっても、それを自分でダウンロードします。 </li></ul> 独自のミニモジュールを記述することで決定します。これは簡単です。 構造の<a href="http://selinuxproject.org/page/NB_RefPolicy">説明</a>を読みます。 同時に、すべてのモジュールのフレームワークを（ローカルに）作成します。 <pre> <code class="bash hljs">mkdir policy/modules/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> policy/modules/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;summary&gt;Local layer -- differences from reference policy.&lt;/summary&gt;'</span></span> &gt; metadata.xml <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'## &lt;summary&gt;sshd local policy&lt;/summary&gt;'</span></span> &gt; sshd_local.if <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'## no file contexts redefined here'</span></span> &gt; sshd_local.fc cat &gt; sshd_local.te &lt;&lt;EOF &gt; policy_module(sshd_local, 0.0.1) &gt; <span class="hljs-comment"><span class="hljs-comment">################################################################## &gt; require { &gt; type kernel_t; &gt; type sshd_t; &gt; class system module_request; &gt; } &gt; #============= sshd_t ============== &gt; # dont audit requests for module load &gt; # </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">NOTE:</span></span></span><span class="hljs-comment"> this may hide some denials in the future &gt; dontaudit sshd_t kernel_t:system module_request; &gt; &gt; EOF</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> ご覧のとおり、ルールを<b>dontaudit sshd_t kernel_tに</b>変更し<b>ました。system module_request;</b>  -これは、禁止することを意味し、ログに書き込みません。 ところで、一部の機能が動作せず、ログが空であるという事実に直面している場合、ほとんどの場合、これは単なるdontauditルールです。 それらを使用せずにポリシーを再構築するだけです： <b>semodule -DB</b> 、ログへのメッセージフローの準備をします。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      modules.confでモジュールを指定し、ポリシーを収集してサーバーにアップロードします。 <pre> <code class="bash hljs">root@sandbox:/tmp<span class="hljs-comment"><span class="hljs-comment"># sesearch --allow -s sshd_t -t kernel_t | grep system root@sandbox:/tmp# sesearch --dontaudit -s sshd_t -t kernel_t | grep system root@sandbox:/tmp# dpkg -i selinux-policy-custom_0.0.1_all.deb (Reading database ... 20371 files and directories currently installed.) Preparing to replace selinux-policy-custom 0.0.1 (using selinux-policy-custom_0.0.1_all.deb) ... Unpacking replacement selinux-policy-custom ... Setting up selinux-policy-custom (0.0.1) ... root@sandbox:/tmp# sesearch --dontaudit -s sshd_t -t kernel_t | grep system dontaudit sshd_t kernel_t : system module_request ; root@sandbox:/tmp# semodule -l | grep sshd_local sshd_local 0.0.1</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> ルールが表示され、モジュールがロードされます。 難しいですか？ まあ。 長くて退屈？ そうそう。 </div></div></li><li><div class="spoiler">  <b class="spoiler_title">MLS制限のソリューション</b> <div class="spoiler_text"> ここに問題があります（ネタバレのレベルは9000以上!! 1つ）： <div class="spoiler">  <b class="spoiler_title">問題</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=AVC msg=audit(1383338997.630:221): avc: denied { sendto } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> pid=1351 comm=<span class="hljs-string"><span class="hljs-string">"acpid"</span></span> path=<span class="hljs-string"><span class="hljs-string">"/dev/log"</span></span> scontext=system_u:system_r:initrc_t:s0-s3:c0.c31 tcontext=system_u:system_r:syslogd_t:s3:c0.c31 tclass=unix_dgram_socket <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=SYSCALL msg=audit(1383338997.630:221): arch=40000003 syscall=102 success=no <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>=-13 a0=3 a1=afbe15d0 a2=a779b000 a3=ffffffc8 items=0 ppid=1 pid=1351 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 ses=4294967295 tty=(none) comm=<span class="hljs-string"><span class="hljs-string">"acpid"</span></span> exe=<span class="hljs-string"><span class="hljs-string">"/usr/sbin/acpid"</span></span> subj=system_u:system_r:initrc_t:s0-s3:c0.c31 key=(null)</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre></div></div> 説明は次のとおりです。 <div class="spoiler">  <b class="spoiler_title">decription</b> <div class="spoiler_text"><pre> <code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># audit2allow -Rev -i /tmp/x require { type syslogd_t; type initrc_t; class unix_dgram_socket sendto; } #============= initrc_t ============== # audit(1383338997.630:221): # scontext="system_u:system_r:initrc_t:s0-s3:c0.c31" tcontext="system_u:system_r:syslogd_t:s3:c0.c31" # class="unix_dgram_socket" perms="sendto" # comm="acpid" exe="" path="" # message="type=AVC msg=audit(1383338997.630:221): avc: denied { sendto } for # pid=1351 comm="acpid" path="/dev/log" # scontext=system_u:system_r:initrc_t:s0-s3:c0.c31 # tcontext=system_u:system_r:syslogd_t:s3:c0.c31 tclass=unix_dgram_socket "#!!!! This avc is a constraint violation. You will need to add an attribute to either the source or target type to make it work. #Constraint rule: # Possible cause source context and target context 'level' differ allow initrc_t syslogd_t:unix_dgram_socket sendto;</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre></div></div> 既存のルールは次のとおりです。 <div class="spoiler">  <b class="spoiler_title">sesearch</b> <div class="spoiler_text"><pre> <code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># sesearch --allow -s initrc_t -t syslogd_t -c unix_dgram_socket Found 2 semantic av rules: allow initrc_t syslogd_t : unix_dgram_socket sendto ; allow unconfined_domain_type domain : unix_dgram_socket { ioctl read write create getattr setattr lock relabelfrom relabelto append bind connect listen accept getopt setopt shutdown recvfrom sendto recv_msg send_msg name_bind } ;</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre></div></div> ご覧のとおり、解決規則はすでに存在しています。 さらに、MLSバージョンではなく、このアクセスは許可されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">オフトピック</b> <div class="spoiler_text"> 同時に、制限のないドメインの美しさを理解できます。 彼は「無制限」であるため、すべてが可能です。 このため、strict以外でSELinuxをテストすることはあまり意味がありません。 そして、たとえ厳密ではあるがテスト済みのオブジェクトがある場合でも、一般的に、SELinuxの必要性と信頼性について結論を出すのは時期尚早です。 </div></div> 解決策。 目的の制限が見つかりました： <pre> <code class="bash hljs">mlsconstrain unix_dgram_socket sendto (( l1 eq l2 ) or (( t1 == mlsnetwriteranged ) and ( l1 dom l2 ) and ( l1 domby h2 )) or (( t1 == mlsnetwritetoclr ) and ( h1 dom l2 ) and ( l1 domby l2 )) or ( t1 == mlsnetwrite ) or ( t2 == mlstrustedobject )); <span class="hljs-comment"><span class="hljs-comment"># scontext=system_u:system_r:initrc_t:s0-s3:c0.c31 # tcontext=system_u:system_r:syslogd_t:s3:c0.c31</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 合計、ソケットへのsendto（t1からt2への書き込み）は次の場合に許可されます。 <ul><li> 低いアクセスレベルt1がt2のアクセスレベルと等しい（s0！= s3）、または </li><li> t1   mlsnetwriteranged (,   <i>seinfo -amlsnetwriteranged -x</i> ),     ,  </li><li> t1   mlsnetwritetoclr (, ),  </li><li> t1   mlsnetwrite (,   setrans_t),  </li><li> t2   mlstrustedobject (, syslogd_t  ,   devlog_t) </li></ul>  ,     . ,     audit2allow      ,       .     /dev/log: <pre> <code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># ls -laZ /dev/log srw-rw-rw-. 1 root root system_u:object_r:devlog_t:s3:c0.c31 0 Nov 1 23:06 /dev/log</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> «WTF?!» —   .    tcontext~syslogd_t,    devlog_t?  ps: <pre> <code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># ps -auxZ | grep [r]syslog system_u:system_r:syslogd_t:s3:c0.c31 root 1338 0.0 0.3 30784 972 ? Ssl Nov01 0:00 /usr/sbin/rsyslogd</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>   : rsyslog,    syslogd_t,  <i></i> ,    ,   /dev/log;  <i></i>   /dev/log   devlog_t     .  ,  sendto    ,   ,     . <a href="http://www.spinics.net/lists/selinux/msg10746.html"> </a>      SELinux, Stephen Smalley.  <a href="http://www.spinics.net/lists/selinux/msg10839.html"></a>    ,   .   <a href="http://oss.tresys.com/pipermail/refpolicy/2010-November/003444.html"></a>     syslogd_t  mlstrustedobject,    /proc/`pidof rsyslog`/   mlstrustedobject. ,   ,  Fedora     . ,    —    <i></i>  ,    ,          , ,    .    ,   : <pre> <code class="bash hljs">$ grep <span class="hljs-string"><span class="hljs-string">''</span></span> syslogd_local.* syslogd_local.fc:<span class="hljs-comment"><span class="hljs-comment"># no file contexts redefined here syslogd_local.if:## &lt;summary&gt;syslogd local policy&lt;/summary&gt; syslogd_local.te:policy_module(syslogd_local, 0.0.1) syslogd_local.te:################################################################## syslogd_local.te:require { syslogd_local.te: type syslogd_t; syslogd_local.te:} syslogd_local.te: syslogd_local.te:#============= syslogd_t ============== syslogd_local.te:# mark syslogd_t as mlstrustedobject syslogd_local.te:# this is possible security hole, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> get some heavy brain augmentation and investigate syslogd_local.te:mls_trusted_object(syslogd_t);</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>      .     modules.conf   . </div></div></li></ul></div></div></li><li><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修正するもの</font></font></b> <div class="spoiler_text">    ,     . ,    permissive (/etc/selinux/config),   ,  audit.log c      ,    , newrole, ssh.    enforcing,     .    auditd         ssh: <pre> <code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># sestatus SELinux status: enabled SELinuxfs mount: /sys/fs/selinux SELinux root directory: /etc/selinux Loaded policy name: custom Current mode: enforcing Mode from config file: enforcing Policy MLS status: enabled Policy deny_unknown status: denied Max kernel policy version: 28 root@sandbox:~# cat /var/log/audit/audit.log type=DAEMON_START msg=audit(1383360996.062:2774): auditd start, ver=2.3.2 format=raw kernel=3.10.17-vm-slnx auid=4294967295 pid=1278 subj=system_u:system_r:auditd_t:s3:c0.c31 res=success type=CONFIG_CHANGE msg=audit(1383360996.180:20): audit_backlog_limit=320 old=64 auid=4294967295 ses=4294967295 subj=system_u:system_r:auditctl_t:s0-s3:c0.c31 res=1 type=LOGIN msg=audit(1383361036.430:21): login pid=1568 uid=0 old auid=4294967295 new auid=0 old ses=4294967295 new ses=1 type=LOGIN msg=audit(1383361038.410:22): login pid=1571 uid=0 old auid=4294967295 new auid=0 old ses=4294967295 new ses=2 root@sandbox:~# id -Z root:secadm_r:secadm_t:s0-s3:c0.c31</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> ,      ,      ,   ,  ,  , ,  -,  .  . </div></div></li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したがって、すべてのセットアップが完了し、システムは強制モードで起動します。</font><font style="vertical-align: inherit;">この時点で、原則として、注意深い読者はすでにモジュール化の広範な知識を持ち、政治の構造に堪能であり、m4構文を心から愛しています（または真に嫌いではありません）。 。</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文書にあまり記載されていないが、もう少し領土を深く掘り下げるときです。</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mls </font></font></h4>       <a href="http://en.wikipedia.org/wiki/Common_Criteria"></a> <a href="http://en.wikipedia.org/wiki/Trusted_Computer_System_Evaluation_Criteria"></a> <a href="http://en.wikipedia.org/wiki/ITSEC"></a> ,   ,  ,  ,   (c <a href="http://www.commoncriteriaportal.org/files/ppfiles/lspp.pdf"></a> (PDF) <a href="http://www.commoncriteriaportal.org/files/ppfiles/lspp.pdf"></a> (PDF),         ),      <a href="http://en.wikipedia.org/wiki/Evaluation_Assurance_Level">  </a> ,      . <a href="http://en.wikipedia.org/wiki/Multilevel_security">MLS</a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既存のSELinux制限に、垂直（レベル）と水平（カテゴリ）の2つのレベルの制御を追加します。</font><font style="vertical-align: inherit;">1つ目は「許容値」に過ぎず、許容値が高いほど部下へのアクセスを意味します（「トップシークレット」は「シークレット」とマークされたドキュメントを読み取ることができます）。2つ目は同じレベルの異なるカテゴリです。残りを読む許可を意味するものではありません。</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの両方のレベルの制御は、SELinuxが動作する任意のオブジェクトに割り当てることができるため、これにより、情報とそのフローの分類に関するほとんどすべての要件を実装できます。</font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">階層アクセス、TopSecret-&gt; Secret-&gt; Unclassified、すべてのオブジェクト。</font><font style="vertical-align: inherit;">完全なリストは、flaskディレクトリにあります。</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> データベース内のファイルとネットワーク接続またはテーブルの両方にマークを付けます。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> システムのユーザー権限に関係なく、より低いレベルへの情報漏えいの防止。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> すべてのユーザー（ルートを含む）に対するデフォルトのアクセス制限。認証に応じてロールがさらに区別されます。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> また、システムの99％のその他の過剰。 </font></font></li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もちろん、これにはまずシステムのアーキテクチャを慎重に検討する必要があります。さもなければ、契約社員にinstagramに署名「トップシークレット」を含むドキュメントをレイアウトさせ</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><pre> <code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># cat /etc/selinux/custom/setrans.conf Domain=Playbox # levels s0=SystemLow s3:c0.c31=SystemHigh s0-s3:c0.c31=SystemLow-SystemHigh s1=Confidential s2=Secret # employee categories s1.c0=Ninjas s1.c1=Pirates s1.c2=Jesuses # secret stuff s2.c0=Aliens s2.c1=BigBrother</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、内部アクセス専用にWebサーバーを構成します。</font><font style="vertical-align: inherit;">厳密にs1（機密）レベルで機能します。</font><font style="vertical-align: inherit;">これはデモンストレーションには必要ありませんが、一般的な開発には役立ちます。</font><font style="vertical-align: inherit;">もちろん、IPSecとパケットラベルを設定しません。そうしないと、誰もそれを見ることができません。ローカルコンテキストに制限します。</font><font style="vertical-align: inherit;">テストマシンではsshのみが構成されているため、RefPolicyに記載されていないサーバーを選択しましょう。</font></font><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nginx</font></font></b> <div class="spoiler_text">    <a href="https://github.com/simple10/selinux-nginx/tree/master/nginx"></a>  nginx,      ,     MCS ( s0).     NIH     .  ,   ,  <b>dpkg -L</b>  <b>lsof</b> ,    : <pre> <code class="bash hljs">/usr/sbin/nginx -- gen_context(system_u:object_r:nginx_exec_t,s1:c0.c2) /etc/init.d/nginx gen_context(system_u:object_r:nginx_initrc_exec_t,s1:c0.c2) /etc/nginx(/.*)? gen_context(system_u:object_r:nginx_etc_t,s1:c0.c2) /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/nginx(/.*)? gen_context(system_u:object_r:nginx_var_log_t,s1:c0.c2) /var/run/nginx(/.*)? gen_context(system_u:object_r:nginx_var_run_t,s1:c0.c2) /var/www(/.*)? gen_context(system_u:object_r:nginx_var_www_t,s1:c0.c2) /var/lib/nginx(/.*)? gen_context(system_u:object_r:nginx_var_lib_t,s1:c0.c3)</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> ,    ,    (, ,  ..),     .        s1 (Confidential),       .       ,      .     ,   ,   ( <b>newrole -r secadm_r</b> ),   premissive  ( <b>setenforce 0</b> ),       ( <b>restorecon -RFvv /</b> ),    nginx   sysadm_r ( <b>run_init /etc/init.d/nginx start</b> ).     audit.log  ,   .     modname.if,  ,     ,  «» : <pre> <code class="bash hljs">template(`web_server_template<span class="hljs-string"><span class="hljs-string">',` type $1_t, web_server; allow blah blah; # so we can call web_server_template(nginxN) in modname.te '</span></span>)</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>    modname.if       ,  «» .      .      ,      ,        : <pre> <code class="bash hljs">root@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># cat nginx_local.te policy_module(nginx_local, 0.0.1) ################################################################## type nginx_t; type nginx_exec_t; type nginx_initrc_exec_t; type nginx_etc_t; type nginx_var_log_t; type nginx_var_run_t; type nginx_var_www_t; type nginx_var_lib_t; corecmd_executable_file(nginx_exec_t); init_script_file(nginx_initrc_exec_t) files_type(nginx_etc_t) logging_log_file(nginx_var_log_t) files_pid_file(nginx_var_run_t) files_type(nginx_var_www_t) files_type(nginx_var_lib_t) init_ranged_daemon_domain(nginx_t, nginx_exec_t, s1:c0.c2)</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>        corecommands.if,        .   — ,  MLS,     ,   nginx     . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ,   ,     (grep nginx /var/log/audit/audit.log | grep 'sysctl'),    , ,  sysctl: <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /read kernel sysctl values require { type sysctl_kernel_t; class dir { search }; class file { open read }; } allow nginx_t sysctl_kernel_t:dir { search }; allow nginx_t sysctl_kernel_t:file { open read };</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>  socket: <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># socket bind require { type node_t; type http_port_t; class tcp_socket { name_bind setopt bind create listen node_bind }; class capability { net_bind_service setuid setgid }; } allow nginx_t http_port_t:tcp_socket { name_bind }; allow nginx_t node_t:tcp_socket { node_bind }; allow nginx_t self:tcp_socket { bind create setopt listen }; allow nginx_t self:capability { net_bind_service setuid setgid };</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> などなど。     audit2allow,             MLS.       require    ,   ,        ,   .   ,    -  <div class="spoiler"> <b class="spoiler_title"></b> <div class="spoiler_text"><pre> <code class="bash hljs">policy_module(nginx_local, 0.0.1) <span class="hljs-comment"><span class="hljs-comment">################################################################## type nginx_t; type nginx_exec_t; type nginx_initrc_exec_t; type nginx_etc_t; type nginx_var_log_t; type nginx_var_run_t; type nginx_var_www_t; type nginx_var_lib_t; corecmd_executable_file(nginx_exec_t); init_script_file(nginx_initrc_exec_t) files_type(nginx_etc_t) logging_log_file(nginx_var_log_t) files_pid_file(nginx_var_run_t) files_type(nginx_var_www_t) files_type(nginx_var_lib_t) init_ranged_daemon_domain(nginx_t, nginx_exec_t, s1:c0.c2) # rules # /sys and /sys/devices/systemcpu/online require { type sysfs_t; class dir { search }; class file { read open }; } allow nginx_t sysfs_t:dir { search }; allow nginx_t sysfs_t:file { read open }; # /read kernel sysctl values require { type sysctl_kernel_t; type sysctl_t; class dir { search }; class file { open read }; } allow nginx_t sysctl_kernel_t:dir { search }; allow nginx_t sysctl_kernel_t:file { open read }; allow nginx_t sysctl_t:dir search; # self configs and symlinks require { type nginx_etc_t; class dir { open read search }; class file { open read getattr }; class lnk_file { read }; } allow nginx_t nginx_etc_t:dir { open read search }; allow nginx_t nginx_etc_t:file { open read getattr }; allow nginx_t nginx_etc_t:lnk_file { read }; # /etc/localtime, /etc/passwc, etc (no pun intended) require { type locale_t; type etc_t; class file { read open getattr }; } allow nginx_t locale_t:file { read open getattr }; allow nginx_t etc_t:file { read open getattr }; # pid file require { type var_run_t; class dir { search write add_name remove_name } ; class file { write read create open unlink }; } allow nginx_t var_run_t: dir { search }; allow nginx_t nginx_var_run_t: file { read write create open unlink }; allow nginx_t nginx_var_run_t: dir { search write add_name remove_name }; # libs require { type var_lib_t; class dir { search getattr }; } allow nginx_t var_lib_t:dir search; allow nginx_t nginx_var_lib_t: dir { search getattr }; # socket bind require { type node_t; type http_port_t; class tcp_socket { name_bind setopt bind create listen node_bind }; class capability { net_bind_service setuid setgid }; } allow nginx_t http_port_t:tcp_socket { name_bind }; allow nginx_t node_t:tcp_socket { node_bind }; allow nginx_t self:tcp_socket { bind create setopt listen }; allow nginx_t self:capability { net_bind_service setuid setgid }; # socket accept require { class tcp_socket { read write accept }; } allow nginx_t self:tcp_socket { read write accept }; # logs require { type var_log_t; class dir { search }; class file { open append }; } allow nginx_t var_log_t:dir { search }; allow nginx_t nginx_var_log_t:dir { search }; allow nginx_t nginx_var_log_t:file { open append }; # www require { class dir { search getattr }; class file { read getattr open }; } allow nginx_t nginx_var_www_t:dir { search getattr }; allow nginx_t nginx_var_www_t:file { read getattr open };</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre></div></div> ,      . </div></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 次のようなユーザーとロールを取得します。 </font></font><pre> <code class="bash hljs">root/sysadm_r@sandbox:~<span class="hljs-comment"><span class="hljs-comment"># adduser alice ...skipped... root/sysadm_r@sandbox:~# adduser bob ...skipped... root/secadm_r@sandbox:~# semanage user -a -R user_r -L s1 -r s1-s1:c0 ninjas root/secadm_r@sandbox:~# semanage user -a -R user_r -L s2 -r s2-s2:c0 aliens root/secadm_r@sandbox:~# semanage login -a -s ninjas alice root/secadm_r@sandbox:~# semanage login -a -s aliens bob # or, ninjas to supervise alice root/secadm_r@sandbox:~# restorecon -RFvv /home/ # thats all, folks.</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 合計： </font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 両方のユーザーは、最低レベル以下のディレクトリにデータを書き込むことはできません。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 両方のユーザーは、許容レベルを超えるオブジェクトから読み取ることはできません。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">両方のユーザーはカテゴリによって制限されています。</font><font style="vertical-align: inherit;">他のドメインを読み取るためのアクセス許可ルールを追加すると、カテゴリc0のファイルのみを読み取ることができます。</font></font></li><li> root     ,   ; </li><li>     - SELinux ID,    alice,      ( DAC )    ; </li><li>      ,   ,      core —       s0,   — s1. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> Funky time </h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さて、最後に、スライドがあります。</font><font style="vertical-align: inherit;">本格的なデモンストレーションのために、私はこの記事のために、NSAの隣に小さなVPSKを購入し、その上で行ったすべてをすばやく完了しました。</font><font style="vertical-align: inherit;">このシステムで直接、SELinuxが何であるかを確認し、ルートの下に移動してrm -rf / *を最初に入力し、あらゆる種類のスクリプト/スプリットおよびルートキットを実行します。</font><font style="vertical-align: inherit;">しかし、この魅力的なことを行う前に、仮定と制限の両方の観点から、もう一度調べてみましょう。</font></font><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> このトレーニングコースの一環として、次のことを行います。 </font></font></h5><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 誰でもサーバーへのルートアクセス権を取得したと考えています。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 彼はssh経由でログインし、対話型シェルを実行できると考えています。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Russell Cokerが</font></font><a href="http://www.coker.com.au/selinux/play.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレイマシンで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行ったように、ルートはuser_uでインスタンス化されないと考えています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">もちろん、この仮定は本番環境では推奨されません（もちろん、以前のすべての例と同様に:-)</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> カーネルをカスタマイズしなかったと思います（grsecはありません。記事とテストにこれを含めないことにしました） </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ファイアウォールはほとんどないと考えています。 </font></font></li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISにセキュリティ状態を表す用語があり、その説明に「押し広げる」と「ロールする」という言葉がある場合、これがそれです。</font><font style="vertical-align: inherit;">完全な妥協とは別にSELinuxのみです。</font><font style="vertical-align: inherit;">妥協は避けられませんが、その期間は非常に興味深いものです。</font></font><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> しかし、SELinuxが意図していないものもあります。つまり： </font></font></h5><ul><li> SELinux     .     <b>:(){ :|:&amp; };:</b> .        fork bombs,  - —  ;   ,        ,   —     —      ,     . </li><li> SELinux         .         .    ,    SELinux  iptables —   ,       .  ,    SELinux,   :-) </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーを最小構成で検討します。コンパイラ/デバッガーはなく、通常はprodでは発生しません。</font><font style="vertical-align: inherit;">MLS Play Machineのフルバージョンは、VPSではなく、より制御されたインフラストラクチャに展開するときに後日リリースされます。</font><font style="vertical-align: inherit;">しかし、scpがあります-何か面白いものをコピーできます。</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、はい、SELinuxを開発した組織の最高の伝統では、コンソールの記録もサーバーで同時にテストされています:-)そして、あなたはNSA、アリゾナ、Area51が近くにあり、ここにルートアクセスがあることを理解しています。</font><font style="vertical-align: inherit;">急に車が私のCPUに押し込まれます。</font><font style="vertical-align: inherit;">レコードを削除します-あなたも素晴らしい仲間であり、コメントを書いてください。</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0day-あなたの裁量で。</font><font style="vertical-align: inherit;">それがポップアップした場合、私は確かにお世辞になります。</font><font style="vertical-align: inherit;">とはいえ、私は誰に言っているのか:-)</font></font></li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドメインを起動しませんでした。これは、玩具バージョン0.0.2用です。</font><font style="vertical-align: inherit;">バージョン0.0.1</font></font><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こっち</font></font></b> <div class="spoiler_text">    : http://162.213.198.69 </div></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、はい、別のリクエストは振る舞ってください。</font><font style="vertical-align: inherit;">すべてのルートプロセスを強制終了して他のプロセスを妨害する必要はありません;ユーザーはまったく1人です。</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> 注釈 </h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> *ティムミンチン、子守by </font></font></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J19919/index.html">年初のブラウザの使用に関する統計。 主な傾向。</a></li>
<li><a href="../J199190/index.html">盗作検索システム</a></li>
<li><a href="../J199192/index.html">オリエンセ 視覚障害者を支援する装置の開発</a></li>
<li><a href="../J199196/index.html">Java NIOの高性能SUN / ONCRPCサーバー</a></li>
<li><a href="../J199198/index.html">カスペルスキーは反抗した</a></li>
<li><a href="../J199206/index.html">Web Essentials 2013でのHTMLの最小化</a></li>
<li><a href="../J19921/index.html">マイクロソフトとその他のインターネット。 ヤフーの購入。 シリコンバレーからの眺め。</a></li>
<li><a href="../J199210/index.html">Web開発者（リリース7）にとって興味深いいくつかの便利なこと</a></li>
<li><a href="../J199214/index.html">オランダでの大学院研究：方法（検索、インタビュー、登録）</a></li>
<li><a href="../J199218/index.html">IvBitカンファレンスレポート</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
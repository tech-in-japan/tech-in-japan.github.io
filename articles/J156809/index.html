<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👫 🙍🏿 🧝🏽 iOSプラットフォーム向けのゲームの最適化。 コードのベクトル化 👩‍👩‍👧‍👧 😖 🖐🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ARMv7 CPUアーキテクチャーおよびPowerVR SGX 5 GPUシリーズ向けにゲームを最適化するための経験と知識を説明できる記事を2、3書いて、iOSプラットフォームを読みたいという願望が長年にわたって高まってきました。 しかし、すべてまたはほぼすべてのヒントは、同じハードウェアを備えた他...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>iOSプラットフォーム向けのゲームの最適化。 コードのベクトル化</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body">  ARMv7 CPUアーキテクチャーおよびPowerVR SGX 5 GPUシリーズ向けにゲームを最適化するための経験と知識を説明できる記事を2、3書いて、iOSプラットフォームを読みたいという願望が長年にわたって高まってきました。 しかし、すべてまたはほぼすべてのヒントは、同じハードウェアを備えた他のシステムにも同様に適用できます。Androidを読んでください。 この素材は、ゲームだけでなく、画像処理、オーディオ、ビデオなど、最も要求の厳しいアプリケーションでも使用できます。  <b>NEON</b>のコードのベクトル化である、最も重要なIMHO最適化で最初の記事を始めます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この記事は、24.11に開催される会議へのレポートとして始まりました。  iPhoneの最適化に関する豊富なヒントが<a href="http://nukecode.blogspot.com/2012/10/leran-ios-game-development-hard-way.html">ここにあります</a> 。 次の記事では、このプレゼンテーションの内容の幅と深さを拡大します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      NEONとは何ですか？  NEONは、ARMプロセッサで使用される汎用<abbr title="単一命令複数データ">SIMD</abbr>エンジンです。 ボード上には、それぞれ128ビットの16個のレジスタがあり、64ビットの32個のレジスタと見なすことができます。  NEONは独自のパイプラインを持っていますが、VFPとレジスタを共有しています。  SSEと同様に、データは16バイトで整列する必要があります。  NEONは、非境界整列データの操作方法も知っていますが、通常は2倍遅くなります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      NEONは以下で動作します： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> 符号付き\符号なし8 \ 16 \ 32 \ 64ビット整数データ型。 </li><li> 単精度浮動小数点数-32ビット浮動小数点。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ゲームなどのマルチメディアタスクに最適です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     主なものから始めましょう-現代のすべてのモバイルシステムの中心、システムオンチップまたはSoC（System on Chip）。  iOS Aデバイスは、チップ上のApple Aシリーズのシステム-A4、A5、A5x、A6、およびA6xを使用することが知られています。 これらのチップの最も重要な仕様を表に示します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <table><tbody><tr><th>  <i>CPUの仕様</i> </th><th>  A4 </th><th>  A5 </th><th>  A5x </th><th>  A6 </th></tr><tr><td> 建築 </td><td>  ARMv7 </td><td>  ARMv7 </td><td>  ARMv7 </td><td>  ARMv7 </td></tr><tr><td> コア </td><td> 皮質a8 </td><td> 皮質a9 </td><td> 皮質a9 </td><td> 独自の開発 </td></tr><tr><td>  ＃コア </td><td>  1 </td><td>  2 </td><td>  2 </td><td>  2 </td></tr><tr><td> 周波数、MHz </td><td>  800 </td><td>  1000 </td><td>  1000 </td><td>  1300 </td></tr><tr><td> 拡張機能 </td><td>  VFPv3（VFPLite）、NEON </td><td>  VFPv3、NEON </td><td>  VFPv3、NEON </td><td>  VFPv4、NEON </td></tr><tr><td>  <i>GPUの仕様</i> </td><td></td><td></td><td></td><td></td></tr><tr><td> モデル </td><td>  PowerVR SGX 535 </td><td>  PowerVR SGX 543MP2 </td><td>  PowerVR SGX 543MP4 </td><td>  PowerVR SGX 543MP3 </td></tr><tr><td> 周波数、MHz </td><td>  200 </td><td>  200 </td><td>  200 </td><td>  266 </td></tr></tbody></table>  <i>*注：NEONはCPU周波数で実行されます</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      NEONの周波数はGPUに比べて5倍高いことがわかります。 もちろん、これは、IPC、パイプラインなど、GPUと比較してパフォーマンスが5倍向上するという意味ではありません。 重要です。 ただし、NEONには1つの機能キラーがあります。4つの32ビットフロートを同時に処理できますが、PowerVR SGXは1つだけです。  GPUは4つの半精度浮動小数点数（16ビット）を同時に処理できるため、PowerVR SGX 5シリーズSIMDレジスタの長さは64ビットのようです。 例を考えてみましょう： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cpp hljs">highp vec4 v1, v2; highp <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> s1, s2; <span class="hljs-comment"><span class="hljs-comment">//  v2 = (v1 * s1) * s2; //v1 * s1      – 4 ,       s2,     -  4 . //8    //  v2 = v1 * (s1 * s2); //s1 * s2 – 1    ;  * v1 – 4   . //5   </span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次に、GPUベクトルエンジンで実行される別の例を考えます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs">mediump vec4 v1, v2, v3; highp vec4 s1, s2, s3; v3 = v1 * v2; <span class="hljs-comment"><span class="hljs-comment">//    – 1  s3 = s1 * s2; //    – 4 </span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     たとえば、頂点の位置など、データの<b>highp</b>指定子が必要に<b>なり</b>ます。  NEONからの利益はここで明白です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次に、NEONの別の利点に移りましょう。  PowerVR SGX 5シリーズには、処理するシェーダーの種類、頂点、ピクセルを問わないシェーダープロセッサである<abbr title="ユニバーサルスケーラブルシェーダーエンジン">USSEが</abbr>搭載されて<abbr title="ユニバーサルスケーラブルシェーダーエンジン">い</abbr>ます。 つまり、プログラマーには一定の電力バジェットがあり、頂点処理に費やすかピクセル処理に費やすかはプログラマー次第です。 ここでNEONが助けになります-これが新しい頂点プロセッサです。 ここにトロールフェイスを挿入するのを忘れたと思うかもしれませんが、それはすべて非常に深刻です。 ほぼすべてのモバイルシステムのパフォーマンスは、特に2Dゲーム、特に最近の画面解像度の競争において、フィルレートによって制限されます。 すべての頂点処理をNEONに転送すると、ピクセル処理用のリソースが解放されます。 これに加えて、NEONは描画呼び出しの回数を減らすのに役立ちます-1つのバッチのすべての頂点の位置をワールド座標で計算し、1つの呼び出しでN個のオブジェクトを描画します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     理論は終わりました！ さあ、ハードコアを始めましょう！  NEONを活用する方法はいくつかあります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> コンパイラにコードをベクトル化させます。 悪い方法。 コンパイラーはベクトル化するか、ベクトル化しない場合があります。 コンパイラがコードをベクトル化しても、これが最良のコードになるという事実からはほど遠い。 しかし、一方で、この方法はあなたの側での努力を必要とせず、利益を得ることができます。 それでも、盲目的にコンパイラに頼るのではなく、少なくとも最も重要なコードを手動でベクトル化する必要があります。 </li><li>  NEONアセンブラー。 そして、ここで彼はハードコアです。 真のジェダイとそのすべての道。 ダークマジックを学び、ARMのマニュアルに一晩を費やす必要があります。  NEONコードはARMモードとThumb-2モードの両方で機能することにも留意してください。 </li><li>  NEON組み込み関数（x86のSSEと同じ）。 コンパイラが指定されたものを愚かに挿入するアセンブラとは異なり、組み込み関数は最適化されます。 彼らと一緒に暮らすことははるかに簡単です-命令のタイミングを研究したり、パイプの停滞を避けるためにそれらをシャッフルする必要はありません </li><li> 既にベクトル化されたコード-GLKMath、数学ネオンで使用します。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     それぞれの方法の長所と短所をすべて発見する時が来ました。 これを行うために、単純なデモを作成しました。10,000個のスプライトの各フレームは、画面内で位置をランダムに変更します。 目標は、最小限のCPU負荷で最速のコードを取得することです。結局のところ、ゲームでは、レンダリング用のデータに加えて、多くをカウントする必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     すべてのデータは1つのVBOに保存されます。  Updateメソッドは、射影行列にランダムな位置のModelView行列を乗算します。 次に、各スプライトの各頂点に、結果のModelViewProjectionマトリックスが乗算されます。 各頂点の最終位置は、単に頂点シェーダーのgl_Positionに渡されます。 すべてのデータは16バイトの境界に揃えられます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     メソッド更新コード： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ GLKMatrix4 modelviewMat = { <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> u32 QUADS_COUNT = <span class="hljs-number"><span class="hljs-number">10000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> u32 VERTS_PER_QUAD = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Y_DELTA = <span class="hljs-number"><span class="hljs-number">420.0f</span></span> / QUADS_COUNT; <span class="hljs-comment"><span class="hljs-comment">//     Y float vertDelta = Y_DELTA; for (int i = 0; i &lt; QUADS_COUNT * VERTS_PER_QUAD; i += VERTS_PER_QUAD) { float randX = random() % 260; //     modelviewMat.m[12] = randX; modelviewMat.m[13] = vertDelta; float32x4x4_t mvp; Matrix4ByMatrix4((float32x4x4_t*)proj.m, (float32x4x4_t*)modelviewMat.m, &amp;mvp); for (int j = 0; j &lt; 4; ++j) { Matrix4ByVec4(&amp;mvp, &amp;squareVertices[j], &amp;data[i + j].pos); } vertDelta += Y_DELTA; } glBindBuffer(GL_ARRAY_BUFFER, vertexBuffer); glBufferData(GL_ARRAY_BUFFER, sizeof(data), data, GL_STREAM_DRAW); }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     さて、今度はこの記事の本質であるコードのベクトル化について説明します。 次に、ゲーム開発で最も頻繁に使用される操作の3つの比較アプローチで使用されるコードを示します。ベクトルによる行列乗算と行列による行列乗算です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      GLKMathを使用したコピーペースト： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> __<span class="hljs-function"><span class="hljs-function">inline__ GLKVector4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GLKMatrix4MultiplyVector4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GLKMatrix4 matrixLeft, GLKVector4 vectorRight)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float32x4x4_t</span></span> iMatrix = *(<span class="hljs-keyword"><span class="hljs-keyword">float32x4x4_t</span></span> *)&amp;matrixLeft; <span class="hljs-keyword"><span class="hljs-keyword">float32x4_t</span></span> v; iMatrix.val[<span class="hljs-number"><span class="hljs-number">0</span></span>] = vmulq_n_f32(iMatrix.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], (<span class="hljs-keyword"><span class="hljs-keyword">float32_t</span></span>)vectorRight.v[<span class="hljs-number"><span class="hljs-number">0</span></span>]); iMatrix.val[<span class="hljs-number"><span class="hljs-number">1</span></span>] = vmulq_n_f32(iMatrix.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], (<span class="hljs-keyword"><span class="hljs-keyword">float32_t</span></span>)vectorRight.v[<span class="hljs-number"><span class="hljs-number">1</span></span>]); iMatrix.val[<span class="hljs-number"><span class="hljs-number">2</span></span>] = vmulq_n_f32(iMatrix.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], (<span class="hljs-keyword"><span class="hljs-keyword">float32_t</span></span>)vectorRight.v[<span class="hljs-number"><span class="hljs-number">2</span></span>]); iMatrix.val[<span class="hljs-number"><span class="hljs-number">3</span></span>] = vmulq_n_f32(iMatrix.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], (<span class="hljs-keyword"><span class="hljs-keyword">float32_t</span></span>)vectorRight.v[<span class="hljs-number"><span class="hljs-number">3</span></span>]); iMatrix.val[<span class="hljs-number"><span class="hljs-number">0</span></span>] = vaddq_f32(iMatrix.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], iMatrix.val[<span class="hljs-number"><span class="hljs-number">1</span></span>]); iMatrix.val[<span class="hljs-number"><span class="hljs-number">2</span></span>] = vaddq_f32(iMatrix.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], iMatrix.val[<span class="hljs-number"><span class="hljs-number">3</span></span>]); v = vaddq_f32(iMatrix.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], iMatrix.val[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *(GLKVector4 *)&amp;v; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> __<span class="hljs-function"><span class="hljs-function">inline__ GLKMatrix4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GLKMatrix4Multiply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GLKMatrix4 matrixLeft, GLKMatrix4 matrixRight)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float32x4x4_t</span></span> iMatrixLeft = *(<span class="hljs-keyword"><span class="hljs-keyword">float32x4x4_t</span></span> *)&amp;matrixLeft; <span class="hljs-keyword"><span class="hljs-keyword">float32x4x4_t</span></span> iMatrixRight = *(<span class="hljs-keyword"><span class="hljs-keyword">float32x4x4_t</span></span> *)&amp;matrixRight; <span class="hljs-keyword"><span class="hljs-keyword">float32x4x4_t</span></span> m; m.val[<span class="hljs-number"><span class="hljs-number">0</span></span>] = vmulq_n_f32(iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">1</span></span>] = vmulq_n_f32(iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">2</span></span>] = vmulq_n_f32(iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">3</span></span>] = vmulq_n_f32(iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">0</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">1</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">1</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">1</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">2</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">1</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">3</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">1</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">0</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">1</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">2</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">3</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">0</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">3</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">1</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">3</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">2</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">3</span></span>)); m.val[<span class="hljs-number"><span class="hljs-number">3</span></span>] = vmlaq_n_f32(m.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], iMatrixLeft.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], vgetq_lane_f32(iMatrixRight.val[<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">3</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *(GLKMatrix4 *)&amp;m; }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>  Appleのこれらの操作の実装では、値から変数を転送し、変数をコピーするという、最適なアプローチとはほど遠い方法を使用していることがわかります。 少なくともデバッグアセンブリでは、かなり遅く見えます。 プロファイリング中にこのコードがどのように表示されるかを見てみましょう。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     アセンブラーのアプローチ： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Matrix4ByVec4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ mat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ vec, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">asm</span></span> ( <span class="hljs-string"><span class="hljs-string">"vldmia %0, { d24-d31 } \n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vld1.32 {q1}, [%1]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmul.f32 q0, q12, d2[0]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q0, q13, d2[1]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q0, q14, d3[0]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q0, q15, d3[1]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vstmia %2, { q0 }"</span></span> : : <span class="hljs-string"><span class="hljs-string">"r"</span></span> (mat), <span class="hljs-string"><span class="hljs-string">"r"</span></span> (vec), <span class="hljs-string"><span class="hljs-string">"r"</span></span> (result) : <span class="hljs-string"><span class="hljs-string">"memory"</span></span>, <span class="hljs-string"><span class="hljs-string">"q0"</span></span>, <span class="hljs-string"><span class="hljs-string">"q1"</span></span>, <span class="hljs-string"><span class="hljs-string">"q8"</span></span>, <span class="hljs-string"><span class="hljs-string">"q9"</span></span>, <span class="hljs-string"><span class="hljs-string">"q10"</span></span>, <span class="hljs-string"><span class="hljs-string">"q11"</span></span> ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Matrix4ByMatrix4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ m1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ m2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">asm</span></span> ( <span class="hljs-string"><span class="hljs-string">"vldmia %1, { q0-q3 } \n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vldmia %2, { q8-q11 }\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmul.f32 q12, q8, d0[0]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmul.f32 q13, q8, d2[0]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmul.f32 q14, q8, d4[0]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmul.f32 q15, q8, d6[0]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q12, q9, d0[1]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q13, q9, d2[1]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q14, q9, d4[1]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q15, q9, d6[1]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q12, q10, d1[0]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q13, q10, d3[0]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q14, q10, d5[0]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q15, q10, d7[0]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q12, q11, d1[1]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q13, q11, d3[1]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q14, q11, d5[1]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vmla.f32 q15, q11, d7[1]\n\t"</span></span> <span class="hljs-string"><span class="hljs-string">"vstmia %0, { q12-q15 }"</span></span> : : <span class="hljs-string"><span class="hljs-string">"r"</span></span> (result), <span class="hljs-string"><span class="hljs-string">"r"</span></span> (m2), <span class="hljs-string"><span class="hljs-string">"r"</span></span> (m1) : <span class="hljs-string"><span class="hljs-string">"memory"</span></span>, <span class="hljs-string"><span class="hljs-string">"q0"</span></span>, <span class="hljs-string"><span class="hljs-string">"q1"</span></span>, <span class="hljs-string"><span class="hljs-string">"q2"</span></span>, <span class="hljs-string"><span class="hljs-string">"q3"</span></span>, <span class="hljs-string"><span class="hljs-string">"q8"</span></span>, <span class="hljs-string"><span class="hljs-string">"q9"</span></span>, <span class="hljs-string"><span class="hljs-string">"q10"</span></span>, <span class="hljs-string"><span class="hljs-string">"q11"</span></span>, <span class="hljs-string"><span class="hljs-string">"q12"</span></span>, <span class="hljs-string"><span class="hljs-string">"q13"</span></span>, <span class="hljs-string"><span class="hljs-string">"q14"</span></span>, <span class="hljs-string"><span class="hljs-string">"q15"</span></span> ); }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> アセンブラーに慣れていない人にとっては、すべてがかなり怖いようです-私自身もそうです、私はNEONアセンブラーしか理解できません。 しかし、実際には、ここではすべてが単純です。実際には、 <i>q1〜q15</i>はNEONレジスタです。  <b>vldmia \ vld1.32-</b>ダウンロード手順。  <b>vstmia-</b>メモリ内の保存。  <b>vmul.f32 \ vmla.f32-</b>乗算\乗算および加算。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     組み込みメソッド： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Matrix4ByVec4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ mat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ vec, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ result)</span></span></span><span class="hljs-function"> </span></span>{ (*result) = vmulq_n_f32((*mat).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], (*vec)[<span class="hljs-number"><span class="hljs-number">0</span></span>]); (*result) = vmlaq_n_f32((*result), (*mat).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], (*vec)[<span class="hljs-number"><span class="hljs-number">1</span></span>]); (*result) = vmlaq_n_f32((*result), (*mat).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], (*vec)[<span class="hljs-number"><span class="hljs-number">2</span></span>]); (*result) = vmlaq_n_f32((*result), (*mat).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], (*vec)[<span class="hljs-number"><span class="hljs-number">3</span></span>]); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Matrix4ByMatrix4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ m1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ m2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float32x4x4_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* __restrict__ r)</span></span></span><span class="hljs-function"> </span></span>{ (*r).val[<span class="hljs-number"><span class="hljs-number">0</span></span>] = vmulq_n_f32((*m1).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">1</span></span>] = vmulq_n_f32((*m1).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">2</span></span>] = vmulq_n_f32((*m1).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">3</span></span>] = vmulq_n_f32((*m1).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">0</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">1</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">1</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">1</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">2</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">1</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">3</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">1</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">0</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">1</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">2</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">3</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">0</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">3</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">1</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">3</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">2</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">3</span></span>)); (*r).val[<span class="hljs-number"><span class="hljs-number">3</span></span>] = vmlaq_n_f32((*r).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], (*m1).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], vgetq_lane_f32((*m2).val[<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">3</span></span>)); }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>  GLKMathとほぼ同じコードですが、わずかな違いがあります。 説明： <b>vmulq_n_f32-</b>ベクトルとスカラーの乗算。  <b>vgetq_lane_f32-</b>ベクトルからスカラーを選択するマクロ。  <b>vmlaq_n_f32-</b>スカラーを<b>乗算</b>して加算します。 このコードは、アセンブラーを組み込み関数に単に反映したものです。 彼が彼と比較してどのように彼自身を示すか見てみましょう。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      iPod Touch 4でテストを行いました。表には、更新機能のプロファイリング結果が含まれています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <table><tbody><tr><th> アプローチ </th><th> 実行時間、ミリ秒 </th><th>  CPU負荷、％ </th></tr><tr><td>  FPU </td><td>  6058 + 5067 * </td><td>  35〜38 </td></tr><tr><td>  GLKMath </td><td>  2789 </td><td>  20-23 </td></tr><tr><td> アセンブラー </td><td>  5304 </td><td>  23-25 </td></tr><tr><td> 真性 </td><td>  2803 </td><td>  18-20 </td></tr></tbody></table>  <i>* Instrumentsの<a href="">スクリーンショット</a>では、Matrix4ByMatrix4関数がインライン化されていないことがわかります。</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ここに別のヒントがあります-パフォーマンスが重要なコードを積極的にインライン化します。 このような場合は、通常の<b>インライン</b>よりも<b>__attribute __（（always_inline））</b>を<b>優先してください</b> 。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     更新された結果表： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <table><tbody><tr><th> アプローチ </th><th> 実行時間、ミリ秒 </th><th>  CPU負荷、％ </th></tr><tr><td>  FPU強制インライン化 </td><td>  6209 </td><td>  25〜28 </td></tr><tr><td>  GLKMath </td><td>  2789 </td><td>  20-23 </td></tr><tr><td> アセンブラー </td><td>  5304 </td><td>  23-25 </td></tr><tr><td> 真性 </td><td>  2803 </td><td>  18-20 </td></tr></tbody></table> 強制インライン化により、パフォーマンスが非常に向上しました！ コードの自動ベクトル化がどのように表示されるかを見てみましょう。 必要なのは、プロジェクト設定の<i>その他のCフラグ</i>に<b>–mllvm –vectorize –mllvm –bb-vectorize-aligned-only</b>を追加すること<b>だけ</b>です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     最終結果表： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <table><tbody><tr><th> アプローチ </th><th> 実行時間、ミリ秒 </th><th> 実行時間（ベクトル）、ms </th><th>  CPU負荷、％ </th><th>  CPU負荷（ベクトル）、％ </th></tr><tr><td>  FPU強制インライン化 </td><td>  6209 </td><td>  5028 </td><td>  25〜28 </td><td>  22-24 </td></tr><tr><td>  GLKMath </td><td>  2789 </td><td>  2776 </td><td>  20-23 </td><td>  20-23 </td></tr><tr><td> アセンブラー </td><td>  5304 </td><td>  5291 </td><td>  23-25 </td><td>  22-24 </td></tr><tr><td> 真性 </td><td>  2803 </td><td>  2789 </td><td>  18-20 </td><td>  18-20 </td></tr></tbody></table>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     アセンブラーと組み込み関数の場合、かなり奇妙な結果が観察されます-実際にはコードは同じですが、結果は劇的に異なります-ほぼ2回です！ この質問に対する答えは、アセンブリのリスト（自分で調べたい人）にあります。 アセンブラの場合、リストに書いたものを正確に見ることができます。 組み込み関数の場合、コンパイラはコードを最適化しました。 ゆっくり、一見したところ、GLKMathコードコンパイラは完全に最適化されており、手動で記述された組み込み関数と同じコード実行時間を与えました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">スクリーンショットの結果</b> <div class="spoiler_text">  <a href="">FPU強制インライン化</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="">FPU自動ベクトル化</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="">GLKMath</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="">アセンブラー</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="">真性</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     在庫を取る時です。 いくつかの結論を引き出すことができます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  LLVMのエンジニアは素晴らしい仕事をしました。 その結果、コンパイラは最適化された組み込みコードを生成します。  Xcodeの唯一のコンパイラがGCC 4.2で、1年以上前に同様のテストを行いましたが、FPUコードと比較してパフォーマンスが10〜15％しか向上しませんでした。 これは素晴らしいニュースです。アセンブラーを学ぶ必要はなく、私はそれについて非常に満足しています！ </li><li>  clangコンパイラは、コードを自動ベクトル化できます。 プログラマーにとって、これはたった4語で書くことによるパフォーマンスボーナスです。 これがクールなものであることを除いて、私は他に何を言うことができますか？！ </li><li>  NEONコードは、通常のCコードに比べてパフォーマンスが2.22倍向上しています。 最適化の結果、頂点処理はこれらの頂点をGPU側にコピーするよりも高速になりました！  memcpyアセンブラーを見ると、そこでNEONコードも使用されていることがわかります。  Cortex A8にハードウェアダニがないため、コードが遅くなります。 </li><li> 特にあなたの目標がプロになることである場合、これらすべての低レベルのことを学ぶことは価値があります。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5> 参照資料 </h5>  <a href="http://www.arm.com/products/processors/technologies/neon.php">www.arm.com/products/processors/technologies/neon.php</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://blogs.arm.com/software-enablement/161-coding-for-neon-part-1-load-and-stores/">blogs.arm.com/software-enablement/161-coding-for-neon-part-1-load-and-stores</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://code.google.com/p/math-neon/">code.google.com/p/math-neon</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://llvm.org/devmtg/2012-04-12/Slides/Hal_Finkel.pdf">llvm.org/devmtg/2012-04-12/Slides/Hal_Finkel.pdf</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://code.google.com/p/neon-demo/">デモプロジェクト</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J15680/index.html">iPod Nano-クローン3の攻撃</a></li>
<li><a href="../J156801/index.html">ARM ChrUbuntu 12.04 Alpha-UbuntuをSamsung Chromebookに移植</a></li>
<li><a href="../J156803/index.html">最も人気のあるプログラミング言語</a></li>
<li><a href="../J156805/index.html">RTFフォームに基づいてレポートを準備する簡単な方法</a></li>
<li><a href="../J156807/index.html">Linuxでの紙文書の便利なコピー</a></li>
<li><a href="../J15681/index.html">WebアプリケーションでのPerl vs C、テスト結果</a></li>
<li><a href="../J156811/index.html">Appleプッシュ通知サービスガイド</a></li>
<li><a href="../J156813/index.html">トピックに関するウェビナー：すべてのスタートアップの失敗につながる5つの最も一般的な間違いを避ける方法</a></li>
<li><a href="../J156819/index.html">パウ-軽量、高速、快適</a></li>
<li><a href="../J15682/index.html">FirefoxとGoogleの関係のいくつかの側面。</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
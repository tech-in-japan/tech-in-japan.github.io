<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛸 🏿 😀 Perl-要求によりHTTPサーバーにファイルを送信します 👩🏿‍🤝‍👩🏾 💪🏽 ⛅️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="実際、オリジナルではなく、ドキュメンテーションだけで十分です。ただし、後者は非常に強い苦痛を引き起こします。 したがって、レーキを10回読んで踏むよりも、実際にどのように、何をしているのかを実際に示す方が簡単です。 条件：ローカルにあるいくつかのバイナリファイルがあり、これらのファイルを配置する必要...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>Perl-要求によりHTTPサーバーにファイルを送信します</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/63432/"> 実際、オリジナルではなく、ドキュメンテーションだけで十分です。ただし、後者は非常に強い苦痛を引き起こします。 したがって、レーキを10回読んで踏むよりも、実際にどのように、何をしているのかを実際に示す方が簡単です。 条件：ローカルにあるいくつかのバイナリファイルがあり、これらのファイルを配置する必要があるサーバーがあります。このサーバーには、ファイルをアップロードするスクリプト（フォームハンドラー）があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     タスク：これらのファイルは、Webインターフェイス（フォームハンドラー）を介してサーバーに追加する必要があります。これは、私たちがブラウザーであり、フォームを介してデータを送信したかのようです。 <a name="habracut"></a><h4>  LWPの使用:: UserAgent </h4> クエリ生成アルゴリズム： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> リクエストを作成する（HTTP ::リクエスト）; </li><li>  「ブラウザ」（LWP :: UserAgent）を作成します。 </li><li> ヘッダーを定義します。 </li><li> リクエストを送信します。 </li></ul>  XML :: LibXMLのように退屈ですが、信頼性が高いため、Perlコード（1） <pre> ＃！/ usr / bin / perl

厳格な使用;
警告を使用します。
 LWPを使用:: UserAgent;

 ＃これは送信するファイルです
私の$ file = './files/some_file.bin';
 ＃これはリクエストを送信するURIです
私の$ uri = 'http://somedomain.com/form/action/script';

 ＃リクエストオブジェクト
私の$ request = HTTP :: Request-&gt; new（ 'POST'、$ uri）;

 ＃セパレータを作成します。強制しない場合、$ ua-&gt; request（$ request）でメインヘッダーに移動しません
 ＃ただし、ヘッダーオブジェクトの形成後に$ request-&gt; as_stringを作成するだけで、デフォルトで置換されますが、リスクはありません
私の$境界= 'X';
 my @rand =（ 'a' .. 'z'、 'A' .. 'Z'）;
 for（0..14）{$ boundary。= $ rand [rand（@rand）];}

 ＃見出しを作成します：
 $ request-&gt; header（ 'Content-Type' =&gt; 'multipart / form-data; boundary ='。$ boundary）;
 $ request-&gt; header（ 'User-Agent' =&gt; '&lt;i&gt; Mozilla Firefox 5.0 :-) &lt;/ i&gt;'）;
 $ request-&gt; header（ 'Referer' =&gt; '&lt;i&gt; http://somedomain.com/form &lt;/ i&gt;'）;
 $ request-&gt; protocol（ 'HTTP / 1.0'）;  ＃LWP :: UserAgentがこれを行いますが、すぐに改善される

 ＃通常のテキスト形式のパラメーターの形成
 my $ field = HTTP :: Message-&gt; new（
                                 [
                                     'Content-Disposition' =&gt; 'フォームデータ;  name = "&lt;i&gt;フィールド名&lt;/ i&gt;" '、
                                     'Content-Type' =&gt; 'text / plain;  charset = utf-8 '、
                                 ]）;  ＃HTTP :: Headersヘッダーは、HTTP :: Messageオブジェクトの作成中に置換されます
 $ field-&gt; add_content_utf8（ '&lt;i&gt; somevalue &lt;/ i&gt;'）;  ＃どうやら、somevalueはUTF-8である必要があります
 $ request-&gt; add_part（$フィールド）;
 ＃...など、各テキストフィールドについて...

 ＃バイナリフォームパラメーターの形成
オープン（私の$ fh、 '&lt;'、$ファイル）;
 ＃そして、最初にヘッダーを作成し、それをHTTP :: Messageに適用できます
     my $ size =（stat $ file）[7];
     my $ header = HTTP :: Headers-&gt; new;
     $ header-&gt; header（ 'Content-Disposition' =&gt; 'form-data; name = "&lt;i&gt; file &lt;/ i&gt;"; filename = "&lt;i&gt; somefile.bin &lt;/ i&gt;'）;＃ただしfilenameファイル名から計算できます
     $ header-&gt; header（ 'Content-Type' =&gt; '&lt;i&gt; application / octet-stream &lt;/ i&gt;'）;  ＃またはファイルの種類に適した
     my $ file_content = HTTP :: Message-&gt; new（$ header）;
     $ file_content-&gt; add_content（$ _）while &lt;$ fh&gt;;
     $ request-&gt; add_part（$ file_content）;
 $ fhを閉じます。
 ＃...など、各ファイルについて...

私の$ response = $ ua-&gt; request（$ request）;
 if（$ response-&gt; is_success）{
    印刷$応答-&gt;コンテンツ
 } else {
     die $ response-&gt; status_line
 } </pre><h4> ソケットを使用する </h4> すべては問題ありませんが、転送用の大きなファイルがある場合、リクエストを収集するためにメモリに完全にアップロードすることは最良の見込みではありません。 したがって、ソケットストリームを介してリクエストを送信することが可能です：Perlコード（2） <pre> ＃！/ usr / bin / perl

厳格な使用;
警告を使用します。
 HTTP ::ヘッダーを使用します。
 HTTP ::メッセージを使用します。
 HTTP ::要求を使用します。
 HTTPを使用::応答;
 IOを使用する::ソケット:: INET;

 ＃これは送信するファイルです
私の$ file = './files/some_file.bin';
 ＃これはリクエストを送信するURIです
私の$ uri = 'http://somedomain.com/form/action/script';
 ＃ソケットを使用するため、ドメイン、ポート、およびパスが個別に必要です
 my（$ドメイン、$ポート、$パス）= $ uri =〜m / ^（？：https？\：\ / \ /）？（[^ \ / \：] +）（？：\：（\ d + ））？（。+）$ /;
 $ポート|| = 80;  ＃デフォルト
    
 ＃自転車はもちろん良いですが、既成のモジュールを使用して簡単にヘッダーと非バイナリのリクエスト本文を作成できます
 my $ header = HTTP :: Headers-&gt; new;  $ header-&gt; header（ 'Content-Type' =&gt; 'multipart / form-data'）;
私の$ request = HTTP :: Request-&gt; new（ 'POST'、$ uri、$ header）;  ＃$パスの代わりに、$ uriがあるので、;-)
 $ request-&gt; protocol（ 'HTTP / 1.0'）;  ＃プロトコルがデフォルトでHTTP :: Requestを設定しないのは奇妙なので、自分で設定します

 ＃テキストフィールドなどの少量のデータの場合、自転車も冗長になります
 ＃（SFCI）条件は前のコード（1）と同じです
 my $ field = HTTP :: Message-&gt; new（
                                 [
                                     'Content-Disposition' =&gt; 'フォームデータ;  name = "&lt;i&gt;フィールド名&lt;/ i&gt;" '、
                                     'Content-Type' =&gt; 'text / plain;  charset = utf-8 '、
                                 ]）;
 $ field-&gt; add_content_utf8（ '&lt;i&gt; somevalue &lt;/ i&gt;'）;  ＃そしてここもutf8
 $ request-&gt; add_part（$フィールド）;
 ＃...など、各テキストフィールドについて...

 ＃さらに、リクエストはありますが、ファイルはありませんが、メインヘッダーとコンテンツの最初の部分に分かれています
 ＃$ request-&gt; headers-&gt; as_stringの正規表現を分割して、リクエストの最初の行、つまりPOSTコマンドを返しません。
 ＃もちろん、文字列は自分で収集できますが、怠butです。
 my（$ head、$ content）= $ request-&gt; as_string =〜m / ^（。+？）\ n \ n（。+）$ / s;
 ＃コンテンツは完成していないため、切り捨てます-[LF] [EOF]
 $ content = substr（$ content、0、-4）;
 ＃同様に境界
 $ content =〜s /（\-\-[^ \ n] +）$ // s;
私の$境界= $ 1;
 ＃仮リクエストの長さを読む
私の$長さ=長さ$コンテンツ;

 ＃これでファイル：
私の$ファイル= [];
 my $ size =（stat $ file）[7];
 my $ f_header = HTTP :: Headers-&gt; new;
 $ f_header-&gt; header（ 'Content-Disposition' =&gt; 'form-data; name = "&lt;i&gt; file &lt;/ i&gt;"; filename = "&lt;i&gt; somefile.bin &lt;/ i&gt;'）;
 $ f_header-&gt; header（ 'Content-Type' =&gt; '&lt;i&gt; application / octet-stream &lt;/ i&gt;'）;
 $ f_header = $ boundary。 "\ n"。$ f_header-&gt; as_string。 "\ n";
 ＃リクエストの長さに追加します
 $ length + = length $ f_header;
 $長さ+ = $サイズ;
 ＃実際には、以下の手順は、多くのファイルがある場合にのみ使用されます。
 ＃次に、コンテンツの長さを計算する必要があります。コンテンツの長さはメインヘッダーで示されるためです
 push @ {$ files}、{header =&gt; $ f_header、file =&gt; $ file};
 ＃...など、各ファイルについて...

 ＃これで完了です
 $ length + = length $ boundary .'-- ';  ＃エンドラインも考慮
 ＃ソケットを開く
 my $ socket = IO :: Socket :: INET-&gt; new（$ domain。 '：'。$ port）|| 死ぬ！
 ＃メインタイトルまでは長い
 $ head。= "\ nContent-Length："。$ length;
 ＃ヘッダーとコンテンツの最初の（テキスト）部分をソケットに送信します
 $ socket $ headを印刷します。
 print $ socket "\ n \ n";
 $ socket $コンテンツを印刷します。

 foreach my file（@ {$ files}）{
     print $ socket $ file-&gt; {header};
     open（my $ fh、 '&lt;'、$ file-&gt; {file}）;
     print $ socket $ _ while &lt;$ fh&gt;;
     print $ socket "\ n";
     $ fhを閉じます。
 }

 ＃ファイルの終わりをソケットに送信
 print $ socket $ boundary .'-- '; 
 ＃ファイルの終わりをソケットに送信
シャットダウン（$ソケット、1）;
 ＃ソケットから応答を取得して解析する
 my $ response = HTTP :: Response-&gt; parse（join（ ''、&lt;$ socket&gt;））;
 if（$ response-&gt; is_success）{
    印刷$応答-&gt;コンテンツ
 } else {
     die $ response-&gt; status_line
 }
    </pre> よくやった（SFCI）コードで斜体で強調表示されているものはすべて、タスク条件の対応する値で置き換える必要があることに注意してください注：SFCI-コピパスターの馬鹿のための特別な。 コメントはありません。 </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J63425/index.html">OperaのOperaメニューの調整</a></li>
<li><a href="../J63426/index.html">目の動きの記録に関する第5チャネル</a></li>
<li><a href="../J63428/index.html">ライセンス供与された音楽をYotaサブスクライバーにダウンロードできるようになりました</a></li>
<li><a href="../J63429/index.html">通信会社とインターネットの種類</a></li>
<li><a href="../J63430/index.html">パンバゴンの奉献-すべてのバッグの神殿</a></li>
<li><a href="../J63434/index.html">LinuxでFirefox 3.5用に正常にコンパイルされたGoogleギア</a></li>
<li><a href="../J63435/index.html">Netflix 百万ドルの競争が最終段階に入った</a></li>
<li><a href="../J63436/index.html">Spezify</a></li>
<li><a href="../J63438/index.html">クローズドベータマジェスティ2</a></li>
<li><a href="../J63442/index.html">ユーザーのブラウザは必要な範囲でCSSをサポートしていますか？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏂🏻 🏢 🏴󠁧󠁢󠁳󠁣󠁴󠁿 C＃5.0の非同期/待機および実装メカニズム 🙏🏿 👏 💥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="コンパイラによる非同期コード変換の詳細  
  
 非同期メカニズムは、.NETベースクラスライブラリのサポートにより、C＃コンパイラに実装されます。 ランタイム自体は変更する必要がありませんでした。 つまり、awaitキーワードは、以前のバージョンのC＃で記述できたビューに変換することで実装されま...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>C＃5.0の非同期/待機および実装メカニズム</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/260217/"><h1> コンパイラによる非同期コード変換の詳細 </h1>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     非同期メカニズムは、.NETベースクラスライブラリのサポートにより、C＃コンパイラに実装されます。 ランタイム自体は変更する必要がありませんでした。 つまり、awaitキーワードは、以前のバージョンのC＃で記述できたビューに変換することで実装されます。  .NET ReflectorまたはILSpyデコンパイラーを使用して、生成されたコードを調べることができます。 これは興味深いだけでなく、デバッグ、パフォーマンス分析、および非同期コードの他のタイプの診断にも役立ちます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> スタブ法 </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     まず、非同期メソッドの簡単な例を考えてみましょう。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;Int32&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MethodTaskAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Int32 one = <span class="hljs-number"><span class="hljs-number">33</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Task.Delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> one; }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この例は非常に単純ですが、非同期/待機の実装の基本原理を説明するのに十分実用的で便利です。  ILSpyを実行し、C＃コンパイラーが自動的に生成するコードを調べます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs django"><span class="xml"><span class="xml"> [AsyncStateMachine(typeof(Program.</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MethodTaskAsync</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">d__0))] public Task</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> MethodTaskAsync() { Program.</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MethodTaskAsync</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">d__0 </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MethodTaskAsync</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">d__ = new Program.</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MethodTaskAsync</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">d__0(); </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MethodTaskAsync</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">d__.</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&gt;</span></span></span><span class="xml">4__this = this; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MethodTaskAsync</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">d__.</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&gt;</span></span></span><span class="xml">t__builder = AsyncTaskMethodBuilder</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">.Create(); </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MethodTask</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">d__.</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&gt;</span></span></span><span class="xml">1__state = -1; AsyncTaskMethodBuilder</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">int</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&gt;</span></span></span><span class="xml">t__builder = </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MethodTaskAsync</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">d__.</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&gt;</span></span></span><span class="xml">t__builder; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&gt;</span></span></span><span class="xml">t__builder.Start</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Program.</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">MethodTaskAsync</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">d__0&gt;(ref </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MethodTaskAsync</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">d__); return </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MethodTaskAsync</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">d__.</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&gt;</span></span></span><span class="xml">t__builder.Task; }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     面白いですね。  asyncキーワードは、メソッドが外部で使用される方法には影響しません。 これは、コンパイラによって生成されたメソッドのシグネチャが、非同期という単語を除いて元のメソッドに対応するため、顕著です。 ある程度まで、非同期指定子はメソッドシグネチャの一部とは見なされません。たとえば、仮想メソッドのオーバーライド、インターフェイスの実装、または呼び出しの場合です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      asyncキーワードの唯一の目的は、対応するメソッドのコンパイル方法を変更することであり、環境との相互作用には影響しません。 また、「新しい」メソッドには元のコードの痕跡がないことに注意してください。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> ステートマシン構造 </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     上記の例では、コンパイラーはAsyncStateMachine属性をメソッドに自動的に適用しました。 メソッド（MethodTaskAsync）に非同期修飾子がある場合、コンパイラはステートマシン構造を含むILを生成します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この構造には、メソッド内のコードが含まれています。  ILコードには、ステートマシンで呼び出されるスタブメソッド（MethodTaskAsync）も含まれています。 コンパイラは、対応するステートマシンを識別できるように、AsyncStateMachine属性をスタブメソッドに追加します。 これは、プログラムが待機状態になった時点でメソッドの状態を保存できるオブジェクトを作成するために必要です。 結局のところ、ご存知のように、このキーワードの前のコードは呼び出しスレッドで実行され、到達すると、プログラムの場所に関する情報が保存されるため、プログラムが再開したときに実行を継続できます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     コンパイラは異なる動作をする可能性があります。すべてのメソッド変数を保存するだけです。 しかし、その場合、多くのコードを生成する必要があります。 ただし、それ以外の方法、つまり、あるタイプのインスタンスを作成し、すべてのメソッドデータをこのオブジェクトのメンバーとして保存することもできます。 次に、このオブジェクトを保存すると、すべてのローカルメソッド変数が自動的に保存されます。 これは、有限状態機械と呼ばれる形成された構造が設計されたものです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     つまり、状態マシンは抽象マシンであり、その内部状態の数は有限です。 大まかに言えば、状態マシンは、ユーザーの目には、何かを転送してそこから何かを取得できるブラックボックスです。 これは非常に便利な抽象化であり、複雑なアルゴリズムを隠すことができます。さらに、有限状態マシンは非常に効率的です。 さらに、出力語が形成される入力文字の有限セットがあります。 また、各入力シンボルがマシンを新しい状態に移行することにも留意する必要があります。 この場合、入力状態は非同期操作の状態になり、この値に基づいて、状態マシンは特定の状態を形成し、それに応じてタスク（出力ワード）への反応を形成します。 このアプローチにより、非同期タスクの形成と管理が簡素化されます有限状態マシンに関する詳細情報は、インターネット上に詳細な記事が多数掲載されています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ステートマシンはクラスの形式で形成され、次のメンバー変数が含まれます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs vala"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int32</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;&gt;1__state'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int32</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;one&gt;5__1'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Mechanism_async.Program <span class="hljs-string"><span class="hljs-string">'&lt;&gt;4__this'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> System.Runtime.CompilerServices.AsyncTaskMethodBuilder`<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int32</span></span>&gt; <span class="hljs-string"><span class="hljs-string">'&lt;&gt;t__builder'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> System.Runtime.CompilerServices.TaskAwaiter <span class="hljs-string"><span class="hljs-string">'&lt;&gt;u__awaiter'</span></span>;</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>すべての変数の名前には、コンパイラによって名前が生成されることを示す山括弧が含まれています。</i>  <i>これは、生成されたコードがユーザーコードと競合しないようにするために必要です。正しいC＃では、変数名に山括弧を含めることができないためです。</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> 最初の変数<i>&lt;&gt; 1_stateに</i>は、到達したawaitステートメントの数が格納されます。 待機が発生するまで、この変数の値は-1です。 元のメソッドのすべての待機演算子には番号が付けられ、一時停止の時点で待機番号が状態変数に入力されます。その後、実行を再開する必要があります。 </li><li> 次の変数<i>&lt;one&gt; 5_1</i>は、元の変数oneを格納するために使用されます。 コンパイラーによって生成されたコードでは、この変数へのすべての呼び出しは、このメンバー変数への呼び出しに置き換えられます。 </li><li> 次に、変数<i>&lt;&gt; 4_thisが見つかり</i>ます。 これは、非静的非同期メソッドの状態マシンでのみ検出され、呼び出されたオブジェクトに代わって含まれています。 ある意味では、これは別のローカルメソッド変数であり、同じオブジェクトの他の変数メンバーにアクセスするためにのみ使用されます。 非同期メソッドを変換するプロセスでは、元のオブジェクトのコードがステートマシンの構造に転送されるため、非同期メソッドを保存して明示的に使用する必要があります。 </li><li>  <i>AsyncTaskMethodBuilder（&lt;&gt; t__builder）</i> -タスクを返す非同期メソッドのビルダーを表します。 このヘルパー型とそのメンバーは、コンパイラーによって使用されることを意図しています。 これにより、すべてのステートマシンに共通のロジックがカプセル化されます。 スタブによって返されるTaskオブジェクトを作成するのはこのタイプです。 実際、このタイプは、後で完了できるパペットタスクを作成するという意味で、TaskCompletionSourceクラスに非常に似ています。  TaskCompletionSourceとの違いは、AsyncTaskMethodBuilderが非同期メソッド用に最適化されており、パフォーマンスを向上させるために、クラスではなく構造体であることです。 </li><li>  <i>TaskAwaiter（&lt;&gt; u_awaiter）</i> -これは、非同期タスクの完了を待つ一時オブジェクトが保存される場所です。 構造体としても提示され、待機オペレーターがタスクが完了したという通知にサインアップするのに役立ちます。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     コンパイラの内部で実際に何が起こるかについてのより詳細な研究のために、&lt;MethodTaskAsync&gt; d__0のコンパイラによって生成されたILコードを検討してください。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">ILコード</b> <div class="spoiler_text"><pre> <code class="tex hljs">.class nested private auto ansi sealed beforefieldinit '&lt;MethodTaskAsync&gt;d__0' extends [mscorlib]System.Object implements [mscorlib]System.Runtime.CompilerServices.IAsyncStateMachine { .custom instance void [mscorlib]System.Runtime.CompilerServices.CompilerGeneratedAttribute::.ctor() = ( 01 00 00 00 ) // Fields .field public int32 '&lt;&gt;1__state' .field public valuetype [mscorlib]System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1&lt;int32&gt; '&lt;&gt;t__builder' .field public class Asynchronous.Program '&lt;&gt;4__this' .field private int32 '&lt;one&gt;5__1' .field private valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter '&lt;&gt;u__1' // Methods .method public hidebysig specialname rtspecialname instance void .ctor () cil managed { // Method begins at RVA 0x20ef // Code size 8 (0x8) .maxstack 8 IL_0000: ldarg.0 IL_0001: call instance void [mscorlib]System.Object::.ctor() IL_0006: nop IL_0007: ret } // end of method '&lt;MethodTaskAsync&gt;d__0'::.ctor .method private final hidebysig newslot virtual instance void MoveNext () cil managed { .override method instance void [mscorlib]System.Runtime.CompilerServices.IAsyncStateMachine::MoveNext() // Method begins at RVA 0x20f8 // Code size 185 (0xb9) .maxstack 3 .locals init ( [0] int32, [1] int32, [2] valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter, [3] class Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0', [4] class [mscorlib]System.Exception ) IL_0000: ldarg.0 IL_0001: ldfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;1__state' IL_0006: stloc.0 .try { IL_0007: ldloc.0 IL_0008: brfalse.s IL_000c IL_000a: br.s IL_000e IL_000c: br.s IL_0054 IL_000e: nop IL_000f: ldarg.0 IL_0010: ldc.i4.s 33 IL_0012: stfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;one&gt;5__1' IL_0017: ldc.i4 1000 IL_001c: call class [mscorlib]System.Threading.Tasks.Task [mscorlib]System.Threading.Tasks.Task::Delay(int32) IL_0021: callvirt instance valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter [mscorlib]System.Threading.Tasks.Task::GetAwaiter() IL_0026: stloc.2 IL_0027: ldloca.s 2 IL_0029: call instance bool [mscorlib]System.Runtime.CompilerServices.TaskAwaiter::get_IsCompleted() IL_002e: brtrue.s IL_0070 IL_0030: ldarg.0 IL_0031: ldc.i4.0 IL_0032: dup IL_0033: stloc.0 IL_0034: stfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;1__state' IL_0039: ldarg.0 IL_003a: ldloc.2 IL_003b: stfld valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;u__1' IL_0040: ldarg.0 IL_0041: stloc.3 IL_0042: ldarg.0 IL_0043: ldflda valuetype [mscorlib]System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1&lt;int32&gt; Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;t__builder' IL_0048: ldloca.s 2 IL_004a: ldloca.s 3 IL_004c: call instance void valuetype [mscorlib]System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1&lt;int32&gt;::AwaitUnsafeOnCompleted&lt;valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter, class Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'&gt;(!!0&amp;, !!1&amp;) IL_0051: nop IL_0052: leave.s IL_00b8 IL_0054: ldarg.0 IL_0055: ldfld valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;u__1' IL_005a: stloc.2 IL_005b: ldarg.0 IL_005c: ldflda valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;u__1' IL_0061: initobj [mscorlib]System.Runtime.CompilerServices.TaskAwaiter IL_0067: ldarg.0 IL_0068: ldc.i4.m1 IL_0069: dup IL_006a: stloc.0 IL_006b: stfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;1__state' IL_0070: ldloca.s 2 IL_0072: call instance void [mscorlib]System.Runtime.CompilerServices.TaskAwaiter::GetResult() IL_0077: nop IL_0078: ldloca.s 2 IL_007a: initobj [mscorlib]System.Runtime.CompilerServices.TaskAwaiter IL_0080: ldarg.0 IL_0081: ldfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;one&gt;5__1' IL_0086: stloc.1 IL_0087: leave.s IL_00a3 } // end .try catch [mscorlib]System.Exception { IL_0089: stloc.s 4 IL_008b: ldarg.0 IL_008c: ldc.i4.s -2 IL_008e: stfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;1__state' IL_0093: ldarg.0 IL_0094: ldflda valuetype [mscorlib]System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1&lt;int32&gt; Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;t__builder' IL_0099: ldloc.s 4 IL_009b: call instance void valuetype [mscorlib]System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1&lt;int32&gt;::SetException(class [mscorlib]System.Exception) IL_00a0: nop IL_00a1: leave.s IL_00b8 } // end handler IL_00a3: ldarg.0 IL_00a4: ldc.i4.s -2 IL_00a6: stfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;1__state' IL_00ab: ldarg.0 IL_00ac: ldflda valuetype [mscorlib]System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1&lt;int32&gt; Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;t__builder' IL_00b1: ldloc.1 IL_00b2: call instance void valuetype [mscorlib]System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1&lt;int32&gt;::SetResult(!0) IL_00b7: nop IL_00b8: ret } // end of method '&lt;MethodTaskAsync&gt;d__0'::MoveNext .method private final hidebysig newslot virtual instance void SetStateMachine ( class [mscorlib]System.Runtime.CompilerServices.IAsyncStateMachine stateMachine ) cil managed { .custom instance void [mscorlib]System.Diagnostics.DebuggerHiddenAttribute::.ctor() = ( 01 00 00 00 ) .override method instance void [mscorlib]System.Runtime.CompilerServices.IAsyncStateMachine::SetStateMachine(class [mscorlib]System.Runtime.CompilerServices.IAsyncStateMachine) // Method begins at RVA 0x21d0 // Code size 1 (0x1) .maxstack 8 IL_0000: ret } // end of method '&lt;MethodTaskAsync&gt;d__0'::SetStateMachine } // end of class &lt;MethodTaskAsync&gt;d__0</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  MoveNextメソッド </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      MethodTaskタイプ用に生成されたクラスは、IAsyncStateMachineインターフェイスを実装します。これは、非同期メソッド用に作成されたステートマシンを表します。 このタイプは、コンパイラー専用です。 このインターフェイスには、MoveNextおよびSetStateMachineのメンバーが含まれます。  MoveNextメソッドは、状態マシンを次の状態に移動します。 このメソッドには元のコードが含まれており、メソッドの最初の入り口と待機の両方で呼び出されます。 ステートマシンは、何らかの初期状態で作業を開始すると考えられています。 最も単純な非同期メソッドを使用しても、MoveNextコードは驚くほど複雑であるため、C＃の同等のコードで可能な限り正確に説明するようにします。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>MoveNextメソッドの名前は、以前のバージョンのC＃の反復子ブロックによって生成されたMoveNextメソッドと類似しているためです。</i>  <i>これらのブロックを使用すると、yield returnキーワードを使用して、単一のメソッドでIEnumerableインターフェイスを実装できます。</i>  <i>この目的で使用される有限状態マシンは、多くの点で非同期状態マシンに似ていますが、より簡単です。</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     中間コードを検討し、その中で何が起こるかを確認します（以下では、コンパイラーが生成するもののより完全な議論のためにCIL言語を完全に説明することにし、技術的な詳細をスキップできるようにすべての命令を説明しました） 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="tex hljs">.locals init ( [0] int32, [1] int32, [2] valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter, [3] class Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0', [4] class [mscorlib]System.Exception )</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <i>localsinit</i>は、メソッドに設定されるフラグであり、値型のローカルインスタンスを初期化する役割を果たします。 これはメソッドヘッダーで定義され、変数をCILで初期化する必要があることを意味します。 ここでは、このメソッドで使用されるすべてのインスタンスが定義され、それらは慣例として配列として定義され、デフォルトで設定されます：オブジェクトタイプおよびオブジェクトを含む値タイプフィールドの場合はNULL、整数タイプの場合は0、浮動小数点。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     したがって、メソッドに入ると、メソッドで使用するための既製のローカル変数が既にあります。 </li><li>  <i>valuetype-</i>重要な型、つまり 構造 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="tex hljs"> IL_0000: ldarg.0 IL_0001: ldfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;1__state' IL_0006: stloc.0</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <i>ldarg.0-</i>引数0 <i>を</i>スタックにロード<i>し</i>ます。 インデックス0の引数は、着信引数からコピーされた計算スタック（.NET中間言語はスタック言語です）にロードされます。 しかし、メソッドには引数がありません！ 事実、非静的メソッドのデフォルトでは、インデックス0の引数は常にクラスのインスタンスへのポインターです-これ。 同時に引数がある場合は、すでに1、2などのインデックスがあります。 静的メソッドでは、引数は0からカウントを開始します。 </li><li>  <i>ldfld-</i>オブジェクトのフィールド値を検索します。リンクはスタック上にあります。 そして、リンク自体はldarg.0を使用して上記でロードされましたが、このフィールドに格納された値はそれに応じてスタックにロードされました。 </li><li>  <i>stloc.0-</i>スタックの一番上の値（MethodTaskAsync.stateオブジェクトフィールドの値）を取得し、インデックス0のローカル変数のリストに保存します。ローカル変数のリストもlocalsinitで宣言されました。 便利ですね。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="tex hljs"> IL_0007: ldloc.0 IL_0008: brfalse.s IL_000c IL_000a: br.s IL_000e IL_000c: br.s IL_0054 IL_000e: nop IL_000f: ldarg.0 IL_0010: ldc.i4.s 33 IL_0012: stfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;one&gt;5__1' IL_0017: ldc.i4 1000 IL_001c: call class [mscorlib]System.Threading.Tasks.Task [mscorlib]System.Threading.Tasks.Task::Delay(int32) IL_0021: callvirt instance valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter [mscorlib]System.Threading.Tasks.Task::GetAwaiter() IL_0026: stloc.2 IL_0027: ldloca.s 2 IL_0029: call instance bool [mscorlib]System.Runtime.CompilerServices.TaskAwaiter::get_IsCompleted() IL_002e: brtrue.s IL_0070</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <i>ldloc.0およびbrfalse.s-</i>インデックス0のローカル変数を計算スタックにロードします。 ここでは、保存されたばかりの状態がスタックにロードされ、状態値がfalseの場合、つまりbrfalse.sコマンドが制御を最終命令に移します。  0.メソッドを初めて入力したときの値は-1で、これは命令ストリームの実行がさらに進むことを意味します。 </li><li>  <i>br.s IL_000e-</i>最終命令の無条件転送。 ここで、実行する必要があるコードの別の部分に移動します。 この場合、次のコマンドは行IL_000eで実行されます。 </li><li>  <i>br.s IL_0054-</i>無条件ジャンプでもあり、brfalse.sコマンドが実行されると、このコマンドのみが実行されます </li><li>  <i>nop-</i>操作コードに修正が含まれている場合、スペースを埋めます。 処理サイクルは完了できますが、重要な操作は実行されません。 </li><li>  <i>ldarg.0およびldc.i4.s 33-</i>ここではthisポインターがロードされ、数値33がスタックにロードされます。ここでldc.i4.s-Int8型の値をInt32（短い形式の書き込み）として計算スタックにプッシュします。 </li><li>  <i>stfld-</i>オブジェクトへの参照により、オブジェクトのフィールドの値を新しい値に置き換えます。 ロードされたポインタとスタック上の数値33を使用して、新しい値33がロードされ、メンバー変数&lt;one&gt; 5_1（デフォルトで0に初期化されます）に格納されます。ご覧のとおり、これは元のメソッドの最初の行です。 元のメソッドのコードが実行されるのは、このブロックです。 </li><li>  <i>ldc.i4 1000</i> -Int32型の変数をInt32としてスタックにロード<i>し</i>ます。 </li><li>  <em>呼び出しクラス[mscorlib] System.Threading.Tasks.Task [mscorlib] System.Threading.Tasks.Task :: Delay（int32）</em> -メソッドはここで呼び出されます。  （callvirt命令と比較した）この命令の特性は、呼び出されたメソッドのアドレスが静的に計算されることです。つまり、JITコンパイル中であってもです。 この場合、Delayメソッドは静的です。 この場合、呼び出されたメソッドのパラメーターは左から右にスタックに配置する必要があります。つまり、最初に最初のパラメーターをスタックにロードし、次に2番目にパラメーターをロードする必要があります。 </li><li>  <i>callvirt instance valuetype [mscorlib] System.Runtime.CompilerServices.TaskAwaiter [mscorlib] System.Threading.Tasks.Task :: GetAwaiter（）</i> -この命令は、呼び出されたメソッドのアドレスがタイプ分析によってプログラム実行中に決定されるという点で主に呼び出しと異なりますメソッドが呼び出されているオブジェクト。 これにより、ポリモーフィズムをサポートするために必要な遅延バインディングの概念が実装されます。 この場合、戻り値（この場合はTaskAwaiter）はスタックにプッシュされます。TaskAwaiterは、非同期タスクの完了を待機しているオブジェクトを表します。 </li><li>  <i>stloc.2-</i>スタックの一番上の値を取得し、インデックス2のローカル変数のリストに保存します。スタックの一番上の値は<i>GetAwaiter（）</i>オペレーションの結果であり、したがってこの値はインデックス2のローカル変数に格納されます </li><li>  <i>ldloca.s 2-</i>インデックス2のローカル値をスタックに読み込みます-最近保存した値 </li><li>  <i>呼び出しインスタンスbool [mscorlib] System.Runtime.CompilerServices.TaskAwaiter :: get_IsCompleted（）</i> -プロパティにアクセスしたときにタスクが完了したかどうかを示す値をスタックにロードします：trueまたはfalse </li><li>  <i>brtrue.s IL_0070-</i>タスクが完了した場合、別のコードの実行に進みます。完了していない場合、先に進みます。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     したがって、次のようなコードを想像できます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveNext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>_state) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.one = <span class="hljs-number"><span class="hljs-number">33</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> task = Task.Delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> awaiter = task.GetAwaiter(); <span class="hljs-comment"><span class="hljs-comment">//  ,     ,     (  IL-) if(!awaiter.IsCompleted) { ... return; } } ... //  }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     上記のコードは、ステートマシンの初期状態を担当し、非同期タスクの完了を確認し、メソッドの適切な場所に移動します。 この場合、オートマトンのいくつかの状態の1つへの移行が発生します。メソッドは待ち合わせ場所または同期終了で中断されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> 一時停止方法 </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     メソッドが中断された場所のILコードを検討します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="tex hljs"> IL_0030: ldarg.0 IL_0031: ldc.i4.0 IL_0032: dup IL_0033: stloc.0 IL_0034: stfld int32 Asynchronous.Program/'&lt;MethosTaskAsync&gt;d__0'::'&lt;&gt;1__state' IL_0039: ldarg.0 IL_003a: ldloc.2 IL_003b: stfld valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter Asynchronous.Program/'&lt;MethosTaskAsync&gt;d__0'::'&lt;&gt;u__1' IL_0040: ldarg.0 IL_0041: stloc.3 IL_0042: ldarg.0 IL_0043: ldflda valuetype [mscorlib]System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1&lt;int32&gt; Asynchronous.Program/'&lt;MethosTaskAsync&gt;d__0'::'&lt;&gt;t__builder' IL_0048: ldloca.s 2 IL_004a: ldloca.s 3 IL_004c: call instance void valuetype [mscorlib]System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1&lt;int32&gt;::AwaitUnsafeOnCompleted&lt;valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter, class Asynchronous.Program/'&lt;MethosTaskAsync&gt;d__0'&gt;(!!0&amp;, !!1&amp;) IL_0051: nop IL_0052: leave.s IL_00b8</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     すべてが上記で説明されているように、各操作を説明する価値はありません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> このコードは、状態変数を0に変更する役割を果たします。コマンド<i>stfld int32 Asynchronous.Program / 'd__0' :: '&lt;&gt; 1__state'</i> <s>I repeat</s>は、フィールド値を新しい値に変更すること<s>を</s>意味します。 そして、正しい場所から再開するには、状態変数を変更する必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li> 次に、 <i>TaskAwaiter</i>オブジェクトを<i>使用</i>して、 <i>タスク</i>タスクの完了に関する通知をサブスクライブします。 これは、インデックス2のローカル変数が<i>スタックにロードされ、</i>フィールド値がこのローカル変数（ <i>ldloc.2</i>および<i>stfld valuetype [mscorlib] System.Runtime.CompilerServices.TaskAwaiter Asynchronous.Program / 'd__0' :: :: &lt;&gt;コマンドの</i>値に変更されると<i>発生しますu__1'</i> ).         ,      . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li>         <i>AwaitUnsafeOnCompleted</i> .      await,      ,      .                 awaiter.   : <i>AsyncTaskMethodBuilder.AwaitOnCompleted(ref TAwaiter awaiter, ref TStateMachine stateMachine)</i> .               2  3,  2 — <i>valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter, 3 — class Asynchronous.Program/'d__0'</i> </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AsyncTaskMethodBuilder構造を詳しく見てみましょう（この構造とそれに関連するすべての研究についてはいくつかの記事で説明できるので、ここでは詳しく説明しません）。 </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs pgsql"> /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt;   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(TResult).&lt;/<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; <span class="hljs-type"><span class="hljs-type">internal</span></span> readonly static Task&lt;TResult&gt; s_defaultResultTask = AsyncTaskCache.CreateCacheableTask(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(TResult)); /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt;,   IAsyncStateMachine.&lt;/<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; private AsyncMethodBuilderCore m_coreState; // mutable struct: must <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> be readonly /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt;  &lt;/<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; private Task&lt;TResult&gt; m_task; // lazily-initialized: must <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> be readonly /// &lt;<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; ///       ,  awaiter  /// &lt;/<span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>&gt; /// &lt;typeparam <span class="hljs-type"><span class="hljs-type">name</span></span>="TAwaiter"&gt;  awaiter.&lt;/typeparam&gt; /// &lt;typeparam <span class="hljs-type"><span class="hljs-type">name</span></span>="TStateMachine"&gt;   .&lt;/typeparam&gt; /// &lt;param <span class="hljs-type"><span class="hljs-type">name</span></span>="awaiter"&gt;The awaiter.&lt;/param&gt; /// &lt;param <span class="hljs-type"><span class="hljs-type">name</span></span>="stateMachine"&gt; .&lt;/param&gt; [SecuritySafeCritical] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> AwaitUnsafeOnCompleted&lt;TAwaiter, TStateMachine&gt;( <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> TAwaiter awaiter, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> TStateMachine stateMachine) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TAwaiter : ICriticalNotifyCompletion <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TStateMachine : IAsyncStateMachine { try { AsyncMethodBuilderCore.MoveNextRunner runnerToInitialize = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; var continuation = m_coreState.GetCompletionAction(AsyncCausalityTracer.LoggingOn ? this.Task : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> runnerToInitialize); //    await,            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_coreState.m_stateMachine == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { //         var builtTask = this.Task; //      <span class="hljs-type"><span class="hljs-type">internal</span></span>-, //      . m_coreState.PostBoxInitialization(stateMachine, runnerToInitialize, builtTask); } awaiter.UnsafeOnCompleted(continuation); } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { AsyncMethodBuilderCore.ThrowAsync(e, targetContext: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> この構造の内部にあるものを簡単に検討してください。 </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s_defaultResultTask = AsyncTaskCache.CreateCacheableTask（デフォルト（TResult））</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -これは、特別な</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DoNotDispose</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグを指定するときにDisposeを実装せずにタスクを作成します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このアプローチは、キャ​​ッシュまたは再利用のためのタスクを作成するときに使用されます。</font></font></li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AsyncMethodBuilderCore m_coreState</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><i><font style="vertical-align: inherit;">IAsyncStateMachine</font></i><font style="vertical-align: inherit;">の実行に関連付けられた状態を表します。</font><font style="vertical-align: inherit;">これが構造です。</font></font></li><li> <i>AsyncMethodBuilderCore.MoveNextRunner runnerToInitialize</i> —       MoveNext     .  ,    ,        MoveNext. </li><li> <i>m_coreState.GetCompletionAction(AsyncCausalityTracer.LoggingOn? this.Task: null, ref runnerToInitialize)</i> —  Action    UnsafeOnCompleted      .         . </li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">awaiter.UnsafeOnCompleted（継続）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -インスタンスの実行が完了したときに呼び出されるアクションの継続をスケジュールします。</font><font style="vertical-align: inherit;">この場合、コンテキストを復元する必要があるかどうかに応じて、MoveNextメソッドがコンテキストとメソッドの一時停止で呼び出されるか、タスクが実行されたスレッドのコンテキストで実行が続行されます。</font></font></li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> わずかに異なるソースコードを取得します。 </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveNext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>_state) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.one = <span class="hljs-number"><span class="hljs-number">33</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> task = Task.Delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> awaiter = task.GetAwaiter(); <span class="hljs-comment"><span class="hljs-comment">//  ,     ,     (  IL-) if(!awaiter.IsCompleted) { this.1_state = 0; this.u__awaiter = awaiter; //u__awaiter   TaskAwaiter t_builder.AwaitUnsafeOnCompleted(ref this.u_awaiter, ref &lt;MethodTaskAsync&gt;d__0); return; } } ... //  }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> メソッドの再開 </font></font></h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このコードを実行した後、呼び出し元のスレッドは自分の仕事に取り掛かりますが、現時点では、タスクが完了するのを待っています。</font><font style="vertical-align: inherit;">タスクが完了すると、メソッドが再び呼び出され</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MoveNextメソッド</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（メソッド呼び出しで</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AwaitUnsafeOnCompleted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仕事のために必要なすべてを完了）。</font><font style="vertical-align: inherit;">続行するときに呼び出されるILコードを考えます。</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="tex hljs"> IL_0054: ldarg.0 IL_0055: ldfld valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;u__1' IL_005a: stloc.2 IL_005b: ldarg.0 IL_005c: ldflda valuetype [mscorlib]System.Runtime.CompilerServices.TaskAwaiter Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;u__1' IL_0061: initobj [mscorlib]System.Runtime.CompilerServices.TaskAwaiter IL_0067: ldarg.0 IL_0068: ldc.i4.m1 IL_0069: dup IL_006a: stloc.0 IL_006b: stfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;1__state' IL_0070: ldloca.s 2 IL_0072: call instance void [mscorlib]System.Runtime.CompilerServices.TaskAwaiter::GetResult() IL_0077: nop IL_0078: ldloca.s 2 IL_007a: initobj [mscorlib]System.Runtime.CompilerServices.TaskAwaiter IL_0080: ldarg.0 IL_0081: ldfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;one&gt;5__1' IL_0086: stloc.1 IL_0087: leave.s IL_00a3 IL_00a3: ldarg.0 IL_00a4: ldc.i4.s -2 IL_00a6: stfld int32 Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;1__state' IL_00ab: ldarg.0 IL_00ac: ldflda valuetype [mscorlib]System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1&lt;int32&gt; Asynchronous.Program/'&lt;MethodTaskAsync&gt;d__0'::'&lt;&gt;t__builder' IL_00b1: ldloc.1 IL_00b2: call instance void valuetype [mscorlib]System.Runtime.CompilerServices.AsyncTaskMethodBuilder`1&lt;int32&gt;::SetResult(!0) IL_00b7: nop</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の部分では、インデックス0の引数が読み込まれます-これは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskAwaiter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &lt;&gt; u__1 </font><font style="vertical-align: inherit;">変数が</font><font style="vertical-align: inherit;">検索され、その値がインデックス2のローカル変数に格納され、再初期化されます。</font><font style="vertical-align: inherit;">その後、値-1がスタックに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロードされ、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この値が</font><i><font style="vertical-align: inherit;">1__state</font></i><font style="vertical-align: inherit;">変数に保存されるため</font><font style="vertical-align: inherit;">、タスクの状態がリセットされます。</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目の部分では、ローカル変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">awaiterがスタックにロードされ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetResult（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出しが</font><i><font style="vertical-align: inherit;">行われ</font></i><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">次に、ローカル変数のスタックへの新しいロードとその新しい初期化。</font><font style="vertical-align: inherit;">次に、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5__1が</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタックに</font><i><font style="vertical-align: inherit;">ロードされ、</font></i><font style="vertical-align: inherit;">インデックス1でローカル変数に保存され、別のコマンドへの移行</font><font style="vertical-align: inherit;">が行われ</font><font style="vertical-align: inherit;">ます。</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3番目の部分では、-2をスタックにロードし、1_state変数に格納します。</font><font style="vertical-align: inherit;">次に、t_builder変数をスタックにロードし、SetResult（1）メソッドを呼び出します。</font></font></li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 結果は、おおよそのソースコードです。 </font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs coffeescript">public void MoveNext() { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>_state) { case <span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.one = <span class="hljs-number"><span class="hljs-number">33</span></span>; var task = Task.Delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); var awaiter = task.GetAwaiter(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  ,     ,     (  IL-) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!awaiter.IsCompleted) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>_state = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.u__awaiter = awaiter; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>u__awaiter   TaskAwaiter t_builder.AwaitUnsafeOnCompleted(ref <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.u_awaiter, ref &lt;MethodTaskAsync&gt;d__0); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } case <span class="hljs-number"><span class="hljs-number">0</span></span>: var awaiter = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.u_awaiter; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.u_awaiter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Runtime.CompilerServices.TaskAwaiter(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>_state = <span class="hljs-number"><span class="hljs-number">-1</span></span>; awaiter.GetResult(); awaiter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Runtime.CompilerServices.TaskAwaiter(); var one = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.&lt;one&gt;<span class="hljs-number"><span class="hljs-number">5</span></span>_1; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>_state = <span class="hljs-number"><span class="hljs-number">-2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.t_builder.SetResult(one); } }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 同期完了 </font></font></h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同期終了の場合、メソッドを停止して再開しないでください。</font><font style="vertical-align: inherit;">この場合、メソッドの実行を確認し、goto caseステートメントを使用して適切な場所に移動するだけです。</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveNext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>_state) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.one = <span class="hljs-number"><span class="hljs-number">33</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> task = Task.Delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> awaiter = task.GetAwaiter(); <span class="hljs-comment"><span class="hljs-comment">//  ,     ,     (  IL-) if(awaiter.IsCompleted) { goto case 0; } case 0: this.1_state = 0; ... } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <i>    ,      ,   goto    .</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  ... </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、Alex DavisによるC＃5.0の非同期プログラミングに関するお気に入りの本の1つに依存しました。一般に、それは小さく（必要に応じて1日で読むことができます）、非常に興味深く、適度に詳細で非同期/待機メカニズム全体を説明しているため、全員に読むことをお勧めします。同時に、初心者にも読むことができ、すべてがそこに非常に簡単に書かれています（人生の例など）。それを読んで並行してILコードを勉強していると、本に書かれているものと実際にそこにあるものとの間にわずかな矛盾が見つかりました。しかし、ほとんどの場合、コンパイラが少し修正してからわずかに異なる結果を生成し始めた可能性が最も高いと思います。しかし、これはそれにこだわるほど重要ではありません。同時に、ソースコードとして（AsyncTaskMethodBuilderを説明するために、このリソースを使用しました：</font></font><a href="http://referencesource.microsoft.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、さらに深く掘り下げたいと思う人がいる場合です</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J260197/index.html">Elvenプログラミング言語</a></li>
<li><a href="../J260201/index.html">3か月でMiddle PHP開発者にアップグレードする</a></li>
<li><a href="../J26021/index.html">Facebookは再設計と大規模な抗議に備える</a></li>
<li><a href="../J260213/index.html">OsmocomBBの紹介：0x03ソフトウェア</a></li>
<li><a href="../J260215/index.html">ReactOSは肌のサポートを大幅に改善しました</a></li>
<li><a href="../J260219/index.html">ポールランドロゴ7段階テスト</a></li>
<li><a href="../J260223/index.html">Goが成功する運命にある理由（更新）</a></li>
<li><a href="../J260225/index.html">iOS 8.3のメールアプリの脆弱性</a></li>
<li><a href="../J260227/index.html">すべてのプログラマーが知っておくべき9つのアンチパターン</a></li>
<li><a href="../J260229/index.html">モバイル開発者向けの興味深い資料のダイジェスト＃107（6月8〜14日）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
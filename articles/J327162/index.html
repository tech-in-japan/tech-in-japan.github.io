<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👧🏻 🎲 👨🏿‍🤝‍👨🏻 FPGAビデオストリーム内の複数のオブジェクトの検出と追跡 👩‍👧‍👦 🕳️ 🌦️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事では、ビデオストリーム内の複数のオブジェクトを検出および追跡するためのシステムの実装について説明します。 この記事は、前の2つ（ FPGAのビデオストリームでの動き検出とFPGAの 数学的形態を使用した画像フィルタリング ）に基づいています。 画像のキャプチャと一次処理は、最初の記事で説明し...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>FPGAビデオストリーム内の複数のオブジェクトの検出と追跡</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/327162/"><div style="text-align:center;"><img src="https://habrastorage.org/files/37f/62c/0ee/37f62c0eeabb409ebe52ad7db0f0f871.png"></div>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この記事では、ビデオストリーム内の複数のオブジェクトを検出および追跡するためのシステムの実装について説明します。 この記事は、前の2つ（ <a href="https://habrahabr.ru/post/323258/"><b>FPGAのビデオストリームでの動き検出とFPGAの</b></a> <a href="https://habrahabr.ru/post/325808/"><b>数学的形態を使用した画像フィルタリング</b></a> ）に基づいています。 画像のキャプチャと一次処理は、最初の記事で説明した方法を使用して実行され、画像のフィルタリングは2番目の記事で説明します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     最初の記事で設定した目標に従って、検出されたオブジェクトの周囲にフレームを描画するアルゴリズムを実装することにしました。 このタスクを実行する過程で、私は質問に出くわしました。しかし、どの特定のオブジェクトの周りにフレームを描く必要があるのでしょうか？ フィルタリング後、フレームに多くのオブジェクトが含まれる場合があります。それらのいくつかは小さく、他は大きいです。 フレームに落ちたすべてのオブジェクトの周囲に1つのフレームを描画する場合、これは難しくありませんが、そのようなシステムの結果に関心を持つ人はほとんどいません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ネットワークで大騒ぎして、複数のオブジェクトを検出するためのさまざまなアプローチを説明する一連のドキュメントに精通しました。  FPGAでの実装には適さないものもあれば、フレーム全体を保存するために大量のブロックメモリを必要とするものもありますが、画像のいくつかのパスで作業を行うものもあります。 欲しいです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     それにもかかわらず、 <a href="http://www.electronics.dit.ie/staff/aschwarzbacher/research/mpc08-1Blob.pdf">ドキュメントの</a> 1つが私の注目を集めました。 画像セクションの分析用のリンクリストの実装を使用して、画像の1回のパスで複数のオブジェクトの検出を実装するアルゴリズムについて説明します。 この資料を分析した後、オブジェクト検出器自体が検出器にデータを入力して画面に画像を表示するロジックよりも高速なブロックドメインで動作するという条件で、このようなアルゴリズムが適していることに気付きました。 これは、このアルゴリズムが入力で受信した新しいデータごとにリンクリストを検索し、リンクリストの最大数が行のピクセル数の半分に達するためです。 つまり、最悪の場合、画像の線幅が320ピクセルの場合、新しいデータごとに160個のリンクリストを処理する必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     以下は、複数のオブジェクトの検出器の機能図です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/df2/a65/e60/df2a65e6075a49e5bf9c5172e82909a6.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     検出器は、 <b>RUN検出器</b> 、 <b>BLOB検出器</b> 、 <b>バウンディングボックスジェネレーター</b>の3つのメインブロックで構成されてい<b>ます</b> 。 各ブロックは独自のブロックドメインで動作し、非同期FIFOを介して別のブロックに接続されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> 検出器を実行する </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     このブロックへの入力は、 <a href="https://habrahabr.ru/post/325808/">数学的形態に基づい</a>た<a href="https://habrahabr.ru/post/325808/">フィルター</a>からの出力です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     このブロックは、入力ストリーム内で、いわゆるRUNという1つのユニットで構成されるピクセルシーケンスを検索します。 この名前は、JPEG圧縮などで使用される<b>RLE（Run Length Encoding）</b>圧縮アルゴリズムから取られてい<b>ます</b> 。 以下の図は、いくつかのタイプのRUN（ <b>class-length</b> 、 <b>class-start</b>および<b>start-end）を示してい</b>ます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/365/f1c/bff/365f1cbffd76493fa54bf5e9fcc68864.png"></div>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     検出器では、最後の（ <b>start-end</b> ）が使用されます 私たちのシステムに最適です。 ユニットシーケンスの開始位置の値は<b>開始</b>フィールドに書き込まれ、 <b>終了</b>位置は<b>終了</b>フィールドに書き込まれます。生成された<b>開始終了</b>フィールドは検出器のRUN出力に送信され、FIFOに記録されます。  RUNとともに、次のブロックが正しく動作するように、行の終わりとフレームの終わりのデータがFIFOに記録されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Verilog Detectorコード 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">検出器を実行する</b> <div class="spoiler_text"><pre><code class="hljs vhdl">module run_detector #( <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> RES_X=<span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d320</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> RES_Y=<span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d240</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> XOFFSET=<span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d320</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> YOFFSET=<span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d0</span></span>) ( input wire clk, input wire nRst, input wire data_valid, input wire [<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data_in, input wire [<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] xi, input wire [<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] yi, output reg [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_start, output reg [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_end, output reg row_end, output reg frame_end, output reg new_run, output reg rd_req ); localparam ST_IDLE=<span class="hljs-number"><span class="hljs-number">0</span></span>, ST_RUN_START=<span class="hljs-number"><span class="hljs-number">1</span></span>, ST_RUN_END=<span class="hljs-number"><span class="hljs-number">2</span></span>, ST_ROW_END=<span class="hljs-number"><span class="hljs-number">3</span></span>, ST_FRAME_END=<span class="hljs-number"><span class="hljs-number">4</span></span>; localparam XRES = RES_X + XOFFSET - <span class="hljs-number"><span class="hljs-number">1</span></span>; localparam YRES = RES_Y + YOFFSET - <span class="hljs-number"><span class="hljs-number">1</span></span>; reg [<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_state = <span class="hljs-number"><span class="hljs-number">0</span></span>; reg [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_start_d; reg [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_end_d; wire row_done_w = ((xi == XRES) &amp;&amp; (yi &lt;= YRES)) ? <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; wire frame_done_w = ((xi == XRES) &amp;&amp; (yi == YRES)) ? <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; always @(posedge clk <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> negedge nRst) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!nRst) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> run_state &lt;= ST_IDLE; run_start &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d0</span></span>; run_end &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d0</span></span>; row_end &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; frame_end &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; new_run &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; rd_req &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> new_run &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; row_end &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; frame_end &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (run_state) ST_IDLE: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data_valid) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data_in) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> run_state &lt;= ST_RUN_START; run_start &lt;= xi[<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ST_RUN_START: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!data_in) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> run_state &lt;= ST_RUN_END; run_end &lt;= xi[<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] - <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span>; new_run &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ST_RUN_END: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data_in) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> run_start &lt;= xi[<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]; run_state &lt;= ST_RUN_START; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> run_state &lt;= ST_IDLE; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ST_ROW_END, ST_FRAME_END: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!data_valid) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> run_state &lt;= ST_IDLE; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endcase <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (row_done_w || frame_done_w) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> run_state &lt;= frame_done_w ? ST_FRAME_END : ST_ROW_END; row_end &lt;= row_done_w ? <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; frame_end &lt;= frame_done_w ? <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; run_start &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d0</span></span>; run_end &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d0</span></span>; new_run &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endmodule</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> ブロブ検出器 </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     検出器の動作アルゴリズムのブロック図を以下に示します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/786/f95/838/786f95838c584c098b101e3ca34e6175.png"></div>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     検出器の動作をより詳細に検討してください。 私の実装では、検出器は大型の同期状態マシンです。 また、2つのブロックメモリモジュールを使用して検出器を操作します。1つ<b>は</b>現在および前の行の<b>実行メモリ</b>を保存し、もう1つは検出されたオブジェクト（ <b>オブジェクトメモリ</b> ）のプロパティを保存します。  32個のオブジェクトのみ。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>初期化</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     検出器は<b>INIT</b>状態で起動します。 この状態では、 <b>実行メモリ</b>バッファの1つが無効なラベル値で初期化されます。 その後、検出器は<b>IDLE</b>状態に入ります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>アイドル</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この状態では、ディテクターはディテクターRUNからの入力FIFO内のデータを待ってから、 <b>FIND_RUN</b>状態に入ります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>FIND_RUN</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ここで、検出器はFIFOからRUNの開始および終了座標を読み取り、 <b>FIND_OVERLAP</b>状態に入り、現在のRUNと前の行のRUNの交差を検索します。 新しいRUNには無効なラベルが割り当てられます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>FIND_OVERLAP</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>実行メモリ内の</b>データは、現在と以前の2行に配置されています。  FIFOからの新しいRUNはそれぞれ、現在のメモリブロックに記録され、交差点（オーバーラップ）と比較して、前の行のブロック全体を通過します。 次の図は、RUNが<b>実行メモリに</b>どのように保存されるかを示して<b>います</b> 。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/da8/471/e73/da8471e737bb4de7b569a5b8328191ad.png"></div>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     前の行のメモリから読み取られたRUNに無効なラベルがある場合、これはこのブロックに前の行の<b>RUN</b>がもうないことを意味し、検出器は<b>CREATE_OBJ</b>状態に切り替わり、現在のRUNから新しいオブジェクトを作成します。 それ以外の場合、交差が確立されると、 <b>オブジェクトは</b> RUNラベルのアドレスで<b>オブジェクトメモリ</b>から読み取られ、検出器は<b>UPDATE_OBJ</b>状態になり、既存のオブジェクトのプロパティを更新します。 現在のRUNタグが無効ではなく、FIFOから読み取るときに与えられた場合、これは、このRUNが特定のオブジェクトに属し、別の既存のオブジェクトとの交差点があり、これらのオブジェクトを1つのオブジェクトにマージする必要があることを意味します。検出器は<b>MERGE_OBJ</b>状態に入ります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>CREATE_OBJ</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ここに新しいオブジェクトが作成され、そのすべてのプロパティが入力されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b>X start</b> - <b>Xの開始</b>座標 </li><li>  <b>X end</b> - <b>X</b>の最終座標 </li><li>  <b>Y start</b> - <b>Yの開始</b>座標 </li><li>  <b>Y end-</b>最終的なY座標 </li><li>  <b>オブジェクトの質量</b> - <b>オブジェクト</b>のピクセル数 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     作成されたオブジェクトは、次の空きアドレス（現在のRUNのラベル）の<b>オブジェクトメモリに</b>保存され<b>ます</b> 。 検出器は、FIFOから新しいRUNを読み取る<b>アイドル</b>状態に入ります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>UPDATE_OBJ</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この状態では、 <b>オブジェクトメモリ</b>からの既存のオブジェクトのプロパティが更新され、オブジェクトの新しい座標は、それに接続されている現在のRUNの長さに基づいて計算されます。 オブジェクトを更新した後、検出器は、実行メモリからの次のRUNとの<b>交差</b>検索の<b>FIND_OVERLAP</b>状態に入ります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>MERGE_OBJ</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ここで、2つの既存のオブジェクトが1つにマージされ、それらのプロパティが更新されて最初のオブジェクトに割り当てられ、2番目のオブジェクトが無効になって以降の処理から除外されます。 マージ後、ディテクタは、 <b>実行メモリ</b>からの次のRUNとの<b>交差</b>検索の<b>FIND_OVERLAP</b>状態に入り<b>ます</b> 。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     以下の図は、赤でハッチングされた共通のRUNによるオブジェクト<b>1</b>と<b>2の</b>マージを示しています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/fd5/f84/a69/fd5f84a69abf43bf83d6e5ef3c5c5700.png"></div>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>FINISH_OBJ</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     検出器は、FIFOから行の終わりまたはフレームの終わりの符号を読み取るたびにこの状態に入ります。 ラインターミネータの場合、 <b>実行メモリ</b>の書き込み領域と読み取り領域が交換され、検出器はFIFOからのデータ入力を待機状態になります。 フレームの終わりの場合、検出器は、見つかったオブジェクトを<b>オブジェクトメモリ</b>から出力FIFOにアンロードする<b>UPLOAD_DATA</b>状態に入り<b>ます</b> 。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>UPLOAD_DATA</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>オブジェクトメモリ</b>全体を渡すことにより、オブジェクト<b>の</b>プロパティが出力FIFOにアンロードされます。  FIFOでページングされる単語は、オブジェクトアドレスと4つの座標<b>Xstart</b> 、 <b>Xend</b> 、 <b>Ystart</b> 、および<b>Yendのレイアウト</b>です。 合計32個のオブジェクトが実現され、 <b>320x240</b>ピクセルのフレームにはこれで十分です。 ただし、見つかったすべてのオブジェクトが有効なわけではありません。  <b>100</b>ピクセル未満のオブジェクトは無効としてFIFO出力にアップロードされ、その後フレームジェネレーターによって処理されません。 すべてのオブジェクトをアンロードした後、検出器はすべての<b>オブジェクトメモリ</b>を消去し、その状態を<b>STARTに</b>変更し、オブジェクトの新しい蓄積サイクルが始まります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Verilog Detectorコード 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">ブロブ検出器</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">module blob_detector #( parameter RES_X=<span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-string"><span class="hljs-string">'d320, parameter RES_Y=10'</span></span>d240) ( <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> wire clk, <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> wire nRst, // <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> RUN FIFO <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> wire fifo_empty, <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> wire [<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] fifo_data, output wire fifo_rd_en, // output boxes interface output reg we, output reg [<span class="hljs-number"><span class="hljs-number">47</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data_o ); localparam ST_START = <span class="hljs-number"><span class="hljs-number">0</span></span>, ST_INIT = <span class="hljs-number"><span class="hljs-number">1</span></span>, ST_IDLE = <span class="hljs-number"><span class="hljs-number">2</span></span>, ST_FIND_RUN = <span class="hljs-number"><span class="hljs-number">3</span></span>, ST_FIND_OVERLAP = <span class="hljs-number"><span class="hljs-number">4</span></span>, ST_FIND_OVERLAP_0 = <span class="hljs-number"><span class="hljs-number">5</span></span>, ST_CREATE_OBJ = <span class="hljs-number"><span class="hljs-number">6</span></span>, ST_UPDATE_OBJ_2 = <span class="hljs-number"><span class="hljs-number">7</span></span>, ST_UPDATE_OBJ = <span class="hljs-number"><span class="hljs-number">8</span></span>, ST_MERGE_OBJ = <span class="hljs-number"><span class="hljs-number">9</span></span>, ST_MERGE_OBJ_2 = <span class="hljs-number"><span class="hljs-number">10</span></span>, ST_FINISH_OBJ = <span class="hljs-number"><span class="hljs-number">11</span></span>, ST_FINISH_OBJ_2 = <span class="hljs-number"><span class="hljs-number">12</span></span>, ST_UPLOAD_DATA_START = <span class="hljs-number"><span class="hljs-number">13</span></span>, ST_UPLOAD_DATA = <span class="hljs-number"><span class="hljs-number">14</span></span>, ST_UPLOAD_DATA_END = <span class="hljs-number"><span class="hljs-number">15</span></span>; localparam MAX_RUNS = RES_X &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; //`define DETECTOR_DEBUG_MODE //<span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> modeling // RUN memory reg [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_mem_wr_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>; reg [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_mem_rd_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>; reg [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_mem_saved_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>; reg run_mem_wr_en = <span class="hljs-number"><span class="hljs-number">0</span></span>; reg run_mem_flip = <span class="hljs-number"><span class="hljs-number">0</span></span>; // RUN memory data wire [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_rd_start_x; wire [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_rd_end_x; wire [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_rd_label; // RUN FIFO data reg [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_cur_start_x = <span class="hljs-number"><span class="hljs-number">0</span></span>; reg [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_cur_end_x = <span class="hljs-number"><span class="hljs-number">0</span></span>; reg [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_cur_label = <span class="hljs-number"><span class="hljs-number">0</span></span>; wire [<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] eb; reg [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] free_label = <span class="hljs-number"><span class="hljs-number">0</span></span>; `define OBJ_MASS_THR <span class="hljs-number"><span class="hljs-number">19</span></span><span class="hljs-string"><span class="hljs-string">'d100 `define OBJ_LIMIT 32 `define FRAME_END fifo_data[21] `define ROW_CHANGED fifo_data[20] `define RUN_EMPTY_LABEL 10'</span></span>h200 `define EMPY_RUN_SLOT <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-string"><span class="hljs-string">'h1FF // FSM reg [5:0] blob_detector_fsm_state = 0; // Internal reg [9:0] current_row = 0; reg [9:0] temp_label = 0; reg frame_end_r = 0; `ifdef DETECTOR_DEBUG_MODE // DEBUG reg create_obj = 0; reg merge_obj = 0; reg update_obj = 0; reg skip_obj = 0; reg finish_obj = 0; wire [8:0] rd_ram_addr = {~run_mem_flip, run_mem_rd_addr}; wire [8:0] wr_ram_addr = {run_mem_flip, run_mem_wr_addr}; `endif // read the input FIFO assign fifo_rd_en = (!fifo_empty &amp;&amp; blob_detector_fsm_state == ST_FIND_RUN); // RUN memory alt_ram_30x512 run_ram ( .clock(clk), .data({2'</span></span>h0, run_cur_start_x, run_cur_end_x, run_cur_label}), .rdaddress({~run_mem_flip, run_mem_rd_addr}), .wraddress({run_mem_flip, run_mem_wr_addr}), .wren(run_mem_wr_en), .q({eb, run_rd_start_x, run_rd_end_x, run_rd_label}) ); reg [<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] obj_wr_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>, obj_rd_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>, obj_saved_rd_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>; reg obj_mem_wr_en = <span class="hljs-number"><span class="hljs-number">0</span></span>; // <span class="hljs-keyword"><span class="hljs-keyword">object</span></span><span class="hljs-string"><span class="hljs-string">'s fields for writing reg [9:0] obj_start_x = 0, obj_start_y = 0, obj_end_x = 0, obj_end_y = 0; reg [21:0] obj_mass = 0; reg obj_valid = 0, obj_updated = 0; // object'</span></span>s wires <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> reading wire [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] obj_rd_start_x, obj_rd_start_y, obj_rd_end_x, obj_rd_end_y; wire [<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] obj_rd_mass; wire obj_rd_valid, obj_rd_updated; // <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> detection condition wire obj_detected_valid = (obj_rd_valid &amp;&amp; (obj_rd_mass &gt; `OBJ_MASS_THR)); // <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span> memory object_ram obj_ram ( .clock(clk), .data({obj_valid,obj_updated,obj_start_x,obj_end_x,obj_start_y,obj_end_y,obj_mass}), .rdaddress(obj_rd_addr), .wraddress(obj_wr_addr), .wren(obj_mem_wr_en), .q({obj_rd_valid,obj_rd_updated,obj_rd_start_x,obj_rd_end_x,obj_rd_start_y,obj_rd_end_y,obj_rd_mass}) ); <span class="hljs-comment"><span class="hljs-comment">/* * The main detector process */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">always</span></span> @(posedge clk <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> negedge nRst) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!nRst) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> blob_detector_fsm_state &lt;= ST_START; run_mem_flip &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; free_label &lt;= 10'</span></span>d0; temp_label &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-string"><span class="hljs-string">'d0; current_row &lt;= 10'</span></span>d0; frame_end_r &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; run_mem_wr_en &lt;= 1'</span></span>b0; obj_mem_wr_en &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; we &lt;= 1'</span></span>b0; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> run_mem_wr_en &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; obj_mem_wr_en &lt;= 1'</span></span>b0; we &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; `ifdef DETECTOR_DEBUG_MODE // DEBUG create_obj &lt;= 1'</span></span>b0; merge_obj &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; update_obj &lt;= 1'</span></span>b0; skip_obj &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; finish_obj &lt;= 1'</span></span>b0; `endif <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (blob_detector_fsm_state) ST_START: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> current_row &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-string"><span class="hljs-string">'d0; free_label &lt;= 10'</span></span>d0; run_mem_rd_addr &lt;= <span class="hljs-number"><span class="hljs-number">8</span></span><span class="hljs-string"><span class="hljs-string">'d0; run_mem_wr_addr &lt;= 8'</span></span>d0; obj_rd_addr &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span><span class="hljs-string"><span class="hljs-string">'d0; obj_wr_addr &lt;= 5'</span></span>d0; frame_end_r &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; run_mem_flip &lt;= 1'</span></span>b0; blob_detector_fsm_state &lt;= ST_INIT; run_cur_start_x &lt;= `EMPY_RUN_SLOT; run_cur_end_x &lt;= `EMPY_RUN_SLOT; run_mem_wr_en &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; end ST_INIT: begin if (run_mem_wr_addr &gt;= MAX_RUNS) begin run_mem_wr_addr &lt;= 8'</span></span>d0; run_mem_flip &lt;= ~run_mem_flip; run_mem_wr_en &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; blob_detector_fsm_state &lt;= ST_IDLE; end else begin run_mem_wr_addr &lt;= run_mem_wr_addr + 1'</span></span>b1; run_mem_wr_en &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; end end ST_IDLE: begin if (!fifo_empty) begin blob_detector_fsm_state &lt;= ST_FIND_RUN; end end ST_FIND_RUN: begin // fifo is already read by now // ALWAYS set the empty label to the new run temp_label &lt;= `RUN_EMPTY_LABEL; run_cur_start_x &lt;= fifo_data[19:10]; run_cur_end_x &lt;= fifo_data[9:0]; if (`ROW_CHANGED) begin frame_end_r &lt;= `FRAME_END; blob_detector_fsm_state &lt;= ST_FINISH_OBJ; end else begin // set first read addres of a RUN run_mem_rd_addr &lt;= 8'</span></span>d0; blob_detector_fsm_state &lt;= ST_FIND_OVERLAP_0; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ST_FIND_OVERLAP_0: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // an empty <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (altera<span class="hljs-string"><span class="hljs-string">'s altsyncram is read in 2 cycles, one of them is empty) blob_detector_fsm_state &lt;= ST_FIND_OVERLAP; end ST_FIND_OVERLAP: begin if ((run_rd_start_x == `EMPY_RUN_SLOT) || (run_rd_start_x &gt; run_cur_end_x + 1'</span></span>b1)) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (temp_label == `RUN_EMPTY_LABEL) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // asssign the run a free label run_cur_label &lt;= free_label; // ??? obj_saved_rd_addr &lt;= obj_rd_addr; obj_rd_addr &lt;= free_label[<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]; // store <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> run <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> the memory run_mem_wr_en &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; blob_detector_fsm_state &lt;= ST_CREATE_OBJ; end else begin // some garbage was read from the FIFO run_mem_rd_addr &lt;= 8'</span></span>d0; blob_detector_fsm_state &lt;= ST_IDLE; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> empty slot <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> memory <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((run_rd_start_x &gt;= run_cur_start_x) &amp;&amp; (run_rd_start_x &lt;= run_cur_end_x)) || ((run_rd_end_x &gt;= run_cur_start_x) &amp;&amp; (run_rd_end_x &lt;= run_cur_end_x)) || ((run_rd_end_x &gt;= run_cur_start_x) &amp;&amp; (run_rd_start_x &lt;= run_cur_end_x)) ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // overlap <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (temp_label == `RUN_EMPTY_LABEL) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> run_cur_label &lt;= run_rd_label; temp_label &lt;= run_rd_label; // <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> RUN run_mem_wr_en &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; // read the object with the overlaped RUN, save the current read addres obj_saved_rd_addr &lt;= obj_rd_addr + 1'</span></span>b1; obj_rd_addr &lt;= run_rd_label[<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]; // leave the RUN <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> address the same run_mem_saved_addr &lt;= run_mem_rd_addr; blob_detector_fsm_state &lt;= ST_UPDATE_OBJ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> label <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> (we came <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> state) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (temp_label != run_rd_label) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // merge <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> RUN <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> existent <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> (objects might <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> be overlaped) obj_rd_addr &lt;= run_rd_label[<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]; // goto merge state blob_detector_fsm_state &lt;= ST_MERGE_OBJ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // otherwise this <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> the same RUN, skip it run_mem_rd_addr &lt;= run_mem_rd_addr + <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; blob_detector_fsm_state &lt;= ST_FIND_OVERLAP_0; end end end else begin // not overlaps, skip it run_mem_rd_addr &lt;= run_mem_rd_addr + 1'</span></span>b1; blob_detector_fsm_state &lt;= ST_FIND_OVERLAP_0; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ST_CREATE_OBJ: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> `ifdef DETECTOR_DEBUG_MODE // <span class="hljs-keyword"><span class="hljs-keyword">DEBUG</span></span> create_obj &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; `endif // the label of the current RUN obj_wr_addr &lt;= run_cur_label[4:0]; // features obj_valid &lt;= 1'</span></span>b1; obj_updated &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; obj_start_x &lt;= run_cur_start_x; obj_end_x &lt;= run_cur_end_x; obj_start_y &lt;= current_row; obj_end_y &lt;= current_row; obj_mass &lt;= run_cur_end_x - run_cur_start_x + 1'</span></span>b1; free_label &lt;= free_label + <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; // write this OBJ into mem obj_mem_wr_en &lt;= 1'</span></span>b1; // <span class="hljs-keyword"><span class="hljs-keyword">increment</span></span> the next RUN write address run_mem_wr_addr &lt;= run_mem_wr_addr + <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; // RUN read address starts from the begining run_mem_rd_addr &lt;= 8'</span></span>d0; // <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> the FIFO <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the next RUN blob_detector_fsm_state &lt;= ST_IDLE; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ST_UPDATE_OBJ: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // we mut take altsyncram<span class="hljs-string"><span class="hljs-string">'s latency into account (one empty cycle) obj_rd_addr &lt;= run_rd_label[4:0]; blob_detector_fsm_state &lt;= ST_UPDATE_OBJ_2; end ST_UPDATE_OBJ_2: begin `ifdef DETECTOR_DEBUG_MODE // DEBUG update_obj &lt;= 1'</span></span>b1; `endif // <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> it was previously <span class="hljs-keyword"><span class="hljs-keyword">valid</span></span> // thus we avoid updating unused objects came <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> the // merge state <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj_rd_valid) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> obj_valid &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; obj_updated &lt;= 1'</span></span>b1; obj_start_x &lt;= (run_cur_start_x &lt; obj_rd_start_x) ? run_cur_start_x : obj_rd_start_x ; obj_end_x &lt;= (run_cur_end_x &gt; obj_rd_end_x) ? run_cur_end_x : obj_rd_end_x; obj_start_y &lt;= (current_row &lt; obj_rd_start_y) ? current_row : obj_rd_start_y; obj_end_y &lt;= (current_row &gt; obj_rd_end_y) ? current_row : obj_rd_end_y; obj_mass &lt;= obj_rd_mass + (run_cur_end_x - run_cur_start_x); // save updated obj <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> it<span class="hljs-string"><span class="hljs-string">'s original address obj_wr_addr &lt;= obj_rd_addr; // restore saved read address run_mem_rd_addr &lt;= run_mem_saved_addr; // write updated object obj_mem_wr_en &lt;= 1'</span></span>b1; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> `ifdef DETECTOR_DEBUG_MODE <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // just skip this <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> // perhaps it was updated previously <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> going <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be updated <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> the next RUN skip_obj &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; end `endif // let store current run into the memory blob_detector_fsm_state &lt;= ST_FIND_OVERLAP_0; // increment the next RUN write address run_mem_wr_addr &lt;= run_mem_wr_addr + 1'</span></span>b1; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ST_MERGE_OBJ: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // invalidate the (second) <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> // !!!free list MUST be updated ??? I can<span class="hljs-string"><span class="hljs-string">'t figure out how it should be done... obj_valid &lt;= 1'</span></span>b0; obj_wr_addr &lt;= run_rd_label[<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]; obj_mem_wr_en &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; blob_detector_fsm_state &lt;= ST_MERGE_OBJ_2; end ST_MERGE_OBJ_2: begin `ifdef DETECTOR_DEBUG_MODE // DEBUG merge_obj &lt;= 1'</span></span>b1; `endif <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj_rd_valid) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> obj_valid &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; obj_start_x &lt;= (obj_start_x &lt; obj_rd_start_x) ? obj_start_x : obj_rd_start_x; obj_end_x &lt;= (obj_end_x &gt; obj_rd_end_x) ? obj_end_x : obj_rd_end_x; obj_start_y &lt;= (obj_start_y &lt; obj_rd_start_y) ? obj_start_y : obj_rd_start_y; obj_end_y &lt;= (obj_end_y &gt; obj_rd_end_y) ? obj_end_y : obj_rd_end_y; obj_mass &lt;= obj_mass + obj_rd_mass; obj_wr_addr &lt;= temp_label[4:0]; // write updated (first) object obj_mem_wr_en &lt;= 1'</span></span>b1; // <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> just written <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> obj_rd_addr &lt;= temp_label[<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> blob_detector_fsm_state &lt;= ST_FIND_OVERLAP_0; run_mem_rd_addr &lt;= run_mem_rd_addr + <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; end ST_FINISH_OBJ: begin // if there are NO opened objects in the row run_cur_start_x &lt;= `EMPY_RUN_SLOT; run_cur_end_x &lt;= `EMPY_RUN_SLOT; run_mem_rd_addr &lt;= 8'</span></span>d0; blob_detector_fsm_state &lt;= ST_FINISH_OBJ_2; run_mem_wr_en &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; end ST_FINISH_OBJ_2: begin run_mem_flip &lt;= ~run_mem_flip; run_mem_wr_addr &lt;= 8'</span></span>d0; current_row &lt;= current_row + <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; if (frame_end_r) begin `ifdef DETECTOR_DEBUG_MODE // DEBUG finish_obj &lt;= 1'</span></span>b1; `endif // <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">some</span></span> stuff around bounding boxes frame_end_r &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; obj_rd_addr &lt;= 5'</span></span>d0; obj_saved_rd_addr &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span><span class="hljs-string"><span class="hljs-string">'d0;; blob_detector_fsm_state &lt;= ST_UPLOAD_DATA_START; end else begin blob_detector_fsm_state &lt;= ST_IDLE; end end ST_UPLOAD_DATA_START: begin // an empty case (altera'</span></span>s altsyncram <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> cycles, one <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> them <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> empty) obj_saved_rd_addr &lt;= obj_rd_addr; blob_detector_fsm_state &lt;= ST_UPLOAD_DATA; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ST_UPLOAD_DATA: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj_rd_addr &gt;= (`OBJ_LIMIT - <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> blob_detector_fsm_state &lt;= ST_UPLOAD_DATA_END; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> data_o &lt;= {<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">'h0, obj_saved_rd_addr, obj_detected_valid, obj_rd_start_x, obj_rd_end_x, obj_rd_start_y, obj_rd_end_y}; //data_o &lt;= {2'</span></span>h0, obj_saved_rd_addr, obj_rd_valid, obj_rd_start_x, obj_rd_end_x, obj_rd_start_y - <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-string"><span class="hljs-string">'d320, obj_rd_end_y - 10'</span></span>d320}; //data_o &lt;= {<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">'h0, obj_saved_rd_addr, 1'</span></span>b1, <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-string"><span class="hljs-string">'d340, 10'</span></span>d380, <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-string"><span class="hljs-string">'d120, 10'</span></span>d160}; we &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; // clean obj memory obj_wr_addr &lt;= obj_rd_addr; obj_valid &lt;= 1'</span></span>b0; obj_updated &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; obj_start_x &lt;= 10'</span></span>d0; obj_end_x &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-string"><span class="hljs-string">'d0; obj_start_y &lt;= 10'</span></span>d0; obj_end_y &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-string"><span class="hljs-string">'d0; obj_mass &lt;= 20'</span></span>d0; obj_mem_wr_en &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; // set box generator'</span></span>s address //<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj_detected_valid) obj_saved_rd_addr &lt;= obj_saved_rd_addr + <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; // set the next read address obj_rd_addr &lt;= obj_rd_addr + 1'</span></span>b1; blob_detector_fsm_state &lt;= ST_UPLOAD_DATA_START; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ST_UPLOAD_DATA_END: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> obj_rd_addr &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span><span class="hljs-string"><span class="hljs-string">'d0; blob_detector_fsm_state &lt;= ST_START; end default: blob_detector_fsm_state &lt;= ST_START; endcase end endmodule</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     中間状態の存在： <b>FIND_OVERLAP_0</b> 、 <b>UPDATE_OBJ_2</b> 、 <b>MERGE_OBJ_2</b> 、 <b>FINISH_OBJ_2</b>および<b>UPLOAD_DATA_START</b>は、2ポートFPGAメモリの読み取りに関連付けられています。  1クロックサイクルのメモリの読み取りは不可能であることがわかりました。つまり、現在のクロックサイクルでアドレスを設定すると、次のクロックサイクルではメモリから有効なデータを受信しませんが、  altsyncram <b>メガファンクション</b>入力はレジスタであり、記録ブロックに同期しています。 ここから、1ステップの遅延が判明します。 私はそれが正しかったことを願っています:) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> バウンディングボックスジェネレーター </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     このブロックは、見つかったオブジェクトの周囲に長方形のフレームを描くために使用されます。  32個のオブジェクトが実装されているため、32個のフレームジェネレータもあり、それらはすべて直列に接続されており、それぞれに固有のアドレスがあります。 このアドレス<b>は</b> 、 <b>Blob Detector</b>モジュールの<b>オブジェクトメモリ</b>内の<b>オブジェクトの</b>アドレスと一致します。  FIFOからデータを読み取るとき、フレームジェネレーターはFIFOからのアドレスを一意のアドレスと比較し、オブジェクトの座標を読み込んでフレームをそれ自体に描画するか、スキップします。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ジェネレータのさらなる作業はかなり簡単です。このピクセルの座標は、ピクセルデータとともにフレームジェネレータに送信され、検出器はそれらをFIFOからロードされた座標と比較します。 入力座標がロードされた座標内にある場合、ピクセルの色はフレームの色に変わります。そうでない場合、ピクセルは変更されません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ボックスジェネレーターコード 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">バウンディングボックスジェネレーター</b> <div class="spoiler_text"><pre> <code class="hljs vhdl">module box_generator #( <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> BADDR = <span class="hljs-number"><span class="hljs-number">5</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> COLOR = <span class="hljs-number"><span class="hljs-number">16</span></span><span class="hljs-symbol"><span class="hljs-symbol">'hF8_00</span></span> ) ( input clk, input nRst, input [<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] addr, input [<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data, input we, input [<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] hcount, input [<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] vcount, input [<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] pixel_i, output wire [<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] pixel_o ); reg [<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] xs = <span class="hljs-number"><span class="hljs-number">0</span></span>,xe = <span class="hljs-number"><span class="hljs-number">0</span></span>,ys = <span class="hljs-number"><span class="hljs-number">0</span></span>,ye = <span class="hljs-number"><span class="hljs-number">0</span></span>; reg box_valid = <span class="hljs-number"><span class="hljs-number">0</span></span>; reg [<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] pixel_r; wire addr_valid = (addr == BADDR) ? <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; always @(posedge clk <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> negedge nRst) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!nRst) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> xs &lt;= <span class="hljs-number"><span class="hljs-number">11</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d0</span></span>; ys &lt;= <span class="hljs-number"><span class="hljs-number">11</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d0</span></span>; xe &lt;= <span class="hljs-number"><span class="hljs-number">11</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d0</span></span>; ye &lt;= <span class="hljs-number"><span class="hljs-number">11</span></span><span class="hljs-symbol"><span class="hljs-symbol">'d0</span></span>; box_valid &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (we &amp;&amp; addr_valid) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> xs = data[<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>]; xe = data[<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>]; ys = data[<span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>]; ye = data[<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]; box_valid = data[<span class="hljs-number"><span class="hljs-number">40</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> always @(*) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((hcount &gt;= xs &amp;&amp; hcount &lt;= xe) &amp;&amp; (vcount == ys || vcount == ye)) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> pixel_r = COLOR; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((hcount == xs || hcount == xe) &amp;&amp; (vcount &gt;= ys &amp;&amp; vcount &lt;= ye)) pixel_r = COLOR; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pixel_r = pixel_i; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> assign pixel_o = box_valid ? pixel_r : pixel_i; endmodule</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      32個のフレームジェネレーターの挿入は、 <b>生成</b>演算子を使用して順次実行されます。 前の各モジュールの出力は、次のモジュールの入力に接続されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">wire</span></span> [<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] box_out [<span class="hljs-number"><span class="hljs-number">0</span></span>:`<span class="hljs-type"><span class="hljs-type">OBJ_LIMIT</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>]; genvar i; generate for(i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; `<span class="hljs-type"><span class="hljs-type">OBJ_LIMIT</span></span>; i = i + <span class="hljs-number"><span class="hljs-number">1</span></span> ) begin : box_gen <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == <span class="hljs-number"><span class="hljs-number">0</span></span>) begin box_generator #( .<span class="hljs-type"><span class="hljs-type">BADDR</span></span>(i), .<span class="hljs-type"><span class="hljs-type">COLOR</span></span>(`<span class="hljs-type"><span class="hljs-type">CL_RED</span></span>) ) <span class="hljs-type"><span class="hljs-type">BOX_GEN</span></span> ( .clk(pix_clk), .nRst(nRst), .addr(box_data[<span class="hljs-number"><span class="hljs-number">45</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>]), .<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_data</span></span></span><span class="hljs-class">[40:0]), .we(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_fifo_rd_en</span></span></span><span class="hljs-class">), .hcount(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">counter_x</span></span></span><span class="hljs-class">), .vcount(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">counter_y</span></span></span><span class="hljs-class">), .pixel_i({</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">morph_out</span></span></span><span class="hljs-class">[7:3], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">morph_out</span></span></span><span class="hljs-class">[7:2], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">morph_out</span></span></span><span class="hljs-class">[7:3]}), .pixel_o(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_out</span></span></span><span class="hljs-class">[0]) ); end else begin box_generator #( .</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BADDR(i)</span></span></span><span class="hljs-class">, .</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">COLOR</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CL_RED</span></span></span><span class="hljs-class">) ) </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BOX_GEN</span></span></span><span class="hljs-class"> ( .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clk</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pix_clk</span></span></span><span class="hljs-class">), .nRst(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nRst</span></span></span><span class="hljs-class">), .addr(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_data</span></span></span><span class="hljs-class">[45:41]), .</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_data</span></span></span><span class="hljs-class">[40:0]), .we(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_fifo_rd_en</span></span></span><span class="hljs-class">), .hcount(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">counter_x</span></span></span><span class="hljs-class">), .vcount(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">counter_y</span></span></span><span class="hljs-class">), .pixel_i(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_out</span></span></span><span class="hljs-class">[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class">-1]), .pixel_o(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_out</span></span></span><span class="hljs-class">[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class">]) ); end end ndgenerate</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     上記のブロックは、次のように接続されています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">wire</span></span> [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_start, run_end; wire row_end, frame_end, new_run; wire [<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_fifo_data_o; wire run_fifo_full, run_fifo_empty, run_fifo_wr_en, run_fifo_rd_en; run_detector #( .<span class="hljs-type"><span class="hljs-type">RES_X</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>'d320), .<span class="hljs-type"><span class="hljs-type">RES_Y</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>'d240), .<span class="hljs-type"><span class="hljs-type">XOFFSET</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>'d320), .<span class="hljs-type"><span class="hljs-type">YOFFSET</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>'d0) ) <span class="hljs-type"><span class="hljs-type">RUN_DETECTOR</span></span> ( .clk(pix_clk), .nRst(nRst), .data_valid(in_frame2), .data_in(&amp;morph_out), .xi(counter_x), .yi(counter_y), .run_start(run_start), .run_end(run_end), .row_end(row_end), .frame_end(frame_end), .new_run(new_run), .rd_req(run_read_req) ); wire [<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] run_fifo_rd_used, run_fifo_wr_used; wire run_fifo_rd_avail = |run_fifo_rd_used[<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]; wire run_fifo_almost_full = &amp;run_fifo_wr_used[<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]; assign run_fifo_wr_en = (!run_fifo_almost_full &amp;&amp; new_run) ? <span class="hljs-number"><span class="hljs-number">1</span></span>'b1: <span class="hljs-number"><span class="hljs-number">1</span></span>'b0; alt_fifo_22x512 <span class="hljs-type"><span class="hljs-type">RUN_FIFO</span></span> ( .wrclk(pix_clk), .<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">({</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">frame_end</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">row_end</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_start</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_end</span></span></span><span class="hljs-class">}), .aclr(~</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nRst</span></span></span><span class="hljs-class">), .rdreq(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_fifo_rd_en</span></span></span><span class="hljs-class">), .wrreq(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_fifo_wr_en</span></span></span><span class="hljs-class">), .rdempty(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_fifo_empty</span></span></span><span class="hljs-class">), .rdclk(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clk</span></span></span><span class="hljs-class">), .wrfull(), .q(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_fifo_data_o</span></span></span><span class="hljs-class">), .rdusedw(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_fifo_rd_used</span></span></span><span class="hljs-class">), .wrusedw(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_fifo_wr_used</span></span></span><span class="hljs-class">) ); wire box_we; wire [47:0] box_data; wire [47:0] box_data_det; blob_detector #( .</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RES_X</span></span></span><span class="hljs-class">(10'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d320</span></span></span><span class="hljs-class">), .</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RES_Y</span></span></span><span class="hljs-class">(10'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d240</span></span></span><span class="hljs-class">) ) </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BLOB_DET</span></span></span><span class="hljs-class"> ( .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clk</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clk</span></span></span><span class="hljs-class">), .nRst(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nRst</span></span></span><span class="hljs-class">), // input </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RUN</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FIFO</span></span></span><span class="hljs-class"> .fifo_empty(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_fifo_empty</span></span></span><span class="hljs-class">), .fifo_data(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_fifo_data_o</span></span></span><span class="hljs-class">), .fifo_rd_en(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run_fifo_rd_en</span></span></span><span class="hljs-class">), // output boxes interface .we(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_we</span></span></span><span class="hljs-class">), .data_o(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_data_det</span></span></span><span class="hljs-class">) ); wire [7:0] box_fifo_rd_used, box_fifo_wr_used; wire box_fifo_rd_avail = |box_fifo_rd_used[7:0]; wire box_fifo_almost_full = &amp;box_fifo_wr_used[6:2]; wire box_fifo_wr_en = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_we</span></span></span><span class="hljs-class"> &amp;&amp; !</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_fifo_almost_full</span></span></span><span class="hljs-class">) ? 1'b1 : 1'b0; // read object </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FIFO</span></span></span><span class="hljs-class"> right after valid first screen (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">might</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">be</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">done</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">anywhere</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">within</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">frame</span></span></span><span class="hljs-class">) wire obj_read_ena = ((</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">counter_y</span></span></span><span class="hljs-class"> == 11'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d0</span></span></span><span class="hljs-class">) &amp;&amp; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">counter_x</span></span></span><span class="hljs-class"> &lt; 10'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d32</span></span></span><span class="hljs-class">)) ? 1'b1 : 1'b0; wire box_fifo_rd_en = box_fifo_rd_avail &amp;&amp; obj_read_ena; dcfifo_41x128 </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BOX_FIFO</span></span></span><span class="hljs-class"> ( .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">aclr</span></span></span><span class="hljs-class">(~</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nRst</span></span></span><span class="hljs-class">), .</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_data_det</span></span></span><span class="hljs-class">), .rdclk(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pix_clk</span></span></span><span class="hljs-class">), .rdreq(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_fifo_rd_en</span></span></span><span class="hljs-class">), .wrclk(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clk</span></span></span><span class="hljs-class">), .wrreq(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_fifo_wr_en</span></span></span><span class="hljs-class">), .q(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_data</span></span></span><span class="hljs-class">), .rdempty(), .rdusedw(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_fifo_rd_used</span></span></span><span class="hljs-class">), .wrfull(), .wrusedw(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">box_fifo_wr_used</span></span></span><span class="hljs-class">) );</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> 結果 </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     複数のオブジェクトの検出器の結果はこのビデオで示されます： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/O5qaqyZWG6A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> 結論 </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     結果の複数オブジェクト検出器はスケーラブルです。 入力画像の大きな解像度で作業するには、オブジェクトとRUNのメモリサイズを増やすことで、検出されたオブジェクトの数を増やすことができます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> 関連資料 </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      → <a href="http://libgen.me/view.php%3Fid%3D738271">FPGAでの組み込み画像処理のためのドナルドG.ベイリーデザイン</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      → <a href="http://www.electronics.dit.ie/staff/aschwarzbacher/research/mpc08-1Blob.pdf">ランレングスエンコーディングを使用したシングルパスリアルタイムブロブ解析のFPGA実装</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      → <a href="http://seat.massey.ac.nz/research/centres/SPRG/pdfs/2015_CASVT_PP.pdf">接続コンポーネント分析のためのリソース効率の高いハードウェアアーキテクチャ</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J327146/index.html">YiiConf 2017、モスクワ6月16日</a></li>
<li><a href="../J327148/index.html">Telegramの簡単なリマインダー</a></li>
<li><a href="../J327150/index.html">Ubuntu Server 16.04 LTSでのZabbix 3.2の構成</a></li>
<li><a href="../J327152/index.html">NAT用Mikrotik L2TP / IPSec：ipsec、エラーはph2パケットの前処理に失敗しました</a></li>
<li><a href="../J327158/index.html">大規模組織でアジャイル手法を実装する際の7つの障壁</a></li>
<li><a href="../J327168/index.html">4つの言語での車の番号。 パート2</a></li>
<li><a href="../J327172/index.html">SQL Server 2017：Pythonサポート付き</a></li>
<li><a href="../J327178/index.html">モバイル＃200開発者向けの興味深い資料のダイジェスト（4月17〜23日）</a></li>
<li><a href="../J327180/index.html">ダガズ：リハーサル</a></li>
<li><a href="../J327184/index.html">60秒でセレン</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
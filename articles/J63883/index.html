<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⬆️ 🌭 👤 ネストされたセット+ MySQL TRIGGER 🚔 😆 👨🏻‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="挑戦する  
  
 タスクは前の記事と同じで、MySQLにのみ適用できます。 
  
 
  
  すくい  
  
 良いニュースだ！ MySQLの再帰トリガーに問題はありません！ MySQL開発者は、トリガーレベルでも変更可能なテーブルを愚かにロックするだけです。これが大根です。 しかし、実際...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>ネストされたセット+ MySQL TRIGGER</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/63883/"><h4> 挑戦する </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     タスクは前の<a href="http://phoinixrw.habrahabr.ru/blog/63416/">記事</a>と同じで、MySQLにのみ適用できます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> すくい </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     良いニュースだ！  <i>MySQLの</i>再帰トリガーに問題はありません！  <i>MySQL</i>開発者は、トリガーレベルでも変更可能なテーブルを愚かにロックするだけです。これが大根です。 しかし、実際には、停電だけが私たちを止めることができます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     小さな抜け穴があり、結合されたテーブルがあります。 私はそれが非常に特別に考案されたことを文書で確認しませんでしたが、否定もありませんでした。 確かに、この抜け穴はカバーされる可能性がありますが、ポイントはわかりません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     悲しいかな、 <i>MySQL</i>のトリガーメカニズム<i>は</i>新しく、かなり粗雑なものであり、その使用にいくつかの制限を課していますが、それでも問題を解決するには十分です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a> したがって、ソーステーブル： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      SQLコード（1） <pre> CREATE TABLE `ns_tree`（
     `id` int（11）NOT NULL auto_increment、
     `left_key` int（11）NOT NULLデフォルト '0'、
     `right_key` int（11）NOT NULLデフォルト '0'、
     `level` int（11）NOT NULLデフォルト '0'、
     `parent_id` int（11）NOT NULLデフォルト '0'、
     `tree` int（11）NOT NULLデフォルト '1'、
     `field1`テキスト、
    主キー（ `id`）
 ）エンジン= MyISAM;
    </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     それに基づいて、まったく同じフィールドセットを持つまったく同じテーブルを作成します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      SQLコード（2） <pre> CREATE TABLE `_ns_tree`（
     `id` int（11）NOT NULL auto_increment、
     `left_key` int（11）NOT NULLデフォルト '0'、
     `right_key` int（11）NOT NULLデフォルト '0'、
     `level` int（11）NOT NULLデフォルト '0'、
     `parent_id` int（11）NOT NULLデフォルト '0'、
     `tree` int（11）NOT NULLデフォルト '1'、
     `field1`テキスト、
    主キー（ `id`）
 ）エンジン=挿入METHOD =最後の結合=（ `ns_tree`）;
    </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     キーワード<i>-MERGEは</i>基本的にテーブルのビューを作成し、それをテーブルとして使用できます。 一般に、MERGEメカニズムも少し湿っています。 結合されたテーブルの構造は、元のテーブルとまったく同じでなければなりません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>重要!!!</b>  <b>元のテーブルの構造を変更すると、テーブル間の接続は失われますが、すでに接続されている行の間では-NO！</b>  <b>注意してください。</b>  <b>ソーステーブルの構造を変更するとき、同じ変更を結合されたものに適用する必要があります！</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     元のテーブルもMyISAMである必要があります。これは理解可能であり、この場合のトランザクションは、テーブルが相互にロックできず、テーブル内のデータが同じであるため、適用できません。 ただし、トリガーの制限内でソーステーブルがロックされ、結合されたテーブルのデータをトリガーから変更するため、これは怖いことではありません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     また、私が注意したいこと：テーブルが完全にブロックされ、キューが長くなりすぎる可能性があるため、同じツリー内でルートノードを使用しないことを強くお勧めします（以前の記事で述べたように）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> レコードを作成 </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>MySQL</i>トリガー方言は、 <i>PostgreSQL</i>方言とわずかに異なり<i>ます</i> 。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> プロシージャの開始時に変数を宣言する必要はありません。 </li><li> トリガーの実行を中断することは不可能です。完全に解決する必要があります。 </li><li> 上記のように、再帰を恐れていないため、追加のチェックや追加のフィールドは必要ありません。 </li></ul> したがって、ロジックは多少変更されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> 変数は途中で表示されます。 </li><li> トリガーから戻る代わりに、コードを条件でラップします。 </li><li> ツリーの構造に関するすべての変更は、補助ジョイントテーブルに適用されます。 </li></ul>  SQLコード（3） <pre> CREATE DEFINER = 'user' @ 'localhost' TRIGGER `ns_tree_before_ins_tr` BEFORE INSERT ON` ns_tree`
    各行ごと
開始
     SET @left_key：= 0;
     SET @level：= 0;
 -親を指定した場合：
     NEW.parent_idがNULLではなく、NEW.parent_id&gt; 0の場合
         SELECT right_key、 `level` + 1 INTO @left_key、@level
             ns_treeから
             WHERE id = NEW.parent_id AND tree = NEW.tree;
    終了IF;
 -左キーを指定した場合：
     NEW.left_keyがNULLではなく、NEW.left_key&gt; 0かつ 
         （@left_keyはNULLまたは@left_key = 0）THEN
         SELECT id、left_key、right_key、 `level`、parent_id 
             INTO @ tmp_id、@ tmp_left_key、@ tmp_right_key、@ tmp_level、@ tmp_parent_id
             ns_treeから
             WHEREツリー= NEW.tree AND（left_key = NEW.left_key OR right_key = NEW.left_key）;
         IF @tmp_left_keyがNULLではなく、かつ@tmp_left_key&gt; 0 AND NEW.left_key = @tmp_left_key THEN
             SET NEW.parent_id：= @tmp_parent_id;
             SET @left_key：= NEW.left_key;
             SET @level：= @tmp_level;
         ELSEIF @tmp_left_keyはNULLではなく、@ tmp_left_key&gt; 0 AND NEW.left_key = @tmp_right_key THEN
             SET NEW.parent_id：= @tmp_id;
             SET @left_key：= NEW.left_key;
             SET @level：= @tmp_level + 1;
        終了IF;
    終了IF;
 -親キーまたは左キーが指定されていない場合、または何も見つからなかった場合
     @left_keyがNULLまたは@left_key = 0の場合
         SELECT MAX（right_key）+ 1 INTO @left_key
             ns_treeから
             WHEREツリー= NEW.tree;
         @left_keyがNULLまたは@left_key = 0の場合
             SET @left_key：= 1;
        終了IF;
         SET @level：= 0;
         SET NEW.parent_id：= 0; 
    終了IF;
 -新しいキー値を設定する
     SET NEW.left_key：= @left_key;
     SET NEW.right_key：= @left_key + 1;
     SET NEW.`level`：= @level;
 -ツリーにギャップを形成する
     UPDATE _ns_tree
         SET left_key = case when when left_key&gt; = @left_key 
               THEN left_key + 2 
               ELSE left_key + 0 
             END、
             right_key = right_key + 2
         WHEREツリー= NEW.tree AND right_key&gt; = @left_key;
終了
    </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> レコードを編集 </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     原則は、方言の使用と同じです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      SQLコード（4） <pre> CREATE DEFINER = 'user' @ 'localhost' TRIGGER `ns_tree_before_upd_tr` BEFORE UPDATE ON` ns_tree`
    各行ごと
開始
 -フィールドの変更、または不快なものの送信を禁止します
     SET NEW.tree：= OLD.tree;
     SET NEW.right_key：= OLD.right_key;
     SET NEW.`level`：= OLD.`level`;
     SET @return_flag：= 0;
     NEW.parent_idがNULLの場合、NEW.parent_idを設定します：= 0; 終了IF;
 -ツリーの構造に関連する変更があるかどうかを確認します
     NEW.parent_id &lt;&gt; OLD.parent_idまたはNEW.left_key &lt;&gt; OLD.left_keyの場合
 -ツリーを再構築しています。先に進みましょう。
         SET @left_key：= 0;
         SET @level：= 0;
         SET @skew_tree：= OLD.right_key-OLD.left_key + 1;
 -移動先を決定します。
 -parent_idが変更された場合：
         NEW.parent_id &lt;&gt; OLD.parent_idの場合
 -別の悪にさらされている場合：
             NEW.parent_id&gt; 0の場合
                 SELECT right_key、レベル+ 1
                     INTO @ left_key、@ level
                     ns_treeから
                     WHERE id = NEW.parent_id AND tree = NEW.tree;
 -それ以外の場合、ツリーのルートに転送します。
            その他
                 SELECT MAX（right_key）+ 1 
                     INTO @left_key
                     ns_treeから
                     WHEREツリー= NEW.tree;
                 SET @level：= 0;
            終了IF;
 -突然親が移動したノードの範囲内にある場合は、以下を確認してください。
             @left_keyがNULLではない場合 
                @left_key&gt; 0 AND
                @left_key&gt; OLD.left_key AND
                @left_key &lt;= OLD.right_key THEN
                    SET NEW.parent_id：= OLD.parent_id;
                    SET NEW.left_key：= OLD.left_key;
                    SET @return_flag：= 1;
            終了IF;
        終了IF;
 -parent_idではない場合、left_keyが変更されるか、parent_idを変更しても何も生じない場合
         @left_keyがNULLまたは@left_key = 0の場合
             SELECT id、left_key、right_key、 `level`、parent_id 
                 INTO @ tmp_id、@ tmp_left_key、@ tmp_right_key、@ tmp_level、@ tmp_parent_id
                 ns_treeから
                 WHEREツリー= NEW.tree AND（right_key = NEW.left_key OR right_key = NEW.left_key-1）
                 LIMIT 1;
             @tmp_left_keyがNULLではない場合 
                @tmp_left_key&gt; 0 AND 
                NEW.left_key-1 = @tmp_right_key THEN
                 SET NEW.parent_id：= @tmp_parent_id;
                 SET @left_key：= NEW.left_key;
                 SET @level：= @tmp_level;
             ELSEIF @tmp_left_keyはNULLではない 
                    @tmp_left_key&gt; 0 AND 
                    NEW.left_key = @tmp_right_key THEN
                 SET NEW.parent_id：= @tmp_id;
                 SET @left_key：= NEW.left_key;
                 SET @level：= @tmp_level + 1;
             ELSEIF NEW.left_key = 1 THEN
                 SET NEW.parent_id：= 0;
                 SET @left_key：= NEW.left_key;
                 SET @level：= 0;
            その他
                 SET NEW.parent_id：= OLD.parent_id;
                 SET NEW.left_key：= OLD.left_key;
                 SET @return_flag = 1;
            終了IF;
        終了IF;
 -これで、ツリーの移動先がわかりました
 -やりがいがあるかどうかを確認します
         @return_flagがNULLまたは@return_flag = 0の場合
             SET @skew_level：= @level-OLD.`level`;
             IF @left_key&gt; OLD.left_key THEN
 -ツリーを上に移動する
                 SET @skew_edit：= @left_key-OLD.left_key-@skew_tree;
                 UPDATE _ns_tree
                     SET left_key = right_key &lt;= OLD.right_keyの場合
                                          THEN left_key + @skew_edit
                                         その他の場合left_key&gt; OLD.right_keyの場合
                                                    THEN left_key-@skew_tree
                                                    ELSE left_key
                                              終了
                                    END、
                         `level` = right_key &lt;= OLD.right_keyの場合 
                                         THEN `レベル` + @skew_level
                                         ELSE `レベル`
                                    END、
                         right_key = right_key &lt;= OLD.right_keyの場合 
                                          THEN right_key + @skew_edit
                                         その他のケースright_key &lt;@left_keyの場合
                                                    THEN right_key-@skew_tree
                                                    ELSE right_key
                                              終了
                                    終了
                     WHEREツリー= OLD.tree AND
                           right_key&gt; OLD.left_key AND
                           left_key &lt;@left_key AND
                           id &lt;&gt; OLD.id;
                 SET @left_key：= @left_key-@skew_tree;
            その他
 -ツリーを下に移動する：
                 SET @skew_edit：= @left_key-OLD.left_key;
                 UPDATE _ns_tree 
                    セット
                         right_key = left_key&gt; = OLD.left_keyの場合
                                          THEN right_key + @skew_edit
                                         その他の場合right_key &lt;OLD.left_keyの場合
                                                    THEN right_key + @skew_tree
                                                    ELSE right_key
                                              終了
                                     END、
                         `level` = left_key&gt; = OLD.left_keyの場合
                                          THEN `レベル` + @skew_level
                                          ELSE `レベル`
                                     END、
                         left_key =ケースleft_key&gt; = OLD.left_keyの場合
                                          THEN left_key + @skew_edit
                                         その他の場合left_key&gt; = @left_key
                                                    THEN left_key + @skew_tree
                                                    ELSE left_key
                                              終了
                                    終了
                     WHEREツリー= OLD.tree AND
                           right_key&gt; = @left_key AND
                           left_key &lt;OLD.right_key AND
                           id &lt;&gt; OLD.id;
            終了IF;
 -ツリーが再構築され、現在のノードのみが残りました
             SET NEW.left_key：= @left_key;
             SET NEW.`level`：= @level;
             SET NEW.right_key：= @left_key + @skew_tree-1;
        終了IF;
    終了IF;
終了
    </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     注意!!!  MySQLでは、同じクエリのクエリ中に変更されたフィールドが値を新しいものに変更するため、 <i>UPDATE</i>クエリにフィールドがリストされる順序が重要です。条件の下でクエリでこれらのフィールドをさらに使用すると、結果が不十分になります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> レコードを削除 </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     トリガーの再帰には問題がないため、一般に削除は簡単な作業になります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     オプションのトリガー：「ブランチ全体を削除」： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      SQLコード（5） <pre> CREATE DEFINER = 'user' @ 'localhost' TRIGGER `ns_tree_before_del_tr` AFTER DELETE ON` ns_tree`
    各行ごと
開始
 -子ノードを削除します。
     _ns_treeから削除
        どこ 
            ツリー= OLD.tree AND
             left_key&gt; OLD.left_key AND
             right_key &lt;OLD.right_key;
 -キーのギャップを削除します。
     SET @skew_tree：= OLD.right_key-OLD.left_key + 1;
     UPDATE _ns_tree
         SET left_key = left_key&gt; OLD.left_keyの場合
                             THEN left_key-@skew_tree
                             ELSE left_key
                        END、
             right_key = right_key-@skew_tree
         WHERE right_key&gt; OLD.right_key AND
            ツリー= OLD.tree AND
             id &lt;&gt; OLD.id;
終了
    </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     オプションのトリガー：「子ノードを上に移動してノードを削除する」： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      SQLコード（6） <pre> CREATE DEFINER = 'user' @ 'localhost' TRIGGER `ns_tree_before_del_tr` AFTER DELETE ON` ns_tree`
    各行ごと
開始
 -キーのギャップを削除します。
    UPDATE _ns_tree
         SET left_key = left_key &lt;OLD.left_keyの場合
                             THEN left_key
                            その他のケース（right_key &lt;OLD.right_keyの場合）
                                       THEN left_key-1 
                                       ELSE left_key-2
                                 終了
                        END、
             parent_id = right_key &lt;OLD.right_key AND `level` = OLD.level + 1の場合
                            OLD.parent_id
                            ELSE parent_id
                         END、
             `level` = right_key &lt;OLD.right_keyの場合
                            THEN `レベル`-1 
                            ELSE `レベル`
                       END、
             right_key = right_key &lt;OLD.right_keyの場合
                              THEN right_key-1 
                              ELSE right_key-2
                        終了
         WHERE（right_key&gt; OLD.right_keyまたは
             （left_key&gt; OLD.left_key AND right_key &lt;OLD.right_key））AND
            ツリー= OLD.tree;
終了
    </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ツリーの構造に影響を与える変更はバッチで行う必要はなく、各ノードで順番に行う必要があるため、その整合性が維持されることに注意してください。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     実際にはすべて。 インデックスを置くことだけが残っています（ここでも、SQLコマンドを書くのが面倒なので、声を出して説明します）。 <ul><li> コンポジットはフィールド（ <i>left_key、right_key、level、tree</i> ）に固有ではありません。 </li><li> フィールド（ <i>parent_id</i> ）で一意ではありません。 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     お楽しみください;-) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>セルゲイ・トムレヴィッチ（別名フェニックス）（07/08/2009）</i> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J63869/index.html">ベラルーシルーブル（WMB）に対する過剰な需要</a></li>
<li><a href="../J63872/index.html">USBチェーンソーI.Saw</a></li>
<li><a href="../J63875/index.html">WhenWill-将来のイベントのお知らせ</a></li>
<li><a href="../J63878/index.html">Jobs HealthとAppleの引用</a></li>
<li><a href="../J63879/index.html">フラッシュドライブカー</a></li>
<li><a href="../J63885/index.html">辞書に入力された単語「twitter」</a></li>
<li><a href="../J63890/index.html">Ubuntuでのext4の問題</a></li>
<li><a href="../J63893/index.html">FBI：ロシアのプログラマーが交換の秘密を盗んだ</a></li>
<li><a href="../J63896/index.html">Opera Mini ProxyでGPRSトラフィックを節約</a></li>
<li><a href="../J63902/index.html">Magentoの変更方法、または簡単な例で基本機能を変更する方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
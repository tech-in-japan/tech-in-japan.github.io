<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛵️ 🚶 👨🏾‍🎓 OLTPゲーム ☮️ 📦 🐠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、高性能アプリケーションの実装のテーマがHabréで一般的になりました。 また、この方向で少し実験し、研究の現在の結果を共有することにしました。 
  
 
  
 件名「Hello、world！」は最も単純なOLTPシステムです。 
  
 
  
  
  
  
  
 
  
 
  
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>OLTPゲーム</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/69974/"> 最近、高性能アプリケーションの実装のテーマがHabréで一般的になりました。 また、この方向で少し実験し、研究の現在の結果を共有することにしました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     件名<em>「Hello、world！」</em>は最も単純なOLTPシステムです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="http://img201.imageshack.us/img201/909/mainb.jpg"></div>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     このようなシステムでは、パフォーマンスとフォールトトレランスの要件が重要です。 したがって、問題の解決策の検索は、C、C ++、fastcgi、nginx、lighttpd、oracleの方向で実行されました。 まず、これらのテクノロジーでOLTPを構築するさまざまなオプションを試し、パフォーマンスとピーク負荷を測定することに興味がありました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> そして、問題の条件 </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次の形式のトランザクションを処理する必要があります：transfer X cu  （お金、あなたはどう思いましたか）アカウントAからアカウントBへ。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> リクエストは次の形式です </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <strong>server.com/paysys.request?account=123&amp;operator=456&amp;money=789</strong> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     つまり、オペレーター456のアカウントからユーザー123のアカウントに789のお金を転送します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     データベースには3つのプレートのみがあります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="http://img201.imageshack.us/img201/9679/tablesp.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <sub>（図1. DB構造）</sub> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     トランザクション手順は、データベース構造よりもそれほど複雑ではありません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ;</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; begin o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) then o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> else <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; insert <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) values ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">procedure</font> PROCESS_TRANS(p_account_id <font color="#0000ff">in</font> number, p_operator_id <font color="#0000ff">in</font> number, p_sum <font color="#0000ff">in</font> number, o_result <font color="#0000ff">out</font> number) <font color="#0000ff">is</font> l_cnt  number; <font color="#0000ff">cursor</font> cur_account <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_account <font color="#0000ff">where</font> id = p_account_id <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> balance; <font color="#0000ff">cursor</font> cur_operator <font color="#0000ff">is</font> <font color="#0000ff">select</font> id <font color="#0000ff">from</font> pay_operator <font color="#0000ff">where</font> id = p_operator_id <font color="#0000ff">and</font> total &gt;= p_sum <font color="#0000ff">for</font> <font color="#0000ff">update</font> <font color="#0000ff">of</font> total; <font color="#0000ff">begin</font> o_result := -1; <font color="#008000">-- tansaction begins</font> <font color="#0000ff">select</font> <font color="#0000ff">count</font> (1) <font color="#008000">-- if such operator exist?</font> <font color="#0000ff">into</font> l_cnt <font color="#0000ff">from</font> pay_operator opr <font color="#0000ff">where</font> opr.id = p_operator_id; <font color="#0000ff">if</font> (l_cnt != 1) <font color="#0000ff">then</font> o_result := -2; <font color="#008000">-- Operator not found!</font> <font color="#0000ff">return</font> ; <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">open</font> cur_account; <font color="#0000ff">open</font> cur_operator; <font color="#0000ff">fetch</font> cur_account <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- need to fetch to update rows later</font> <font color="#0000ff">fetch</font> cur_operator <font color="#0000ff">into</font> l_cnt; <font color="#008000">-- 0/1 row in cursor as selected by prim_key</font> <font color="#0000ff">if</font> cur_account%notfound <font color="#0000ff">then</font> o_result := -3; <font color="#008000">-- Account not found!</font> elsif cur_operator%notfound <font color="#0000ff">then</font> o_result := -4; <font color="#008000">-- Operator has not enough money</font> <font color="#0000ff">else</font> <font color="#0000ff">update</font> pay_account <font color="#0000ff">set</font> balance = (balance + p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_account; <font color="#0000ff">update</font> pay_operator <font color="#0000ff">set</font> total = (total - p_sum) <font color="#0000ff">where</font> <font color="#0000ff">current</font> <font color="#0000ff">of</font> cur_operator; <font color="#0000ff">insert</font> <font color="#0000ff">into</font> pay_transaction ( id, account_id, operator_id, money, datetime ) <font color="#0000ff">values</font> ( pay_transaction_seq.nextval, p_account_id, p_operator_id, p_sum, sysdate ); <font color="#0000ff">commit</font> ; o_result := 1; <font color="#008000">-- transaction successfully finished!</font> <font color="#0000ff">end</font> <font color="#0000ff">if</font> ; <font color="#0000ff">close</font> cur_account; <font color="#0000ff">close</font> cur_operator; <font color="#0000ff">end</font> ;</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     多数の同時接続を備えた高負荷のサーバーアプリケーションを構築するための最もイデオロギー的かつ実際的に正しいアプローチは、マルチプレクサの実装です（ <a href="http://www.kegel.com/c10k.html">C10Kの問題</a> ）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     彼らは、「非伝統的な」 <em>Oracle 10.2 Express Edition</em>をデータベースとして採用することにしました。  <em>約2ミリ秒で</em>実行したデータベース内のトランザクション（更新）。  Oracleがデータをディスクにフラッシュしたとき（明らかに<em>dbwrが</em>変更されたデータブロックをバッファキャッシュから書き込んでいたとき）、トランザクションは<em>20ミリ秒</em>まで遅延しました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     データベースに接続するために、メーカーのライブラリを使用することにしました。 これらのうち、タスクのフレームワークでは、2つのジョークが蓄積されました。 <ul><li>  Oracle Call Interface© </li><li>  Oracle C ++ Call Interface（C ++） </li></ul>  OCIの最高の伝統であるOCCIは、はるかに視覚的で使いやすいです。 ただし、その低レベルの対応には否定できない利点があります。OCIを使用すると、1つのクライアントの処理の一部として複数のデータベースクエリを持つ多重化サーバーを実装するために必要な非ブロッキング（非同期）データベースクエリを実行できます。 多くの人は、ノンブロッキングコールの可能性のために、かなり面倒なコードを記述し、OCCIソースを開くようにOracleに要求する必要があることを不満に思っていますが、私が知る限り、役に立ちません。 パフォーマンスの面では、2人の兄弟は非常にわずかに異なります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> 成分 </h4><ul><li>  Oracle XE 10.2 </li><li>  Nginx 0.7.62 </li><li>  Lighttpd 1.4.23 </li></ul> 他のハードウェアがないため、 <em>Acer 5920G</em>ラップトップ上の<em>VMWareの</em>下で<em>Ubuntu 9.04に</em>住んでいました。 すべてのテストが同じ環境で実行されたため、リソースの不足（両方の意味で）が比較テストの結果の客観性に影響を与えないことを願っています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Oracleのセットアップでは、Tom Kiteから遠く離れているため、データベースとOSはチューニングにあまり煩わされていませんでした。 フルサーバーに移行するときは忙しくなります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     実験の純度を高めるため、各プレートに〜100kエントリが追加されました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2> 体験 </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     そのようなシステムを構築する方法は？  FastCGIプロトコルに基づく最も簡単なソリューションを考えたのは私たちが最初でした。  FastCGIがその祖先CGIと比較して好意的に比較される方法をもう一度説明する価値はないと思います。 高負荷のアプリケーションでは、この違いが基本です。 別のニュアンスについて詳しく説明したいと思いますが、すぐにはわかりませんでした。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      FastCGI仕様は、複数の要求の多重化処理を同時に実装できるように、ユーザー接続の保存を規定しています。 簡単に言えば、リクエストハンドラーで非同期操作を呼び出して、他のクライアントに静かにプロセッサー時間を与え、ポーリングサイクルの次の反復で、呼び出された操作の結果を取得し、クライアントに応答を渡して、接続を閉じます。 残念ながら、nginxとlighttpd（およびlibfcgiとfastcgippライブラリ）はまだこれをサポートしていないため、次のクライアントを処理する前に接続を閉じる必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ただし、この例では、パフォーマンスの大幅な低下を心配せずに、データベースに対して1つの短いクエリのみを同期的に実行できます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Nginxとlighttpdを使用すると、2つの方法でFastCGIとやり取りできます。TCPチャネルとUnixドメインソケットを使用する方法です。 最初のアプローチの利点はFastCGIサーバーのクラスタリングの可能性であり、欠点はデータ転送の比較的高いオーバーヘッドです（それにもかかわらずTCPスタック）。 ただし、UDSはローカルでのみ動作するため、パフォーマンスが向上します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      2番目の方法について、多くの「暖かい」言葉を述べたいと思います。 最初のテスト後、リクエストの10分の1がFastCGIアプリケーションに到達し、200以上のクライアント（ハードウェア上）からの同時リクエストが届きました。 キャッチはカーネル変数net.unux.max_dgram_qlenにありました。これは、ソケットへの書き込み時の要求キューのサイズを制限します。 デフォルトでは、このオプションは10で、リクエストの損失を説明していました。 値を10000に設定すると、すべてが正常に戻るはずです。 しかし、そこにありました。 ほぼ10分の1のリクエストが確実に落ち、nginxはロジックに<em>「connect（）to socket failed（11：Resource temporary unavailable）」</em>という恐ろしい言葉を書きました。 ロシア語では、多数の同時リクエストがあるため、ソケットは「窒息」していました。 この問題はまだ解決できていません。 生産性は向上しましたが、トランザクションの約10％がコード<em>「502」で</em>完了したときに、誰がそれを必要としますか 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  FastCGIサーバー： </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     <ol><li>  <font color="#0000ff">const</font> <font color="#0000ff">char</font> * bind_address = <font color="#A31515">"：9000"</font> ; </li><li>  <font color="#0000ff">const</font> <font color="#0000ff">char</font> * db_user_name = <font color="#A31515">"orauser"</font> ; </li><li>  <font color="#0000ff">const</font> <font color="#0000ff">char</font> * db_password = <font color="#A31515">"pass"</font> ; </li><li>  <font color="#0000ff">const</font> <font color="#0000ff">char</font> * db_conn_str = <font color="#A31515">"comp：1521 / xe"</font> ; </li><li></li><li>  <font color="#0000ff">int</font> main（ <font color="#0000ff">int</font> argc、 <font color="#0000ff">char</font> * <font color="#0000ff">const</font> argv []） </li><li>  { </li><li>  oracle：occi <font color="#0000ff">名前空間</font> <font color="#0000ff">を使用し</font> <font color="#0000ff">ます</font> 。 </li><li></li><li>  <font color="#0000ff">int</font> listenQueueBacklog = 4000; </li><li>  FCGX_Requestリクエスト; </li><li></li><li>  <font color="#0000ff">if</font> （FCGX_Init（）） </li><li>  exit（1）; </li><li></li><li>  <font color="#0000ff">int</font> listen_socket = FCGX_OpenSocket（bind_address、listenQueueBacklog）; </li><li>  <font color="#0000ff">if</font> （listen_socket &lt;0） </li><li>  exit（1）; </li><li></li><li>  <font color="#0000ff">if</font> （fchmod（listen_socket、S_IROTH | S_IWOTH）） </li><li>  exit（1）; </li><li></li><li>  <font color="#0000ff">if</font> （FCGX_InitRequest（＆request、listen_socket、0））exit（1）; </li><li></li><li> 環境* env = Environment :: createEnvironment（Environment :: DEFAULT）; </li><li> 接続* conn = env-&gt; createConnection（db_user_name、db_password、db_conn_str）; </li><li> ステートメント* stmt = conn-&gt; createStatement（ </li><li>  <font color="#A31515">「BEGIN PAY_SYS.PROCESS_TRANS（：v1 ,: v2 ,: v3 ,: v4）; END;」</font>  ）; </li><li></li><li>  <font color="#0000ff">while</font> （FCGX_Accept_r（＆request）== 0） </li><li>  { </li><li>  <font color="#0000ff">bool</font> noException = <font color="#0000ff">false</font> 、succesful = <font color="#0000ff">false</font> ; </li><li></li><li>  <font color="#0000ff">ロング</font>スタート= GetTickCount（）; </li><li>  <font color="#0000ff">char</font> * <font color="#0000ff">params</font> = FCGX_GetParam（ <font color="#A31515">"QUERY_STRING"</font> 、request.envp）; </li><li>  <font color="#0000ff">int</font> operatorID、accountID、moneySum、result = -1; </li><li></li><li>  operatorID = GetIntParam（ <font color="#0000ff">params</font> 、 <font color="#A31515">"operator ="</font> ）; </li><li>  accountID = GetIntParam（ <font color="#0000ff">params</font> 、 <font color="#A31515">"account ="</font> ）; </li><li>  moneySum = GetIntParam（ <font color="#0000ff">params</font> 、 <font color="#A31515">"money ="</font> ）; </li><li></li><li>  <font color="#0000ff">if</font> （operatorID &lt;= 0 || accountID &lt;= 0 || moneySum &lt;= 0） </li><li>  { </li><li>  FCGX_FPrintF（リクエスト。出力、 <font color="#A31515">「HTTP / 1.0 503 Params Error \ n」</font> ）; </li><li>  FCGX_FPrintF（リクエスト。出力、 <font color="#A31515">「コンテンツタイプ：text / html \ r \ n \ r \ n」</font> ）; </li><li>  FCGX_FPrintF（request。Out、 <font color="#A31515">"wrong params &lt;br&gt; \ n"</font> ）; </li><li>  FCGX_Finish_r（＆リクエスト）; </li><li>  <font color="#0000ff">続ける</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">試してみる</font> </li><li>  { </li><li>  stmt-&gt; setInt（1、accountID）; </li><li>  stmt-&gt; setInt（2、operatorID）; </li><li>  stmt-&gt; setInt（3、moneySum）; </li><li>  stmt-&gt; registerOutParam（4、OCCIINT、 <font color="#0000ff">sizeof</font> （結果））; </li><li>  stmt-&gt; execute（）; </li><li> 結果= stmt-&gt; getInt（4）; </li><li></li><li>  <font color="#0000ff">if</font> （結果== 1） </li><li>  succesful = <font color="#0000ff">true</font> ; </li><li>  } </li><li>  <font color="#0000ff">catch</font> （SQLExceptionおよびsqlExcp） </li><li>  { </li><li>  error_log（sqlExcp.getMessage（）。c_str（））; </li><li>  } </li><li></li><li>  <font color="#0000ff">if</font> （成功） </li><li>  { </li><li>  FCGX_FPrintF（リクエスト。出力、 <font color="#A31515">「HTTP / 1.0 200 OK \ n」</font> ）; </li><li>  FCGX_FPrintF（リクエスト。出力、 <font color="#A31515">「コンテンツタイプ：text / html \ r \ n \ r \ n」</font> ）; </li><li>  FCGX_FPrintF（request。Out、 <font color="#A31515">「SQL result =％d」</font> 、result）; </li><li>  } </li><li>  <font color="#0000ff">他に</font> </li><li>  { </li><li>  FCGX_FPrintF（リクエスト。Out、 <font color="#A31515">"HTTP / 1.0 503 DatabaseError \ n"</font> ）; </li><li>  FCGX_FPrintF（リクエスト。出力、 <font color="#A31515">「コンテンツタイプ：text / html \ r \ n \ r \ n」</font> ）; </li><li>  FCGX_FPrintF（リクエスト。出力、 <font color="#A31515">「データベースエラーが発生しました」</font> ）; </li><li>  error_log（ <font color="#A31515">"db error"</font> ）; </li><li>  } </li><li></li><li>  FCGX_Finish_r（＆リクエスト）; </li><li>  } </li><li></li><li>  conn-&gt; terminateStatement（stmt）; </li><li>  env-&gt; terminateConnection（conn）; </li><li> 環境:: terminateEnvironment（env）; </li><li></li><li>  0を<font color="#0000ff">返し</font>ます。 </li><li>  } </li></ol>  <font color="gray">*このソースコードは、 <font color="gray">ソースコードハイライターで</font>強調表示されました。</font> </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2> 合計 </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     使用された包囲とab。 メモリの問題により、Siegeは1秒あたり380を超えるリクエストをきっぱりと拒否し、1000のリクエストに「絞り込んだ」が、過剰な数のオープンソケットに言及した。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     結果の信頼性のために、テストは100、200、300、400の同時10,000クエリのスキームに従って実行されました。 デフォルトのカーネル設定を使用したこのマシン上のFastCGIの場合、負荷は、失われた要求の10％のクリティカルしきい値を克服するのに十分でした。  lighttpd + fastcgiの束は200件のリクエストで「つまずき」始めましたが、nginxの束は最大300の同時接続を維持しました。  400を超える同時接続の負荷では、両方のFastCGIバリアントが「apr_poll：指定されたタイムアウトが期限切れ（70007）」というメッセージで落ちましたが、nginxモジュールはabを介した1000の同時接続で悲鳴を上げることなく分解されました。 テストは再びハードウェアで実行されました。 明確にするために、測定結果をグラフ形式で表示することにしました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     そのため、グラフの署名に応じて、横軸-同時要求数、縦軸-になります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="http://img225.imageshack.us/img225/5023/longestrequest.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <sub>（図2.最長のリクエスト、秒）</sub> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="http://img225.imageshack.us/img225/707/meantime.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <sub>（図3.平均リクエスト処理時間、秒）</sub> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="http://img201.imageshack.us/img201/1341/rps.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <sub>（図4. 1秒間に処理されるリクエストの数）</sub> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="http://img233.imageshack.us/img233/3711/testtime.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <sub>（図5. 10,000リクエストの処理にかかった時間、秒）</sub> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2> おわりに </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     限られたリソースでは素晴らしい結果を得ることができませんでしたが、比較テストは非常に成功したと信じています。 テスト結果は完全であると主張していませんが、一般的に、私たちの意見では、期待を確認します。 国内のアスリートは、最小限の追加装備で自信を持ってリードしています。 彼と彼のコーチは大きな敬意を払っています！  FastCGIと連動して、彼は再び小さな外国の敵をバイパスします。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     私たちの実験では、非同期データベース呼び出しのメカニズムはまだ使用されていません。 クライアントの処理をデータベースへの複数の呼び出しに複雑にし、完全なマルチプレクサを実装すると、テスト結果がどのように変化するか興味があります。  FastCGIでは、これは機能しませんが、nginxモジュールで実行できます。実験を完全にするために、poco、asio、pionなどのライブラリに基づいて独自のHTTPデーモンを呼び出して、「実験的」なもののランクに入れます... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     一般的に、 <em>継続するには...</em> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <strong>UPD</strong> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Nginxモジュールは、静的にコンパイルされるサーバー拡張機能です。  SSLやFastCGIなどの組み込み機能もモジュールとして実装されます。 プラス-速度、マイナス-実行中のマシンでの更新の複雑さ。 すばらしいマニュアルが<a href="http://www.evanmiller.org/">ここにあります</a> 。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     簡単な例を以下に示します。 変更については、OCI Cライブラリを使用してORACLEを操作してください。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     <ol><li>  <font color="#008000">// nginx.confおよびエラー処理による設定のサポートなしのオプション</font> </li><li></li><li>  #include &lt;ngx_config.h&gt; </li><li>  #include &lt;ngx_core.h&gt; </li><li>  #include &lt;ngx_http.h&gt; </li><li>  #include &lt; <font color="#0000ff">string</font> .h&gt; </li><li>  #include &lt;oci.h&gt; </li><li></li><li>  <font color="#0000ff">const</font> text * db_user_name =（ <font color="#0000ff">const</font> text *） <font color="#A31515">"orauser"</font> ; </li><li>  <font color="#0000ff">const</font> text * db_password =（ <font color="#0000ff">const</font> text *） <font color="#A31515">"pass"</font> ; </li><li>  <font color="#0000ff">const</font> text * db_conn_str =（ <font color="#0000ff">const</font> text *） <font color="#A31515">"comp：1521 / xe"</font> ; </li><li>  <font color="#0000ff">const</font> text * command =（ <font color="#0000ff">const</font> text *） </li><li>  <font color="#A31515">「BEGIN PAY_SYS.PROCESS_TRANS（：v1 ,: v2 ,: v3 ,: v4）; END;」</font>  ; </li><li></li><li>  OCIEnv * env; </li><li>  OCISvcCtx *コンテキスト。 </li><li>  OCISession *セッション。 </li><li>  OCIServer *サーバー。 </li><li>  OCIError *エラー。 </li><li>  OCIStmt *ステートメント。 </li><li>  OCIBind * bnd1、* bnd2、* bnd3、* bnd4; </li><li></li><li>  <font color="#0000ff">int</font> operatorID、accountID、sum、result; </li><li>  <font color="#0000ff">static</font> <font color="#0000ff">char</font> * ngx_http_payment_init（ngx_conf_t * cf、 </li><li>  ngx_command_t * cmd、 <font color="#0000ff">void</font> * conf）; </li><li></li><li>  <font color="#008000">// nginx.confの可能なモジュールオプションの配列</font> </li><li>  <font color="#0000ff">static</font> ngx_command_t ngx_http_payment_commands [] = </li><li>  { <font color="#008000">//指定された場所のモジュールを含むメインオプションを1つだけ設定する</font> </li><li>  {ngx_string（ <font color="#A31515">"payment_enabled"</font> ）、 </li><li>  NGX_HTTP_LOC_CONF | NGX_CONF_NOARGS、 </li><li>  ngx_http_payment_init、 </li><li>  NGX_HTTP_LOC_CONF_OFFSET、 </li><li>  0 </li><li>  NULL}、 </li><li>  ngx_null_command <font color="#008000">//配列を終了します</font> </li><li>  }; </li><li>  <font color="#008000">//コールバック、使用しない</font> </li><li>  <font color="#0000ff">static</font> ngx_http_module_t ngx_http_payment_module_ctx = </li><li>  { </li><li>  NULL、 <font color="#008000">/ *事前設定* /</font> </li><li>  NULL、 <font color="#008000">/ *構成後* /</font> </li><li>  NULL、 <font color="#008000">/ *メイン構成の作成* /</font> </li><li>  NULL、 <font color="#008000">/ *メイン構成の初期化* /</font> </li><li>  NULL、 <font color="#008000">/ *サーバー構成の作成* /</font> </li><li>  NULL、 <font color="#008000">/ *サーバー構成のマージ* /</font> </li><li>  NULL、 <font color="#008000">/ *ロケーション構成の作成* /</font> </li><li>  NULL <font color="#008000">/ *ロケーション構成のマージ* /</font> </li><li>  }; </li><li>  <font color="#008000">//すべてのパラメーターを含むモジュール記述子</font> </li><li>  ngx_module_t ngx_http_payment_module = </li><li>  { </li><li>  NGX_MODULE_V1、 </li><li>  ＆ngx_http_payment_module_ctx、 <font color="#008000">/ *モジュールコンテキスト* /</font> </li><li>  ngx_http_payment_commands、 <font color="#008000">/ *モジュールディレクティブ* /</font> </li><li>  NGX_HTTP_MODULE、 <font color="#008000">/ *モジュールタイプ* /</font> </li><li>  NULL、 <font color="#008000">/ * init master * /</font> </li><li>  NULL、 <font color="#008000">/ *初期化モジュール* /</font> </li><li>  NULL、 <font color="#008000">/ *初期化プロセス* /</font> </li><li>  NULL、 <font color="#008000">/ *初期化スレッド* /</font> </li><li>  NULL、 <font color="#008000">/ *終了スレッド* /</font> </li><li>  NULL、 <font color="#008000">/ *プロセスを終了* /</font> </li><li>  NULL、 <font color="#008000">/ *終了マスター* /</font> </li><li>  NGX_MODULE_V1_PADDING </li><li>  }; </li><li></li><li>  <font color="#0000ff">void</font> SetCallParams（ <font color="#0000ff">int</font> oper、 <font color="#0000ff">int</font> account、 <font color="#0000ff">int</font> money） </li><li>  { </li><li>  <font color="#0000ff">if</font> （bnd1！= 0）OCIHandleFree（（dvoid *）bnd1、OCI_HTYPE_BIND）; </li><li>  <font color="#0000ff">if</font> （bnd2！= 0）OCIHandleFree（（dvoid *）bnd2、OCI_HTYPE_BIND）; </li><li>  <font color="#0000ff">if</font> （bnd3！= 0）OCIHandleFree（（dvoid *）bnd3、OCI_HTYPE_BIND）; </li><li>  <font color="#0000ff">if</font> （bnd4！= 0）OCIHandleFree（（dvoid *）bnd4、OCI_HTYPE_BIND）; </li><li></li><li>  <font color="#008000">//スタックからコピーして、有効なポインターを渡すことができるようにします</font> </li><li> 結果= 0; </li><li>  operatorID = oper; </li><li>  accountID =アカウント。 </li><li> 合計=お金; </li><li></li><li>  <font color="#008000">//パラメータをSQL呼び出しにバインドします</font> </li><li>  OCIBindByPos（ステートメント、＆bnd1、エラー、1、およびaccountID、 </li><li>  <font color="#0000ff">sizeof</font> （accountID）、SQLT_INT、（dvoid *）0、 </li><li>  （ub2 *）0、（ub2 *）0、（ub4）0、（ub4 *）0、OCI_DEFAULT）; </li><li>  OCIBindByPos（ステートメント、＆bnd2、エラー、2、＆operatorID、 </li><li>  <font color="#0000ff">sizeof</font> （operatorID）、SQLT_INT、（dvoid *）0、 </li><li>  （ub2 *）0、（ub2 *）0、（ub4）0、（ub4 *）0、OCI_DEFAULT）; </li><li>  OCIBindByPos（ステートメント、＆bnd3、エラー、3、＆合計、 <font color="#0000ff">sizeof</font> （合計）、SQLT_INT、 </li><li>  （dvoid *）0、（ub2 *）0、（ub2 *）0、（ub4）0、 </li><li>  （ub4 *）0、OCI_DEFAULT）; </li><li>  OCIBindByPos（ステートメント、＆bnd4、エラー、4、＆結果、 <font color="#0000ff">sizeof</font> （結果）、SQLT_INT、 </li><li>  （dvoid *）0、（ub2 *）0、（ub2 *）0、（ub4）0、（ub4 *）0、OCI_DEFAULT）; </li><li>  } </li><li>  <font color="#008000">//メインハンドラ、すべての作業はここで行われます</font> </li><li>  <font color="#0000ff">静的</font> ngx_int_t ngx_http_payment_handler（ngx_http_request_t * r） </li><li>  { </li><li>  <font color="#008000">//本体セクションをクリアします</font> </li><li>  ngx_int_t rc = ngx_http_discard_request_body（r）; </li><li></li><li>  <font color="#0000ff">if</font> （rc！= NGX_OK &amp;&amp; rc！= NGX_AGAIN） </li><li>  { </li><li>  ngx_log_error（NGX_LOG_ERR、r-&gt; connection-&gt; log、0、 </li><li>  <font color="#A31515">「ngx_http_discard_request_body（）に失敗しました」</font> ）; </li><li>  <font color="#0000ff">return</font> rc; </li><li>  } </li><li></li><li>  <font color="#008000">// nginxの行は、長さデータのペアとして保存されます。</font> </li><li>  <font color="#008000">//従来のCスタイルのゼロエンドとしてではありません</font> </li><li>  <font color="#008000">//パーサーが正しく動作するようにコピーします</font> </li><li>  <font color="#0000ff">const</font> <font color="#0000ff">int</font> buflen = 100; </li><li>  <font color="#0000ff">char</font> buf [buflen + 1]; </li><li>  <font color="#0000ff">int</font> len =（r-&gt; args.len &lt;buflen）？  r-&gt; args.len：buflen; </li><li>  buf [len] = <font color="#A31515">'\ 0'</font> ; </li><li>  ngx_memcpy（buf、r-&gt; args.data、r-&gt; args.len）; </li><li></li><li>  <font color="#0000ff">int</font>成功= 0; </li><li>  <font color="#0000ff">int</font> <font color="#0000ff">演算子</font> 、abonent、money、result = -1; </li><li></li><li>  <font color="#008000">//最も単純なパーサーを呼び出します</font> </li><li>  <font color="#0000ff">operator</font> = GetIntParam（buf、 <font color="#A31515">"operator ="</font> ）; </li><li>  abonent = GetIntParam（buf、 <font color="#A31515">"abonent ="</font> ）; </li><li>  money = GetIntParam（buf、 <font color="#A31515">"money ="</font> ）; </li><li></li><li>  <font color="#0000ff">if</font> （ <font color="#0000ff">演算子</font> &gt; 0 &amp;&amp; abonent&gt; 0 &amp;&amp; money&gt; 0） </li><li>  { </li><li>  SetCallParams（ <font color="#0000ff">operator</font> 、abonent、money）; </li><li></li><li>  <font color="#0000ff">int</font> retCode = OCIStmtExecute（ </li><li> コンテキスト、ステートメント、エラー、（ub4）1、（ub4）0、 </li><li>  （OCISnapshot *）NULL、（OCISnapshot *）NULL、 </li><li>  （ub4）OCI_COMMIT_ON_SUCCESS）; </li><li></li><li>  <font color="#0000ff">if</font> （retCode == OCI_SUCCESS） </li><li> 成功= 1; </li><li>  } </li><li></li><li>  r-&gt; headers_out.content_type.len = <font color="#0000ff">sizeof</font> （ <font color="#A31515">"text / html"</font> ）-1; </li><li>  r-&gt; headers_out.content_type.data =（u_char *） <font color="#A31515">"text / html"</font> ; </li><li>  r-&gt; headers_out.content_length_n = 0; </li><li></li><li>  <font color="#0000ff">if</font> （成功== 1） </li><li>  r-&gt; headers_out.status = NGX_HTTP_OK; </li><li>  <font color="#0000ff">他に</font> </li><li>  r-&gt; headers_out.status = NGX_HTTP_INTERNAL_SERVER_ERROR; </li><li></li><li>  <font color="#008000">// ...応答の本文を形成し、nginxに渡します.. emillerの例を参照してください</font> </li><li>  } </li><li></li><li>  <font color="#0000ff">static</font> <font color="#0000ff">char</font> * ngx_http_payment_init（ngx_conf_t * cf、 </li><li>  ngx_command_t * cmd、 </li><li>  <font color="#0000ff">void</font> * our_conf） </li><li>  { </li><li>  <font color="#008000">// nginxハンドラーを設定します</font> </li><li>  ngx_http_core_loc_conf_t * core_conf = </li><li>  ngx_http_conf_get_module_loc_conf（cf、ngx_http_core_module）; </li><li>  core_conf-&gt; handler = ngx_http_payment_handler; </li><li></li><li>  <font color="#008000">//オラクル</font> </li><li>  bnd1 =（OCIBind *）0; </li><li>  bnd2 =（OCIBind *）0; </li><li>  bnd3 =（OCIBind *）0; </li><li>  bnd4 =（OCIBind *）0; </li><li></li><li>  OCIEnvCreate（（OCIEnv **）＆env、（ub4）OCI_DEFAULT、 </li><li>  （dvoid *）0、（dvoid *（*）（dvoid *、size_t））0、 </li><li>  （dvoid *（*）（dvoid *、dvoid *、size_t））0、 </li><li>  （ <font color="#0000ff">void</font> （*）（dvoid *、dvoid *））0、（size_t）0、（dvoid **）0）; </li><li>  <font color="#008000">/ *サーバーハンドルを割り当てます* /</font> </li><li>  OCIHandleAlloc（（dvoid *）env、（dvoid **）＆server、 </li><li>  OCI_HTYPE_SERVER、0、（dvoid **）0）; </li><li>  <font color="#008000">/ *エラーハンドルを割り当てます* /</font> </li><li>  OCIHandleAlloc（（dvoid *）env、（dvoid **）＆エラー、 </li><li>  OCI_HTYPE_ERROR、0、（dvoid **）0）; </li><li>  <font color="#008000">/ *サーバーコンテキストを作成* /</font> </li><li>  <font color="#0000ff">int</font> retCode = OCIServerAttach（サーバー、エラー、db_conn_str、 </li><li>  strlen（（ <font color="#0000ff">const</font> <font color="#0000ff">char</font> *）db_conn_str）、OCI_DEFAULT）; </li><li></li><li>  <font color="#008000">/ *サービスハンドルを割り当てます* /</font> </li><li>  retCode = OCIHandleAlloc（（dvoid *）env、（dvoid **）＆context、 </li><li>  OCI_HTYPE_SVCCTX、0、（dvoid **）0）; </li><li>  <font color="#008000">/ *サービスコンテキストハンドルのサーバー属性を設定* /</font> </li><li>  retCode = OCIAttrSet（（dvoid *）コンテキスト、OCI_HTYPE_SVCCTX、 </li><li>  （dvoid *）サーバー、（ub4）0、OCI_ATTR_SERVER、エラー）; </li><li>  <font color="#008000">/ *ユーザーセッションハンドルを割り当てます* /</font> </li><li>  retCode = OCIHandleAlloc（（dvoid *）env、（dvoid **）＆session、 </li><li>  OCI_HTYPE_SESSION、0、（dvoid **）0）; </li><li>  <font color="#008000">//セッションのユーザーとパスワードを設定します</font> </li><li>  retCode = OCIAttrSet（（dvoid *）セッション、OCI_HTYPE_SESSION、 </li><li>  （ <font color="#0000ff">void</font> *）db_user_name、（ub4）strlen（（ <font color="#0000ff">const</font> <font color="#0000ff">char</font> *）db_user_name）、 </li><li>  OCI_ATTR_USERNAME、エラー）; </li><li>  retCode = OCIAttrSet（（dvoid *）セッション、OCI_HTYPE_SESSION、 </li><li>  （ <font color="#0000ff">void</font> *）db_password、（ub4）strlen（（ <font color="#0000ff">const</font> <font color="#0000ff">char</font> *）db_password）、 </li><li>  OCI_ATTR_PASSWORD、エラー）; </li><li>  <font color="#008000">//セッションを開始</font> </li><li>  retCode = OCISessionBegin（コンテキスト、エラー、セッション、 </li><li>  OCI_CRED_RDBMS、OCI_DEFAULT）; </li><li></li><li>  <font color="#008000">/ *サービスコンテキストハンドルでユーザーセッション属性を設定* /</font> </li><li>  retCode = OCIAttrSet（（dvoid *）コンテキスト、OCI_HTYPE_SVCCTX、 </li><li>  （dvoid *）セッション、（ub4）0、 </li><li>  OCI_ATTR_SESSION、エラー）; </li><li>  OCIHandleAlloc（（dvoid *）env、（dvoid **）＆ステートメント、 </li><li>  OCI_HTYPE_STMT、（size_t）0、（dvoid **）0）; </li><li>  OCIStmtPrepare（ステートメント、エラー、コマンド、（ub4）strlen（（ <font color="#0000ff">char</font> *）コマンド）、 </li><li>  （ub4）OCI_NTV_SYNTAX、（ub4）OCI_DEFAULT）; </li><li>  <font color="#0000ff">return</font> NGX_CONF_OK; </li><li>  } </li></ol>  <font color="gray">*このソースコードは、 <font color="gray">ソースコードハイライターで</font>強調表示されました。</font> </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J69968/index.html">AaaaaAAaaaAAAaaAAAAaaAAAAA !!! -重力に対する無謀な無視！</a></li>
<li><a href="../J69970/index.html">posterousにポスターテーマが登場</a></li>
<li><a href="../J69971/index.html">ヤロスラフ・グレシロフのルール</a></li>
<li><a href="../J69972/index.html">シンプルハウスゲーム</a></li>
<li><a href="../J69973/index.html">無料のドメイン名登録</a></li>
<li><a href="../J69976/index.html">Googleドキュメントに数式エディタが表示されます</a></li>
<li><a href="../J69977/index.html">Google翻訳</a></li>
<li><a href="../J6998/index.html">オンラインストア</a></li>
<li><a href="../J69983/index.html">MySQLカレンダーデータタイプ：使用機能</a></li>
<li><a href="../J69985/index.html">特定のスタイルに基づいて音楽を生成する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ¾â€ğŸ¤â€ğŸ§‘ğŸ¼ ğŸ”‹ ğŸ¥’ æœ¬ç•ªç’°å¢ƒã®Websocket ğŸ¤½ â›“ï¸ ğŸš¬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="10ãƒ¶æœˆå‰ã€ç§ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ãŠã‚‚ã¡ã‚ƒã‚’ä½œã‚Šå§‹ã‚ã¾ã—ãŸã€‚ cocos jsã¯ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¨ã—ã¦ã€websocketã¯ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã¨ã—ã¦é¸æŠã•ã‚Œã¾ã—ãŸã€‚ ç§ã¯ã“ã®ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ãŒæœ¬å½“ã«å¥½ãã§ã€ãã®ä¸Šã§ã‚µãƒ¼ãƒãƒ¼ã¨ã®ã‚²ãƒ¼ãƒ ã®é€šä¿¡ã‚’ã™ã¹ã¦æ•´ç†ã—ã¾ã—ãŸã€‚ ã“ã®ãŸã‚ã«ã“ã®è¨˜äº‹ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚ ã—ã‹ã—ã€æ®‹å¿µãªãŒã‚‰...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>æœ¬ç•ªç’°å¢ƒã®Websocket</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/301822/">  10ãƒ¶æœˆå‰ã€ç§ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ãŠã‚‚ã¡ã‚ƒã‚’ä½œã‚Šå§‹ã‚ã¾ã—ãŸã€‚  cocos jsã¯ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¨ã—ã¦ã€websocketã¯ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã¨ã—ã¦é¸æŠã•ã‚Œã¾ã—ãŸã€‚ ç§ã¯ã“ã®ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ãŒæœ¬å½“ã«å¥½ãã§ã€ãã®ä¸Šã§ã‚µãƒ¼ãƒãƒ¼ã¨ã®ã‚²ãƒ¼ãƒ ã®é€šä¿¡ã‚’ã™ã¹ã¦æ•´ç†ã—ã¾ã—ãŸã€‚  <a href="https://habrahabr.ru/post/209864/">ã“ã®</a>ãŸã‚ã«<a href="https://habrahabr.ru/post/209864/">ã“ã®è¨˜äº‹</a>ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚ ã—ã‹ã—ã€æ®‹å¿µãªãŒã‚‰ã€ãã®è¨˜äº‹ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã¯å®Ÿç¨¼åƒã§ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚ åˆ¤æ˜ã—ãŸã‚ˆã†ã«ã€å•é¡Œã®ãƒ¬ãƒ™ãƒ«ã¯é‡å¤§ã§ã¯ãªãã€ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚ ã™ã¹ã¦ãŒéå¸¸ã«æ‚ªã„ã®ã§ã€ã‚µãƒ¼ãƒãƒ¼ã¨ã®ã™ã¹ã¦ã®é€šä¿¡ã‚’Webã‚½ã‚±ãƒƒãƒˆã‹ã‚‰ãƒ­ãƒ³ã‚°ãƒ—ãƒ¼ãƒ«ã¾ã§æ›¸ãç›´ã™å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ æœ€å¾Œã«ã€ã€Œã‚µãƒ•ã‚¡ãƒªã§ã¯ãªããƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯websocketã‚’ä½¿ç”¨ã—ã€ãã‚Œä»¥å¤–ã®å ´åˆã¯ãƒ­ãƒ³ã‚°ãƒãƒ¼ãƒªãƒ³ã‚°ã€ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ®‹ã—ã€ã“ã®ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦ã‚‚ã†å°‘ã—åˆ†å²ã—ã¾ã™ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ãã®ãŸã‚ã€å®Ÿç¨¼åƒç’°å¢ƒã§Webã‚½ã‚±ãƒƒãƒˆã‚’ä½¿ç”¨ã—ãŸçµŒé¨“ã¯ã¾ã¨ã‚‚ãªã‚‚ã®ã«ãªã‚Šã¾ã—ãŸã€‚ ãã—ã¦æœ€è¿‘ã€ãƒãƒ–ãƒ¬ã«é–¢ã™ã‚‹æœ€åˆã®è¨˜äº‹ã‚’æ›¸ãã‚ˆã†ã«ä¿ƒã—ãŸã‚¤ãƒ™ãƒ³ãƒˆãŒèµ·ã“ã‚Šã¾ã—ãŸã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ãŠã‚‚ã¡ã‚ƒãŒã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å…¬é–‹ã•ã‚ŒãŸå¾Œã€è¦‹ã¤ã‹ã£ãŸã™ã¹ã¦ã®ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«/ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãƒã‚°ã‚’ä¿®æ­£ã—ã€ã™ã¹ã¦ã‚’é™ã‹ãªãƒ¢ãƒ¼ãƒ‰ã§æ•´ç†ã—å§‹ã‚ã¾ã—ãŸã€‚  <a href="https://habrahabr.ru/post/209864/">ã“ã®ä¾‹</a>ã¯ã€ä¸€èˆ¬çš„ã«ã€ã‚³ãƒ¼ãƒ‰ã«æŒ¿å…¥ã—ã¦ä½¿ç”¨ã§ãã‚‹ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å«ã‚€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®å”¯ä¸€ã®ã‚¬ã‚¤ãƒ‰ã§ã‚ã‚‹ã¨ã„ã†äº‹å®Ÿã«æ³¨ç›®ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚ ã•ã¦ã€æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã§ã€Œphp websocket serverã€ã¨å…¥åŠ›ã—ã¾ã™-è‡ªåˆ†ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã‚‚ã®ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     çªç„¶ã€ç§ã¯ä¸Šè¨˜ã®<a href="https://habrahabr.ru/post/209864/">è¨˜äº‹ã‚’</a>èª­ã¿ç›´ã—ã€æœ€åˆã«ã€Œphpdaemonã€ã¨ã€Œratchetã€ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚ ãã‚Œã§ã¯ã€å†·é™ã«ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚  PhpDeamonã§ã¯ã€WebSocketæ¥ç¶šå‡¦ç†ã®è…¸å†…ã§ã€WebSocketãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¸ã®å°ã•ãªã—ã‹ã—éå¸¸ã«é‡è¦ãªåˆ†å²ãŒã‚ã‚Šã¾ã™ã€‚ ã¾ãŸã€1ã¤ã®ã‚±ãƒ¼ã‚¹ã§ã€ŒSafari5ã¨å¤šãã®éãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ ç§ãŒãŠã‹ã—ããªã‚Šãã†ã ã¨è¨€ã†ã“ã¨ã¯ã€ä½•ã‚‚è¨€ã‚ãªã„ã“ã¨ã§ã™ã€‚ ç§ã®ç›®ã®å‰ã§æ•°ç™¾æ™‚é–“ã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãŒç™ºç”Ÿã—ã€å¤šãã®æ‰‹é–“ã¨è‹¦ã—ã¿ãŒã‚ã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã«ç–‘å•ã‚’æŠ•ã’ã‹ã‘ã¾ã—ãŸã€‚ ä¿¡ã˜ã‚‰ã‚Œãªã‹ã£ãŸã®ã§ã€ç¢ºèªã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ã€œ15æ™‚é–“ä»¥å†…ã«ã€PhpDeamonã‹ã‚‰WebSocketã«é–¢é€£ã™ã‚‹æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’å¼•ãå‡ºã—ã¾ã—ãŸï¼ˆæœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã™ã¹ã¦ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§å‹•ä½œã—ã€ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰è‡ªä½“ã¯é«˜è² è·ã§ã‚‚å‹•ä½œã—ã¾ã™ï¼‰ã€‚èª¬æ˜ä»˜ãã§å…¬é–‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚ ä»–ã®äººãŒç§ãŒçµŒé¨“ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„è‹¦ç—›ã‚’çµŒé¨“ã—ãªã„ã‚ˆã†ã«ã€‚ ã¯ã„ã€ã‚³ãƒ¼ãƒ‰ã¯å°ã•ãã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚WebSocketã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã¯éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§ã‚ã‚Šã€ã‚µãƒ¼ãƒãƒ¼å´ã§ã¯ã™ã¹ã¦ãŒéå¸¸ã«å¤§ãããªã‚Šã¾ã™ï¼ˆSafarié–‹ç™ºè€…ã«åˆ¥ã®ã€Œã‚ã‚ŠãŒã¨ã†ã€ã¨ã—ã¾ã—ã‚‡ã†ï¼‰ã€‚ ã¾ãŸã€WebSocketã®ã‚¹ã‚³ãƒ¼ãƒ—ã¯ä¸»ã«ã‚²ãƒ¼ãƒ ã§ã‚ã‚‹ã¨ã„ã†äº‹å®Ÿã«ã‚ˆã‚Šã€ã‚µãƒ¼ãƒãƒ¼ã‚½ã‚±ãƒƒãƒˆã®ãƒãƒ³ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ä½¿ç”¨ã®å•é¡ŒãŒé‡è¦ã§ã™-ã“ã‚Œã¯ãƒœãƒ¼ãƒŠã‚¹ã®è¤‡é›‘ã•ã§ã‚ã‚Šã€éå¸¸ã«é‡è¦ã§ã™ãŒã€ <a href="https://habrahabr.ru/post/209864/">ã“ã“</a>ã§ã¯æ±ºã—ã¦è€ƒæ…®ã—ã¾ã›ã‚“ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ã‚ˆã‚Šç†è§£ã—ã‚„ã™ã„ã‚ˆã†ã«ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãªã„ãƒ†ã‚¹ãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ãŸã‹ã£ãŸã®ã§ã™ã€‚ ã—ã‹ã—ã€æ®‹å¿µãªãŒã‚‰ã€ã“ã®ä¾‹ã®ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã¯å¤šãã®ç¹°ã‚Šè¿”ã—ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ã€1ã¤ã®ã‚¯ãƒ©ã‚¹ã¨3ã¤ã®ç¶™æ‰¿è€…ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ æ®‹ã‚Šã¯ã™ã¹ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã—ã§ã™ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">ã¾ãšã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆéƒ¨åˆ†</b> <div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/1999/xhtml"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>WebSocket test page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"create();"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="actionscript"><span class="hljs-function"><span class="hljs-title">create</span></span></span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">// Example ws = new WebSocket('ws://'+document.domain+':8081/'); ws.onopen = function () {document.getElementById('log').innerHTML += 'WebSocket opened &lt;br/&gt;';} ws.onmessage = function (e) {document.getElementById('log').innerHTML += 'WebSocket message: '+e.data+' &lt;br/&gt;';} ws.onclose = function () {document.getElementById('log').innerHTML += 'WebSocket closed &lt;br/&gt;';} } </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"create();"</span></span></span><span class="hljs-tag">&gt;</span></span>Create WebSocket<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ws.send('ping');"</span></span></span><span class="hljs-tag">&gt;</span></span>Send ping<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ws.close();"</span></span></span><span class="hljs-tag">&gt;</span></span>Close WebSocket<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"log"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:300px; height: 300px; border: 1px solid #999999; overflow:auto;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ç§ã®ã‚²ãƒ¼ãƒ ã§ã¯ã€3ã¤ã®ã‚µãƒ¼ãƒãƒ¼ã‚½ã‚±ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚  WebSocketã€ãƒ¯ãƒ¼ã‚«ãƒ¼ç”¨ã€ãŠã‚ˆã³ãƒ­ãƒ³ã‚°ãƒ—ãƒ¼ãƒ«ç”¨ã€‚ ã‚²ãƒ¼ãƒ ã«ã¯ãŸãã•ã‚“ã®æ•°å­¦ãŒã‚ã‚Šã¾ã™ã®ã§ã€ç§ãŸã¡ã¯ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’ã—ã¦ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãŸã‚ã®ã‚¿ã‚¹ã‚¯ã‚’ä¸ãˆãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ ãã‚ŒãŒç›®çš„ã§ã™ã€‚ ãã®stream_selectã¯ã€ãã‚Œã‚‰ã™ã¹ã¦ã«å…±é€šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã†ã§ãªã„ã¨ã€é…å»¶ã‚„ç‹‚ã£ãŸãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ä½¿ç”¨ãŒç™ºç”Ÿã—ã¾ã™ã€‚ ã“ã®çŸ¥è­˜ã¯ã€ä½¿ç”¨æ¸ˆã¿ã®ç¥çµŒã®å±±ã¨å¼•ãæ›ãˆã«å¾—ã‚‰ã‚Œã¾ã—ãŸã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã‚µã‚¤ã‚¯ãƒ«</b> <div class="spoiler_text"><pre> <code class="php hljs">$master = stream_socket_server(<span class="hljs-string"><span class="hljs-string">"tcp://127.0.0.1:8081"</span></span>, $errno, $errstr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$master) <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">"$errstr ($errno)\n"</span></span>); $sockets = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($master); stream_set_blocking($master, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      ,         ,     "stream_socket_accept". ,         - ,      -  . while (true) { $read = $sockets; $write = $except = array(); if (($num_changed_streams = stream_select($read, $write, $except, 0, 1000000)) === false) { var_dump('stream_select error'); break; //    ,   "die",                "/etc/init.d/game restart"  100%   case,     "pcntl"       . } foreach ($read as $socket) { $index_socket = array_search($socket, $sockets); if ($index_socket == 0) { //   continue; } //      } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     æ–°ã—ã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã®æ¥ç¶šã¯éå¸¸ã«æ¨™æº–çš„ãªã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€ã‚½ã‚±ãƒƒãƒˆãŒéãƒ–ãƒ­ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§ã‚ã‚‹ã¨ã„ã†äº‹å®Ÿã«ã‚ˆã‚Šã€ã™ã¹ã¦ã®ç€ä¿¡ãƒ‡ãƒ¼ã‚¿ã‚’æ–­ç‰‡çš„ã«åé›†ã—ã€ååˆ†ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã«ãã‚Œã‚’å‡¦ç†ã—ã€å¿…è¦ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ç†è§£ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã®æŸã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã“ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ä½¿ç”¨ã—ã¦åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚ ã“ã®1ã¤ã®ã‚¿ã‚¹ã‚¯ã¯ã™ã§ã«å¤§é‡ã®ã‚³ãƒ¼ãƒ‰ã§ã‚ã‚Šã€PhpDeamonã§ã¯WebSocketã¨ã¯é–¢ä¿‚ã®ãªã„ã‚³ãƒ¼ãƒ‰ã‚’å¤§é‡ã«ç©ã¿ã¾ã—ãŸï¼ˆ8ã¤ã®ç•°ãªã‚‹ã‚µãƒ¼ãƒãƒ¼ã‚’ãã“ã«ä¸Šã’ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼‰ã€‚ ã“ã®ãƒˆãƒ”ãƒƒã‚¯ã§ã¯ã€å¤šãã®éƒ¨åˆ†ã‚’åˆ‡ã‚Šé›¢ã—ã¦å˜ç´”åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ å½¼ã¯WebSocketã«é–¢é€£ã™ã‚‹ã‚‚ã®ã ã‘ã‚’æ®‹ã—ã¾ã—ãŸã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">åˆ‡ã‚Šæ¨ã¦ã‚‰ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«&lt;ws.php&gt;</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ws</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MAX_BUFFER_SIZE = <span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $socket; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> array _SERVER */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $server = []; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $headers = []; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $closed = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $unparsed_data = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $current_header; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $unread_lines = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $extensions = []; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $extensionsCleanRegex = <span class="hljs-string"><span class="hljs-string">'/(?:^|\W)x-webkit-/iS'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> integer Current state */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $state = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// stream state of the connection (application protocol level) /** * Alias of STATE_STANDBY */ const STATE_ROOT = 0; /** * Standby state (default state) */ const STATE_STANDBY = 0; /** * State: first line */ const STATE_FIRSTLINE = 1; /** * State: headers */ const STATE_HEADERS = 2; /** * State: content */ const STATE_CONTENT = 3; /** * State: prehandshake */ const STATE_PREHANDSHAKE = 5; /** * State: handshaked */ const STATE_HANDSHAKED = 6; public function get_state() { return $this-&gt;state; } public function closed() { return $this-&gt;closed; } protected function close() { if ($this-&gt;closed) return; var_dump('self close'); fclose($this-&gt;socket); $this-&gt;closed = true; } public function __construct($socket) { stream_set_blocking($socket, false); $this-&gt;socket = $socket; } private function read_line() { $lines = explode(PHP_EOL, $this-&gt;unparsed_data); $last_line = $lines[count($lines)-1]; unset($lines[count($lines) - 1]); foreach ($lines as $line) { $this-&gt;unread_lines[] = $line; } $this-&gt;unparsed_data = $last_line; if (count($this-&gt;unread_lines) != 0) { return array_shift($this-&gt;unread_lines); } else { return null; } } public function on_receive_data() { if ($this-&gt;closed) return; $data = stream_socket_recvfrom($this-&gt;socket, MAX_BUFFER_SIZE); if (is_string($data)) { $this-&gt;unparsed_data .= $data; } } /** * Called when new data received. * @return void */ public function on_read() { if ($this-&gt;closed) return; if ($this-&gt;state === self::STATE_STANDBY) { $this-&gt;state = self::STATE_FIRSTLINE; } if ($this-&gt;state === self::STATE_FIRSTLINE) { if (!$this-&gt;http_read_first_line()) { return; } $this-&gt;state = self::STATE_HEADERS; } if ($this-&gt;state === self::STATE_HEADERS) { if (!$this-&gt;http_read_headers()) { return; } if (!$this-&gt;http_process_headers()) { $this-&gt;close(); return; } $this-&gt;state = self::STATE_CONTENT; } if ($this-&gt;state === self::STATE_CONTENT) { $this-&gt;state = self::STATE_PREHANDSHAKE; } } /** * Read first line of HTTP request * @return boolean|null Success */ protected function http_read_first_line() { if (($l = $this-&gt;read_line()) === null) { return null; } $e = explode(' ', $l); $u = isset($e[1]) ? parse_url($e[1]) : false; if ($u === false) { $this-&gt;bad_request(); return false; } if (!isset($u['path'])) { $u['path'] = null; } if (isset($u['host'])) { $this-&gt;server['HTTP_HOST'] = $u['host']; } $srv = &amp; $this-&gt;server; $srv['REQUEST_METHOD'] = $e[0]; $srv['REQUEST_TIME'] = time(); $srv['REQUEST_TIME_FLOAT'] = microtime(true); $srv['REQUEST_URI'] = $u['path'] . (isset($u['query']) ? '?' . $u['query'] : ''); $srv['DOCUMENT_URI'] = $u['path']; $srv['PHP_SELF'] = $u['path']; $srv['QUERY_STRING'] = isset($u['query']) ? $u['query'] : null; $srv['SCRIPT_NAME'] = $srv['DOCUMENT_URI'] = isset($u['path']) ? $u['path'] : '/'; $srv['SERVER_PROTOCOL'] = isset($e[2]) ? $e[2] : 'HTTP/1.1'; $srv['REMOTE_ADDR'] = null; $srv['REMOTE_PORT'] = null; return true; } /** * Read headers line-by-line * @return boolean|null Success */ protected function http_read_headers() { while (($l = $this-&gt;read_line()) !== null) { if ($l === '') { return true; } $e = explode(': ', $l); if (isset($e[1])) { $this-&gt;current_header = 'HTTP_' . strtoupper(strtr($e[0], ['-' =&gt; '_'])); $this-&gt;server[$this-&gt;current_header] = $e[1]; } elseif (($e[0][0] === "\t" || $e[0][0] === "\x20") &amp;&amp; $this-&gt;current_header) { // multiline header continued $this-&gt;server[$this-&gt;current_header] .= $e[0]; } else { // whatever client speaks is not HTTP anymore $this-&gt;bad_request(); return false; } } } /** * Process headers * @return bool */ protected function http_process_headers() { $this-&gt;state = self::STATE_PREHANDSHAKE; if (isset($this-&gt;server['HTTP_SEC_WEBSOCKET_EXTENSIONS'])) { $str = strtolower($this-&gt;server['HTTP_SEC_WEBSOCKET_EXTENSIONS']); $str = preg_replace($this-&gt;extensionsCleanRegex, '', $str); $this-&gt;extensions = explode(', ', $str); } if (!isset($this-&gt;server['HTTP_CONNECTION']) || (!preg_match('~(?:^|\W)Upgrade(?:\W|$)~i', $this-&gt;server['HTTP_CONNECTION'])) // "Upgrade" is not always alone (ie. "Connection: Keep-alive, Upgrade") || !isset($this-&gt;server['HTTP_UPGRADE']) || (strtolower($this-&gt;server['HTTP_UPGRADE']) !== 'websocket') // Lowercase comparison iss important ) { $this-&gt;close(); return false; } if (isset($this-&gt;server['HTTP_COOKIE'])) { self::parse_str(strtr($this-&gt;server['HTTP_COOKIE'], self::$hvaltr), $this-&gt;cookie); } if (isset($this-&gt;server['QUERY_STRING'])) { self::parse_str($this-&gt;server['QUERY_STRING'], $this-&gt;get); } // ---------------------------------------------------------- // Protocol discovery, based on HTTP headers... // ---------------------------------------------------------- if (isset($this-&gt;server['HTTP_SEC_WEBSOCKET_VERSION'])) { // HYBI if ($this-&gt;server['HTTP_SEC_WEBSOCKET_VERSION'] === '8') { // Version 8 (FF7, Chrome14) $this-&gt;switch_to_protocol('v13'); } elseif ($this-&gt;server['HTTP_SEC_WEBSOCKET_VERSION'] === '13') { // newest protocol $this-&gt;switch_to_protocol('v13'); } else { error_log(get_class($this) . '::' . __METHOD__ . " : Websocket protocol version " . $this-&gt;server['HTTP_SEC_WEBSOCKET_VERSION'] . ' is not yet supported for client "addr"'); // $this-&gt;addr $this-&gt;close(); return false; } } elseif (!isset($this-&gt;server['HTTP_SEC_WEBSOCKET_KEY1']) || !isset($this-&gt;server['HTTP_SEC_WEBSOCKET_KEY2'])) { $this-&gt;switch_to_protocol('ve'); } else { // Defaulting to HIXIE (Safari5 and many non-browser clients...) $this-&gt;switch_to_protocol('v0'); } // ---------------------------------------------------------- // End of protocol discovery // ---------------------------------------------------------- return true; } private function switch_to_protocol($protocol) { $class = 'ws_'.$protocol; $this-&gt;new_instance = new $class($this-&gt;socket); $this-&gt;new_instance-&gt;state = $this-&gt;state; $this-&gt;new_instance-&gt;unparsed_data = $this-&gt;unparsed_data; $this-&gt;new_instance-&gt;server = $this-&gt;server; } /** * Send Bad request * @return void */ public function bad_request() { $this-&gt;write("400 Bad Request\r\n\r\n&lt;html&gt;&lt;head&gt;&lt;title&gt;400 Bad Request&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=\"white\"&gt;&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;"); $this-&gt;close(); } /** * Replacement for default parse_str(), it supoorts UCS-2 like this: %uXXXX * @param string $s String to parse * @param array &amp;$var Reference to the resulting array * @param boolean $header Header-style string * @return void */ public static function parse_str($s, &amp;$var, $header = false) { static $cb; if ($cb === null) { $cb = function ($m) { return urlencode(html_entity_decode('&amp;#' . hexdec($m[1]) . ';', ENT_NOQUOTES, 'utf-8')); }; } if ($header) { $s = strtr($s, self::$hvaltr); } if ( (stripos($s, '%u') !== false) &amp;&amp; preg_match('~(%u[af\d]{4}|%[cf][af\d](?!%[89a-f][af\d]))~is', $s, $m) ) { $s = preg_replace_callback('~%(u[af\d]{4}|[af\d]{2})~i', $cb, $s); } parse_str($s, $var); } /** * Send data to the connection. Note that it just writes to buffer that flushes at every baseloop * @param string $data Data to send * @return boolean Success */ public function write($data) { if ($this-&gt;closed) return false; return stream_socket_sendto($this-&gt;socket, $data) == 0; } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ã“ã®ã‚ˆã†ãªåˆ‡ã‚Šæ¨ã¦ã‚‰ã‚ŒãŸå½¢å¼ã§ã®ã“ã®ã‚¯ãƒ©ã‚¹ã®æ„å‘³ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ¥ç¶šã™ã‚‹ãŸã‚ã«ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã§éãƒ–ãƒ­ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã™ã€‚ æ¬¡ã«ã€ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã§ã€ãƒ‡ãƒ¼ã‚¿ãŒåˆ°ç€ã™ã‚‹ãŸã³ã«ã€ã™ãã«èª­ã¿å–ã‚Šã€ã€Œ <b>unparsed_data</b> ã€å¤‰æ•°ã«è¿½åŠ ï¼ˆè¿½åŠ ï¼‰ã—ã¾ã™ï¼ˆã“ã‚Œã¯<b>on_receive_data</b>ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ï¼‰ã€‚  MAX_BUFFER_SIZEã®æ¬¡å…ƒã‚’è¶…ãˆã¦ã‚‚ã€æ‚ªã„ã“ã¨ã¯ã¾ã£ãŸãèµ·ã“ã‚‰ãªã„ã“ã¨ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ æœ€å¾Œã®ä¾‹ã§ã¯ã€ã“ã“ã§ä½•ãŒèµ·ã“ã‚‹ã‹ã€ãã®å€¤ã‚’ã€Œ5ã€ã¨è¨€ã£ã¦ã€ã™ã¹ã¦ãŒå¼•ãç¶šãæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚ å˜ç´”ã«ã€æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒãƒƒãƒ•ã‚¡ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã¯ç„¡è¦–ã•ã‚Œã¾ã™-çµå±€ã€ãã‚Œã‚‰ã¯ä¸å®Œå…¨ã§ã‚ã‚Šã€2ç•ªç›®ã€5ç•ªç›®ã€ã¾ãŸã¯100ç•ªç›®ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‹ã‚‰ã€æœ€å¾Œã«ã€ã™ã¹ã¦ã®å—ä¿¡ãƒ‡ãƒ¼ã‚¿ãŒå…¥åŠ›ã•ã‚Œã€å‡¦ç†ã•ã‚Œã¾ã™ã€‚ åŒæ™‚ã«ã€stream_selectã¯ã€ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã•ã‚Œã‚‹ã¾ã§ã€ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã§ãƒã‚¤ã‚¯ãƒ­ç§’ã‚‚å¾…æ©Ÿã—ã¾ã›ã‚“ã€‚ äºˆæƒ³ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®95ï¼…ãŒå®Œå…¨ã«èª­ã¿å–ã‚‰ã‚Œã‚‹ã‚ˆã†ãªå®šæ•°ã‚’é¸æŠã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ã•ã‚‰ã«ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ï¼ˆãƒ‡ãƒ¼ã‚¿ã®æ¬¡ã®éƒ¨åˆ†ã‚’å—ã‘å–ã£ãŸå¾Œï¼‰ã§ã€è“„ç©ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ã‚’è©¦ã¿ã¾ã™ï¼ˆã“ã‚Œã¯<b>on_read</b>ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ï¼‰ã€‚  wsã‚¯ãƒ©ã‚¹ã§ã¯ã€on_readãƒ¡ã‚½ãƒƒãƒ‰ã¯åŸºæœ¬çš„ã«ã€Œæœ€åˆã®è¡Œã‚’èª­ã¿å–ã‚Šã€ç’°å¢ƒå¤‰æ•°ã‚’æº–å‚™ã™ã‚‹ã€ã€ã€Œã™ã¹ã¦ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’èª­ã¿å–ã‚‹ã€ã€ã€Œã™ã¹ã¦ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‡¦ç†ã™ã‚‹ã€ã¨ã„ã†3ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚ æœ€åˆã®2ã¤ã¯èª¬æ˜ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€éãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã‚ã‚Šã€ãƒ‡ãƒ¼ã‚¿ãŒã©ã“ã§ã‚‚å¼•ãè£‚ã‹ã‚Œã¦ã„ã‚‹ã¨ã„ã†äº‹å®Ÿã«å‚™ãˆãªã‘ã‚Œã°ãªã‚‰ãªã„ãŸã‚ã€ã‹ãªã‚Šå¤§é‡ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚ ãƒ˜ãƒƒãƒ€ãƒ¼ã®å‡¦ç†ã§ã¯ã€æœ€åˆã«è¦æ±‚ã®å½¢å¼ãŒæ­£ã—ã„ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€æ¬¡ã«ãƒ˜ãƒƒãƒ€ãƒ¼ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨é€šä¿¡ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æ±ºå®šã—ã¾ã™ã€‚ ãã®çµæœã€ <b>switch_to_protocol</b>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ—ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Š<b>ã¾ã™</b> ã€‚ å†…éƒ¨ã®ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ã‚¯ãƒ©ã‚¹ã€Œws_ &lt;protocol&gt;ã€ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å½¢æˆã—ã€ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã«æˆ»ã‚‹æº–å‚™ã‚’ã—ã¾ã™ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã§ã¯ã€å®Ÿéš›ã«ã•ã‚‰ã«ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã©ã†ã‹ï¼ˆèª°ã‹ãŒã“ã®å ´æ‰€ã®å®Ÿè£…ã‚’ã‚ˆã‚Šé©åˆ‡ã«æä¾›ã§ãã‚‹å ´åˆ-å¸¸ã«æ­“è¿ã—ã¾ã™ï¼‰ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     æ¬¡ã«ã€ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã§ã€ã‚½ã‚±ãƒƒãƒˆãŒé–‰ã˜ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ é–‰ã˜ã¦ã„ã‚‹å ´åˆã¯ã€ãƒ¡ãƒ¢ãƒªã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ï¼ˆè©³ç´°ã¯æ¬¡ã®ãƒ–ãƒ­ãƒƒã‚¯ã§ï¼‰ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">&lt;deamon.php&gt;ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ws.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ws_v0.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ws_v13.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ws_ve.php'</span></span>); $master = stream_socket_server(<span class="hljs-string"><span class="hljs-string">"tcp://127.0.0.1:8081"</span></span>, $errno, $errstr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$master) <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">"$errstr ($errno)\n"</span></span>); $sockets = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($master); <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> ws[] $connections */</span></span> $connections = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); stream_set_blocking($master, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> ws $connection * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $data * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $type */</span></span> $my_callback = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($connection, $data, $type)</span></span></span><span class="hljs-function"> </span></span>{ var_dump(<span class="hljs-string"><span class="hljs-string">'my ws data: ['</span></span>.$data.<span class="hljs-string"><span class="hljs-string">'/'</span></span>.$type.<span class="hljs-string"><span class="hljs-string">']'</span></span>); $connection-&gt;send_frame(<span class="hljs-string"><span class="hljs-string">'test '</span></span>.time()); }; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { $read = $sockets; $write = $except = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($num_changed_streams = stream_select($read, $write, $except, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000000</span></span>)) === <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) { var_dump(<span class="hljs-string"><span class="hljs-string">'stream_select error'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($read <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $socket) { $index_socket = array_search($socket, $sockets); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($index_socket == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   if ($socket_new = stream_socket_accept($master, -1)) { $connection = new ws($socket_new, $my_callback); $sockets[] = $socket_new; $index_new_socket = array_search($socket_new, $sockets); $connections[$index_new_socket] = &amp;$connection; $index_socket = $index_new_socket; } else { //            error_log('stream_socket_accept'); var_dump('error stream_socket_accept'); continue; } } $connection = &amp;$connections[$index_socket]; $connection-&gt;on_receive_data(); $connection-&gt;on_read(); if ($connection-&gt;get_state() == ws::STATE_PREHANDSHAKE) { $connection = $connection-&gt;get_new_instance(); $connections[$index_socket] = &amp;$connection; $connection-&gt;on_read(); } if ($connection-&gt;closed()) { unset($sockets[$index_socket]); unset($connections[$index_socket]); unset($connection); var_dump('close '.$index_socket); } } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ã€Œ$ My_callbackã€ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™-ã“ã‚Œã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ³ãƒ‰ãƒ©ã§ã™ã€‚ ã‚‚ã¡ã‚ã‚“ã€æœ¬ç•ªç’°å¢ƒã§ã¯ã‚ã‚‰ã‚†ã‚‹ç¨®é¡ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã™ã¹ã¦ã‚’ãƒ©ãƒƒãƒ—ã§ãã¾ã™ãŒã€ã“ã“ã§ã¯é–¢æ•°å¤‰æ•°ã ã‘ã‚’ç†è§£ã—ã‚„ã™ãã—ã¾ã™ã€‚ å½¼å¥³ã«ã¤ã„ã¦ã¯å°‘ã—å¾Œã§ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     æ–°ã—ã„æ¥ç¶šã®å‡¦ç†ã‚’å®Ÿè£…ã—ã€ãƒ«ãƒ¼ãƒ—ã®æœ¬ä½“ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã¤ã„ã¦ã¯ã‚‚ã†å°‘ã—ä¸Šã«æ›¸ãã¾ã—ãŸã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="https://habrahabr.ru/post/209864/">ã“ã“ã§</a>ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã«æ³¨æ„ã—ãŸã„ã§ã™ã€‚ ã‚½ã‚±ãƒƒãƒˆã‹ã‚‰èª­ã¿å–ã‚‰ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒç©ºã®æ–‡å­—åˆ—ã§ã‚ã‚‹å ´åˆï¼ˆã‚‚ã¡ã‚ã‚“ã€æ›´æ–°ã§ç©ºã®æ–‡å­—åˆ—ã®ãƒã‚§ãƒƒã‚¯ã‚’è¦‹ãŸå ´åˆï¼‰ã€ã‚½ã‚±ãƒƒãƒˆã‚’é–‰ã˜ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ ã‚ã‚ã€ç§ã¯ã“ã®å‹¢ã„ãŒã©ã‚Œã ã‘ç§ã«è¡€ã‚’é£²ã‚“ã ã®ã‹ã€ãã—ã¦ä½•äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å¤±ã£ãŸã®ã‹ã•ãˆçŸ¥ã‚Šã¾ã›ã‚“ã€‚ çªç„¶ã€Safariã¯ç©ºã®æ–‡å­—åˆ—ã‚’é€ä¿¡ã—ã€ã“ã‚Œã‚’æ¨™æº–ã¨è¦‹ãªã—ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®æ¥ç¶šã‚’å–å¾—ã—ã¦é–‰ã˜ã¾ã™ã€‚  Yandexãƒ–ãƒ©ã‚¦ã‚¶ã¯æ™‚ã€…åŒã˜ã‚ˆã†ã«å‹•ä½œã—ã¾ã™ã€‚ ç†ç”±ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€ã“ã®å ´åˆã€Safariã®å ´åˆã€WebSocketã¯ãƒ•ãƒªãƒ¼ã‚ºã—ãŸã¾ã¾ã§ã™ã€‚ã¤ã¾ã‚Šã€é–‰ã˜ãšã€é–‹ã‹ãšã€ãƒãƒ³ã‚°ã™ã‚‹ã ã‘ã§ã™ã€‚ ç§ã¯ã“ã®é­”æ³•ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ç„¡é–¢å¿ƒã§ã¯ãªã„ã“ã¨ã«æ°—ã¥ãã¾ã—ãŸã‹ï¼Ÿ ç§ã¯IE6ã‚’ã©ã®ã‚ˆã†ã«ä½œã‚Šä¸Šã’ãŸã‹è¦šãˆã¦ã„ã¾ã™-åŒã˜æ„Ÿè¦šã§ã™ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     æ¬¡ã«ã€ <b>array_search</b>ã‚’ä½¿ç”¨ã—ã¦ã€$ socketsé…åˆ—ã¨$ connectionsé…åˆ—ã‚’åŒæœŸã™ã‚‹ç†ç”±ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ äº‹å®Ÿã€stream_selectã¯ã‚¯ãƒªãƒ¼ãƒ³ãª$ã‚½ã‚±ãƒƒãƒˆé…åˆ—ã«ä¸å¯æ¬ ã§ã‚ã‚Šã€ä»–ã«ã¯ä½•ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚ ã—ã‹ã—ã€ã©ã†ã„ã†ã‚ã‘ã‹ã€$ socketsé…åˆ—ã®ç‰¹å®šã®ã‚½ã‚±ãƒƒãƒˆã‚’wsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«é–¢é€£ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ ãŸãã•ã‚“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸ-æœ€çµ‚çš„ã«ã€ã‚­ãƒ¼ã§å¸¸ã«åŒæœŸã•ã‚Œã‚‹2ã¤ã®ã‚¢ãƒ¬ã‚¤ãŒã‚ã‚‹ã‚ˆã†ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§åœæ­¢ã—ã¾ã—ãŸã€‚  1ã¤ã®é…åˆ—ã§ã¯ã€stream_selectã«å¿…è¦ãªã‚¯ãƒªãƒ¼ãƒ³ã‚½ã‚±ãƒƒãƒˆã€2ç•ªç›®ã®é…åˆ—ã§ã¯ã€wsã‚¯ãƒ©ã‚¹ã¾ãŸã¯ãã®å­å­«ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€‚ èª°ã‹ãŒã‚ˆã‚Šè‰¯ã„ã“ã®å ´æ‰€ã‚’æä¾›ã§ãã‚‹å ´åˆ-æä¾›ã—ã¦ã„ã¾ã™ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     æ³¨æ„ã™ã¹ãã‚‚ã†1ã¤ã®ã‚±ãƒ¼ã‚¹ã¯ã€ <b>stream_socket_acceptã«</b>æ¬ é™¥<b>ãŒ</b>ã‚ã‚‹å ´åˆã§ã™ã€‚ ç§ãŒç†è§£ã—ã¦ã„ã‚‹ã‚ˆã†ã«ã€ç†è«–çš„ã«ã¯ã€ãƒã‚¹ã‚¿ãƒ¼ã‚½ã‚±ãƒƒãƒˆãŒéãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã‚ã‚Šã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ¥ç¶šã™ã‚‹ã®ã«ååˆ†ãªãƒ‡ãƒ¼ã‚¿ãŒåˆ°ç€ã—ã¦ã„ãªã„å ´åˆã«ã®ã¿å¯èƒ½ã§ã™ã€‚ ã—ãŸãŒã£ã¦ã€ä½•ã‚‚ã—ã¾ã›ã‚“ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">ãƒ•ã‚¡ã‚¤ãƒ«&lt;ws.php&gt;ã®ãƒ•ãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ws</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $hvaltr = [<span class="hljs-string"><span class="hljs-string">'; '</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>, <span class="hljs-string"><span class="hljs-string">';'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'%20'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> maxAllowedPacket = <span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MAX_BUFFER_SIZE = <span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $socket; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> array _SERVER */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $server = []; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $on_frame_user = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $handshaked = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $headers = []; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $headers_sent = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $closed = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $unparsed_data = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $current_header; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $unread_lines = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> ws|null */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $new_instance = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $extensions = []; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $extensionsCleanRegex = <span class="hljs-string"><span class="hljs-string">'/(?:^|\W)x-webkit-/iS'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> integer Current state */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $state = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// stream state of the connection (application protocol level) /** * Alias of STATE_STANDBY */ const STATE_ROOT = 0; /** * Standby state (default state) */ const STATE_STANDBY = 0; /** * State: first line */ const STATE_FIRSTLINE = 1; /** * State: headers */ const STATE_HEADERS = 2; /** * State: content */ const STATE_CONTENT = 3; /** * State: prehandshake */ const STATE_PREHANDSHAKE = 5; /** * State: handshaked */ const STATE_HANDSHAKED = 6; public function get_state() { return $this-&gt;state; } public function get_new_instance() { return $this-&gt;new_instance; } public function closed() { return $this-&gt;closed; } protected function close() { if ($this-&gt;closed) return; var_dump('self close'); fclose($this-&gt;socket); $this-&gt;closed = true; } public function __construct($socket, $on_frame_user = null) { stream_set_blocking($socket, false); $this-&gt;socket = $socket; $this-&gt;on_frame_user = $on_frame_user; } private function read_line() { $lines = explode(PHP_EOL, $this-&gt;unparsed_data); $last_line = $lines[count($lines)-1]; unset($lines[count($lines) - 1]); foreach ($lines as $line) { $this-&gt;unread_lines[] = $line; } $this-&gt;unparsed_data = $last_line; if (count($this-&gt;unread_lines) != 0) { return array_shift($this-&gt;unread_lines); } else { return null; } } public function on_receive_data() { if ($this-&gt;closed) return; $data = stream_socket_recvfrom($this-&gt;socket, self::MAX_BUFFER_SIZE); if (is_string($data)) { $this-&gt;unparsed_data .= $data; } } /** * Called when new data received. * @return void */ public function on_read() { if ($this-&gt;closed) return; if ($this-&gt;state === self::STATE_STANDBY) { $this-&gt;state = self::STATE_FIRSTLINE; } if ($this-&gt;state === self::STATE_FIRSTLINE) { if (!$this-&gt;http_read_first_line()) { return; } $this-&gt;state = self::STATE_HEADERS; } if ($this-&gt;state === self::STATE_HEADERS) { if (!$this-&gt;http_read_headers()) { return; } if (!$this-&gt;http_process_headers()) { $this-&gt;close(); return; } $this-&gt;state = self::STATE_CONTENT; } if ($this-&gt;state === self::STATE_CONTENT) { $this-&gt;state = self::STATE_PREHANDSHAKE; } } /** * Read first line of HTTP request * @return boolean|null Success */ protected function http_read_first_line() { if (($l = $this-&gt;read_line()) === null) { return null; } $e = explode(' ', $l); $u = isset($e[1]) ? parse_url($e[1]) : false; if ($u === false) { $this-&gt;bad_request(); return false; } if (!isset($u['path'])) { $u['path'] = null; } if (isset($u['host'])) { $this-&gt;server['HTTP_HOST'] = $u['host']; } $address = explode(':', stream_socket_get_name($this-&gt;socket, true)); //   $srv = &amp; $this-&gt;server; $srv['REQUEST_METHOD'] = $e[0]; $srv['REQUEST_TIME'] = time(); $srv['REQUEST_TIME_FLOAT'] = microtime(true); $srv['REQUEST_URI'] = $u['path'] . (isset($u['query']) ? '?' . $u['query'] : ''); $srv['DOCUMENT_URI'] = $u['path']; $srv['PHP_SELF'] = $u['path']; $srv['QUERY_STRING'] = isset($u['query']) ? $u['query'] : null; $srv['SCRIPT_NAME'] = $srv['DOCUMENT_URI'] = isset($u['path']) ? $u['path'] : '/'; $srv['SERVER_PROTOCOL'] = isset($e[2]) ? $e[2] : 'HTTP/1.1'; $srv['REMOTE_ADDR'] = $address[0]; $srv['REMOTE_PORT'] = $address[1]; return true; } /** * Read headers line-by-line * @return boolean|null Success */ protected function http_read_headers() { while (($l = $this-&gt;read_line()) !== null) { if ($l === '') { return true; } $e = explode(': ', $l); if (isset($e[1])) { $this-&gt;current_header = 'HTTP_' . strtoupper(strtr($e[0], ['-' =&gt; '_'])); $this-&gt;server[$this-&gt;current_header] = $e[1]; } elseif (($e[0][0] === "\t" || $e[0][0] === "\x20") &amp;&amp; $this-&gt;current_header) { // multiline header continued $this-&gt;server[$this-&gt;current_header] .= $e[0]; } else { // whatever client speaks is not HTTP anymore $this-&gt;bad_request(); return false; } } } /** * Process headers * @return bool */ protected function http_process_headers() { $this-&gt;state = self::STATE_PREHANDSHAKE; if (isset($this-&gt;server['HTTP_SEC_WEBSOCKET_EXTENSIONS'])) { $str = strtolower($this-&gt;server['HTTP_SEC_WEBSOCKET_EXTENSIONS']); $str = preg_replace($this-&gt;extensionsCleanRegex, '', $str); $this-&gt;extensions = explode(', ', $str); } if (!isset($this-&gt;server['HTTP_CONNECTION']) || (!preg_match('~(?:^|\W)Upgrade(?:\W|$)~i', $this-&gt;server['HTTP_CONNECTION'])) // "Upgrade" is not always alone (ie. "Connection: Keep-alive, Upgrade") || !isset($this-&gt;server['HTTP_UPGRADE']) || (strtolower($this-&gt;server['HTTP_UPGRADE']) !== 'websocket') // Lowercase comparison iss important ) { $this-&gt;close(); return false; } /* if (isset($this-&gt;server['HTTP_COOKIE'])) { self::parse_str(strtr($this-&gt;server['HTTP_COOKIE'], self::$hvaltr), $this-&gt;cookie); } if (isset($this-&gt;server['QUERY_STRING'])) { self::parse_str($this-&gt;server['QUERY_STRING'], $this-&gt;get); } */ // ---------------------------------------------------------- // Protocol discovery, based on HTTP headers... // ---------------------------------------------------------- if (isset($this-&gt;server['HTTP_SEC_WEBSOCKET_VERSION'])) { // HYBI if ($this-&gt;server['HTTP_SEC_WEBSOCKET_VERSION'] === '8') { // Version 8 (FF7, Chrome14) $this-&gt;switch_to_protocol('v13'); } elseif ($this-&gt;server['HTTP_SEC_WEBSOCKET_VERSION'] === '13') { // newest protocol $this-&gt;switch_to_protocol('v13'); } else { error_log(get_class($this) . '::' . __METHOD__ . " : Websocket protocol version " . $this-&gt;server['HTTP_SEC_WEBSOCKET_VERSION'] . ' is not yet supported for client "addr"'); // $this-&gt;addr $this-&gt;close(); return false; } } elseif (!isset($this-&gt;server['HTTP_SEC_WEBSOCKET_KEY1']) || !isset($this-&gt;server['HTTP_SEC_WEBSOCKET_KEY2'])) { $this-&gt;switch_to_protocol('ve'); } else { // Defaulting to HIXIE (Safari5 and many non-browser clients...) $this-&gt;switch_to_protocol('v0'); } // ---------------------------------------------------------- // End of protocol discovery // ---------------------------------------------------------- return true; } private function switch_to_protocol($protocol) { $class = 'ws_'.$protocol; $this-&gt;new_instance = new $class($this-&gt;socket); $this-&gt;new_instance-&gt;state = $this-&gt;state; $this-&gt;new_instance-&gt;unparsed_data = $this-&gt;unparsed_data; $this-&gt;new_instance-&gt;server = $this-&gt;server; $this-&gt;new_instance-&gt;on_frame_user = $this-&gt;on_frame_user; } /** * Send Bad request * @return void */ public function bad_request() { $this-&gt;write("400 Bad Request\r\n\r\n&lt;html&gt;&lt;head&gt;&lt;title&gt;400 Bad Request&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=\"white\"&gt;&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;"); $this-&gt;close(); } /** * Replacement for default parse_str(), it supoorts UCS-2 like this: %uXXXX * @param string $s String to parse * @param array &amp;$var Reference to the resulting array * @param boolean $header Header-style string * @return void */ public static function parse_str($s, &amp;$var, $header = false) { static $cb; if ($cb === null) { $cb = function ($m) { return urlencode(html_entity_decode('&amp;#' . hexdec($m[1]) . ';', ENT_NOQUOTES, 'utf-8')); }; } if ($header) { $s = strtr($s, self::$hvaltr); } if ( (stripos($s, '%u') !== false) &amp;&amp; preg_match('~(%u[af\d]{4}|%[cf][af\d](?!%[89a-f][af\d]))~is', $s, $m) ) { $s = preg_replace_callback('~%(u[af\d]{4}|[af\d]{2})~i', $cb, $s); } parse_str($s, $var); } /** * Send data to the connection. Note that it just writes to buffer that flushes at every baseloop * @param string $data Data to send * @return boolean Success */ public function write($data) { if ($this-&gt;closed) return false; return stream_socket_sendto($this-&gt;socket, $data) == 0; } /** *         * @return bool */ protected function send_handshake_reply() { return false; } /** * Called when we're going to handshake. * @return boolean Handshake status */ public function handshake() { $extra_headers = ''; foreach ($this-&gt;headers as $k =&gt; $line) { if ($k !== 'STATUS') { $extra_headers .= $line . "\r\n"; } } if (!$this-&gt;send_handshake_reply($extra_headers)) { error_log(get_class($this) . '::' . __METHOD__ . ' : Handshake protocol failure for client ""'); // $this-&gt;addr $this-&gt;close(); return false; } $this-&gt;handshaked = true; $this-&gt;headers_sent = true; $this-&gt;state = static::STATE_HANDSHAKED; return true; } /** * Read from buffer without draining * @param integer $n Number of bytes to read * @param integer $o Offset * @return string|false */ public function look($n, $o = 0) { if (strlen($this-&gt;unparsed_data) &lt;= $o) { return ''; } return substr($this-&gt;unparsed_data, $o, $n); } /** * Convert bytes into integer * @param string $str Bytes * @param boolean $l Little endian? Default is false * @return integer */ public static function bytes2int($str, $l = false) { if ($l) { $str = strrev($str); } $dec = 0; $len = strlen($str); for ($i = 0; $i &lt; $len; ++$i) { $dec += ord(substr($str, $i, 1)) * pow(0x100, $len - $i - 1); } return $dec; } /** * Drains buffer * @param integer $n Numbers of bytes to drain * @return boolean Success */ public function drain($n) { $ret = substr($this-&gt;unparsed_data, 0, $n); $this-&gt;unparsed_data = substr($this-&gt;unparsed_data, $n); return $ret; } /** * Read data from the connection's buffer * @param integer $n Max. number of bytes to read * @return string|false Readed data */ public function read($n) { if ($n &lt;= 0) { return ''; } $read = $this-&gt;drain($n); if ($read === '') { return false; } return $read; } /** * Reads all data from the connection's buffer * @return string Readed data */ public function read_unlimited() { $ret = $this-&gt;unparsed_data; $this-&gt;unparsed_data = ''; return $ret; } /** * Searches first occurence of the string in input buffer * @param string $what Needle * @param integer $start Offset start * @param integer $end Offset end * @return integer Position */ public function search($what, $start = 0, $end = -1) { return strpos($this-&gt;unparsed_data, $what, $start); } /** * Called when new frame received. * @param string $data Frame's data. * @param string $type Frame's type ("STRING" OR "BINARY"). * @return boolean Success. */ public function on_frame($data, $type) { if (is_callable($this-&gt;on_frame_user)) { call_user_func($this-&gt;on_frame_user, $this, $data, $type); } return true; } public function send_frame($data, $type = null, $cb = null) { return false; } /** * Get real frame type identificator * @param $type * @return integer */ public function get_frame_type($type) { if (is_int($type)) { return $type; } if ($type === null) { $type = 'STRING'; } $frametype = @constant(get_class($this) . '::' . $type); if ($frametype === null) { error_log(__METHOD__ . ' : Undefined frametype "' . $type . '"'); } return $frametype; } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     å®Ÿéš›ã«ã¯ã€ã€ŒWebã‚½ã‚±ãƒƒãƒˆãƒ¬ãƒ™ãƒ«ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ¥ç¶šã™ã‚‹ã€ã€ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã™ã‚‹ã€ã€ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã€ã¨ã„ã†3ã¤ã®ã“ã¨ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ã¾ãšã€ã„ãã¤ã‹ã®ç†è«–ã¨ç”¨èªã€‚  ã€Œãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã€ã¯ã€Webã‚½ã‚±ãƒƒãƒˆã®è¦³ç‚¹ã‹ã‚‰ã€httpã‚’ä»‹ã—ãŸæ¥ç¶šã‚’ç¢ºç«‹ã™ã‚‹ãŸã‚ã®æ‰‹é †ã§ã™ã€‚ çµå±€ã®ã¨ã“ã‚ã€ä¸€é€£ã®è³ªå•ã‚’è§£æ±ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ—ãƒ­ã‚­ã‚·ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®åšã„éƒ¨åˆ†ã‚’çªç ´ã™ã‚‹æ–¹æ³•ã€é‚ªæ‚ªãªãƒãƒƒã‚«ãƒ¼ã‹ã‚‰èº«ã‚’å®ˆã‚‹æ–¹æ³•ã§ã™ã€‚  ã€Œãƒ•ãƒ¬ãƒ¼ãƒ ã€ã¨ã„ã†ç”¨èªã¯ã€å¾©å·åŒ–ã•ã‚ŒãŸå½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚ã“ã‚Œã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¾ãŸã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚ ãŠãã‚‰ãè¨˜äº‹ã®å†’é ­ã§ã“ã‚Œã«ã¤ã„ã¦æ›¸ãä¾¡å€¤ã¯ã‚ã‚Šã¾ã—ãŸãŒã€ã“ã‚Œã‚‰ã®ã€Œãƒ•ãƒ¬ãƒ¼ãƒ ã€ã®ãŸã‚ã«ã€ã‚½ã‚±ãƒƒãƒˆã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã‚½ã‚±ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã«ã™ã‚‹ã“ã¨ã¯æ„å‘³ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ ã“ã®ç¬é–“ãŒ<a href="https://habrahabr.ru/post/209864/">ã“ã“</a>ã§è¡Œã‚ã‚Œ<a href="https://habrahabr.ru/post/209864/">ãŸæ–¹æ³•</a> -ãã‚Œã¯ç§ãŒä¸€æ™©ä»¥ä¸Šç¡çœ ã‚’å¥ªã£ãŸã€‚ ãã®è¨˜äº‹ã§ã¯ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãŒå®Œå…¨ã«åˆ°ç€ã—ãªã‹ã£ãŸã€ã¾ãŸã¯2ã¤ãŒä¸€åº¦ã«åˆ°ç€ã—ãŸã¨ã¯è¦‹ãªã•ã‚Œã¾ã›ã‚“ã€‚ ã¡ãªã¿ã«ã€ã‚²ãƒ¼ãƒ ãƒ­ã‚°ãŒç¤ºã—ãŸã‚ˆã†ã«ã€ã“ã‚Œã¨ãã‚Œã¯éå¸¸ã«å…¸å‹çš„ãªçŠ¶æ³ã§ã™ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ã•ã¦è©³ç´°ã«ã€‚ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webã‚½ã‚±ãƒƒãƒˆãƒ¬ãƒ™ãƒ«ã§ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®æ¥ç¶š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆws_v0ãªã©ï¼‰ãŒon_readãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã€ååˆ†ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã¨ãã«å†…éƒ¨ã§ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã‚’ãƒ—ãƒ«ã™ã‚‹ã¨æƒ³å®šã•ã‚Œã¾ã™ã€‚æ¬¡ã¯ã€è¦ªã®ã€Œæ¡æ‰‹ã€ã§ã™ã€‚æ¬¡ã«ã€send_handshake_replyãƒ¡ã‚½ãƒƒãƒ‰ãŒä½œå‹•ã—ã¾ã™ã€‚ã“ã‚Œã¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ã€Œsend_handshake_replyã€ã¯ã€ã€Œæ¥ç¶šãŒç¢ºç«‹ã•ã‚ŒãŸã“ã¨ã€ã€é€šå¸¸ã®ãƒ–ãƒ©ã‚¦ã‚¶-é€šå¸¸ã®å›ç­”ã€ãŠã‚ˆã³Safari-ç‰¹åˆ¥ãªå›ç­”ã‚’ç†è§£ã™ã‚‹ã‚ˆã†ãªæ–¹æ³•ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¿œç­”ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã™ã‚‹</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æ„šã‹ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã€æ¥ç¶šãŒç¢ºç«‹ã•ã‚Œãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã™ã§ã«åˆ°ç€ã—ã¦ã„ã‚‹ã‚ˆã†ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã§ãã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã—ãŸãŒã£ã¦ã€ã€Œunparsed_dataã€å¤‰æ•°ã‚’æ…é‡ã«æ‰±ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å„ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã€on_readãƒ¡ã‚½ãƒƒãƒ‰ã¯é€ä¿¡ã•ã‚ŒãŸãƒ•ãƒ¬ãƒ¼ãƒ ã®ã‚µã‚¤ã‚ºã‚’ç†è§£ã—ã€ãƒ•ãƒ¬ãƒ¼ãƒ å…¨ä½“ãŒåˆ°ç€ã—ãŸã“ã¨ã‚’ç¢ºèªã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§åˆ°ç€ã—ãŸãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å¾©å·åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å„ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã€ã“ã‚Œã¯éå¸¸ã«ç•°ãªã£ã¦éå¸¸ã«ã‚«ãƒ¼ãƒªãƒ¼ã«è¡Œã‚ã‚Œã¾ã™ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ãŒå®Œå…¨ã«åˆ°ç€ã—ãŸã‹ã©ã†ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã®ãƒã‚¤ãƒˆã‚’å™›ã‚€ã“ã¨ã¯ã§ãã¾ã›ã‚“ï¼‰ã€‚ã•ã‚‰ã«ã€Œon_readã€ã®å†…éƒ¨ã§ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ãŒå—ä¿¡ãŠã‚ˆã³å¾©å·åŒ–ã•ã‚Œã€ãã®ã‚¿ã‚¤ãƒ—ãŒæ±ºå®šã•ã‚Œã‚‹ã¨ï¼ˆã¯ã„ã€ãã®ã‚ˆã†ã«æä¾›ã•ã‚Œã¾ã™ï¼‰ã€ã€Œon_frameã€ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ—ãƒ«ã—ã¾ã™ã€‚ my_callbackã€ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã®å‰ï¼‰ãã®çµæœã€$ my_callbackã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã™</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã€Œsend_frameã€ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«å†…ã«å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã ã‘ã§ã€ã²ãã¤ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã“ã§ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æš—å·åŒ–ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€ä¿¡ã™ã‚‹ã ã‘ã§ã™ã€‚</font><font style="vertical-align: inherit;">ç•°ãªã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ç•°ãªã‚‹æ–¹æ³•ã§æš—å·åŒ–ã—ã¾ã™ã€‚</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¾åœ¨ã€3ã¤ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€Œv13ã€ã€ã€Œv0ã€ã€ã€Œveã€ã‚’æ·»ä»˜ã—ã¦ã„ã¾ã™ã€‚</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ãƒ«&lt;ws_v13.php&gt;</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ws_v13</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ws</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CONTINUATION = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STRING = <span class="hljs-number"><span class="hljs-number">0x1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BINARY = <span class="hljs-number"><span class="hljs-number">0x2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CONNCLOSE = <span class="hljs-number"><span class="hljs-number">0x8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PING = <span class="hljs-number"><span class="hljs-number">0x9</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PONG = <span class="hljs-number"><span class="hljs-number">0xA</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $opcodes = [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'CONTINUATION'</span></span>, <span class="hljs-number"><span class="hljs-number">0x1</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'STRING'</span></span>, <span class="hljs-number"><span class="hljs-number">0x2</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'BINARY'</span></span>, <span class="hljs-number"><span class="hljs-number">0x8</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'CONNCLOSE'</span></span>, <span class="hljs-number"><span class="hljs-number">0x9</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'PING'</span></span>, <span class="hljs-number"><span class="hljs-number">0xA</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'PONG'</span></span>, ]; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $outgoingCompression = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $framebuf = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Apply mask * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $data * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string|false $mask * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> mixed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $mask)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>, $l = strlen($data), $ml = strlen($mask); $i &lt; $l; $i++) { $data[$i] = $data[$i] ^ $mask[$i % $ml]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $data; } <span class="hljs-comment"><span class="hljs-comment">/** * Sends a frame. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $data Frame's data. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $type Frame's type. ("STRING" OR "BINARY") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> callable $cb Optional. Callback called when the frame is received by client. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@callback</span></span></span><span class="hljs-comment"> $cb ( ) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> boolean Success. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_frame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $type = null, $cb = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;handshaked) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;closed &amp;&amp; $type !== <span class="hljs-string"><span class="hljs-string">'CONNCLOSE'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*if (in_array($type, ['STRING', 'BINARY']) &amp;&amp; ($this-&gt;outgoingCompression &gt; 0) &amp;&amp; in_array('deflate-frame', $this-&gt;extensions)) { //$data = gzcompress($data, $this-&gt;outgoingCompression); //$rsv1 = 1; }*/</span></span> $fin = <span class="hljs-number"><span class="hljs-number">1</span></span>; $rsv1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; $rsv2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; $rsv3 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;write(chr(bindec($fin . $rsv1 . $rsv2 . $rsv3 . str_pad(decbin(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get_frame_type($type)), <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>, STR_PAD_LEFT)))); $dataLength = strlen($data); $isMasked = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $isMaskedInt = $isMasked ? <span class="hljs-number"><span class="hljs-number">128</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($dataLength &lt;= <span class="hljs-number"><span class="hljs-number">125</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;write(chr($dataLength + $isMaskedInt)); } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ($dataLength &lt;= <span class="hljs-number"><span class="hljs-number">65535</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;write(chr(<span class="hljs-number"><span class="hljs-number">126</span></span> + $isMaskedInt) . <span class="hljs-comment"><span class="hljs-comment">// 126 + 128 chr($dataLength &gt;&gt; 8) . chr($dataLength &amp; 0xFF)); } else { $this-&gt;write(chr(127 + $isMaskedInt) . // 127 + 128 chr($dataLength &gt;&gt; 56) . chr($dataLength &gt;&gt; 48) . chr($dataLength &gt;&gt; 40) . chr($dataLength &gt;&gt; 32) . chr($dataLength &gt;&gt; 24) . chr($dataLength &gt;&gt; 16) . chr($dataLength &gt;&gt; 8) . chr($dataLength &amp; 0xFF)); } if ($isMasked) { $mask = chr(mt_rand(0, 0xFF)) . chr(mt_rand(0, 0xFF)) . chr(mt_rand(0, 0xFF)) . chr(mt_rand(0, 0xFF)); $this-&gt;write($mask . $this-&gt;mask($data, $mask)); } else { $this-&gt;write($data); } if ($cb !== null) { $cb(); } return true; } /** * Sends a handshake message reply * @param string Received data (no use in this class) * @return boolean OK? */ public function send_handshake_reply($extraHeaders = '') { if (!isset($this-&gt;server['HTTP_SEC_WEBSOCKET_KEY']) || !isset($this-&gt;server['HTTP_SEC_WEBSOCKET_VERSION'])) { return false; } if ($this-&gt;server['HTTP_SEC_WEBSOCKET_VERSION'] !== '13' &amp;&amp; $this-&gt;server['HTTP_SEC_WEBSOCKET_VERSION'] !== '8') { return false; } if (isset($this-&gt;server['HTTP_ORIGIN'])) { $this-&gt;server['HTTP_SEC_WEBSOCKET_ORIGIN'] = $this-&gt;server['HTTP_ORIGIN']; } if (!isset($this-&gt;server['HTTP_SEC_WEBSOCKET_ORIGIN'])) { $this-&gt;server['HTTP_SEC_WEBSOCKET_ORIGIN'] = ''; } $this-&gt;write("HTTP/1.1 101 Switching Protocols\r\n" . "Upgrade: WebSocket\r\n" . "Connection: Upgrade\r\n" . "Date: " . date('r') . "\r\n" . "Sec-WebSocket-Origin: " . $this-&gt;server['HTTP_SEC_WEBSOCKET_ORIGIN'] . "\r\n" . "Sec-WebSocket-Location: ws://" . $this-&gt;server['HTTP_HOST'] . $this-&gt;server['REQUEST_URI'] . "\r\n" . "Sec-WebSocket-Accept: " . base64_encode(sha1(trim($this-&gt;server['HTTP_SEC_WEBSOCKET_KEY']) . "258EAFA5-E914-47DA-95CA-C5AB0DC85B11", true)) . "\r\n" ); if (isset($this-&gt;server['HTTP_SEC_WEBSOCKET_PROTOCOL'])) { $this-&gt;write("Sec-WebSocket-Protocol: " . $this-&gt;server['HTTP_SEC_WEBSOCKET_PROTOCOL']."\r\n"); } $this-&gt;write($extraHeaders."\r\n"); return true; } /** * Called when new data received * @see http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-10#page-16 * @return void */ public function on_read() { if ($this-&gt;closed) return; if ($this-&gt;state === self::STATE_PREHANDSHAKE) { if (!$this-&gt;handshake()) { return; } } if ($this-&gt;state === self::STATE_HANDSHAKED) { while (($buflen = strlen($this-&gt;unparsed_data)) &gt;= 2) { $first = ord($this-&gt;look(1)); // first byte integer (fin, opcode) $firstBits = decbin($first); $opcode = (int)bindec(substr($firstBits, 4, 4)); if ($opcode === 0x8) { // CLOSE $this-&gt;close(); return; } $opcodeName = isset(static::$opcodes[$opcode]) ? static::$opcodes[$opcode] : false; if (!$opcodeName) { error_log(get_class($this) . ': Undefined opcode ' . $opcode); $this-&gt;close(); return; } $second = ord($this-&gt;look(1, 1)); // second byte integer (masked, payload length) $fin = (bool)($first &gt;&gt; 7); $isMasked = (bool)($second &gt;&gt; 7); $dataLength = $second &amp; 0x7f; $p = 2; if ($dataLength === 0x7e) { // 2 bytes-length if ($buflen &lt; $p + 2) { return; // not enough data yet } $dataLength = self::bytes2int($this-&gt;look(2, $p), false); $p += 2; } elseif ($dataLength === 0x7f) { // 8 bytes-length if ($buflen &lt; $p + 8) { return; // not enough data yet } $dataLength = self::bytes2int($this-&gt;look(8, $p)); $p += 8; } if (self::maxAllowedPacket &lt;= $dataLength) { // Too big packet $this-&gt;close(); return; } if ($isMasked) { if ($buflen &lt; $p + 4) { return; // not enough data yet } $mask = $this-&gt;look(4, $p); $p += 4; } if ($buflen &lt; $p + $dataLength) { return; // not enough data yet } $this-&gt;drain($p); $data = $this-&gt;read($dataLength); if ($isMasked) { $data = $this-&gt;mask($data, $mask); } //Daemon::log(De</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">bug:</span></span></span><span class="hljs-comment">:dump(array('ext' =&gt; $this-&gt;extensions, 'rsv1' =&gt; $firstBits[1], 'data' =&gt; De</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">bug:</span></span></span><span class="hljs-comment">:exportBytes($data)))); /*if ($firstBits[1] &amp;&amp; in_array('deflate-frame', $this-&gt;extensions)) { // deflate frame $data = gzuncompress($data, $this-&gt;pool-&gt;maxAllowedPacket); }*/ if (!$fin) { $this-&gt;framebuf .= $data; } else { $this-&gt;on_frame($this-&gt;framebuf . $data, $opcodeName); $this-&gt;framebuf = ''; } } } } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ãƒ«&lt;ws_v0.php&gt;</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ws_v0</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ws</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STRING = <span class="hljs-number"><span class="hljs-number">0x00</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BINARY = <span class="hljs-number"><span class="hljs-number">0x80</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $key; <span class="hljs-comment"><span class="hljs-comment">/** * Sends a handshake message reply * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string Received data (no use in this class) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> boolean OK? */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_handshake_reply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($extraHeaders = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_KEY1'</span></span>]) || !<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_KEY2'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } $final_key = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_computeFinalKey(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_KEY1'</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_KEY2'</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;key); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;key = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$final_key) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_ORIGIN'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_ORIGIN'</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;write(<span class="hljs-string"><span class="hljs-string">"HTTP/1.1 101 Web Socket Protocol Handshake\r\n"</span></span> . <span class="hljs-string"><span class="hljs-string">"Upgrade: WebSocket\r\n"</span></span> . <span class="hljs-string"><span class="hljs-string">"Connection: Upgrade\r\n"</span></span> . <span class="hljs-string"><span class="hljs-string">"Sec-WebSocket-Origin: "</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_ORIGIN'</span></span>] . <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span> . <span class="hljs-string"><span class="hljs-string">"Sec-WebSocket-Location: ws://"</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_HOST'</span></span>] . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'REQUEST_URI'</span></span>] . <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_PROTOCOL'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;write(<span class="hljs-string"><span class="hljs-string">"Sec-WebSocket-Protocol: "</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_PROTOCOL'</span></span>].<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;write($extraHeaders . <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span> . $final_key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Computes final key for Sec-WebSocket. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string Key1 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string Key2 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string Data * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string Result */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_computeFinalKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($key1, $key2, $data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strlen($data) &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) { error_log(get_class(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>) . <span class="hljs-string"><span class="hljs-string">'::'</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">__METHOD__</span></span> . <span class="hljs-string"><span class="hljs-string">' : Invalid handshake data for client ""'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// $this-&gt;addr return false; } return md5($this-&gt;_computeKey($key1) . $this-&gt;_computeKey($key2) . substr($data, 0, 8), true); } /** * Computes key for Sec-WebSocket. * @param string Key * @return string Result */ protected function _computeKey($key) { $spaces = 0; $digits = ''; for ($i = 0, $s = strlen($key); $i &lt; $s; ++$i) { $c = substr($key, $i, 1); if ($c === "\x20") { ++$spaces; } elseif (ctype_digit($c)) { $digits .= $c; } } if ($spaces &gt; 0) { $result = (float)floor($digits / $spaces); } else { $result = (float)$digits; } return pack('N', $result); } /** * Sends a frame. * @param string $data Frame's data. * @param string $type Frame's type. ("STRING" OR "BINARY") * @param callable $cb Optional. Callback called when the frame is received by client. * @callback $cb ( ) * @return boolean Success. */ public function send_frame($data, $type = null, $cb = null) { if (!$this-&gt;handshaked) { return false; } if ($this-&gt;closed &amp;&amp; $type !== 'CONNCLOSE') { return false; } if ($type === 'CONNCLOSE') { if ($cb !== null) { $cb($this); return true; } } $type = $this-&gt;get_frame_type($type); // Binary if (($type &amp; self::BINARY) === self::BINARY) { $n = strlen($data); $len = ''; $pos = 0; char: ++$pos; $c = $n &gt;&gt; 0 &amp; 0x7F; $n &gt;&gt;= 7; if ($pos !== 1) { $c += 0x80; } if ($c !== 0x80) { $len = chr($c) . $len; goto char; }; $this-&gt;write(chr(self::BINARY) . $len . $data); } // String else { $this-&gt;write(chr(self::STRING) . $data . "\xFF"); } if ($cb !== null) { $cb(); } return true; } /** * Called when new data received * @return void */ public function on_read() { if ($this-&gt;state === self::STATE_PREHANDSHAKE) { if (strlen($this-&gt;unparsed_data) &lt; 8) { return; } $this-&gt;key = $this-&gt;read_unlimited(); $this-&gt;handshake(); } if ($this-&gt;state === self::STATE_HANDSHAKED) { while (($buflen = strlen($this-&gt;unparsed_data)) &gt;= 2) { $hdr = $this-&gt;look(10); $frametype = ord(substr($hdr, 0, 1)); if (($frametype &amp; 0x80) === 0x80) { $len = 0; $i = 0; do { if ($buflen &lt; $i + 1) { // not enough data yet return; } $b = ord(substr($hdr, ++$i, 1)); $n = $b &amp; 0x7F; $len *= 0x80; $len += $n; } while ($b &gt; 0x80); if (self::maxAllowedPacket &lt;= $len) { // Too big packet $this-&gt;close(); return; } if ($buflen &lt; $len + $i + 1) { // not enough data yet return; } $this-&gt;drain($i + 1); $this-&gt;on_frame($this-&gt;read($len), 'BINARY'); } else { if (($p = $this-&gt;search("\xFF")) !== false) { if (self::maxAllowedPacket &lt;= $p - 1) { // Too big packet $this-&gt;close(); return; } $this-&gt;drain(1); $data = $this-&gt;read($p); $this-&gt;drain(1); $this-&gt;on_frame($data, 'STRING'); } else { if (self::maxAllowedPacket &lt; $buflen - 1) { // Too big packet $this-&gt;close(); return; } // not enough data yet return; } } } } } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ãƒ«&lt;ws_ve.php&gt;</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ws_ve</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ws</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STRING = <span class="hljs-number"><span class="hljs-number">0x00</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BINARY = <span class="hljs-number"><span class="hljs-number">0x80</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Sends a handshake message reply * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string Received data (no use in this class) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> boolean OK? */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_handshake_reply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($extraHeaders = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_ORIGIN'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_ORIGIN'</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;write(<span class="hljs-string"><span class="hljs-string">"HTTP/1.1 101 Web Socket Protocol Handshake\r\n"</span></span> . <span class="hljs-string"><span class="hljs-string">"Upgrade: WebSocket\r\n"</span></span> . <span class="hljs-string"><span class="hljs-string">"Connection: Upgrade\r\n"</span></span> . <span class="hljs-string"><span class="hljs-string">"Sec-WebSocket-Origin: "</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_ORIGIN'</span></span>] . <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span> . <span class="hljs-string"><span class="hljs-string">"Sec-WebSocket-Location: ws://"</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_HOST'</span></span>] . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'REQUEST_URI'</span></span>] . <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_PROTOCOL'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;write(<span class="hljs-string"><span class="hljs-string">"Sec-WebSocket-Protocol: "</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;server[<span class="hljs-string"><span class="hljs-string">'HTTP_SEC_WEBSOCKET_PROTOCOL'</span></span>].<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;write($extraHeaders.<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Computes key for Sec-WebSocket. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string Key * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string Result */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_computeKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($key)</span></span></span><span class="hljs-function"> </span></span>{ $spaces = <span class="hljs-number"><span class="hljs-number">0</span></span>; $digits = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>, $s = strlen($key); $i &lt; $s; ++$i) { $c = substr($key, $i, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($c === <span class="hljs-string"><span class="hljs-string">"\x20"</span></span>) { ++$spaces; } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> (ctype_digit($c)) { $digits .= $c; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($spaces &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $result = (float)floor($digits / $spaces); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $result = (float)$digits; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pack(<span class="hljs-string"><span class="hljs-string">'N'</span></span>, $result); } <span class="hljs-comment"><span class="hljs-comment">/** * Sends a frame. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $data Frame's data. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $type Frame's type. ("STRING" OR "BINARY") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> callable $cb Optional. Callback called when the frame is received by client. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@callback</span></span></span><span class="hljs-comment"> $cb ( ) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> boolean Success. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_frame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $type = null, $cb = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;handshaked) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;closed &amp;&amp; $type !== <span class="hljs-string"><span class="hljs-string">'CONNCLOSE'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($type === <span class="hljs-string"><span class="hljs-string">'CONNCLOSE'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($cb !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { $cb(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">// Binary $type = $this-&gt;get_frame_type($type); if (($type &amp; self::BINARY) === self::BINARY) { $n = strlen($data); $len = ''; $pos = 0; char: ++$pos; $c = $n &gt;&gt; 0 &amp; 0x7F; $n &gt;&gt;= 7; if ($pos !== 1) { $c += 0x80; } if ($c !== 0x80) { $len = chr($c) . $len; goto char; }; $this-&gt;write(chr(self::BINARY) . $len . $data); } // String else { $this-&gt;write(chr(self::STRING) . $data . "\xFF"); } if ($cb !== null) { $cb(); } return true; } /** * Called when new data received * @return void */ public function on_read() { while (($buflen = strlen($this-&gt;unparsed_data)) &gt;= 2) { $hdr = $this-&gt;look(10); $frametype = ord(substr($hdr, 0, 1)); if (($frametype &amp; 0x80) === 0x80) { $len = 0; $i = 0; do { if ($buflen &lt; $i + 1) { return; } $b = ord(substr($hdr, ++$i, 1)); $n = $b &amp; 0x7F; $len *= 0x80; $len += $n; } while ($b &gt; 0x80); if (self::maxAllowedPacket &lt;= $len) { // Too big packet $this-&gt;close(); return; } if ($buflen &lt; $len + $i + 1) { // not enough data yet return; } $this-&gt;drain($i + 1); $this-&gt;on_frame($this-&gt;read($len), $frametype); } else { if (($p = $this-&gt;search("\xFF")) !== false) { if (self::maxAllowedPacket &lt;= $p - 1) { // Too big packet $this-&gt;close(); return; } $this-&gt;drain(1); $data = $this-&gt;read($p); $this-&gt;drain(1); $this-&gt;on_frame($data, 'STRING'); } else { if (self::maxAllowedPacket &lt; $buflen - 1) { // Too big packet $this-&gt;close(); return; } } } } } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VEãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ã¾ã ãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„-èª°ãŒãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã®ã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€PhpDeamonã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’å¿ å®Ÿã«å¤‰æ›ã—ã¦ã‚«ãƒƒãƒˆã—ã¾ã—ãŸã€‚</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V13ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ã€ã™ã¹ã¦ã®é€šå¸¸ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ï¼ˆFireFoxã€Operaã€Chromeã€Yandexï¼‰ã§ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">IEã§ã‚‚ä½¿ç”¨ã—ã¾ã™ï¼ˆIE6ä»¥é™ã€ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ãŒã€IEãŒã€Œãƒ–ãƒ©ã‚¦ã‚¶ã€ã«ãªã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚IEé–‹ç™ºãƒãƒ¼ãƒ ã§ã•ãˆã€ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ãªãã‚·ãƒ³ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ã¨è¿°ã¹ã¦ã„ã¾ã™ï¼‰ã€‚</font><font style="vertical-align: inherit;">V0ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯Safariãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> çµè«–ã®ä»£ã‚ã‚Šã« </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„ã—ã¦ãã ã•ã„ã€å¥åº·ã®ãŸã‚ã«ä¸Šè¨˜ã®ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼ˆã‚‚ã¡ã‚ã‚“ã€é€šå¸¸ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ã™ã¹ã¦ãŒç†è§£ã®ãŸã‚ã«å˜ç´”åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ã€ŒThanks Anlide and PhpDeamonã€ã¨ã„ã†ã‚³ãƒ¼ãƒ‰ã®ã©ã“ã‹ã«æ›¸ã„ã¦ãã ã•ã„ã€‚</font><font style="vertical-align: inherit;">ãã®çµæœã€ã“ã“ã«ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚½ã‚±ãƒƒãƒˆã‚µãƒ¼ãƒãƒ¼ã¯ã€ã™ã¹ã¦ã®æœ€æ–°ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã¨äº’æ›æ€§ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãªã—ã§å‹•ä½œã—ã€è² è·ã®é«˜ã„ã‚·ã‚¹ãƒ†ãƒ ã§ã®ä½¿ç”¨ã«é©ã—ã¦ã„ã¾ã™ã€‚</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ–°</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¨˜äº‹ã®è‘—è€…ã®ã‚³ãƒ¡ãƒ³ãƒˆã€‚ç§ã¯ãƒ†ã‚­ã‚¹ãƒˆã§å¸¸ã«è¨€åŠã—ã¦ã„ã¾ã™ï¼š</font></font><a href="https://habrahabr.ru/post/301822/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habrahabr.ru/post/301822/#comment_9634636</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> read_lintï¼ˆï¼‰ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¯ã‚¨ãƒ©ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ã‚’èª­ã¿å–ã‚‹å¿…è¦ãŒã‚ã‚‹ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€httpãƒªã‚¯ã‚¨ã‚¹ãƒˆæœ¬æ–‡ã®æœ¬æ–‡ã‚’èª­ã¿å–ã£ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚ </font></font></li><li>     â€”       . </li><li>       gitbub <a href="https://github.com/anlide/websocket">github.com/anlide/websocket</a>      ping-pong ,         select  - â€”         websocket. </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J30181/index.html">è§’ãŒä¸¸ã„åŠé€æ˜ãƒ–ãƒ­ãƒƒã‚¯</a></li>
<li><a href="../J301810/index.html">ã‚®ã‚¬ãƒ“ãƒƒãƒˆã‚¹ã‚¯ã‚¤ãƒ¼ã‚¸ãƒ³ã‚°ï¼šã¾ãŸã¯ViPNet Client / Coordinatorã®æ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ãªã„æ©Ÿèƒ½</a></li>
<li><a href="../J301812/index.html">KitchenCIã‚’ä½¿ç”¨ã—ã¦SaltStackã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹</a></li>
<li><a href="../J301814/index.html">ãƒ­ã‚·ã‚¢ã®ITã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆã®é¸ã³æ–¹ï¼šç¥è©±2ã€3</a></li>
<li><a href="../J301820/index.html">ä¸­å›½èªã®Postgresã¾ãŸã¯Postgresã§ä¸­å›½èªã®å…¨æ–‡æ¤œç´¢ã‚’è¨­å®šã™ã‚‹</a></li>
<li><a href="../J301826/index.html">DropboxãŒã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®ã‚«ãƒ¼ãƒãƒ«ã«åŸ‹ã‚è¾¼ã¾ã‚Œã¦ã„ã‚‹ç†ç”±ã‚’èª¬æ˜ã—ã¾ã—ãŸ</a></li>
<li><a href="../J301828/index.html">DevConf :: Hii by Yii at TASS June 18-19ã€2016</a></li>
<li><a href="../J301830/index.html">æ²ç¤ºæ¿ã¨ã—ã¦ã®å¤©äº•æ™‚è¨ˆã®ä½¿ç”¨</a></li>
<li><a href="../J301834/index.html">ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚®ãƒ£ãƒƒãƒ—ã€Œã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚®ãƒ£ãƒƒãƒ—ã€</a></li>
<li><a href="../J301836/index.html">ãƒã‚±ãƒƒãƒˆã®ä¸­ã®ã‚¹ãƒšãƒ¼ã‚¹ï¼šå®Ÿé¨“ã®çµæœ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
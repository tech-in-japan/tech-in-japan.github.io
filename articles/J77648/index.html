<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💑 👨🏾‍💼 🙁 OAuth：シンプルで理解可能な言語でのプロトコル記述 👓 👨🏽‍🔧 🐓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OAuthは、 ソーシャルサービスが互いに統合できるようにする一般的なプロトコルであり、個人情報を安全に交換する方法を提供します。 OAuthは2つのサービスを相互接続できます。各サービスには独自のユーザーベースがあります。この場合、これらは「ソーシャル」と呼ばれます。 OAuthの使用を開始すると...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>OAuth：シンプルで理解可能な言語でのプロトコル記述</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/77648/"> <a href=""><img align="left" src="https://habrastorage.org/getpro/geektimes/post_images/ce2/7e3/33e/ce27e333e10df7f4145911fd4932a7da.png" width="319" height="236"></a>  <a href="http://oauth.net/">OAuth</a>は、 <i>ソーシャル</i>サービスが互いに統合できるようにする一般的なプロトコルであり、個人情報を安全に交換する方法を提供します。  OAuthは2つのサービスを相互接続できます。各サービスには独自のユーザーベースがあります。この場合、これらは「ソーシャル」と呼ばれます。  OAuthの使用を開始するとき、最初に感じるのは、プロトコルが非常に複雑で冗長であることです。 この記事では、OAuthの基本を人間の言語で説明しようとします。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2> 相互認証の例 </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      2005年に戻り、ソーシャルネットワークを作成していると想像します。  Gmailのアドレス帳から連絡先をインポートするためのフォームがあります。  Gmailの連絡先にアクセスするには何が必要ですか？ もちろん、ボックスのユーザー名とパスワード。 しかし、私たちがウェブサイトでそれらを入力するように頼むならば、ユーザーは何かが間違っていると疑います。 入力したパスワードをサーバーに保存しないという保証はどこにありますか？ したがって、パスワード<i>はGMail Webサイト</i>で<i>のみ</i>入力し、その後、GMail APIを介した連絡先へのアクセスがソーシャルネットワークに提供されるようにします（場合によっては）。 <a name="habracut"></a><table><tbody><tr><td></td><td> 次のようになります。フォームは、「連絡先のインポート」という1つのボタンで構成されています。 クリックすると、ユーザーは一時的にGMailにリダイレクトされ、そこでユーザー名とパスワードを入力します（既に認証されている場合は何も入力しません）。 その後、ユーザーは当社のWebサイトに戻り、スクリプトはすでに内部GMail APIを介して連絡先をダウンロードする機会を得ています。 </td></tr></tbody></table> 条件に同意しましょう。 <ul><li>  <b>消費者</b> ：消費者。 ソーシャルネットワークで連絡先をインポートするフォームを処理するためのスクリプト。 </li><li>  <b>サービスプロバイダー</b> ：データプロバイダー。  GMail。消費者が関心を持つアドレス帳データが含まれています。 </li><li>  <b>ユーザー</b> ：コンシューマーとサービスプロバイダーの両方のアカウントを持っているユーザー。 </li><li>  <b>保護されたリソース</b> ：個人データ。  Gmailのアドレス帳の連絡先（サービスプロバイダーのリソースなど）。 </li><li>  <b>プロバイダーAPI</b> ：任意のスクリプトがGMailアドレス帳から連絡先を取得できるようにするGMail API。 </li></ul><table><tbody><tr><td></td><td>  <i>ここで、画面の上部を紙で閉じて、質問として質問に答えてください：サービスプロバイダーは誰ですか？</i>  <i>保護されたリソースとは何ですか？</i>  <i>消費者とはどのようなもので、ユーザーとどう違うのですか？</i>  <i>APIはどこにありますか？</i>  <i>さらに記事では、これらの条件を自由に使用します。</i>  <i>あなたがそれらに今十分でない場合、理解に問題があるかもしれません。</i> </td></tr></tbody></table>  <b>OAuthの目標は</b> 、ユーザーがサービスプロバイダー（GMail）の保護されたデータを使用して（ソーシャルネットワーク上の）コンシューマーサービスで作業できるようにすることです。 それほど複雑ではありませんか？ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  OAuthとOpenIDの違いは何ですか？ </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      OAuthは「ロボット用プロトコル」と呼ばれることが多く、OpenIDとは異なり、「ユーザー用プロトコル」と呼ばれます。 それらを混同しないでください！ <ol><li>  <b>OpenIDは、登録を加速するためのプロトコルです。</b>  OpenIDを使用すると、ユーザーは、インターネット上の別の場所に既に登録されている場合、パスワードを入力せずにサービスのアカウントを入力できます。  （そして、「どこか」で認証されて、パスワードを入力せずにサービスに入ることができます。）たとえば、Yandexにアカウントがある場合、OpenID認証をサポートするサービスに「ログイン」できます。 </li><li>  <b>OAuthは、サードパーティAPIへの承認されたアクセスのためのプロトコルです。</b>  OAuthを使用すると、ユーザーが許可した場合、コンシューマースクリプトはサードパーティのサービスプロバイダーデータへのAPIアクセスを制限できます。 つまり これは、APIにアクセスするためのツールです。 </li></ol><table><tbody><tr><td></td><td><h2> 警察のアナロジー </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     あなたが1973年のWebMoney窃盗事件の終結を求めている犯罪捜査局の従業員であると想像してください。 条件に同意します。 <ul><li>  <b>OAuthコンシューマー</b> ：犯罪捜査。 </li><li>  <b>ユーザー</b> ：犯罪捜査官。 </li><li>  <b>サービスプロバイダー</b> ：犯罪アーカイブのファイルアーカイブ。 </li></ul><ol><li>  OpenID：犯罪捜査部門（ユーザー）の従業員がカードファイル（サービスプロバイダー）に来て、入り口で承認を提示し、その場で情報を求めてカードを反復処理します。 </li><li>  OAuth：犯罪捜査部門の従業員（ユーザー）は、仕事（消費者）から直接サービスプロバイダーを呼び出します。 彼は姓を報告します。 彼が認められた場合（認可）、彼は1973年のすべての犯罪のリストを要求します（APIコール）。 </li></ol> ご覧のとおり、OpenIDとOAuthは2つの異なるものです。  OpenIDを使用すると、その場でいくつかのリソースにアクセスできます。  OAuthは、APIを介してリモートサービスからの情報の一部を提供します。 </td></tr></tbody></table><h2> この記事の概要 </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     主要部分に移る前に、どのように正確に移動するかを見てみましょう。 <ol><li> 相互認証の「手動」実装で発生する問題を考慮してください。 </li><li>  「アプリケーション」とは何か、消費者は誰かについて話しましょう。 </li><li> 暗号化の基本に触れましょう。 </li><li> この記事で作成するデモアプリケーションを示します。 </li><li> 実験するOAuthテストサーバーを決定します。 </li><li>  OAuthプロトコルのすべての手順を実行して、スクリプトのソースを提供します。 </li></ol><h2> 自転車の発明について </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     何かを理解する良い方法は、すべてのスプレッドレーキに沿って自分でそれを行うことです。 次に、車輪を再発明します。標準化されたプロトコルなしで、コンシューマとサービスプロバイダ間の相互作用の問題をどのように解決するか想像してみてください。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     最初に、GMail自体を使用して連絡先をインポートするためのフォームを作成します。 <table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト1：Velocityインポート連絡先</b> </td></tr><tr><td><pre>  &lt;form action = "http://gmail.com/auth.php?retpath=http://oursocialnetwork.ru/import.php" method = "get"&gt;
   &lt;input type = "submit" value = "Download Address Book" /&gt;
 &lt;/ form&gt; </pre></td></tr></tbody></table> 次に、GMail開発者に、ユーザーが/auth.php URIに移動したときに、承認フォームが表示されることを確認するよう依頼します（Velomir GMailはPHPで記述されています）。 パスワードを正常に入力したら、ユーザーはretpathパラメーターでURLが指定されているサイトにリダイレクトする必要があります。 さらに、一部の秘密鍵をURLに渡す必要があります。これは、GMail APIへのアクセスにすでに使用できます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     そのため、パスワードを入力すると、ユーザーは次のアドレスのWebサイトに戻ります。 <table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト2：自転車キーリターン自転車アドレス</b> </td></tr><tr><td><pre>  http://oursocialnetwork.ru/import.php?secret=Y49xdN0Zo2B5v0RR </pre></td></tr></tbody></table> そして、/ import.phpスクリプトからGMail APIに戻り、キーY49xdN0Zo2B5v0RRを渡して連絡先をロードします。 <table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト3：バイクAPIメソッドの実行</b> </td></tr><tr><td><pre>  $連絡先= $ gmailApi-&gt; getContacts（$ _ GET ['secret']）; </pre></td></tr></tbody></table> さて、レーキをカウントしましょう（バンプをカウントするには遅すぎます）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Rake First：スプーフィングretpathリターンアドレス </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     まあ、もちろん、あなたは彼のサイトの攻撃者が最初にリンクを置くと推測しました <table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト4：攻撃者のサイト上のリンク</b> </td></tr><tr><td><pre>  http://gmail.com/auth.php?retpath=http://hackersite.ru/save.php </pre></td></tr></tbody></table> クリックしてください。 その結果、彼はGMailから返された秘密鍵を受け取ります。これは、連絡先を意味します。 <table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト5：返信先住所の自転車の秘密</b> </td></tr><tr><td><pre>  http://hackersite.ru/save.php?secret=Y49xdN0Zo2B5v0RR </pre></td></tr></tbody></table><h3>  2番目の熊手：秘密鍵の「盗聴」 </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     どうにかしてretpathを保護し、今ではそれが私たちのサイトを指すことしかできないとします。 しかし、秘密パラメーターの問題は残っています。 <table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト6：自転車のキーで自転車の住所を返す</b> </td></tr><tr><td><pre>  http://oursocialnetwork.ru/import.php?secret=Y49xdN0Zo2B5v0RR </pre></td></tr></tbody></table> シークレットは背後から見張られたり、WiFiトラフィックを聞いて傍受されたりします。 または、あなたのサイトで、いつかあなたが秘密鍵を「締める」ことを可能にするXSS脆弱性があるでしょう。 秘密の値を使用すると、攻撃者はアドレス帳を読み取ることができます。 そのため、シークレットが傍受されないように保護する必要があります（理想的には、URLをまったく渡さないでください）。 <table><tbody><tr><td></td><td>  <i>秘密キーはURLで送信されるだけでなく、APIメソッドを呼び出すときにも送信されることに注意してください。</i>  <i>傍受も可能です。</i>  <i>もちろん、ここでSSLを使用すると役立ちます。</i> </td></tr></tbody></table><h3> レーキ3番目：リダイレクトが多すぎる </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      API呼び出しごとに異なるシークレットが必要な場合は、呼び出しと同数のサービスプロバイダーWebサイトへのリダイレクトを整理する必要があります。  APIを集中的に使用すると、これは非常に遅く、順番に不快になります... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> レーキ4：消費者の悪い識別 </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     もちろん、GMailは誰がそのAPIを使用しているかを知りたがっています。 あるサイトへのアクセスを許可し、別のサイトへのアクセスを拒否します。したがって、連絡先をインポートする形式でリクエストを生成する場合、コンシューマー（サイト）はサービスプロバイダー（GMail）に「提示」する必要があります。 この場合、この機能はretpath（その中のサイト名）によって部分的に実行されますが、この方法は普遍的ではありません。  APIメソッドを呼び出すときに「プレゼンテーション」メカニズムも呼び出す必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  OAuth Foundation </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      「水中の熊手」がまだたくさんあることは注目に値します。 この熊手はマリアナ海溝（深さ10920 m）にあるため、ここでは説明しません。 脆弱性の説明には、数十ページを費やす必要があります。 そこで、すべての問題がすでに解決されているOAuthの説明に直接進みます。 <table><tbody><tr><td></td><td>  <i>OAuthに関する素晴らしい一連の記事があります：OAuthの<a href="http://hueniverse.com/oauth/">初心者向けガイド</a> （英語、hueniverseというニックネームを持つ著者から）。</i>  <i>ここまでトピックを完全に理解していない場合、学習するには約4時間かかります。</i> </td></tr></tbody></table><h3> アプリケーション=消費者+ APIアクセス </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      OAuthを使用する場合、Consumerという用語が「サイト」の意味に限定されないことが重要です。 消費者は特定の<i>アプリケーション</i>であり、その場所はそれほど重要ではありません。 実生活の消費者の例： <ul><li>  GMailからの連絡先インポートフォームのスクリプト（上記の例を参照）。 </li><li>  Twitterに投稿できるiPhoneアプリ。 </li><li> 最新のチャットメッセージと新しいメッセージを書き込む機能を表示するサイト上の長方形のウィジェット。 </li></ul> ただし、OAuthだけでおridgeを作ることはできません。 実際、OAuthが提供するのは、リモートサービス（サービスプロバイダー）にログインし、許可されたAPIリクエストを行う機能だけです。 このAPIがどのように機能するかは問題ではありません。純粋なSOAP、RESTアプローチなどです。主なことは、各APIメソッドがOAuthプロトコルに従って送信される特別なパラメーターを受け入れることです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> トークン=キー+シークレット </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      OAuthの原則の1つは、リクエストで秘密鍵を公開して送信しないことです（上記の例で理由を調べました）。 したがって、プロトコルはトークンの概念を使用します。 トークンは、ユーザー名とパスワードのペアに非常に似ています。ユーザー名は公開情報であり、パスワードは送信側と受信側のみに知られています。  OAuthの用語では、ログインはKeyと呼ばれ、パスワードはSecretです。 シークレットが送信者と受信者のみに知られ、他の誰にも知られない状況は、共有シークレットと呼ばれます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     そのため、コンシューマとプロバイダが共有シークレットについて何らかの形で合意した場合、これらのキーの傍受が危険になることを恐れずに、URL内の対応するキー（キー）をオープンに交換できます。 しかし、キーを使用してURLを偽造から保護する方法 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3> メッセージ=ドキュメント+デジタル署名 </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      「デジタル署名」-怖いように聞こえますが、実際にはかなり明白なことです。 文書をペンでサインオンすると、この文書が他人によってではなく、あなたによって書かれたことを証明します。 署名はドキュメントに「追加」され、「1セット」で送信されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     同様に、データブロックにデジタル署名が追加され、このデータを生成した人が別の人になりすましていないことを証明します。  <i>デジタル署名はドキュメントを暗号化せず、信頼性を保証するだけです！</i> 署名を受信者と送信者には知られているが、他の誰にも知られていない非常に共有された秘密に置くことができます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     どのように機能しますか？  $ sharedSecret = 529AeGWgとすると、受信側の耳元でささやくように彼に知らせました。 攻撃者による不正行為に対する保護が保証されたメッセージ「My Phone 1234567」を送信します。 <ol><li> 一般に、消費者はメッセージにデジタル署名を追加します- <pre>  $転送= $メッセージ。  「-」。  md5（$メッセージ。$ sharedSecret）;
 // $ transfer = "私の電話は1234567"です。  「-」。  md5（「私の電話は1234567です。」「529AeGWg」） </pre></li><li> サービスプロバイダーはデータを受け入れ、それを2つの部分（$メッセージと$署名）に分割して戻し、まったく同じ操作を実行します。 <pre>  $ signatureToMatch = md5（$メッセージ。$ sharedSecret）;
 // $ signatureToMatch = md5（ "私の電話は1234567"。 "529AeGWg"）; </pre> 残っているのは、結果の$ signatureToMatch値を、受信データに含まれる$ signatureと比較し、値が一致しなかった場合に偽を報告することです。 </li></ol><table><tbody><tr><td></td><td>  <i>したがって、MD5署名を作成するには、共有秘密を知っている必要があります。</i>  <i>（ところで、MD5に加えて、他の不可逆的なハッシュアルゴリズムがあります。）攻撃者は共有秘密を知らないため、署名を偽造することはできません。</i> </td></tr></tbody></table><h2> シンプルなアプリケーションを使用したOAuthのデモ </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      OAuthをライブで体験するには、次の2つが必要です。 <ol><li> プロトコルのクライアント部分を実装するスクリプト。 このような小さなPHPスクリプトを作成しました（ <a href="">zipアーカイブへのリンク</a> ）。 これは、PHPサイトに挿入できるウィジェットです。 </li><li> 実験可能なOAuthテストサーバー。 この目的には、RuTvitを使用すると便利です。http：//rutvit.ru/apps/newというページがあり、30秒でテストアプリケーションを追加できます。  （ちなみに、フォームの戻りURLは省略できます。テストスクリプトから渡します。） </li></ol> デモスクリプトのコードを見て、記事の以下の説明を読むと、プロトコルの詳細がわかります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/geektimes/post_images/c51/cbd/a61/c51cbda6190e8fa9a21f255714d1e716.png" width="397" height="220">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     コードをコピーしてレイアウトを微調整するだけで、このウィジェットを任意のPHPサイトに貼り付けることができます。 指定したハッシュタグでマークされた<a href="http://rutvit.ru/">RuTvit</a>サービスからのすべてのツイートが表示され、新しいツイートを追加することもできます（これはOAuthが使用される場所です）。 ウィジェットはRuTwit APIとOAuth認証を使用しますが、これは偶然、Twitter API標準と一致しています。 <table><tbody><tr><td></td><td> 現在、PHPでOAuthを操作するための<a href="http://oauth.googlecode.com/svn/code/php/">やや</a>普遍的なライブラリは<a href="http://oauth.googlecode.com/svn/code/php/">、Andy SmithによるOAuth.phpのみ</a>です。 これには2つの欠点があります：汚く書かれており、1年以上更新されていない。 他のライブラリへのリンク<a href="http://oauth.net/code/">はOAuth Webサイト</a>で提供さ<a href="http://oauth.net/code/">れてい</a>ますが、これらのツールはPHP拡張のインストールが必要であるか、粗すぎるか、他のライブラリに外部依存関係があります（Zend Frameworkのドラフトライブラリは非常に有望に見えます）。 彼らが言うように、「マウスは泣き、刺したが、サボテンを食べ続けた」-OAuth.phpを使用します。 </td></tr></tbody></table> このスクリプトはテストサーバーで実行できます。 これを行うには、次の3つのアクションを実行する必要があります。 <ol><li>  <a href="">スクリプトコード</a>を<a href="">ダウンロード</a>し、Webサーバー上の任意の便利なディレクトリに展開します。 </li><li>  OAuthサーバーに<a href="http://rutvit.ru/apps/new">新しいテストアプリケーション</a>を<a href="http://rutvit.ru/apps/new">登録し</a>ます。 </li><li> アプリケーションを登録した後、スクリプトのOA_CONSUMER_KEYおよびOA_CONSUMER_SECRETパラメーターをサーバーから受信した値に置き換えます。 </li></ol><table><tbody><tr><td></td><td>  <i>このスクリプトは、OOPを使用せず、可能な限り「額に」書かれています。</i>  <i>2つの目標を追求しました。a）コードの簡潔さとわかりやすさを実現すること、b）コードを記事のストーリーテリングの行と平行にすることです（したがって、この有限状態マシンとswitch ...の場合）。</i>  <i>はい、もう1つ。</i>  <i>OAuth.phpファイルは一般的なものではなく、Andy Smithのライブラリです（変更はありません）。</i> </td></tr></tbody></table><h3> アプリケーション登録とそのパラメーター </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     アプリケーションがどこから来たのか、そしてサービスプロバイダーがそれらについてどのように見つけたのかについて話しましょう。 すべてが非常に簡単です。サービスプロバイダーには、誰でも使用できる特別なアプリケーション登録フォームがあります。 このフォームの例を次に示します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/geektimes/post_images/875/5d0/aa2/8755d0aa2f06387bf98acd6edac2a21c.png" width="368" height="224">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     アプリケーションを登録すると、OAuthを使用するために必要な5つのパラメーターが与えられます。 それらは次のようになります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/geektimes/post_images/936/05f/a89/93605fa89234aaaccea42140068a2704.png" width="410" height="91">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ここで、コンシューマキーとコンシューマシークレットは、アプリケーションの一種の「ユーザー名+パスワード」です（上記のトークンに関する会話を覚えていますか？これはそのうちの1つにすぎません）。 コンシューマシークレットは共有シークレットであり、送信者と受信者のみに知られ、他の誰にも知られていません。 残りの3つの値はサービスのURLを指定しますが、その意味を次に検討します。 <table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト7：OAuthオプションと変数定義</b> </td></tr><tr><td><pre>  &lt;？php
 require_once "OAuth.php";

 //異なるパラメーター。
 define（ "ENCODING"、 "windows-1251"）;  //サイトのエンコード。  UTF-8を使用している場合は、これで完了です。
定義（「TAG」、「サポート」）;  //ツイートをフィルタリングするタグ。

 // OAuthパラメーター。 それらを暗記してください（特にSECRET）。
 define（ "OA_CONSUMER_KEY"、 "JId0zVAbQCVnqjD9OlvM"）;  // OAuthアクセスパラメータ。
 define（ "OA_CONSUMER_SECRET"、 "qocMBQg1P17CBcdVsJizsNPnlGbTU4fvlGxAszmzB5"）;
 define（ "OA_URL_REQ_TOK"、 "http://api.rutvit.ru/oauth/request_token"）;
 define（ "OA_URL_AUTH_TOK"、 "https://api.rutvit.ru/oauth/authorize"）;
 define（ "OA_URL_ACCESS_TOK"、 "http://api.rutvit.ru/oauth/access_token"）; </pre></td></tr></tbody></table><h3>  OAuth =リクエストトークンの取得+承認へのリダイレクト+アクセストークンの取得+ APIの呼び出し </h3><table><tbody><tr><td></td><td>  <i>...または、偉大な強大な意味に翻訳されます：</i> <ol><li>  <i>コンシューマアプリケーションはリクエストトークンを受け取ります。</i> </li><li>  <i>ユーザーはサービスプロバイダーのWebサイトにリダイレクトされ、そこでリクエストトークンを承認します。</i> </li><li>  <i>コンシューマアプリケーションは、アクセストークンのリクエストトークンを交換します。</i> </li><li>  <i>Consumerアプリケーションは、サービスAPIに対して承認済みのリクエストを行います。</i> </li></ol></td></tr></tbody></table>  GMailの例では、2種類のリモート呼び出しを使用しました。a）ブラウザーを介したリダイレクト。  b）スクリプト内からAPIへのアクセス。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     そして、多くのセキュリティ上の問題を明らかにしました。これは、さらなる課題があるべきであることを示唆しています。 これがOAuthで発生することです。トークンで動作するコンシューマスクリプトからプロバイダへの中間リクエストが追加されます。 それらを見てみましょう。 <table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト8：ステートマシンを介した状態遷移の処理</b> </td></tr><tr><td><pre>  // OAuthを使用するには、値を保持する3つの変数が必要です
 //ページの読み込み間（簡単にするために、セッションに保存します）。
 session_start（）;
 $ S_MSG =＆$ _ SESSION ['msg'];
 $ S_REQUEST_TOK =＆$ _ SESSION ['REQUEST_TOK'];
 $ S_ACCESS_TOK =＆$ _ SESSION ['ACCESS_TOK'];

 //パス： 
 // form_is_sent-&gt; 
 // fetch_request_token-&gt; 
 // authorize_request_token（ブラウザ経由）-&gt;
 // fetch_access_token（request_tokenをaccess_tokenと交換）-&gt;
 // send_msg（API経由）
 //または：
 // form_is_sent-&gt;
 // send_msg（API経由）
 $ action = @ $ _ GET ['action'];
 while（$アクション）{
    スイッチ（$アクション）{ </pre></td></tr></tbody></table><ol><li>  <b>フォーム送信の処理。</b> これはOAuthの一部ではなく、アプリケーションの一部です。 プロバイダーAPIに連絡する前に、このアクションの注文をこのユーザーから受け取る必要があります。 このような「注文」の例を次に示します。 <table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト9：フォーム送信の処理</b> </td></tr><tr><td><pre>  // 1.フォームの送信が要求されました。 開始するステップを決定します。
 // OAuthを使用するか、APIを介してメッセージを送信します。
ケース 'form_is_sent'：{
     //メッセージをセッションに保存します。後で必要になります。
     $ S_MSG = $ _POST ['msg'];
     if（$ S_ACCESS_TOK &amp;&amp; $ S_ACCESS_TOK-&gt; secret）{
         //ユーザーは現在のセッションで既にコメントを投稿しています。
         $ action = 'send_msg';
     } else {
         //承認はまだ実行されていません。OAuthプロシージャを開始します。
         $ action = 'fetch_request_token';
     }
    休憩;
 } </pre></td></tr></tbody></table></li><li>  <b>フェッチリクエストトークン（内部リクエスト）。</b> <ul><li> コンシューマスクリプト<b>は、</b>プロバイダーの<b>リクエストトークンURLに</b>アクセスし<b>ます（</b>例： <a href="http://api.rutvit.ru/oauth/request_token">api.rutvit.ru/oauth/request_token）</a> 。 リクエストはコンシューマキー（「アプリケーションログイン」）を渡し、リクエスト自体はコンシューマシークレット（「アプリケーションパスワード」）を使用して署名され、偽造から保護されます。 </li><li> 応答として、プロバイダーはリクエストトークンと呼ばれる「ガベージで満たされた」トークンを生成して返します。 まだ便利なので、どこかに保存する必要があります-たとえば、$ S_REQUEST_TOKセッション変数に保存します。 </li></ul><table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト10：リクエストトークンの取得</b> </td></tr><tr><td><pre>  // 2.リクエストトークンの受信をリクエスト。
 //ソケットを介してサービスプロバイダーにアクセスし、トークンを取得します。
 case 'fetch_request_token'：{
     //リクエストトークンのリクエストを生成します。
     $ consumer =新しいOAuthConsumer（OA_CONSUMER_KEY、OA_CONSUMER_SECRET）;
     $ req = OAuthRequest :: from_consumer_and_token（
         $コンシューマー、NULL、 
         「GET」、「http://api.rutvit.ru/oauth/request_token」
     ）;
     //リクエストにデジタル署名を追加して、偽造されないようにします。
     $ req-&gt; sign_request（新しいOAuthSignatureMethod_HMAC_SHA1（）、$ consumer、NULL）;
     //要求トークンを受信し、承認のために送信します。
     $ parsed = OAuthUtil :: parse_parameters（file_get_contents（$ req-&gt; to_url（）））;
     $ S_REQUEST_TOK = new OAuthToken（$解析済み['oauth_token']、$解析済み['oauth_token_secret']）;
     //次の状態に進みます。
     $ action = 'authorize_request_token';
    休憩;
 } </pre></td></tr></tbody></table></li><li>  <b>承認にリダイレクトします（ブラウザのリダイレクト経由）。</b> このアプリケーションには、一意のリクエストトークンがあります。 このトークンを使用するには、ユーザーから許可を取得する必要があります。  <i>Request Token</i>を<i>許可する</i>ように彼に<i>依頼し</i>ます。 <ul><li> コンシューマーは、ブラウザーを特別な<b>認証URL</b>プロバイダー（たとえば、 <a href="http://api.rutvit.ru/oauth/authorize">api.rutvit.ru/oauth/authorize）にリダイレクトし</a>ます。 パラメータでは、リクエストトークンキーが渡されます。 </li><li> プロバイダーは、ユーザーの認証フォームを表示し、ログインしている場合はブラウザーをリダイレクトします。 正確にどこに？ そして、これをoauth_callbackパラメーターで示します。 </li></ul><table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト11：承認へのリダイレクト</b> </td></tr><tr><td><pre>  // 3.承認（ユーザーによる確認）リダイレクトを介したトークンの要求。
 //ブラウザをサービスプロバイダーにリダイレクトして、ユーザーによるアクセスを確認します。
 // GETパラメータに戻ると、action = fetch_access_tokenになります。
ケース「authorize_request_token」：{
     //ブラウザは確認後にこのURLに戻ります。
     $ callbackUrl = "http：// {$ _SERVER ['HTTP_HOST']} {$ _SERVER ['SCRIPT_NAME']}"
         。  「？action = fetch_access_token」;
     //パラメータでコールバックURLを渡します（OAuth 1.0プロトコル。1.0aではそうではありません！）。
     $ authUrl = "http://api.rutvit.ru/oauth/authorize"。  「？」
         。  「＆oauth_token = {$ S_REQUEST_TOK-&gt; key}」
         。  "＆oauth_callback ="。  urlencode（$ callbackUrl）;
     //ブラウザのリダイレクト。
     header（ "Location：$ authUrl"）;
     exit（）;
 } </pre></td></tr></tbody></table></li><li>  <b>アクセストークンの取得（内部リクエスト）。</b> そのため、ブラウザは一連のリダイレクト後にアプリケーションに戻りました。 これは、プロバイダーでの認証が成功し、リクエストトークンが機能することを許可されていることを意味します。 ただし、OAuthでは、セキュリティのために、各トークンには独自の厳密に制限された目的があります。 たとえば、リクエストトークンは、ユーザーから確認を取得するためにのみ使用され、それ以外の場合には使用されません。 リソースにアクセスするには、新しいトークンを取得する必要があります-アクセストークン-または、彼らが言うように、「アクセストークンのリクエストトークンを交換する」。 <ul><li> 消費者は<b>アクセストークンURL</b> （たとえば、 <a href="http://api.rutvit.ru/oauth/access_token">api.rutvit.ru / oauth / access_token）</a>を参照し、 <a href="http://api.rutvit.ru/oauth/access_token">所有</a>するリクエストトークンの代わりにアクセストークンを要求します。 リクエストは、リクエストトークンシークレットに基づいてデジタル署名されます。 </li><li> プロバイダーは、ガベージで満たされたアクセストークンを生成して返します。 また、彼の表では、アクセストークンがAPIへのアクセスを許可されていることにも注目しています。 将来APIを使用する場合、アプリケーションはアクセストークンを保持する必要があります。 </li></ul><table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト12：アクセストークンの取得</b> </td></tr><tr><td><pre>  // 4.リクエストトークンをアクセストークンに交換し、アクセストークンをセッションに書き込みます。
 //ユーザーによるアクセスを確認した後、リダイレクトからここに戻りました。
 case 'fetch_access_token'：{
     $ consumer =新しいOAuthConsumer（OA_CONSUMER_KEY、OA_CONSUMER_SECRET）;
     $ req = OAuthRequest :: from_consumer_and_token（
         $消費者、$ S_REQUEST_TOK、 
         「GET」、「http://api.rutvit.ru/oauth/access_token」、
         array（）//追加。 パラメータ
     ）;
     $ req-&gt; sign_request（新しいOAuthSignatureMethod_HMAC_SHA1（）、$コンシューマ、$ S_REQUEST_TOK）;
     //リクエストを実行し、アクセストークンをセッションに書き込みます。
     $ parsed = OAuthUtil :: parse_parameters（file_get_contents（$ req-&gt; to_url（）））;
     $ S_ACCESS_TOK = new OAuthToken（$解析済み['oauth_token']、$解析済み['oauth_token_secret']）;
     //メッセージの送信に進みます。
     $ action = 'send_msg';
    休憩;
 } </pre></td></tr></tbody></table></li><li>  <b>API（内部リクエスト）を呼び出します。</b> さて、これでアクセストークンが得られ、APIメソッドを呼び出すときにそのキーを渡すことができます。 <ul><li> コンシューマーは、プロバイダーAPIへの要求を生成します（たとえば、RESTイデオロギーに従ってPOST要求を使用して）。 要求では、アクセストークンキーが送信され、このトークンの共有秘密を使用して署名されます。 </li><li> プロバイダーはAPI呼び出しを処理し、データをアプリケーションに返します。 </li></ul><table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト13：APIを呼び出す</b> </td></tr><tr><td><pre>  // 5.メッセージを送信します。
 // API URLをOAuthコンテナにラップします。
 case 'send_msg'：{
     $ consumer =新しいOAuthConsumer（OA_CONSUMER_KEY、OA_CONSUMER_SECRET）;
     $ req = OAuthRequest :: from_consumer_and_token（
         $消費者、$ S_ACCESS_TOK、 
         「POST」、「http://api.rutvit.ru/statuses/update.xml」、 
        配列（ 'status' =&gt; "＃"。TAG。 ""。iconv（ENCODING、 "UTF-8"、$ S_MSG））
     ）;
     $ req-&gt; sign_request（新しいOAuthSignatureMethod_HMAC_SHA1（）、$コンシューマ、$ S_ACCESS_TOK）;
     // POSTリクエストを送信します。
     $ h = curl_init（）;
     curl_setopt（$ h、CURLOPT_URL、$ req-&gt; get_normalized_http_url（））;
     curl_setopt（$ h、CURLOPT_POST、true）;
     curl_setopt（$ h、CURLOPT_RETURNTRANSFER、true）;
     curl_setopt（$ h、CURLOPT_POSTFIELDS、$ req-&gt; to_postdata（））;
     $ resp = curl_exec（$ h）;
     $ code = curl_getinfo（$ h、CURLINFO_HTTP_CODE）;
     //成功した場合、ウィジェットのあるページにリダイレクトします。
     if（$ code！= 200）{
         e（$応答）;
         exit（）;
     }
     header（ "場所：{$ _SERVER ['SCRIPT_NAME']}"）;
     exit（）;
 } </pre></td></tr></tbody></table></li></ol><h3> スクリプトの終わり：ウィジェットの出力 </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     スクリプトの終わりは、詳細な説明なしで明確にする必要があります。 <table cellspacing="1" cellpadding="6"><tbody><tr><td>  <b>コードリスト14：スクリプトの終わり：ウィジェットの出力</b> </td></tr><tr><td><pre>  //終了ケース
     }
 }

 //利用可能なすべてのツイートを取得します。
 $ text = file_get_contents（ "http://api.rutvit.ru/search.xml?rpp=5&amp;q="。urlencode（ "＃"。TAG））;
 $ TWEETS = new SimpleXMLElement（$ text）;

 //メッセージを再コーディングおよび引用して表示するショートカット。
関数e（$テキスト、$引用= 1）
 {
     $ text = iconv（ "utf-8"、ENCODING、$ text）;
    エコー$引用？  htmlspecialchars（$テキスト）：$テキスト;
 }
 ？&gt;

 &lt;スタイル&gt;
 .hiddenLink {display：none}
 &lt;/ style&gt;

 &lt;div style = "border：1px solid black; padding：0.5em"&gt;
 &lt;？foreach（$ TWEETS-&gt; $ tweetとしてのステータス）{？&gt;
     &lt;div style = "margin-bottom：6px"&gt;
         &lt;b&gt; &lt;？e（$ tweet-&gt; user-&gt; screen_name）？&gt;：&lt;/ b&gt; 
         &lt;？e（$ tweet-&gt; text_formatted、0）？&gt;
     &lt;/ div&gt;
 &lt;？}？&gt;
 &lt;form method = "post" action = "&lt;？e（$ _ SERVER ['SCRIPT_NAME']）？&gt;？action = form_is_sent" style = "margin：1em 0 0 0"&gt;
     &lt;入力タイプ=「テキスト」サイズ=「30」名前=「msg」/&gt;
     &lt;入力タイプ= "送信"値= "送信" /&gt;
 &lt;/ form&gt;
 &lt;/ div&gt; </pre></td></tr></tbody></table><h2> 便利なOAuthリンク </h2><ul><li>  <a href="http://dklab.ru/chicken/nablas/57.html">dklab.ruの現在の記事のオリジナル</a> </li><li>  <a href="http://oauth.net/">公式OAuthウェブサイト</a> 。 </li><li>  <a href="http://oauth.googlecode.com/svn/code/php/">Andy SmithによるOAuth.php</a> </li><li> さまざまなプログラミング言語<a href="http://oauth.net/code/">でのOAuthプロトコルの実装</a> 。 </li><li>  <a href="http://hueniverse.com/oauth/">OAuthの初心者向けガイド</a> ：英語のOAuthに関する記事。読むことを強くお勧めします。 </li></ul> こちらもご覧ください： <ul><li>  <a href="http://rutvit.ru/apps/new">http://rutvit.ru/apps/new：Rutvit</a> OAuthサーバーにアプリケーションを登録します。 </li><li> この記事の<a href="">完全なソースコードの</a>例。 </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J7764/index.html">パーソナライズされたページはありません-iGoogleがあります！</a></li>
<li><a href="../J77640/index.html">また、ウィジェットの収益化について</a></li>
<li><a href="../J77641/index.html">レコードを削除するときにMySQLがブロック制限（定数）を取得する、HowTo</a></li>
<li><a href="../J77644/index.html">個人アカウントはすべてのQIWI端末でアクティブ化されます（QIWI）</a></li>
<li><a href="../J77646/index.html">紙「コンピューター」すべて</a></li>
<li><a href="../J7765/index.html">iGoogle-貴重な毛皮だけでなく、面白​​い写真も</a></li>
<li><a href="../J77651/index.html">LLCの登録方法</a></li>
<li><a href="../J77652/index.html">Computerraは終了します</a></li>
<li><a href="../J77654/index.html">ウェブカメラ→ピクセルシェーダー→楽しい</a></li>
<li><a href="../J77656/index.html">Memcached phpモジュールの奇妙な点</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
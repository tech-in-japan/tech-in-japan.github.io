<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔫 🛀🏾 🙆🏾 PHPMailer機能の拡張 ➖ 👯 🎉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは 
  
 おそらく、SMTPを介してPHPコードからメールを送信する必要があった人は誰でも、 PHPMailerクラスに精通しているでしょう 。 
  
 この記事では、追加パラメーターとして送信したいネットワークインターフェースのIPアドレスを受け入れるようにPHPMailerに教える...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>PHPMailer機能の拡張</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body"> こんにちは 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     おそらく、SMTPを介してPHPコードからメールを送信する必要があった人は誰でも、 <a href="http://code.google.com/a/apache-extras.org/p/phpmailer/">PHPMailer</a>クラスに精通している<a href="http://code.google.com/a/apache-extras.org/p/phpmailer/">でしょう</a> 。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この記事では、追加パラメーターとして送信したいネットワークインターフェースのIPアドレスを受け入れるようにPHPMailerに教える方法について説明します。 当然、この機能は複数の白いIPアドレスを持つサーバーでのみ役立ちます。 また、ちょっとした追加として、PHPMailerコードからのやや不快なバグをキャッチします。 <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  PHPMailerアーキテクチャの概要 </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      PHPMailerパッケージは、同じ名前のフロントエンド（PHPMailerクラス）と、POP3事前認証など、SMTP経由でメールを送信する機能を実装するいくつかのプラグインクラスで構成されています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      PHPMailerフロントエンドは、メッセージパラメータ（localhost、return-path、AddAdress（）、body、fromなど）を設定し、送信方法と認証方法（SMTPSecure、SMTPAuth、IsMail（）、IsSendMail（）、IsSMTP（ ）など）、およびSend（）メソッド。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     レターのパラメーターを設定し、送信方法（mail、sendmail、qmail、smtpから選択可能）を指定したら、PHPMailer Send（）クラスメソッドを呼び出す必要があります。このメソッドは、何らかの方法でメールを送信する内部メソッドに呼び出しを委任します。 。  SMTPに興味があるため、主にclass.smtp.phpファイルのSMTPプラグインを検討します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      PHPMailer :: IsSMTP（）メソッドを使用する場合、PHPMailer :: Send（）メソッドは、保護されたPHPMailer :: SmtpSend（$ header、$ body）メソッドを呼び出し、生成されたヘッダーとメッセージ本文を渡します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      PHPMailer :: SmtpSend（）メソッドは、受信者のリモートSMTPサーバーへの接続を試み（これがPHPMailerオブジェクトによって送信された最初のメッセージでない場合、おそらく接続が既に確立されており、このステップはスキップされます）、標準SMTPセッションを開始します（HELLO / EHLO、MAIL TO、RCPT、DATAなど）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      SMTPサーバーへの接続は、パブリックメソッドPHPMailer :: SmtpConnect（）で行われます。 一度に1つのドメインに対して異なる優先順位を持つ複数のMXレコードが存在する可能性があるため、PHPMailer :: SmtpConnect（）メソッドは、PHPMailerの構成中に指定された各SMTPサーバーに順番に接続しようとします。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> コードのバグ </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次に、PHPMailer :: SmtpConnect（）コードをよく見てください。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Initiates a connection to an SMTP server. * Returns false if the operation failed. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@uses</span></span></span><span class="hljs-comment"> SMTP * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@access</span></span></span><span class="hljs-comment"> public * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SmtpConnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(is_null(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;smtp)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;smtp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SMTP(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;smtp-&gt;do_debug = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;SMTPDebug; $hosts = explode(<span class="hljs-string"><span class="hljs-string">';'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;Host); $index = <span class="hljs-number"><span class="hljs-number">0</span></span>; $connection = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;smtp-&gt;Connected(); <span class="hljs-comment"><span class="hljs-comment">// Retry while there is no connection try { while($index &lt; count($hosts) &amp;&amp; !$connection) { $hostinfo = array(); if (preg_match('/^(.+):([0-9]+)$/', $hosts[$index], $hostinfo)) { $host = $hostinfo[1]; $port = $hostinfo[2]; } else { $host = $hosts[$index]; $port = $this-&gt;Port; } $tls = ($this-&gt;SMTPSecure == 'tls'); $ssl = ($this-&gt;SMTPSecure == 'ssl'); if ($this-&gt;smtp-&gt;Connect(($ssl ? 'ssl://':'').$host, $port, $this-&gt;Timeout)) { $hello = ($this-&gt;Helo != '' ? $this-&gt;Helo : $this-&gt;ServerHostname()); $this-&gt;smtp-&gt;Hello($hello); if ($tls) { if (!$this-&gt;smtp-&gt;StartTLS()) { throw new phpmailerException($this-&gt;Lang('tls')); } //We must resend HELO after tls negotiation $this-&gt;smtp-&gt;Hello($hello); } $connection = true; if ($this-&gt;SMTPAuth) { if (!$this-&gt;smtp-&gt;Authenticate($this-&gt;Username, $this-&gt;Password)) { throw new phpmailerException($this-&gt;Lang('authenticate')); } } } $index++; if (!$connection) { throw new phpmailerException($this-&gt;Lang('connect_host')); } } } catch (phpmailerException $e) { $this-&gt;smtp-&gt;Reset(); if ($this-&gt;exceptions) { throw $e; } } return true; }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     コードで$ this-&gt; smtpはSMTPプラグインクラスのオブジェクトです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     著者が何を念頭に置いていたかを理解しようとします。 まず、SMTPで機能する内部オブジェクトが作成されているかどうかを確認し、これがPHPMailerクラスのオブジェクトのSmtpConnect（）メソッドの最初の呼び出しである場合に作成されます（実際、PHPMailer :: Close（）メソッドは$ this-&gt; smtpに変換できますnull）。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次に、PHPMailer :: Hostフィールドは、区切り文字「;」で分割されます 結果は、受信者ドメインのMXレコードの配列です。  Hostにエントリが1つしかない場合（「smtp.yandex.ru」など）、配列には要素が1つしかありません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次に、受信者サーバーに既に接続されているかどうかを確認します。 これがSmtpConnect（）の最初の呼び出しである場合、$ connectionがfalseであることは明らかです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     だから、私たちは最も興味深いことに到達しました。 サイクルはすべてのMXレコードで開始され、各反復で次のMXへの接続が試行されます。 しかし、このサイクルのアルゴリズムを頭の中で実行すると、最初のMXレコードについて次のように想像するとどうなりますか？（$ this-&gt; smtp-&gt; Connect（（$ ssl？ 'Ssl：//'： ''）。$ Host、$ port、$ this-&gt; Timeout））falseを返しましたか？ サイクルは、サイクルの後に既にキャッチされる例外をスローすることがわかります。 つまり 他のすべてのMXレコードの可用性はチェックされず、例外がキャッチされます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     しかし、これは最も不快ではありません。  PHPMailerは2つのモードで動作します-例外をスローするか、ErrorInfoフィールドにエラーメッセージを書き込むことで静かに死にます。 サイレントモードを使用する場合（$ this-&gt; exceptions == false、これがデフォルトモード）、SmtpConnect（）はtrueを返します！ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     一般に、このバグには時間がかかり、開発者に<a href="http://code.google.com/a/apache-extras.org/p/phpmailer/issues/detail%3Fid%3D41">通知され</a>ます。 バージョン5.2.1で気付きましたが、古いバージョンでも同じように動作します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     先に進む前に、クイックフィックスを紹介します。 開発者からの公式リリースまで、私は彼と一緒に住んでいます。 今月は飛行が正常です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SmtpConnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(is_null(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;smtp)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;smtp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SMTP(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;smtp-&gt;do_debug = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;SMTPDebug; $hosts = explode(<span class="hljs-string"><span class="hljs-string">';'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;Host); $index = <span class="hljs-number"><span class="hljs-number">0</span></span>; $connection = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;smtp-&gt;Connected(); <span class="hljs-comment"><span class="hljs-comment">// Retry while there is no connection try { while($index &lt; count($hosts) &amp;&amp; !$connection) { $hostinfo = array(); if (preg_match('/^(.+):([0-9]+)$/', $hosts[$index], $hostinfo)) { $host = $hostinfo[1]; $port = $hostinfo[2]; } else { $host = $hosts[$index]; $port = $this-&gt;Port; } $tls = ($this-&gt;SMTPSecure == 'tls'); $ssl = ($this-&gt;SMTPSecure == 'ssl'); $bRetVal = $this-&gt;smtp-&gt;Connect(($ssl ? 'ssl://':'').$host, $port, $this-&gt;Timeout); if ($bRetVal) { $hello = ($this-&gt;Helo != '' ? $this-&gt;Helo : $this-&gt;ServerHostname()); $this-&gt;smtp-&gt;Hello($hello); if ($tls) { if (!$this-&gt;smtp-&gt;StartTLS()) { throw new phpmailerException($this-&gt;Lang('tls')); } //We must resend HELO after tls negotiation $this-&gt;smtp-&gt;Hello($hello); } if ($this-&gt;SMTPAuth) { if (!$this-&gt;smtp-&gt;Authenticate($this-&gt;Username, $this-&gt;Password)) { throw new phpmailerException($this-&gt;Lang('authenticate')); } } $connection = true; break; } $index++; } if (!$connection) { throw new phpmailerException($this-&gt;Lang('connect_host')); } } catch (phpmailerException $e) { $this-&gt;SetError($e-&gt;getMessage()); if ($this-&gt;smtp-&gt;Connected()) $this-&gt;smtp-&gt;Reset(); if ($this-&gt;exceptions) { throw $e; } return false; } return true; }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  PHPMailerを拡張して、複数のネットワークインターフェイスで動作するようにします </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      PHPMailerのSMTPプラグインは、fsockopen、fputs、fgetsを介してネットワークで動作します。 マシン上にインターネットに接続するネットワークインターフェイスが複数ある場合、fsockopenはいずれの場合も最初の接続でソケットを作成します。 何でも作成できる必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     最初に思いついたのは、標準的なソケットsocket_create、socket_bind、socket_connectの標準的な束を使用することでした。これにより、socket_bindで、IPアドレスにソケットを関連付けるネットワークインターフェイスを指定できます。 結局のところ、このアイデアは完全に成功しているわけではありません。 その結果、fputsとfgetsはsocket_createによって作成されたリソースを使用できないため、PHPMailer SMTPプラグインのほぼ全体を書き換えて、fputsとfgetsをsocket_readとsocket_writeに置き換えなければなりませんでした。 獲得したが、魂は堆積物のままだった。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次の考えがより成功したことが判明しました。  fgetsが安全に読み取れるストリームソケットを作成するstream_socket_client関数があります！ その結果、SMTPプラグインの1つのメソッドを置き換えるだけで、PHPMailerにネットワークインターフェースの明示的な指示でメールを送信するように教えることができ、同時に実際には開発者のコ​​ードに手を触れません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     プラグインは次のとおりです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'class.smtp.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SMTPX</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SMTP</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Connect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($host, $port = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $tval = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">30</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $local_ip)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// set the error val to null so there is no confusion $this-&gt;error = null; // make sure we are __not__ connected if($this-&gt;connected()) { // already connected, generate error $this-&gt;error = array("error" =&gt; "Already connected to a server"); return false; } if(empty($port)) { $port = $this-&gt;SMTP_PORT; } $opts = array( 'socket' =&gt; array( 'bindto' =&gt; "$local_ip:0", ), ); // create the context... $context = stream_context_create($opts); // connect to the smtp server $this-&gt;smtp_conn = @stream_socket_client($host.':'.$port, $errno, $errstr, $tval, // give up after ? secs STREAM_CLIENT_CONNECT, $context); // verify we connected properly if(empty($this-&gt;smtp_conn)) { $this-&gt;error = array("error" =&gt; "Failed to connect to server", "errno" =&gt; $errno, "errstr" =&gt; $errstr); if($this-&gt;do_debug &gt;= 1) { echo "SMTP -&gt; ERROR: " . $this-&gt;error["error"] . ": $errstr ($errno)" . $this-&gt;CRLF . '&lt;br /&gt;'; } return false; } // SMTP server can take longer to respond, give longer timeout for first read // Windows does not have support for this timeout function if(substr(PHP_OS, 0, 3) != "WIN") socket_set_timeout($this-&gt;smtp_conn, $tval, 0); // get any announcement $announce = $this-&gt;get_lines(); if($this-&gt;do_debug &gt;= 2) { echo "SMTP -&gt; FROM SERVER:" . $announce . $this-&gt;CRLF . '&lt;br /&gt;'; } return true; } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     実際、Connect（）メソッドの実装も最小限に変更されています。 ソケットを直接作成する文字列のみが置き換えられ、署名に別のパラメーター（ネットワークインターフェイスのIPアドレス）が追加されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     このプラグインを使用するには、PHPMailerクラスを次のように拡張する必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'class.phpmailer.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultipleInterfaceMailer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPMailer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * IP   ,    *    SMTP-. *      SMTPX. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $Ip = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($exceptions = false)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($exceptions); } <span class="hljs-comment"><span class="hljs-comment">/** *      SMTPX. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $ip IP       . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsSMTPX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ip = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">''</span></span> !== $ip) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;Ip = $ip; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;Mailer = <span class="hljs-string"><span class="hljs-string">'smtpx'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostSend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">'smtpx'</span></span> == <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;Mailer) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;SmtpSend(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;MIMEHeader, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;MIMEBody); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::PostSend(); } <span class="hljs-comment"><span class="hljs-comment">/** *  ,       * IP    . * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $header The message headers * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $body The message body * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@uses</span></span></span><span class="hljs-comment"> SMTP * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@access</span></span></span><span class="hljs-comment"> protected * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SmtpSend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($header, $body)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;PluginDir . <span class="hljs-string"><span class="hljs-string">'class.smtpx.php'</span></span>; $bad_rcpt = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;SmtpConnect()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> phpmailerException(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;Lang(<span class="hljs-string"><span class="hljs-string">'connect_host'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::STOP_CRITICAL); } $smtp_from = (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;Sender == <span class="hljs-string"><span class="hljs-string">''</span></span>) ? <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;From : <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;Sender; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;smtp-&gt;Mail($smtp_from)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> phpmailerException(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;Lang(<span class="hljs-string"><span class="hljs-string">'from_failed'</span></span>) . $smtp_from, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::STOP_CRITICAL); } <span class="hljs-comment"><span class="hljs-comment">// Attempt to send attach all recipients foreach($this-&gt;to as $to) { if (!$this-&gt;smtp-&gt;Recipient($to[0])) { $bad_rcpt[] = $to[0]; // implement call back function if it exists $isSent = 0; $this-&gt;doCallback($isSent, $to[0], '', '', $this-&gt;Subject, $body); } else { // implement call back function if it exists $isSent = 1; $this-&gt;doCallback($isSent, $to[0], '', '', $this-&gt;Subject, $body); } } foreach($this-&gt;cc as $cc) { if (!$this-&gt;smtp-&gt;Recipient($cc[0])) { $bad_rcpt[] = $cc[0]; // implement call back function if it exists $isSent = 0; $this-&gt;doCallback($isSent, '', $cc[0], '', $this-&gt;Subject, $body); } else { // implement call back function if it exists $isSent = 1; $this-&gt;doCallback($isSent, '', $cc[0], '', $this-&gt;Subject, $body); } } foreach($this-&gt;bcc as $bcc) { if (!$this-&gt;smtp-&gt;Recipient($bcc[0])) { $bad_rcpt[] = $bcc[0]; // implement call back function if it exists $isSent = 0; $this-&gt;doCallback($isSent, '', '', $bcc[0], $this-&gt;Subject, $body); } else { // implement call back function if it exists $isSent = 1; $this-&gt;doCallback($isSent, '', '', $bcc[0], $this-&gt;Subject, $body); } } if (count($bad_rcpt) &gt; 0 ) { //Create error message for any bad addresses $badaddresses = implode(', ', $bad_rcpt); throw new phpmailerException($this-&gt;Lang('recipients_failed') . $badaddresses); } if(!$this-&gt;smtp-&gt;Data($header . $body)) { throw new phpmailerException($this-&gt;Lang('data_not_accepted'), self::STOP_CRITICAL); } if($this-&gt;SMTPKeepAlive == true) { $this-&gt;smtp-&gt;Reset(); } return true; } /** *  ,   PHPMailer  *    SMTPX. * @uses SMTP * @access public * @return bool */ public function SmtpConnect() { if(is_null($this-&gt;smtp) || !($this-&gt;smtp instanceof SMTPX)) { $this-&gt;smtp = new SMTPX(); } $this-&gt;smtp-&gt;do_debug = $this-&gt;SMTPDebug; $hosts = explode(';', $this-&gt;Host); $index = 0; $connection = $this-&gt;smtp-&gt;Connected(); // Retry while there is no connection try { while($index &lt; count($hosts) &amp;&amp; !$connection) { $hostinfo = array(); if (preg_match('/^(.+):([0-9]+)$/', $hosts[$index], $hostinfo)) { $host = $hostinfo[1]; $port = $hostinfo[2]; } else { $host = $hosts[$index]; $port = $this-&gt;Port; } $tls = ($this-&gt;SMTPSecure == 'tls'); $ssl = ($this-&gt;SMTPSecure == 'ssl'); $bRetVal = $this-&gt;smtp-&gt;Connect(($ssl ? 'ssl://':'').$host, $port, $this-&gt;Timeout, $this-&gt;Ip); if ($bRetVal) { $hello = ($this-&gt;Helo != '' ? $this-&gt;Helo : $this-&gt;ServerHostname()); $this-&gt;smtp-&gt;Hello($hello); if ($tls) { if (!$this-&gt;smtp-&gt;StartTLS()) { throw new phpmailerException($this-&gt;Lang('tls')); } //We must resend HELO after tls negotiation $this-&gt;smtp-&gt;Hello($hello); } if ($this-&gt;SMTPAuth) { if (!$this-&gt;smtp-&gt;Authenticate($this-&gt;Username, $this-&gt;Password)) { throw new phpmailerException($this-&gt;Lang('authenticate')); } } $connection = true; break; } $index++; } if (!$connection) { throw new phpmailerException($this-&gt;Lang('connect_host')); } } catch (phpmailerException $e) { $this-&gt;SetError($e-&gt;getMessage()); if ($this-&gt;smtp-&gt;Connected()) $this-&gt;smtp-&gt;Reset(); if ($this-&gt;exceptions) { throw $e; } return false; } return true; } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      MultipleInterfaceMailerクラスに新しいパブリックIpフィールドが追加されました。これは、メールを送信するネットワークインターフェイスのIPアドレスの文字列表現によって設定する必要があります。 また、IsSMTPX（）メソッドが追加され、新しいプラグインを使用して文字を送信する必要があることを示しています。  PostSend（）、SmtpSend（）、およびSmtpConnect（）メソッドも、SMTPXプラグインを使用するためにやり直されました。 この場合、使用手順もクラスインターフェイスも変更されていないため、MultipleInterfaceMailerクラスのオブジェクトを既存のクライアントコードで安全に使用できます。たとえば、sendmailまたは元のSMTPプラグインを介してメールを送信します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     以下は、新しいクラスを使用する小さな例です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSmtpHostsByDomain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sRcptDomain)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getmxrr($sRcptDomain, $aMxRecords, $aMxWeights)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($aMxRecords) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; count($aMxRecords); ++$i) { $mxs[$aMxRecords[$i]] = $aMxWeights[$i]; } asort($mxs); $aSortedMxRecords = array_keys($mxs); $sResult = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($aSortedMxRecords <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $r) { $sResult .= $r . <span class="hljs-string"><span class="hljs-string">';'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $sResult; } } <span class="hljs-comment"><span class="hljs-comment">// getmxrr    ,   DNS, //,  RFC 2821,      , //   $sRcptDomain      // 0. return $sRcptDomain; } require 'MultipleInterfaceMailer.php'; $mailer = new MultipleInterfaceMailer(true); $mailer-&gt;IsSMTPX('192.168.1.1'); //   IP    //$mailer-&gt;IsSMTP();      $mailer-&gt;Host = getSmtpHostsByDomain('email.net'); $mailer-&gt;Body = 'blah-blah'; $mailer-&gt;From ='no-replay@yourdomain.net'; $mailer-&gt;AddAddress('sucreface@email.net'); $mailer-&gt;Send();</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> おわりに </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     要約すると： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  PHPMailerのバグを修正しました。これは、SMTPサーバーへの接続に失敗した場合でも、SmtpConnect（）が常にtrueを返すためです。 </li><li>  SmtpConnect（）は、最初に成功する前に渡されたすべてのMXレコードを正直にチェックし始めました。 </li><li> 新しいプラグインが作成されました。このプラグインを使用すると、SMTP経由でメールを送信し、使用する送信サーバーのネットワークインターフェイスを明示的に指定できます。 </li><li>  PHPMailerは、古いクライアントコードが新しいSMTPXプラグインを使用するために簡単に拡張されます。 </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     お友達、頑張ってください！ </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J13887/index.html">ついに出産しました！</a></li>
<li><a href="../J138871/index.html">Google Transit：公共交通機関の静かな革命</a></li>
<li><a href="../J138872/index.html">彼はどのようにしてtimeweb.ruを入手しましたか！</a></li>
<li><a href="../J138874/index.html">私がSCADAに書いたように。 パート2</a></li>
<li><a href="../J138876/index.html">eBayでの詐欺の兆候</a></li>
<li><a href="../J138879/index.html">Windows 8のUIコンセプト</a></li>
<li><a href="../J13888/index.html">画像をダウンロードするときのさまざまなブラウザーのMIMEタイプ</a></li>
<li><a href="../J138880/index.html">モバイルネットワーク用のフルHD音声コーデック</a></li>
<li><a href="../J138881/index.html">ドラゴンカーブとタートル</a></li>
<li><a href="../J138883/index.html">1995年秋のPC購入者向けのヒント</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤛🏾 🤦🏿 🕖 HibernateのSoftReference読み取り/書き込みキャッシュ-クラスター実装用の「テール」付き 📀 🤚🏽 💅🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="このトピックでは、CMS ArpSiteでのデータキャッシュシステムの実装についてお話します。 このサブシステムは複数回書き直されましたが、システムが許容可能な応答時間で動作できるようにするのはまさにそれです。 
  
 
  
 SoftReferenceを使用すると、キャッシュ動作を「偶然」に残...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>HibernateのSoftReference読み取り/書き込みキャッシュ-クラスター実装用の「テール」付き</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/91333/"> このトピックでは、CMS ArpSiteでのデータキャッシュシステムの実装についてお話します。 このサブシステムは複数回書き直されましたが、システムが許容可能な応答時間で動作できるようにするのはまさにそれです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      SoftReferenceを使用すると、キャッシュ動作を「偶然」に残すことができます。JVM自体がメモリ消費を監視し、古い要素もクリーンアップします。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      「クラスター」とは、キャッシュが値の無効化（エージング、更新）のイベントを個別に監視し、クラスター内の他のサーバーのキャッシュから古い要素が破棄されることを意味します。 他のクラスターキャッシュ定義があります。 たとえば、JBoss Cacheのメイン操作モードでは、現在のマシン上にないアイテムをクラスター内の他のノードから「プル」することもできます。 しかし、別のマシンから要素を受け取る速度が要素を生成する速度よりわずかに遅いシステムでは、障害は十分です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     読み取り/書き込みとは、キャッシュ要素のブロックを使用せず、通常、システムに独立したトランザクションが存在することを（ほとんど）考えないことを意味します。  CMSの場合、これは正常ですが、もちろん、一部のエンタープライズアプリケーションではこれは受け入れられません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     現在、ArpSiteのキャッシュは3つのレベルに分かれています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> 生成されたページのキャッシュ </li><li> その他のキャッシュ </li><li> データキャッシング </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     残りのキャッシュが誤って中央にあるわけではありません。 生成されたページは、URLとその他のパラメーターが一致する場合に、ユーザーにすぐに提供されます。 このためにデータベースを呼び出す必要はまったくありません。 データキャッシング-これは現在Hibernateで<a href="http://www.javabeat.net/articles/37-introduction-to-hibernate-caching-1.html">2番目のレベルのキャッシュ</a>と呼ばれているものです-個々のデータベース行（キーによる）といくつかの一般的なデータベースクエリ（引数による）がキャッシュされます。 他のキャッシュは、ページ生成の中間結果をキャッシュするためのさまざまなメカニズム、XSLTスタイルシートのキャッシュ、XMLスライスなどとして理解されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     システムに変更があった場合、キャッシュをクリアする必要があります。 これを行うために、システムはデータが変更されるたびに1つ以上のイベント（イベント）を生成します。 これらのイベントはクラスター内の他のノードに非同期で送信され、その後、キャッシュは個々の要素を完全にクリアまたは無効にすることでこれらのイベントに応答します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     キャッシュへのイベントの影響が小さければ小さいほど、うまく機能します。 明らかに、生成されたページのキャッシュは<i>変更があれば</i>クリアさ<i>れ</i>ます。特定のデータベース行のページ要素の依存関係を分析しようとすると、コストがかかりすぎます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     各サーバーのデータキャッシュ。 以前、JGroupsにキャッシュを実装する前に、イベントが発生した場合、アプリケーションはコマンドを呼び出してデータキャッシュを無効にするか、着信イベントからの情報に基づいて完全にクリアしました。 同様の手順は機能しましたが、重大な欠点がありました。データキャッシングでは、イベントに対する反応手順を非常に詳細に検討するか、変更ごとにキャッシュをクリアする必要がありました。  「その他」のキャッシュで何が起きているのか。 個々のデータベースクエリのキャッシュを記述することは特に問題でした。クエリで使用されたテーブルを覚えて、これらのテーブルのデータが変更されたときにキャッシュをクリアする必要がありました。 そして、キャッシュしたいリクエストごとに同様のコードを書く必要がありました... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     しかし、これはHibernateがすでに独自に行っていることです！  Hibernateは、データ変更が行われたときにどのキャッシュをクリアする必要があるかを知っているので、1つのノードで何をするのかを「覗き」、他のノードで同じことをするだけです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Hibernateの新しいキャッシュAPI </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Hibernateの用語では、1つのキャッシュは、同じタイプのデータのセットを含む個別のキャッシュです。 たとえば、1つのテーブルのデータや、たとえば、キャッシュされたすべてのデータベースクエリの直後のデータ。  Hibernateのキャッシュ動作を制御するために、プログラマーは使用するCacheProviderを示します。 たとえば、EhCacheProviderまたは単純なHashtableCacheProviderまたはNoCacheProviderにすることができます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     バージョン3.3では、Hibernateは新しいキャッシュAPIを導入し、1つの古いCacheインターフェースをいくつかに分割しました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="">地域</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ** <a href="">一般的なデータ領域</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      **** <a href="">クエリ結果領域</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      **** <a href="">タイムスタンプ地域</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ** <a href="">トランザクションデータ領域</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      **** <a href="">収集地域</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      **** <a href="">エンティティリージョン</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     また、各リージョンは、コンテキスト外で作業するためのメソッド（destroy、getSize、getName（））、一般データ領域-標準のget / putメソッド、およびトランザクションデータ領域が、ストラテジー-エンティティのコレクション領域および<a href="">EntityRegionAccessStrategyの</a> <a href="">CollectionRegionAccessStrategy</a>パターンを介してデータの処理を整理するようになりました地域 これらのインターフェイスには、とりわけ、トランザクション内のデータロックを管理するためのコマンドが含まれています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     古いAPIに基づいたHibernateのキャッシュはすでにありました。 しかし、古いAPIでは、更新とデータベースからのキャッシュへのデータの追加を区別することができなかったため（古いため）、それを放棄しなければなりませんでした。 したがって、最初のステップは、新しいAPIを実装することでしたが、すでに地域/戦略に基づいています。  Hibernateが新しいAPIから古いAPIへのアダプター実装を持っているという事実は大いに役立ちました。 非トランザクションキャッシュに基づいたEntityRegionAccessStrategyなどの実装をスパイすることができます。 それが行われました。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      APIの中核は地域です： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } }</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { /** <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> * Default no-operation implementation of {@link ArpSiteRegionListener}. <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> * Will be replaced by cluster listener if cluster extension is installed <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> * <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> * @author vlsergey {at} gmail {dot} com <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> */ <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { @Override <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { // noop } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } @Override <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { // noop } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; /** <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> * @param regionName <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> *      The name of the cache region. <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> * @param useHardReferences <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> *      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> *      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt; <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> *      otherwise. <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> */ @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } @Override <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } @Override <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { // to let JVM know it shall not GC it because of timeout value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } @Override <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } @Override <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } @Override <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } @Override <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } @Override <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } @Override <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } @Override <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } @Override <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } @Override <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } @Override <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } @Override <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } @Override <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } @Override <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } @Override <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } @Override <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } @Override <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } @Override <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">abstract</font> <font color="#0000ff">class</font> SoftRegion implements ArpSiteRegion, Cache, SoftRegionMBean { <font color="#008000">/**</font> <font color="#008000">* Default no-operation implementation of {@link ArpSiteRegionListener}.</font> <font color="#008000">* Will be replaced by cluster listener if cluster extension is installed</font> <font color="#008000">*</font> <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> <font color="#008000">*/</font> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">class</font> NoOpListener implements ArpSiteRegionListener { <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClear() { <font color="#008000">// noop</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onRemove(Object key) { <font color="#008000">// noop</font> } } <font color="#0000ff">private</font> AtomicLong clears = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> AtomicLong hits = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">protected</font> final AtomicLong lastTimestamp = <font color="#0000ff">new</font> AtomicLong(); <font color="#0000ff">protected</font> volatile ArpSiteRegionListener listener = <font color="#0000ff">new</font> NoOpListener(); <font color="#0000ff">private</font> final Map&lt;Object, Object&gt; map; <font color="#0000ff">private</font> AtomicLong miss = <font color="#0000ff">new</font> AtomicLong(0); <font color="#0000ff">private</font> final String regionName; <font color="#008000">/**</font> <font color="#008000">* @param regionName</font> <font color="#008000">*      The name of the cache region.</font> <font color="#008000">* @param useHardReferences</font> <font color="#008000">*      &lt;code&gt;true&lt;/code&gt; if cache must use hard references instead of</font> <font color="#008000">*      {@link java.lang.ref.SoftReference}s. &lt;code&gt;false&lt;/code&gt;</font> <font color="#008000">*      otherwise.</font> <font color="#008000">*/</font> @SuppressWarnings( <font color="#A31515">"unchecked"</font> ) SoftRegion(String regionName, boolean useHardReferences) { <font color="#0000ff">this</font> .regionName = regionName; <font color="#0000ff">if</font> (useHardReferences) { map = <font color="#0000ff">new</font> ConcurrentHashMap&lt;Object, Object&gt;(); } <font color="#0000ff">else</font> { map = Collections .&lt;Object, Object&gt; synchronizedMap( <font color="#0000ff">new</font> ReferenceMap( ReferenceMap.SOFT, ReferenceMap.SOFT, <font color="#0000ff">true</font> )); } } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> clear() { map.clear(); clears.incrementAndGet(); listener.onClear(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> boolean contains(Object key) { Object value = map.get(key); <font color="#0000ff">if</font> (value != <font color="#0000ff">null</font> ) { <font color="#008000">// to let JVM know it shall not GC it because of timeout</font> value.hashCode(); <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> destroy() throws CacheException { map.clear(); } <font color="#0000ff">protected</font> Object get(Object key) { final Object result = map.get(key); <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { miss.incrementAndGet(); } <font color="#0000ff">else</font> { hits.incrementAndGet(); } <font color="#0000ff">return</font> result; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getBuildCalls() { <font color="#0000ff">return</font> miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getCacheSize() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getClearCalls() { <font color="#0000ff">return</font> clears.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountInMemory() { <font color="#0000ff">return</font> map.size(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getElementCountOnDisk() { <font color="#0000ff">return</font> 0; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getGetCalls() { <font color="#0000ff">return</font> hits.get() + miss.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getHits() { <font color="#0000ff">return</font> hits.get(); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getHitsPercent() { <font color="#0000ff">long</font> hits = <font color="#0000ff">this</font> .hits.get(); <font color="#0000ff">long</font> total = hits + miss.get(); <font color="#0000ff">if</font> (total == 0) { <font color="#0000ff">return</font> 0; } <font color="#0000ff">return</font> ( <font color="#0000ff">int</font> ) (hits * 100 / total); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String getName() { <font color="#0000ff">return</font> regionName; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> getSizeInMemory() { <font color="#0000ff">return</font> -1; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">int</font> getTimeout() { <font color="#0000ff">return</font> Timestamper.ONE_MS * 60000; <font color="#008000">// ie. 60 seconds</font> } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">long</font> nextTimestamp() { final <font color="#0000ff">long</font> next = Timestamper.next(); lastTimestamp.set(next); <font color="#0000ff">return</font> next; } <font color="#0000ff">protected</font> <font color="#0000ff">void</font> put(Object key, Object value) { map.put(key, value); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove(Object key) { map.remove(key); listener.onRemove(key); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> setListener(ArpSiteRegionListener listener) { <font color="#0000ff">this</font> .listener = listener; } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> Map&lt;?, ?&gt; toMap() { <font color="#0000ff">return</font> Collections.unmodifiableMap(map); } <font color="#0000ff">@Override</font> <font color="#0000ff">public</font> String toString() { <font color="#0000ff">return</font> <font color="#A31515">"SoftReferenceCache ["</font> + regionName + <font color="#A31515">", "</font> + <font color="#0000ff">this</font> .getSizeInMemory() + <font color="#A31515">']'</font> ; } }</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     基本的なメソッドの実装はかなり簡単です。 追加のsetListener（）メソッドが含まれているため、 <a href="">ArpSiteRegion</a>インターフェースを実装します。これは後でクラスターで作業を実装する必要があります。  TimestampRegionImplにはnextTimestamp / getTimeoutメソッドが必要です。  getClearCalls / getBuildCalls / getHitsPercent / clearなどの追加メソッドは、アプリケーションの<a href="">Cache</a>インターフェースで定義されており、 <a href="">JMXを</a>介してキャッシュを管理するために必要です。 残念ながら、Hibernateはそのような機能を提供しません。 そして、彼はキャッシュの機能についてどのように知っていますか？） 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="">SoftCollectionRegion</a>と<a href="">SoftEntityRegion</a>は非常に似ているので、そのうちの2番目だけを示します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     <ol><li>  <font color="#0000ff">クラス</font> SoftEntityRegionはSoftTransactionalDataRegionの実装を拡張します </li><li>  EntityRegion { </li><li></li><li>  <font color="#008000">/ **</font> </li><li>  <font color="#008000">* @param regionName</font> </li><li>  <font color="#008000">*キャッシュ領域の名前。</font> </li><li>  <font color="#008000">* /</font> </li><li>  SoftEntityRegion（String regionName、 </li><li>  CacheDataDescription cacheDataDescription）{ </li><li>  super（regionName、cacheDataDescription）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> EntityRegionAccessStrategy buildAccessStrategy（AccessType accessType）{ </li><li>  <font color="#0000ff">新しい</font> EntityRegionAccessStrategy（）を<font color="#0000ff">返す</font> { </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean afterInsert（オブジェクトキー、オブジェクト値、オブジェクトバージョン）{ </li><li>  <font color="#0000ff">falseを</font> <font color="#0000ff">返し</font> <font color="#0000ff">ます</font> 。 </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean afterUpdate（オブジェクトキー、オブジェクト値、 </li><li> オブジェクトcurrentVersion、オブジェクトpreviousVersion、SoftLock <font color="#0000ff">ロック</font> ）{ </li><li>  SoftEntityRegion。  <font color="#0000ff">this</font> .remove（キー）; </li><li>  <font color="#0000ff">falseを</font> <font color="#0000ff">返し</font> <font color="#0000ff">ます</font> 。 </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> evict（オブジェクトキー）{ </li><li>  SoftEntityRegion。  <font color="#0000ff">this</font> .remove（キー）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> evictAll（）{ </li><li>  SoftEntityRegion。  <font color="#0000ff">this</font> .clear（）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> Object get（オブジェクトキー、 <font color="#0000ff">長い</font> txTimestamp）{ </li><li>  SoftEntityRegionを<font color="#0000ff">返し</font>ます。  <font color="#0000ff">this</font> .get（キー）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> EntityRegion getRegion（）{ </li><li>  SoftEntityRegionを<font color="#0000ff">返し</font>ます。  <font color="#0000ff">これ</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean insert（オブジェクトキー、オブジェクト値、オブジェクトバージョン）{ </li><li>  <font color="#0000ff">falseを</font> <font color="#0000ff">返し</font> <font color="#0000ff">ます</font> 。 </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">Public</font> SoftLock lockItem（オブジェクトキー、オブジェクトバージョン）{ </li><li>  <font color="#0000ff">nullを</font> <font color="#0000ff">返し</font> <font color="#0000ff">ます</font> 。 </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> SoftLock lockRegion（）{ </li><li>  <font color="#0000ff">nullを</font> <font color="#0000ff">返し</font> <font color="#0000ff">ます</font> 。 </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean putFromLoad（オブジェクトキー、オブジェクト値、 </li><li>  <font color="#0000ff">long</font> txTimestamp、オブジェクトバージョン）{ </li><li>  SoftEntityRegion。  <font color="#0000ff">this</font> .put（キー、値）; </li><li>  <font color="#0000ff">trueを</font> <font color="#0000ff">返し</font> <font color="#0000ff">ます</font> 。 </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean putFromLoad（オブジェクトキー、オブジェクト値、 </li><li>  <font color="#0000ff">long</font> txTimestamp、オブジェクトバージョン、ブール値minimalPutOverride）{ </li><li>  <font color="#0000ff">if</font> （minimalPutOverride &amp;&amp; contains（key））{ </li><li>  <font color="#0000ff">falseを</font> <font color="#0000ff">返し</font> <font color="#0000ff">ます</font> 。 </li><li>  } </li><li></li><li>  SoftEntityRegion。  <font color="#0000ff">this</font> .put（キー、値）; </li><li>  <font color="#0000ff">trueを</font> <font color="#0000ff">返し</font> <font color="#0000ff">ます</font> 。 </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> remove（オブジェクトキー）{ </li><li>  SoftEntityRegion。  <font color="#0000ff">this</font> .remove（キー）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> removeAll（）{ </li><li>  SoftEntityRegion。  <font color="#0000ff">this</font> .clear（）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> unlockItem（オブジェクトキー、SoftLock <font color="#0000ff">ロック</font> ）{ </li><li>  SoftEntityRegion。  <font color="#0000ff">this</font> .remove（キー）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> unlockRegion（SoftLock <font color="#0000ff">ロック</font> ）{ </li><li>  SoftEntityRegion。  <font color="#0000ff">this</font> .clear（）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> boolean update（オブジェクトキー、オブジェクト値、 </li><li> オブジェクトcurrentVersion、オブジェクトpreviousVersion）{ </li><li>  SoftEntityRegion。  <font color="#0000ff">this</font> .remove（キー）; </li><li>  <font color="#0000ff">falseを</font> <font color="#0000ff">返し</font> <font color="#0000ff">ます</font> 。 </li><li>  } </li><li>  }; </li><li>  } </li><li></li><li>  } </li></ol>  <font color="gray">*このソースコードは、 <font color="gray">ソースコードハイライターで</font>強調表示されました。</font> </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     主な作業は、戦略インターフェイスを介して行われます。 個別のインターフェイスを使用するという考え方は、トランザクション実装では、各トランザクションがEntityRegionAccessStrategyの個別のインスタンスを使用するということです。 ただし、当社では、すべてのリクエストをSoftEntityRegionにリダイレクトするだけです。  update（）、unlockItem（）、unlockRegion（）メソッドの実装機能は、EntityAccessStrategyAdapterクラスでスパイされていました。 クラスタの将来の「ねじ込み」の観点から、SoftRegionからのリスナーはremove（）およびclear（）メソッドにのみ応答することに注意することが重要です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     誰がそれらを呼ぶのですか？  Hibernate自体は、個々のオブジェクトでの作業が終了した時点でそれらを呼び出します。 たとえば、クエリを使用して何かをした場合は、常にevict（）またはevictAll（）を呼び出します。 キャッシュを使用したこのような予測可能な作業により、クリア/削除呼び出しを追跡するだけで、将来的にクラスターサポートを簡単に追加できるようになります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     しかし、QueryCacheの使用はそれほど簡単ではありません。 問題は、Hibernate ...がキャッシュから古いリクエストを削除しないことです。 つまり、何かが起こってもキャッシュ内の値は無効になりません。 その動作はトリッキーです。QueryResultsRegionの横にあるTimestampsRegionは、その名前から判断すると、データベース内の個々のテーブルに対する最近の変更のタイムスタンプを含みます。 したがって、データベースクエリを実行する必要がある場合、Hibernateは以下を実行します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  TimestampsRegionからテーブルのタイムスタンプを取得します </li><li>  QueryResultsRegionから結果を取得する </li><li> 結果からタイムスタンプを取得します。 </li><li>  TimestampsRegionから取得したものと比較してください。 値が大きい場合、QueryResultsRegionの結果は最後の変更よりも新しいと見なされ、使用できます。 </li><li> 重要-TimestampsRegionに特定のテーブルの値がない場合、Hibernateはデータが変更されていないと判断します </li><li> 結果のタイムスタンプがTimestampsRegionから取得したタイムスタンプよりも小さい場合、値は廃止されたと見なされます。 ただし、この場合、値はキャッシュから削除されず、データベースから受信したものに置き換えられます </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     この場合、UPDATEまたはINSERTのリクエストの場合、テーブルの新しいタイムスタンプはTimestampsRegionに配置されますが、QueryCacheは通知されません！ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ちなみに、5番目のポイントから、通常の操作では、クラスターがなくても、SoftReferenceを使用してTimestampsRegionに値を保存することはできません。  UpdateTimestampsCacheの説明でさえ、「 <i>基礎となるキャッシュを</i>期限切れ<i>に設定しないことをお勧めします</i> 」-つまり、このキャッシュから値を削除しないでください。 幸いなことに、彼は実際には記憶の多くのスペースを占有しません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     上記の説明から、clear（）/ remove（）の単純なインターセプトでは何も得られないことは明らかです-それらは単に呼び出されません。  QueryCacheのput（）をインターセプトすることは役に立たず、遅すぎる場合があります-タイムスタンプは既に更新されている可能性があります。 したがって、次の2つのオプションが可能です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> クラスターレベルでTimestampsRegionの完全な実装を行います。 つまり、各マシンで発行されたタイムスタンプを追跡し、クラスターレベルで正しく同期させる </li><li> 汚いハックをする </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     残念ながら、CMS Arp.Siteの最初のアプローチは受け入れられないことが判明しました。タイムスタンプの同期は、AtomicLongのような一般的なカウンターを想定していますが、クラスター内で機能しています。 つまり、すべての呼び出しを同期する必要があります-各オブジェクトはQueryCacheキャッシュに追加されます。 そして、これはパフォーマンスに非常に悪い影響を及ぼします-ネットワーク上の同期処理は非同期よりもはるかに高価です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ここで非同期アプローチを実装するために、ダーティハックを作成しました。 つまり、Hibernateがどの値を入れるかを知るようにTimestampCacheを作成しました。  Hibernateは次のバージョンで値のタイプを変更する可能性があるため、これは悪いです。 したがって、これはハックと呼ばれます。 しかし、それは動作します： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     <ol><li>  <font color="#0000ff">クラス</font> TimestampRegionImplはSoftRegionを拡張し、ArpSiteTimestampRegionを実装します{ </li><li>  <font color="#008000">/ **</font> </li><li>  <font color="#008000">*のデフォルトの無操作実装</font> </li><li>  <font color="#008000">* {@link ArpSiteTimestampRegionListener}。</font>  <font color="#008000">クラスターに置き換えられます</font> </li><li>  <font color="#008000">*クラスター拡張機能がインストールされている場合のリスナー</font> </li><li>  <font color="#008000">*</font> </li><li>  <font color="#008000">* @author vlsergey {at} gmail {dot} com</font> </li><li>  <font color="#008000">* /</font> </li><li>  <font color="#0000ff">プライベート</font> <font color="#0000ff">静的</font>最終<font color="#0000ff">クラス</font> NoOpListenerが実装します </li><li>  ArpSiteTimestampRegionListener { </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> onInvalidate（シリアル化可能なスペース）{ </li><li>  <font color="#008000">//操作なし</font> </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> onPreInvalidate（シリアル化可能なスペース）{ </li><li>  <font color="#008000">//操作なし</font> </li><li>  } </li><li></li><li>  } </li><li></li><li>  <font color="#0000ff">private</font> ArpSiteTimestampRegionListener listener = <font color="#0000ff">new</font> NoOpListener（）; </li><li></li><li>  <font color="#008000">/ **</font> </li><li>  <font color="#008000">* @param regionName</font> </li><li>  <font color="#008000">*リージョンの名前。</font> </li><li>  <font color="#008000">* /</font> </li><li>  TimestampRegionImpl（String regionName）{ </li><li>  super（regionName、 <font color="#0000ff">true</font> ）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> evict（オブジェクトキー）{ </li><li>  super.remove（キー）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> evictAll（）{ </li><li>  super.clear（）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> Object get（オブジェクトキー）{ </li><li>  <font color="#0000ff">return</font> super.get（キー）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> invalidate（シリアル化可能なスペース）{ </li><li>  Long ts = Long.valueOf（nextTimestamp（））; </li><li>  super.put（スペース、ts）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> preInvalidate（シリアル化可能なスペース）{ </li><li> 長いts = Long.valueOf（nextTimestamp（）+ getTimeout（））; </li><li>  super.put（スペース、ts）; </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> put（オブジェクトキー、オブジェクト値）{ </li><li>  super.put（キー、値）; </li><li></li><li> 最終シリアル化可能スペース=（シリアル化可能）キー。 </li><li> 最終的な長いタイムスタンプ=（長い）値; </li><li></li><li> 最終的なブールinFuture = timestamp.longValue（）&gt; lastTimestamp.get（）; </li><li>  <font color="#0000ff">if</font> （inFuture）{ </li><li>  listener.onPreInvalidate（スペース）; </li><li>  } <font color="#0000ff">else</font> { </li><li>  listener.onInvalidate（スペース）; </li><li>  } </li><li>  } </li><li></li><li>  <font color="#0000ff">@Override</font> </li><li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> setTimstampListener（ </li><li>  ArpSiteTimestampRegionListener timestampListener）{ </li><li>  <font color="#0000ff">this</font> .listener = timestampListener; </li><li>  } </li><li>  } </li></ol>  <font color="gray">*このソースコードは、 <font color="gray">ソースコードハイライターで</font>強調表示されました。</font> </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     主な作業はput（）メソッドで行われます。 メソッドのロジックを理解するには、Hibernate cタイムスタンプキャッシュの機能について詳しく調べる必要があります。 つまり、3つの操作が実行されます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li> 操作を取得-リージョンのタイムスタンプを取得します（Serializableの後ろに隠れています） </li><li> 無効な操作-新しいタイムスタンプを取得し、リージョン用にキャッシュします </li><li> 操作の事前無効化-新しいタイムスタンプを取得し、60秒を追加してキャッシュします </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     実装では、Hibernateが実行する最後の2つのアクションのどちらを追跡しようとしており、将来、このアクションをクラスター内のすべてのノードに拡張します。 もちろん、これを行うには、別のリスナー（ <a href="">ArpSiteTimestampRegionListener</a> ）が必要です。 キャッシュに配置された値によって無効化と事前無効化の違いを追跡し、その後リスナーに通知されます。 また、クラスターでは、他のマシンからの通知のために、Hibernateロジックを繰り返す2つのメソッド（ <a href="">ArpSiteTimestampRegion</a>インターフェースからアクセス可能）を無効化およびpreInvalidateにしました。 実装の特性は、クラスター内のキャッシュを無効にするために、異なるマシンの現在のタイムスタンプ値を知る必要がないことです。 たとえば、無効化（領域）メソッドは、 <i>現在の</i>マシンでQueryCacheを無効にするために、 <i>現在の</i>マシンで新しいタイムスタンプを取得します。 彼は、Hibernateが障害を要求したマシンの重要性に興味がありません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ちなみに、Hibernate自体のロジックは、気にする人は、クラス<a href="">UpdateTimestampsCache</a>および<a href="">StandardQueryCacheにあり</a>ます。 変更された場合、TimestampRegionImplの実装を書き換える必要があります。 これは、ハックに対して支払う価格です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> 続く </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     このトピックでは、ノッチを備えたキャッシュの実装がどのように行われ、別々のマシン上の別々のキャッシュを単一のクラスターソリューションにリンクできるようにするかを説明しました。 ノッチは次のとおりです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      -SoftRegionおよびTimestampRegionImplクラスは、イベントについてクラスター内の他のマシンに通知する必要がある場合、ArpSiteRegionListenerおよびArpSiteTimestampRegionListenerインターフェイスメソッドを呼び出します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      -次に、ArpSiteRegionおよびArpSiteTimestampRegionインターフェースを介して、クラスター内のイベントを通知する機能を提供します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     また、クラスターでの作業についてはまだ説明されていませんが、キャッシュは既に機能しています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次のトピック-JGroupsを使用してクラスターを作成する方法。 </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J91323/index.html">Ext JS-コンポーネントを正しく書くことを学びます。 継承とネストされた構成</a></li>
<li><a href="../J91327/index.html">Facebookでサイトをソーシャル化</a></li>
<li><a href="../J91328/index.html">Hibernateのカスタムタイプ</a></li>
<li><a href="../J91331/index.html">BinaryHTTPServiceまたはHTTPServiceがByteArrayデータを受け入れられるようにする方法</a></li>
<li><a href="../J91332/index.html">チーズで作られた月</a></li>
<li><a href="../J91335/index.html">第2回オープンテクノロジーフォーラム開催</a></li>
<li><a href="../J91336/index.html">ToriBash-完全な暴力</a></li>
<li><a href="../J91341/index.html">便利なjQueryプラグインのカップル</a></li>
<li><a href="../J91342/index.html">招待状（招待状）では、以前とは異なります...</a></li>
<li><a href="../J91343/index.html">判決から1年後の海賊湾</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
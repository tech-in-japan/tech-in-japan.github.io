<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤘 🤞 🚓 Yii2用のシンプルなデーモンシステム 👾 💦 🙇🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事では、PHPのデーモンシステムの実装の主なニュアンスを明らかにし、Yii2コン​​ソールコマンドを悪魔化するように教えます。 
  
 
  
 過去3年間、私は1つのグループの企業向けに十分な規模の企業ポータルを開発および開発してきました。 私は、多くの人と同じように、ビジネスが必要とする...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>Yii2用のシンプルなデーモンシステム</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/307464/"> この記事では、PHPのデーモンシステムの実装の主なニュアンスを明らかにし、Yii2コン​​ソールコマンドを悪魔化するように教えます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     過去3年間、私は1つのグループの企業向けに十分な規模の企業ポータルを開発および開発してきました。 私は、多くの人と同じように、ビジネスが必要とするタスクを解決するときにタイムアウトが収まらないという問題に遭遇しました。  30万行のExcelでレポートを作成し、1500文字のメーリングリストを送信します。 当然、そのようなタスクはバックグラウンドタスク、デーモン、およびcrontabで解決する必要があります。 記事の枠組みでは、王冠と悪魔の比較は行いません。このような問題を解決するために悪魔を選びました。 同時に、私たちにとって重要な要件は、それぞれバックエンド用にすでに記述されたすべてのものにアクセスできることでした。デーモンはYii2フレームワークの継続である必要があります。 同じ理由で、phpDaemonのような既製のソリューションは私たちに適合しませんでした。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     カットの下で、私が得たYii2に悪魔を実装するための既製のソリューション。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      PHPのデーモンのテーマは、うらやましい規則性で上昇します（1、2、3、 <a href="https://habrahabr.ru/company/badoo/blog/252809/">およびbadooの連中は、接続を失うことなくそれらを再起動します</a> ）。 おそらく私の<s>自転車は</s> 、人気のあるフレームワークで悪魔を実行<s>する</s>簡単な方法が役立つでしょう。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> いくつかの基本 </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     プロセスが悪魔になるためには、次のものが必要です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li> コンソールおよび標準入出力ストリームからスクリプトをアンバインドします。 </li><li> メインコードの実行を無限ループでラップします。 </li><li> プロセス制御メカニズムを実装します。 </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5> コンソールから取り外します </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     開始するには、標準ストリームSTDIN、STOUT、STDERRを閉じます。 しかし、PHPを使用しないと、最初のオープンストリーム標準になるため、/ dev / nullで開きます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_resource(STDIN)) { fclose(STDIN); $stdIn = fopen(<span class="hljs-string"><span class="hljs-string">'/dev/null'</span></span>, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_resource(STDOUT)) { fclose(STDOUT); $stdOut = fopen(<span class="hljs-string"><span class="hljs-string">'/dev/null'</span></span>, <span class="hljs-string"><span class="hljs-string">'ab'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_resource(STDERR)) { fclose(STDERR); $stdErr = fopen(<span class="hljs-string"><span class="hljs-string">'/dev/null'</span></span>, <span class="hljs-string"><span class="hljs-string">'ab'</span></span>); }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次に、プロセスをforkし、forkをメインプロセスにします。 ドナープロセス-完了。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs">$pid = pcntl_fork(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($pid == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;halt(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::EXIT_CODE_ERROR, <span class="hljs-string"><span class="hljs-string">'pcntl_fork() rise error'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ($pid) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;halt(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::EXIT_CODE_NORMAL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { posix_setsid(); }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5> 無限ループと制御 </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     私はすべてがサイクルで理解されていると思います。 ただし、必要な制御メカニズムをより詳細に検討する必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6> すでに実行中のプロセスを修正する </h6>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ここではすべてが簡単です-デーモンを起動すると、PIDがその名前のファイルに格納され、作業の最後にこのファイルが爆発します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  POSIX信号処理 </h6>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     デーモンは、オペレーティングシステムからの信号を正しく処理する必要があります。 シグナルを受信すると、SIGTERMはスムーズにシャットダウンします。 これはいくつかのことで実現されます。まず、受信した信号を処理する関数を定義します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs">pcntl_signal(SIGTERM, [<span class="hljs-string"><span class="hljs-string">'MyClassName'</span></span>, <span class="hljs-string"><span class="hljs-string">'mySignalHandlerFunction'</span></span>]);</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     次に、信号処理関数で、クラスの静的プロパティの割り当てをtrueに設定します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signalHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($signo, $pid = null, $status = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$stopFlag = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     そして第三に、無限ループはそれほど無限ではないはずです。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$stopFlag) { pcntl_signal_dispatch(); }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">PHPの異なるバージョンでの信号処理の機能</b> <div class="spoiler_text">  PHP &lt;5.3.0では、特別な<a href="http://php.net/manual/ru/control-structures.declare.php">宣言</a>ディレクティブ<a href="http://php.net/manual/ru/control-structures.declare.php">（ticks = N）が</a>信号の配信<a href="http://php.net/manual/ru/control-structures.declare.php">に</a>使用されました。  tickは、declareブロック内のパーサーによって実行される低レベルの操作ごとに発生するイベントです。 信号の分配は設定に従って行われました。 値が小さすぎるとパフォーマンスが低下し、値が大きすぎると信号処理がタイミングよく行われません。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      PHP&gt; = 5.3.0では、 <a href="http://php.net/manual/ru/function.pcntl-signal-dispatch.php">pcntl_signal_dispatch（）</a>関数が登場しました。この関数は、手動でシグナルを配信するために呼び出すことができます。これは各反復後に行います。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     そして最後に、PHP 7.1では<a href="https://wiki.php.net/rfc/async_signals">、シグナルの非同期配信が</a>利用可能になり、オーバーヘッドや手動で関数を呼び出すことなく、ほぼ瞬時にシグナルを受信できるようになります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     これで、オペレーティングシステムからコマンドを受信すると、スクリプトは現在の反復を静かに終了し、ループを終了します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6> メモリリーク監視 </h6>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     残念ながら、デーモンが再起動せずに長時間動作すると、メモリが流れ始めます。 リーク率は、使用する機能によって異なります。 私たちの実践から、最もひどく流れていたのは、標準のSoapClientクラスを介してリモートSOAPサービスと連携するデーモンでした。 したがって、これを監視し、定期的に再起動する必要があります。 サイクルを漏れ制御条件で補完します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$stopFlag) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (memory_get_usage() &gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;memoryLimit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } pcntl_signal_dispatch(); }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Yiiのコードはどこにありますか？ </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     ソースはGithub- <a href="https://github.com/vyants/yii2-daemon">yii2-daemon</a>に投稿されており、パッケージはcomposerを介してインストールすることもできます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     パッケージは、基本クラスDaemonControllerとクラスWatcherDaemonControllerの2つの抽象クラスのみで構成されています。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">デーモンコントローラー</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">vyants</span></span>\<span class="hljs-title"><span class="hljs-title">daemon</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">NotSupportedException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">console</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">helpers</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class DaemonController * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> Vladimir Yants &lt;vladimir.yants</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@gmail</span></span></span><span class="hljs-comment">.com&gt; */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DaemonController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> EVENT_BEFORE_JOB = <span class="hljs-string"><span class="hljs-string">"beforeJob"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> EVENT_AFTER_JOB = <span class="hljs-string"><span class="hljs-string">"afterJob"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> EVENT_BEFORE_ITERATION = <span class="hljs-string"><span class="hljs-string">"beforeIteration"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> EVENT_AFTER_ITERATION = <span class="hljs-string"><span class="hljs-string">"afterIteration"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $demonize boolean Run controller as Daemon * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@default</span></span></span><span class="hljs-comment"> false */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $demonize = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $isMultiInstance boolean allow daemon create a few instances * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@see</span></span></span><span class="hljs-comment"> $maxChildProcesses * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@default</span></span></span><span class="hljs-comment"> false */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $isMultiInstance = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $parentPID int main procces pid */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $parentPID; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $maxChildProcesses int max daemon instances * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@default</span></span></span><span class="hljs-comment"> 10 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $maxChildProcesses = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $currentJobs [] array of running instances */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $currentJobs = []; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int Memory limit for daemon, must bee less than php memory_limit * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@default</span></span></span><span class="hljs-comment"> 32M */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $memoryLimit = <span class="hljs-number"><span class="hljs-number">268435456</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> boolean used for soft daemon stop, set 1 to stop */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $stopFlag = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int Delay between task list checking * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@default</span></span></span><span class="hljs-comment"> 5sec */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $sleep = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $pidDir = <span class="hljs-string"><span class="hljs-string">"@runtime/daemons/pids"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $logDir = <span class="hljs-string"><span class="hljs-string">"@runtime/daemons/logs"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $stdIn; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $stdOut; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $stdErr; <span class="hljs-comment"><span class="hljs-comment">/** * Init function */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::init(); <span class="hljs-comment"><span class="hljs-comment">//set PCNTL signal handlers pcntl_signal(SIGTERM, ['vyants\daemon\DaemonController', 'signalHandler']); pcntl_signal(SIGINT, ['vyants\daemon\DaemonController', 'signalHandler']); pcntl_signal(SIGHUP, ['vyants\daemon\DaemonController', 'signalHandler']); pcntl_signal(SIGUSR1, ['vyants\daemon\DaemonController', 'signalHandler']); pcntl_signal(SIGCHLD, ['vyants\daemon\DaemonController', 'signalHandler']); } function __destruct() { $this-&gt;deletePid(); } /** * Adjusting logger. You can override it. */ protected function initLogger() { $targets = \Yii::$app-&gt;getLog()-&gt;targets; foreach ($targets as $name =&gt; $target) { $target-&gt;enabled = false; } $config = [ 'levels' =&gt; ['error', 'warning', 'trace', 'info'], 'logFile' =&gt; \Yii::getAlias($this-&gt;logDir) . DIRECTORY_SEPARATOR . $this-&gt;getProcessName() . '.log', 'logVars' =&gt; [], 'except' =&gt; [ 'yii\db\*', // Don't include messages from db ], ]; $targets['daemon'] = new \yii\log\FileTarget($config); \Yii::$app-&gt;getLog()-&gt;targets = $targets; \Yii::$app-&gt;getLog()-&gt;init(); } /** * Daemon worker body * * @param $job * * @return boolean */ abstract protected function doJob($job); /** * Base action, you can\t override or create another actions * @return bool * @throws NotSupportedException */ final public function actionIndex() { if ($this-&gt;demonize) { $pid = pcntl_fork(); if ($pid == -1) { $this-&gt;halt(self::EXIT_CODE_ERROR, 'pcntl_fork() rise error'); } elseif ($pid) { $this-&gt;cleanLog(); $this-&gt;halt(self::EXIT_CODE_NORMAL); } else { posix_setsid(); $this-&gt;closeStdStreams(); } } $this-&gt;changeProcessName(); //run loop return $this-&gt;loop(); } /** * Set new process name */ protected function changeProcessName() { //rename process if (version_compare(PHP_VERSION, '5.5.0') &gt;= 0) { cli_set_process_title($this-&gt;getProcessName()); } else { if (function_exists('setproctitle')) { setproctitle($this-&gt;getProcessName()); } else { \Yii::error('Can\'t find cli_set_process_title or setproctitle function'); } } } /** * Close std streams and open to /dev/null * need some class properties */ protected function closeStdStreams() { if (is_resource(STDIN)) { fclose(STDIN); $this-&gt;stdIn = fopen('/dev/null', 'r'); } if (is_resource(STDOUT)) { fclose(STDOUT); $this-&gt;stdOut = fopen('/dev/null', 'ab'); } if (is_resource(STDERR)) { fclose(STDERR); $this-&gt;stdErr = fopen('/dev/null', 'ab'); } } /** * Prevent non index action running * * @param \yii\base\Action $action * * @return bool * @throws NotSupportedException */ public function beforeAction($action) { if (parent::beforeAction($action)) { $this-&gt;initLogger(); if ($action-&gt;id != "index") { throw new NotSupportedException( "Only index action allowed in daemons. So, don't create and call another" ); } return true; } else { return false; } } /** *    * * @param string $actionID * * @return array */ public function options($actionID) { return [ 'demonize', 'taskLimit', 'isMultiInstance', 'maxChildProcesses', ]; } /** * Extract current unprocessed jobs * You can extract jobs from DB (DataProvider will be great), queue managers (ZMQ, RabbiMQ etc), redis and so on * * @return array with jobs */ abstract protected function defineJobs(); /** * Fetch one task from array of tasks * * @param Array * * @return mixed one task */ protected function defineJobExtractor(&amp;$jobs) { return array_shift($jobs); } /** * Main Loop * * * @return boolean 0|1 */ final private function loop() { if (file_put_contents($this-&gt;getPidPath(), getmypid())) { $this-&gt;parentPID = getmypid(); \Yii::trace('Daemon ' . $this-&gt;getProcessName() . ' pid ' . getmypid() . ' started.'); while (!self::$stopFlag) { if (memory_get_usage() &gt; $this-&gt;memoryLimit) { \Yii::trace('Daemon ' . $this-&gt;getProcessName() . ' pid ' . getmypid() . ' used ' . memory_get_usage() . ' bytes on ' . $this-&gt;memoryLimit . ' bytes allowed by memory limit'); break; } $this-&gt;trigger(self::EVENT_BEFORE_ITERATION); $this-&gt;renewConnections(); $jobs = $this-&gt;defineJobs(); if ($jobs &amp;&amp; !empty($jobs)) { while (($job = $this-&gt;defineJobExtractor($jobs)) !== null) { //if no free workers, wait if ($this-&gt;isMultiInstance &amp;&amp; (count(static::$currentJobs) &gt;= $this-&gt;maxChildProcesses)) { \Yii::trace('Reached maximum number of child processes. Waiting...'); while (count(static::$currentJobs) &gt;= $this-&gt;maxChildProcesses) { sleep(1); pcntl_signal_dispatch(); } \Yii::trace( 'Free workers found: ' . ($this-&gt;maxChildProcesses - count(static::$currentJobs)) . ' worker(s). Delegate tasks.' ); } pcntl_signal_dispatch(); $this-&gt;runDaemon($job); } } else { sleep($this-&gt;sleep); } pcntl_signal_dispatch(); $this-&gt;trigger(self::EVENT_AFTER_ITERATION); } \Yii::info('Daemon ' . $this-&gt;getProcessName() . ' pid ' . getmypid() . ' is stopped.'); return self::EXIT_CODE_NORMAL; } $this-&gt;halt(self::EXIT_CODE_ERROR, 'Can\'t create pid file ' . $this-&gt;getPidPath()); } /** * Delete pid file */ protected function deletePid() { $pid = $this-&gt;getPidPath(); if (file_exists($pid)) { if (file_get_contents($pid) == getmypid()) { unlink($this-&gt;getPidPath()); } } else { \Yii::error('Can\'t unlink pid file ' . $this-&gt;getPidPath()); } } /** * PCNTL signals handler * * @param $signo * @param null $pid * @param null $status */ final static function signalHandler($signo, $pid = null, $status = null) { switch ($signo) { case SIGINT: case SIGTERM: //shutdown self::$stopFlag = true; break; case SIGHUP: //restart, not implemented break; case SIGUSR1: //user signal, not implemented break; case SIGCHLD: if (!$pid) { $pid = pcntl_waitpid(-1, $status, WNOHANG); } while ($pid &gt; 0) { if ($pid &amp;&amp; isset(static::$currentJobs[$pid])) { unset(static::$currentJobs[$pid]); } $pid = pcntl_waitpid(-1, $status, WNOHANG); } break; } } /** * Tasks runner * * @param string $job * * @return boolean */ final public function runDaemon($job) { if ($this-&gt;isMultiInstance) { $this-&gt;flushLog(); $pid = pcntl_fork(); if ($pid == -1) { return false; } elseif ($pid !== 0) { static::$currentJobs[$pid] = true; return true; } else { $this-&gt;cleanLog(); $this-&gt;renewConnections(); //child process must die $this-&gt;trigger(self::EVENT_BEFORE_JOB); $status = $this-&gt;doJob($job); $this-&gt;trigger(self::EVENT_AFTER_JOB); if ($status) { $this-&gt;halt(self::EXIT_CODE_NORMAL); } else { $this-&gt;halt(self::EXIT_CODE_ERROR, 'Child process #' . $pid . ' return error.'); } } } else { $this-&gt;trigger(self::EVENT_BEFORE_JOB); $status = $this-&gt;doJob($job); $this-&gt;trigger(self::EVENT_AFTER_JOB); return $status; } } /** * Stop process and show or write message * * @param $code int -1|0|1 * @param $message string */ protected function halt($code, $message = null) { if ($message !== null) { if ($code == self::EXIT_CODE_ERROR) { \Yii::error($message); if (!$this-&gt;demonize) { $message = Console::ansiFormat($message, [Console::FG_RED]); } } else { \Yii::trace($message); } if (!$this-&gt;demonize) { $this-&gt;writeConsole($message); } } if ($code !== -1) { \Yii::$app-&gt;end($code); } } /** * Renew connections * @throws \yii\base\InvalidConfigException * @throws \yii\db\Exception */ protected function renewConnections() { if (isset(\Yii::$app-&gt;db)) { \Yii::$app-&gt;db-&gt;close(); \Yii::$app-&gt;db-&gt;open(); } } /** * Show message in console * * @param $message */ private function writeConsole($message) { $out = Console::ansiFormat('[' . date('dmY H:i:s') . '] ', [Console::BOLD]); $this-&gt;stdout($out . $message . "\n"); } /** * @param string $daemon * * @return string */ public function getPidPath($daemon = null) { $dir = \Yii::getAlias($this-&gt;pidDir); if (!file_exists($dir)) { mkdir($dir, 0744, true); } $daemon = $this-&gt;getProcessName($daemon); return $dir . DIRECTORY_SEPARATOR . $daemon; } /** * @return string */ public function getProcessName($route = null) { if (is_null($route)) { $route = \Yii::$app-&gt;requestedRoute; } return str_replace(['/index', '/'], ['', '.'], $route); } /** * If in daemon mode - no write to console * * @param string $string * * @return bool|int */ public function stdout($string) { if (!$this-&gt;demonize &amp;&amp; is_resource(STDOUT)) { return parent::stdout($string); } else { return false; } } /** * If in daemon mode - no write to console * * @param string $string * * @return int */ public function stderr($string) { if (!$this-&gt;demonize &amp;&amp; is_resource(\STDERR)) { return parent::stderr($string); } else { return false; } } /** * Empty log queue */ protected function cleanLog() { \Yii::$app-&gt;log-&gt;logger-&gt;messages = []; } /** * Empty log queue */ protected function flushLog($final = false) { \Yii::$app-&gt;log-&gt;logger-&gt;flush($final); } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">WatcherDaemonController</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">vyants</span></span>\<span class="hljs-title"><span class="hljs-title">daemon</span></span>\<span class="hljs-title"><span class="hljs-title">controllers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">vyants</span></span>\<span class="hljs-title"><span class="hljs-title">daemon</span></span>\<span class="hljs-title"><span class="hljs-title">DaemonController</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * watcher-daemon - check another daemons and run it if need * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> Vladimir Yants &lt;vladimir.yants</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@gmail</span></span></span><span class="hljs-comment">.com&gt; */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WatcherDaemonController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DaemonController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string subfolder in console/controllers */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $daemonFolder = <span class="hljs-string"><span class="hljs-string">'daemons'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> boolean flag for first iteration */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $firstIteration = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Prevent double start */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $pid_file = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getPidPath(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($pid_file) &amp;&amp; ($pid = file_get_contents($pid_file)) &amp;&amp; file_exists(<span class="hljs-string"><span class="hljs-string">"/proc/$pid"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;halt(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::EXIT_CODE_ERROR, <span class="hljs-string"><span class="hljs-string">'Another Watcher is already running.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::init(); } <span class="hljs-comment"><span class="hljs-comment">/** * Job processing body * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $job array * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> boolean */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($job)</span></span></span><span class="hljs-function"> </span></span>{ $pid_file = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getPidPath($job[<span class="hljs-string"><span class="hljs-string">'daemon'</span></span>]); \Yii::trace(<span class="hljs-string"><span class="hljs-string">'Check daemon '</span></span> . $job[<span class="hljs-string"><span class="hljs-string">'daemon'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($pid_file)) { $pid = file_get_contents($pid_file); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;isProcessRunning($pid)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($job[<span class="hljs-string"><span class="hljs-string">'enabled'</span></span>]) { \Yii::trace(<span class="hljs-string"><span class="hljs-string">'Daemon '</span></span> . $job[<span class="hljs-string"><span class="hljs-string">'daemon'</span></span>] . <span class="hljs-string"><span class="hljs-string">' running and working fine'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { \Yii::warning(<span class="hljs-string"><span class="hljs-string">'Daemon '</span></span> . $job[<span class="hljs-string"><span class="hljs-string">'daemon'</span></span>] . <span class="hljs-string"><span class="hljs-string">' running, but disabled in config. Send SIGTERM signal.'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($job[<span class="hljs-string"><span class="hljs-string">'hardKill'</span></span>]) &amp;&amp; $job[<span class="hljs-string"><span class="hljs-string">'hardKill'</span></span>]) { posix_kill($pid, SIGKILL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { posix_kill($pid, SIGTERM); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } } \Yii::error(<span class="hljs-string"><span class="hljs-string">'Daemon pid not found.'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($job[<span class="hljs-string"><span class="hljs-string">'enabled'</span></span>]) { \Yii::trace(<span class="hljs-string"><span class="hljs-string">'Try to run daemon '</span></span> . $job[<span class="hljs-string"><span class="hljs-string">'daemon'</span></span>] . <span class="hljs-string"><span class="hljs-string">'.'</span></span>); $command_name = $job[<span class="hljs-string"><span class="hljs-string">'daemon'</span></span>] . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'index'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//flush log before fork $this-&gt;flushLog(true); //run daemon $pid = pcntl_fork(); if ($pid === -1) { $this-&gt;halt(self::EXIT_CODE_ERROR, 'pcntl_fork() returned error'); } elseif ($pid === 0) { $this-&gt;cleanLog(); \Yii::$app-&gt;requestedRoute = $command_name; \Yii::$app-&gt;runAction("$command_name", ['demonize' =&gt; 1]); $this-&gt;halt(0); } else { $this-&gt;initLogger(); \Yii::trace('Daemon ' . $job['daemon'] . ' is running with pid ' . $pid); } } \Yii::trace('Daemon ' . $job['daemon'] . ' is checked.'); return true; } /** * @return array */ protected function defineJobs() { if ($this-&gt;firstIteration) { $this-&gt;firstIteration = false; } else { sleep($this-&gt;sleep); } return $this-&gt;getDaemonsList(); } /** * Daemons for check. Better way - get it from database * [ * ['daemon' =&gt; 'one-daemon', 'enabled' =&gt; true] * ... * ['daemon' =&gt; 'another-daemon', 'enabled' =&gt; false] * ] * @return array */ abstract protected function getDaemonsList(); /** * @param $pid * * @return bool */ public function isProcessRunning($pid) { return file_exists("/proc/$pid"); } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5> デーモンコントローラー </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     これは、すべてのデーモンの親クラスです。 最小限の悪魔の例を次に示します。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">console</span></span>\<span class="hljs-title"><span class="hljs-title">controllers</span></span>\<span class="hljs-title"><span class="hljs-title">daemons</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">vyants</span></span>\<span class="hljs-title"><span class="hljs-title">daemon</span></span>\<span class="hljs-title"><span class="hljs-title">DaemonController</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DaemonController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $job * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> boolean */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($job)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//do some job return true; } /** * @return array */ protected function defineJobs() { return []; } }</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      defineJobs（）関数は、実行する一連のタスクを返す必要があります。 デフォルトでは、配列を返すことが期待されています。 たとえばMongoCursorを返したい場合は、defineJobExtractor（）をオーバーライドする必要があります。  doJob（）関数は、入力用の1つのタスクを受け取り、それを使用して必要な操作を実行し、ソース内の特定のタスクを2回目に落ちないように満たす必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     可能なパラメーターと設定： 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b>demonize-</b>このパラメーターは、スクリプトがデーモン化されるか、コンソールアプリケーションとして動作するかを決定します。 このパラメーターは、コンソールから設定できます。--demonize = 1 </li><li>  <b>isMultiInstanceおよびmaxChildProcesses-</b>デーモンが独自のコピーを作成できるかどうか、および同時に動作できる最大数を決定します。 この機能により、複数のタスクを並行して実行できます。  doJobは子プロセスで実行され、親プロセスは子孫にタスクを委任するだけで、その数が許可されている最大数を超えないようにします。 非常に時間のかかるいくつかのタスクを実行するために十分なサーバーリソースがある場合に非常に便利です。 デフォルトでは、この動作はオフになっています。 パラメーターはコンソールからも利用できます：--isMultiInstance = 1 --maxChildProcesses = 2 </li><li>  <b>memoryLimit-</b>デーモンがメモリを消費するためのしきい値。スタンバイモードのデーモンがこのしきい値を超えた場合、sippokuを気高くコミットします。 前に示したように、リークの結果としてデーモンによって消費されるメモリのサイズを削減します。 </li><li>  <b>sleep-</b>タスクのチェック間でデーモンが<b>スリープ状態</b>になる秒単位の時間。 デーモンは、defineJobが空を返し、タスクがある間デーモンがスリープしない場合にのみスリープ状態になります。 したがって、defineJobsはタスクの静的リストを返すべきではありません。そうしないと、デーモンはタスクを際限なく打ち続けて休みます。 </li><li>  <b>pidDirおよびlogDir-</b>ログとpid-sを保存する方法、Yiiエイリアスをサポートします。 デフォルトでは、「@ runtime / daemons / pids」および「@ runtime / daemons / logs」 </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6> 接続損失の問題 </h6>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      fork（）操作中に、親プロセスで確立された接続が子プロセスで機能しなくなります。 この問題を回避するために、すべての分岐の後、renewConnections（）関数呼び出しが行われます。 デフォルトでは、この関数はYii :: $ app-&gt; dbのみを再接続しますが、これをオーバーライドして、子プロセスで接続する必要がある他のソースを追加できます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6> ロギング </h6>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     デーモンは、標準のYiiロガーを再構成します。 デフォルトの動作に満足できない場合は、initLogger（）関数をオーバーライドします。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  WatcherDaemonController </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     これはほぼ完成した悪魔のオブザーバーです。 このデーモンのタスクは、他のデーモンを監視し、必要に応じてそれらを開始および停止することです。  2回起動することはできないため、crontabで安全に実行できます。 使用を開始するには、コンソール/コントローラーにデーモンフォルダーを作成し、次の形式のクラスを配置する必要があります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">console</span></span>\<span class="hljs-title"><span class="hljs-title">controllers</span></span>\<span class="hljs-title"><span class="hljs-title">daemons</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">vyants</span></span>\<span class="hljs-title"><span class="hljs-title">daemon</span></span>\<span class="hljs-title"><span class="hljs-title">controllers</span></span>\<span class="hljs-title"><span class="hljs-title">WatcherDaemonController</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class WatcherController */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WatcherController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WatcherDaemonController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $sleep = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDaemonsList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [<span class="hljs-string"><span class="hljs-string">'daemon'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'daemons/test'</span></span>, <span class="hljs-string"><span class="hljs-string">'enabled'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>] ]; } }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     定義する必要がある関数は、getDaemonsList（）の1つだけです。この関数は、監視するデーモンのリストを返します。 最も単純な形式では、コードに配線された配列ですが、この場合、その場でリストを変更することはできません。 デーモンのリストをデータベースまたは別のファイルに入れて、そこから毎回取得します。 この場合、ウォッチャーは自身を再起動せずにデーモンをオンまたはオフにできます。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4> おわりに </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     現在、電子メールメッセージの送信からレポートの生成、異なるシステム間でのデータの更新まで、さまざまなタスクを実行する50以上のデーモンがあります。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     デーモンは、MySQL、RabbitMQ、リモートWebサービスなど、さまざまなタスクのソースで動作します。 フライトは正常です。 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     もちろん、PHPのデーモンをGoの同じデーモンと比較することはできません。 しかし、開発速度が速いこと、すでに記述されたコードを再利用できること、および別の言語でチームを学ぶ必要がないことは、短所を上回ります。 </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../J307456/index.html">IXIA ThreatARMOR：攻撃の減少、SIEMアラームの減少、ROIの改善</a></li>
<li><a href="../J307458/index.html">チャットボットとアプリ：誰が誰ですか？</a></li>
<li><a href="../J30746/index.html">大きな時計はあなたのダイヤルを保存することもできます</a></li>
<li><a href="../J307460/index.html">クライアントに話をさせる5つの方法</a></li>
<li><a href="../J307462/index.html">サイトの可用性を監視するのはなぜですか？ HostTrackerサービスの概要</a></li>
<li><a href="../J307466/index.html">オープンデータプログラミングコンテスト：バジェットスプリント</a></li>
<li><a href="../J307468/index.html">私がウェブで仕事をするのが好きな理由。 レミー・シャープ</a></li>
<li><a href="../J307474/index.html">最小限の実行可能なUX：SaaS（サービスアプリケーション）の設計</a></li>
<li><a href="../J307478/index.html">データベースを使用せずにアスタリスクで電話番号によって地域を決定する</a></li>
<li><a href="../J30748/index.html">仮想オフィス用の無料ツール</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>
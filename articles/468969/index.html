<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEDBM7F51Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FEDBM7F51Q');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíå üòî ‚è∞ Create Google users from PowerShell via API ‚õ©Ô∏è üîö üë©üèº‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
  
 
  
 This article will describe how PowerShell interacts with the Google API to manipulate G Suite users. 
  
 
  
 In the organization, w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script>document.write('<script src="https://pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://tech-in-japan.github.io/index.html"></a>
    <div class="page-header-text">Clever Geek Handbook</div>
  </header>
  <section class="page js-page"><h1>Create Google users from PowerShell via API</h1><div class="post__text post__text-html js-mediator-article">  Hello! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This article will describe how PowerShell interacts with the Google API to manipulate G Suite users. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the organization, we use several internal and cloud services.  For the most part, authorization in them comes down to Google or Active Directory, between which we cannot maintain a replica, respectively, when a new employee is released, you need to create / enable an account in these two systems.  To automate the process, we decided to write a script that collects information and sends it to both services. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  <font color="#5D8DDF">Login</font> </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Composing the requirements, we decided to use real people as administrators for authorization, this simplifies the analysis of actions in case of accidental or intentional massive changes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The Google APIs use the OAuth 2.0 protocol for authentication and authorization.  Use cases and a more detailed description can be found here: <a href="https://developers.google.com/identity/protocols/OAuth2">Using OAuth 2.0 to Access Google APIs</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I chose the script that is used for authorization in desktop applications.  There is also an option to use a service account that does not require unnecessary movements from the user. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The image below is a schematic description of the selected scenario from the Google page. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/wx/sp/rw/wxsprwm-uqyd1koa-2xx4sgjkku.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  First, we send the user to the authentication page in the Google account, indicating GET parameters: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  application id </li><li>  areas that the application needs access to </li><li>  address to which the user will be redirected after completion of the procedure </li><li>  the way we will update the token </li><li>  Security Code </li><li>  verification code transmission format </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li>  After authorization is completed, the user will be redirected to the page specified in the first request, with an error or authorization code transmitted by GET parameters </li><li>  The application (script) will need to get these parameters and, if the code is received, execute the following request for tokens </li><li>  If the request is correct, the Google API returns: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Access token with which we can make requests </li><li>  Validity of this token </li><li>  Refresh token needed to update Access token. </li></ul></li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First you need to go to the Google API console: <a href="https://console.developers.google.com/apis/credentials">Credentials - Google API Console</a> , select the application you need and in the Credentials section create the client OAuth identifier.  In the same place (or later, in the properties of the created identifier), you need to specify the addresses to which redirection is allowed.  In our case, it will be several localhost entries with different ports (see below). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To make it easier to read the script algorithm, you can output the first steps in a separate function that will return Access and refresh tokens for the application: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cs hljs">$client_secret = <span class="hljs-string"><span class="hljs-string">'Our Client Secret'</span></span> $client_id = <span class="hljs-string"><span class="hljs-string">'Our Client ID'</span></span> function Get-GoogleAuthToken { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (-not [System.Net.HttpListener]::IsSupported) { <span class="hljs-string"><span class="hljs-string">"HttpListener is not supported."</span></span> exit <span class="hljs-number"><span class="hljs-number">1</span></span> } $codeverifier = -<span class="hljs-keyword"><span class="hljs-keyword">join</span></span> ((<span class="hljs-number"><span class="hljs-number">65.</span></span><span class="hljs-number"><span class="hljs-number">.90</span></span>) + (<span class="hljs-number"><span class="hljs-number">97.</span></span><span class="hljs-number"><span class="hljs-number">.122</span></span>) + (<span class="hljs-number"><span class="hljs-number">48.</span></span><span class="hljs-number"><span class="hljs-number">.57</span></span>) + <span class="hljs-number"><span class="hljs-number">45</span></span> + <span class="hljs-number"><span class="hljs-number">46</span></span> + <span class="hljs-number"><span class="hljs-number">95</span></span> + <span class="hljs-number"><span class="hljs-number">126</span></span> |Get-Random -Count <span class="hljs-number"><span class="hljs-number">60</span></span>| % {[<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>]$_}) $hasher = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> System.Security.Cryptography.SHA256Managed $hashByteArray = $hasher.ComputeHash([System.Text.Encoding]::UTF8.GetBytes($codeverifier)) $base64 = ((([System.Convert]::ToBase64String($hashByteArray)).replace(<span class="hljs-string"><span class="hljs-string">'='</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>)).replace(<span class="hljs-string"><span class="hljs-string">'+'</span></span>,<span class="hljs-string"><span class="hljs-string">'-'</span></span>)).replace(<span class="hljs-string"><span class="hljs-string">'/'</span></span>,<span class="hljs-string"><span class="hljs-string">'_'</span></span>) $ports = @(<span class="hljs-number"><span class="hljs-number">10600</span></span>,<span class="hljs-number"><span class="hljs-number">15084</span></span>,<span class="hljs-number"><span class="hljs-number">39700</span></span>,<span class="hljs-number"><span class="hljs-number">42847</span></span>,<span class="hljs-number"><span class="hljs-number">65387</span></span>,<span class="hljs-number"><span class="hljs-number">32079</span></span>) $port = $ports[(<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-random -Minimum <span class="hljs-number"><span class="hljs-number">0</span></span> -maximum <span class="hljs-number"><span class="hljs-number">5</span></span>)] Write-Host <span class="hljs-string"><span class="hljs-string">"Start browser..."</span></span> Start-Process <span class="hljs-string"><span class="hljs-string">"https://accounts.google.com/o/oauth2/v2/auth?code_challenge_method=S256&amp;code_challenge=$base64&amp;access_type=offline&amp;client_id=$client_id&amp;redirect_uri=http://localhost:$port&amp;response_type=code&amp;scope=https://www.googleapis.com/auth/admin.directory.user https://www.googleapis.com/auth/admin.directory.group"</span></span> $listener = New-Object System.Net.HttpListener $listener.Prefixes.Add(<span class="hljs-string"><span class="hljs-string">"http://localhost:"</span></span>+$port+<span class="hljs-string"><span class="hljs-string">'/'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {$listener.Start()} <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-string"><span class="hljs-string">"Unable to start listener."</span></span> exit <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (($code -eq $<span class="hljs-literal"><span class="hljs-literal">null</span></span>)) { $context = $listener.GetContext() Write-Host <span class="hljs-string"><span class="hljs-string">"Connection accepted"</span></span> -f <span class="hljs-string"><span class="hljs-string">'mag'</span></span> $url = $context.Request.RawUrl $code = $url.split(<span class="hljs-string"><span class="hljs-string">'?'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-string"><span class="hljs-string">'='</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($url.split(<span class="hljs-string"><span class="hljs-string">'?'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-string"><span class="hljs-string">'='</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] -eq <span class="hljs-string"><span class="hljs-string">'error'</span></span>) { Write-Host <span class="hljs-string"><span class="hljs-string">"Error!"</span></span>$code -f <span class="hljs-string"><span class="hljs-string">'red'</span></span> $buffer = [System.Text.Encoding]::UTF8.GetBytes(<span class="hljs-string"><span class="hljs-string">"Error!"</span></span>+$code) $context.Response.ContentLength64 = $buffer.Length $context.Response.OutputStream.Write($buffer, <span class="hljs-number"><span class="hljs-number">0</span></span>, $buffer.Length) $context.Response.OutputStream.Close() $listener.Stop() exit <span class="hljs-number"><span class="hljs-number">1</span></span> } $buffer = [System.Text.Encoding]::UTF8.GetBytes(<span class="hljs-string"><span class="hljs-string">"Now you can close this browser tab."</span></span>) $context.Response.ContentLength64 = $buffer.Length $context.Response.OutputStream.Write($buffer, <span class="hljs-number"><span class="hljs-number">0</span></span>, $buffer.Length) $context.Response.OutputStream.Close() $listener.Stop() } Return Invoke-RestMethod -Method Post -Uri <span class="hljs-string"><span class="hljs-string">"https://www.googleapis.com/oauth2/v4/token"</span></span> -Body @{ code = $code client_id = $client_id client_secret = $client_secret redirect_uri = <span class="hljs-string"><span class="hljs-string">'http://localhost:'</span></span>+$port grant_type = <span class="hljs-string"><span class="hljs-string">'authorization_code'</span></span> code_verifier = $codeverifier } $code = $<span class="hljs-literal"><span class="hljs-literal">null</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We set the Client ID and Client Secret obtained in the OAuth client identifier properties, and the code verifier is a string from 43 to 128 characters in length, which should be randomly generated from non-reserved characters: [AZ] / [az] / [0-9 ] / "-" / "."  / "_" / "~". 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Further this code will be retransmitted.  It eliminates the vulnerability in which an attacker could intercept a response that returned a redirect after user authorization. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You can send the code verifier in the current request in the clear (which makes it pointless - this is suitable only for systems that do not support SHA256), or by creating a hash using the SHA256 algorithm, which must be encoded in BASE64Url (differs from Base64 in two characters of the table) and delete the character line endings: =. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, we need to start listening to http on the local machine to get a response after authorization, which will return as a redirect. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Administrative tasks are performed on a special server, we cannot exclude the possibility that several administrators will run the script at the same time, so he will randomly select a port for the current user, but I specified predefined ports, because  they must also be added as trusted in the API console. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>access_type = offline</i> means that the application can update the expired token independently without user interaction with the browser, 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>response_type = code</i> sets the format for how the code will return (referring to the old authorization method when the user copied the code from the browser to the script), 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>scope</i> indicates the <i>scope</i> and type of access.  They must be separated by spaces or% 20 (according to URL Encoding).  A list of access areas with types can be seen here: <a href="https://developers.google.com/identity/protocols/googlescopes">OAuth 2.0 Scopes for Google APIs</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After receiving the authorization code, the application will return a closing message to the browser, stop listening to the port and send a POST request to receive the token.  We indicate in it the previously set id and secret from the console API, the address to which the user will be redirected, and grant_type in accordance with the protocol specification. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In response, we will get an Access token, its duration in seconds and a Refresh token, with which we can update the Access token. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The application should store the tokens in a safe place with a long shelf life, so until we revoke the access received, the refresh token will not be returned to the application.  At the end, I added a request to revoke the token, if the application was not completed successfully and the refresh token did not return, it will start the procedure again (we considered it unsafe to store tokens locally on the terminal, but we don‚Äôt want to complicate cryptography or often open the browser). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { $token_result = Get-GoogleAuthToken $token = $token_result.<span class="hljs-function"><span class="hljs-function">access_token </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$token_result.refresh_token -eq $</span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { Write-Host (<span class="hljs-string"><span class="hljs-string">"Session is not destroyed. Revoking token..."</span></span>) Invoke-WebRequest -Uri (<span class="hljs-string"><span class="hljs-string">"https://accounts.google.com/o/oauth2/revoke?token="</span></span>+$token) } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($token_result.refresh_token -eq $<span class="hljs-literal"><span class="hljs-literal">null</span></span>) $refresh_token = $token_result.refresh_token $minute = ([<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>](<span class="hljs-string"><span class="hljs-string">"{0:mm}"</span></span> -f ([timespan]::fromseconds($token_result.expires_in))))+((Get-date).Minute)<span class="hljs-number"><span class="hljs-number">-2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($minute -lt <span class="hljs-number"><span class="hljs-number">0</span></span>) {$minute += <span class="hljs-number"><span class="hljs-number">60</span></span>} elseif ($minute -gt <span class="hljs-number"><span class="hljs-number">59</span></span>) {$minute -=<span class="hljs-number"><span class="hljs-number">60</span></span>} $token_expire = @{ hour = ([<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>](<span class="hljs-string"><span class="hljs-string">"{0:hh}"</span></span> -f ([timespan]::fromseconds($token_result.expires_in))))+((Get-date).Hour) minute = $minute }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you may have noticed, when invoking a token, Invoke-WebRequest is used.  Unlike Invoke-RestMethod, it does not return the received data in a convenient format for use and shows the status of the request. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, the script will ask you to enter the first and last name of the user, generating a username + email. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  <font color="#5D8DDF">Inquiries</font> </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The following will be the requests - first of all, it is necessary to check whether the user already exists with such a login to get a decision on forming a new one or turning on the current one. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I decided to implement all the requests in the format of a single function with a selection using switch: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs">function GoogleQuery { param ( $type, $query ) <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($type) { <span class="hljs-string"><span class="hljs-string">"SearchAccount"</span></span> { Return Invoke-RestMethod -Method Get -Uri <span class="hljs-string"><span class="hljs-string">"https://www.googleapis.com/admin/directory/v1/users"</span></span> -Headers @{Authorization = <span class="hljs-string"><span class="hljs-string">"Bearer "</span></span>+(Get-GoogleToken)} -Body @{ domain = <span class="hljs-string"><span class="hljs-string">'rocketguys.com'</span></span> query = <span class="hljs-string"><span class="hljs-string">"email:$query"</span></span> } } <span class="hljs-string"><span class="hljs-string">"UpdateAccount"</span></span> { $body = @{ name = @{ givenName = $query[<span class="hljs-string"><span class="hljs-string">'givenName'</span></span>] familyName = $query[<span class="hljs-string"><span class="hljs-string">'familyName'</span></span>] } suspended = <span class="hljs-string"><span class="hljs-string">'false'</span></span> password = $query[<span class="hljs-string"><span class="hljs-string">'password'</span></span>] changePasswordAtNextLogin = <span class="hljs-string"><span class="hljs-string">'true'</span></span> phones = @(@{ primary = <span class="hljs-string"><span class="hljs-string">'true'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = $query[<span class="hljs-string"><span class="hljs-string">'phone'</span></span>] type = <span class="hljs-string"><span class="hljs-string">"mobile"</span></span> }) orgUnitPath = $query[<span class="hljs-string"><span class="hljs-string">'orgunit'</span></span>] } Return Invoke-RestMethod -Method Put -Uri (<span class="hljs-string"><span class="hljs-string">"https://www.googleapis.com/admin/directory/v1/users/"</span></span>+$query[<span class="hljs-string"><span class="hljs-string">'email'</span></span>]) -Headers @{Authorization = <span class="hljs-string"><span class="hljs-string">"Bearer "</span></span>+(Get-GoogleToken)} -Body (ConvertTo-Json $body) -ContentType <span class="hljs-string"><span class="hljs-string">'application/json; charset=utf-8'</span></span> } <span class="hljs-string"><span class="hljs-string">"CreateAccount"</span></span> { $body = @{ primaryEmail = $query[<span class="hljs-string"><span class="hljs-string">'email'</span></span>] name = @{ givenName = $query[<span class="hljs-string"><span class="hljs-string">'givenName'</span></span>] familyName = $query[<span class="hljs-string"><span class="hljs-string">'familyName'</span></span>] } suspended = <span class="hljs-string"><span class="hljs-string">'false'</span></span> password = $query[<span class="hljs-string"><span class="hljs-string">'password'</span></span>] changePasswordAtNextLogin = <span class="hljs-string"><span class="hljs-string">'true'</span></span> phones = @(@{ primary = <span class="hljs-string"><span class="hljs-string">'true'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = $query[<span class="hljs-string"><span class="hljs-string">'phone'</span></span>] type = <span class="hljs-string"><span class="hljs-string">"mobile"</span></span> }) orgUnitPath = $query[<span class="hljs-string"><span class="hljs-string">'orgunit'</span></span>] } Return Invoke-RestMethod -Method Post -Uri <span class="hljs-string"><span class="hljs-string">"https://www.googleapis.com/admin/directory/v1/users"</span></span> -Headers @{Authorization = <span class="hljs-string"><span class="hljs-string">"Bearer "</span></span>+(Get-GoogleToken)} -Body (ConvertTo-Json $body) -ContentType <span class="hljs-string"><span class="hljs-string">'application/json; charset=utf-8'</span></span> } <span class="hljs-string"><span class="hljs-string">"AddMember"</span></span> { $body = @{ userKey = $query[<span class="hljs-string"><span class="hljs-string">'email'</span></span>] } $ifrequest = Invoke-RestMethod -Method Get -Uri <span class="hljs-string"><span class="hljs-string">"https://www.googleapis.com/admin/directory/v1/groups"</span></span> -Headers @{Authorization = <span class="hljs-string"><span class="hljs-string">"Bearer "</span></span>+(Get-GoogleToken)} -Body $body $array = @() <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $ifrequest.groups) {$array += $<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>.email} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($array -notcontains $query[<span class="hljs-string"><span class="hljs-string">'groupkey'</span></span>]) { $body = @{ email = $query[<span class="hljs-string"><span class="hljs-string">'email'</span></span>] role = <span class="hljs-string"><span class="hljs-string">"MEMBER"</span></span> } Return Invoke-RestMethod -Method Post -Uri (<span class="hljs-string"><span class="hljs-string">"https://www.googleapis.com/admin/directory/v1/groups/"</span></span>+$query[<span class="hljs-string"><span class="hljs-string">'groupkey'</span></span>]+<span class="hljs-string"><span class="hljs-string">"/members"</span></span>) -Headers @{Authorization = <span class="hljs-string"><span class="hljs-string">"Bearer "</span></span>+(Get-GoogleToken)} -Body (ConvertTo-Json $body) -ContentType <span class="hljs-string"><span class="hljs-string">'application/json; charset=utf-8'</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Return ($query[<span class="hljs-string"><span class="hljs-string">'email'</span></span>]+<span class="hljs-string"><span class="hljs-string">" now is a member of "</span></span>+$query[<span class="hljs-string"><span class="hljs-string">'groupkey'</span></span>]) } } } }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In each request, you need to send an Authorization header containing the type of token and the Access token itself.  At the moment, the type of token is always Bearer.  Because  we need to check that the token is not expired and update it after an hour from the moment it was issued, I indicated a request for another function that returns an Access token.  The same piece of code is at the beginning of the script when receiving the first Access token: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs">function Get-GoogleToken { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((Get-date).Hour -gt $token_expire.hour) -or (((Get-date).Hour -ge $token_expire.hour) -and ((Get-date).Minute -gt $token_expire.minute))) { Write-Host <span class="hljs-string"><span class="hljs-string">"Token Expired. Refreshing..."</span></span> $request = (Invoke-RestMethod -Method Post -Uri <span class="hljs-string"><span class="hljs-string">"https://www.googleapis.com/oauth2/v4/token"</span></span> -ContentType <span class="hljs-string"><span class="hljs-string">'application/x-www-form-urlencoded'</span></span> -Body @{ client_id = $client_id client_secret = $client_secret refresh_token = $refresh_token grant_type = <span class="hljs-string"><span class="hljs-string">'refresh_token'</span></span> }) $token = $request.access_token $minute = ([<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>](<span class="hljs-string"><span class="hljs-string">"{0:mm}"</span></span> -f ([timespan]::fromseconds($request.expires_in))))+((Get-date).Minute)<span class="hljs-number"><span class="hljs-number">-2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($minute -lt <span class="hljs-number"><span class="hljs-number">0</span></span>) {$minute += <span class="hljs-number"><span class="hljs-number">60</span></span>} elseif ($minute -gt <span class="hljs-number"><span class="hljs-number">59</span></span>) {$minute -=<span class="hljs-number"><span class="hljs-number">60</span></span>} $script:token_expire = @{ hour = ([<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>](<span class="hljs-string"><span class="hljs-string">"{0:hh}"</span></span> -f ([timespan]::fromseconds($request.expires_in))))+((Get-date).Hour) minute = $minute } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $token }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Checking the login for existence: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs">function Check_Google { $query = (GoogleQuery <span class="hljs-string"><span class="hljs-string">'SearchAccount'</span></span> $username) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($query.users -ne $<span class="hljs-literal"><span class="hljs-literal">null</span></span>) { $user = $query.users[<span class="hljs-number"><span class="hljs-number">0</span></span>] Write-Host $user.name.fullName<span class="hljs-string"><span class="hljs-string">' - '</span></span>$user.PrimaryEmail<span class="hljs-string"><span class="hljs-string">' - suspended: '</span></span>$user.Suspended $GAresult = $user } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($GAresult) { $<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = $GAresult } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {$<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = <span class="hljs-string"><span class="hljs-string">'gg'</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Email request: $ query will ask the API to search for a user with this email, including aliases will be found.  You can also use wildcard: <i>=,:,: {PREFIX} *</i> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To obtain data, the GET request method is used, to insert data (create an account or add a member to a group) - POST, to update existing data - PUT, to delete an entry (for example, a participant from a group) - DELETE. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The script will also ask for a phone number (an invalid string) and to include it in a regional distribution group.  It decides which organizational unit the user should have based on the selected Active Directory OU and will come up with a password: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { $phone = Read-Host <span class="hljs-string"><span class="hljs-string">"   +7"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (-not $phone) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { $moscow = Read-Host <span class="hljs-string"><span class="hljs-string">"  ? (y/n) "</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (-not (($moscow -eq <span class="hljs-string"><span class="hljs-string">'y'</span></span>) -or ($moscow -eq <span class="hljs-string"><span class="hljs-string">'n'</span></span>))) $orgunit = <span class="hljs-string"><span class="hljs-string">'/'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($OU -like <span class="hljs-string"><span class="hljs-string">"*OU=Delivery,OU=Users,OU=ROOT,DC=rocket,DC=local"</span></span>) { Write-host <span class="hljs-string"><span class="hljs-string">"   /Team delivery"</span></span> $orgunit = <span class="hljs-string"><span class="hljs-string">"/Team delivery"</span></span> } $Password = -<span class="hljs-keyword"><span class="hljs-keyword">join</span></span> ( <span class="hljs-number"><span class="hljs-number">48.</span></span><span class="hljs-number"><span class="hljs-number">.57</span></span> + <span class="hljs-number"><span class="hljs-number">65.</span></span><span class="hljs-number"><span class="hljs-number">.90</span></span> + <span class="hljs-number"><span class="hljs-number">97.</span></span><span class="hljs-number"><span class="hljs-number">.122</span></span> | Get-Random -Count <span class="hljs-number"><span class="hljs-number">12</span></span> | % {[<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>]$_})+<span class="hljs-string"><span class="hljs-string">"*Ba"</span></span></code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And then begins to manipulate the account: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs">$query = @{ email = $email givenName = $firstname familyName = $lastname password = $password phone = $phone orgunit = $orgunit } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($GMailExist) { Write-Host <span class="hljs-string"><span class="hljs-string">"  "</span></span> -<span class="hljs-function"><span class="hljs-function">f </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mag</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GoogleQuery </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'UpdateAccount'</span></span></span></span><span class="hljs-function"><span class="hljs-params"> $query</span></span></span><span class="hljs-function">) | fl write-host "      $Username  Google." } else</span></span> { Write-Host <span class="hljs-string"><span class="hljs-string">"  "</span></span> -<span class="hljs-function"><span class="hljs-function">f </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mag</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GoogleQuery </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'CreateAccount'</span></span></span></span><span class="hljs-function"><span class="hljs-params"> $query</span></span></span><span class="hljs-function">) | fl } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$moscow -eq </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"y"</span></span></span></span></span><span class="hljs-function">)</span></span>{ write-host <span class="hljs-string"><span class="hljs-string">"   moscowoffice"</span></span> $query = @{ groupkey = <span class="hljs-string"><span class="hljs-string">'moscowoffice@rocketguys.com'</span></span> email = $email } (GoogleQuery <span class="hljs-string"><span class="hljs-string">'AddMember'</span></span> $query) | fl }</code>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
     </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The functions of updating and creating an account have the same syntax, not all additional fields are required, in the section with phone numbers you need to specify an array that can contain from one record with a number and its type. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order not to get an error when adding a user to a group, we can first check whether he is already in this group by receiving a list of group members or composition from the user himself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>A request for the composition of groups of a specific user will not be recursive and will show only direct membership.</b>  The inclusion of the user in the parent group, in which the child group of which the user is a member, already exists, will be successful. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  <font color="#5D8DDF">Conclusion</font> </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It remains to send the user the password for the new account.  We do this through SMS, and send general information with instructions and login to personal mail, which, along with the phone number, was provided by the personnel selection department.  As an alternative, you can save money and send a password to a secret telegram chat, which can also be considered the second factor (macbooks will be an exception). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thank you for reading to the end.  I will be glad to see suggestions for improving the writing style of articles and I wish you to catch fewer mistakes when writing scripts =) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      List of links that can be thematically useful or just answer your questions: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="https://developers.google.com/identity/protocols/OAuth2InstalledApp">OAuth 2.0 for Mobile &amp; Desktop Apps</a> </li><li>  <a href="https://developers.google.com/identity/protocols/OAuth2WebServer">Using OAuth 2.0 for Web Server Applications</a> </li><li>  <a href="https://tools.ietf.org/html/rfc7636">Proof Key for Code Exchange by OAuth Public Clients</a> </li><li>  <a href="https://devblogs.microsoft.com/scripting/generate-random-letters-with-powershell/">Generate Random Letters with PowerShell</a> </li><li>  <a href="http://www.asciitable.com/">ASCII Table and Description</a> </li><li>  <a href="https://blogs.msdn.microsoft.com/luc/2011/01/21/powershell-getting-the-hash-value-for-a-string/">PowerShell: Getting the hash value for a string</a> </li><li>  <a href="https://communary.net/2015/04/05/encodedecode-base64url/">Encode / Decode Base64Url</a> </li><li>  <a href="http://websecurityinfo.blogspot.com/2017/06/base64-encoding-vs-base64url-encoding.html">Base64 encoding vs Base64url encoding</a> </li><li>  <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-restmethod%3Fview%3Dpowershell-5.1">Invoke-RestMethod in PowerShell 5.1</a> </li><li>  <a href="https://github.com/googleapis/google-api-python-client/issues/213">Not getting refresh token even though access_type is offline in step1</a> </li><li>  <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_comparison_operators%3Fview%3Dpowershell-6">About Comparison Operators</a> </li><li>  <a href="https://developers.google.com/admin-sdk/directory/v1/guides/manage-users">Directory API: User Accounts</a> </li><li>  <a href="https://developers.google.com/admin-sdk/directory/v1/guides/search-users">Search for users</a> </li><li>  <a href="https://developers.google.com/admin-sdk/directory/v1/guides/manage-groups">Directory API: Groups</a> </li><li>  <a href="https://stackoverflow.com/questions/29613572/error-handling-for-invoke-restmethod-powershell">Error Handling for Invoke-RestMethod - Powershell</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../468957/index.html">Cyclic dungeon generation on the example of Unexplored</a></li>
<li><a href="../468959/index.html">Dependency management in multi-module project on hail</a></li>
<li><a href="../468961/index.html">How to get rid of the routine in life for $ 560? Or how to live, not live</a></li>
<li><a href="../468963/index.html">Backup, part at the request of readers: UrBackup overview, BackupPC, AMANDA</a></li>
<li><a href="../468967/index.html">"Technology" of obtaining dynamic equations of TAU. And why is System Identification is sucks, and "honest physics" rules</a></li>
<li><a href="../468971/index.html">Writing in Java for Nintendo DS</a></li>
<li><a href="../468973/index.html">Neural network for classifying satellite images using Tensorflow in Python</a></li>
<li><a href="../468989/index.html">UEBA Market Dies - Long Live UEBA</a></li>
<li><a href="../468991/index.html">Modular sprite characters and their animation</a></li>
<li><a href="../468993/index.html">Oculus Quest connects to a PC and sees hands</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter70218013 = new Ya.Metrika({
                  id:70218013,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/70218013" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'G-FEDBM7F51Q', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Clever Geek | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <div class="company-info js-company-info" itemscope="" itemtype="http://schema.org/Organization">
      <span itemprop="name">Western Town Media (WTM)</span>
      <div itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
        <span itemprop="streetAddress">1968 Stoney Lonesome Road</span>
        <br>
        <span itemprop="postalCode">PA 18640</span>
        <span itemprop="addressLocality">Pittston, USA</span>
      </div>
      <span itemprop="telephone">570-362-1316</span>
    </div>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Pittston, USA",
          "postalCode": "PA 18640",
          "streetAddress": "1968 Stoney Lonesome Road"
        },
        "name": "Western Town Media (WTM)",
        "telephone": "570-362-1316"
      }
    </script>
  </div>
</footer>
  
</body>

</html>